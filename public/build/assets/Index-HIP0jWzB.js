import{r,j as e,L}from"./app-CQngmq00.js";import{A as E}from"./app-layout-C76KB2Lm.js";import{S as U}from"./layout-DfjdbQgR.js";import{H as O}from"./heading-small-xTyNxbYL.js";import{B as n}from"./button-Cw9tQIeO.js";import{S as P}from"./index-uG0LJcWd.js";import{D as A,a as B,e as F,b as _}from"./dialog-D-tH9FDm.js";import{T as W,a as H,b as w,c as N}from"./tabs-DJOYkXMD.js";import{t as l}from"./index-Vwkg4oTI.js";import{S as I}from"./signature-CMYTxh5x.js";import{c as M}from"./createLucideIcon-pjYyoixj.js";import{T as R}from"./trash-2-BOv4JxAD.js";import"./index-CDDLQrUy.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./input-izsDzGd9.js";import"./index-BSk2xfhC.js";import"./index-DRp-GX9j.js";import"./index-BZgaE142.js";import"./x-B3RMhnUQ.js";import"./tooltip-BvePKNvs.js";import"./floating-ui.react-dom-DL84dtXf.js";import"./separator-CMC4qrzs.js";import"./index-ahz1tZ6M.js";import"./chevron-right-QGs8lTP5.js";import"./dropdown-menu-BQlfF7jf.js";import"./index-CgLqTVh4.js";import"./index-VBHUZLOo.js";import"./index-BfMlnZ5P.js";import"./index-Csh4Fj4k.js";import"./check-BEGkAg7k.js";import"./avatar-DUph8BC-.js";import"./settings-CDLWUJwV.js";import"./users-DZ67WViD.js";import"./graduation-cap-DHFIPOzN.js";import"./file-text-Buh9X5tE.js";import"./dollar-sign-CkMbILE9.js";import"./send-BvMnN6yE.js";import"./credit-card-Cid_txJ6.js";import"./badge-BsPMjMb7.js";import"./circle-check-big-PSYRp90q.js";import"./info-BJ9Jpdwx.js";import"./sun-5m6UvoyG.js";import"./typeof-QjJsDpFa.js";import"./index-BGXDct6C.js";import"./index-Chjiymov.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],y=M("CloudUpload",q),G=[{title:"E‑Signatures",href:"/settings/signatures"}];function We(){const[g,b]=r.useState([]),[o,c]=r.useState(!1),[x,m]=r.useState(!1),[f,S]=r.useState("draw"),[$,d]=r.useState(!1),a=r.useRef(null);async function u(){d(!0);const t=await fetch("/api/signatures");t.ok&&b(await t.json()),d(!1)}r.useEffect(()=>{u()},[]);async function h(t){var i;if(!((i=t.target.files)!=null&&i[0]))return;c(!0);const s=new FormData;s.append("image",t.target.files[0]);const p=await fetch("/api/signatures",{method:"POST",body:s});c(!1),p.ok?(l.success("Signature uploaded!"),u()):l.error("Failed to upload signature.")}async function C(){var v;if(!a.current)return;const t=a.current.getCanvas(),s=t.toDataURL("image/png"),p=t.width,i=t.height,T="Drawn Signature",D=(v=document.querySelector('meta[name="csrf-token"]'))==null?void 0:v.content;c(!0);const z=await fetch("/api/signatures",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":D||""},body:JSON.stringify({image_base64:s,label:T,natural_width:p,natural_height:i})});c(!1),z.ok?(m(!1),a.current.clear(),l.success("Signature created!"),u()):l.error("Failed to save signature.")}async function k(t){d(!0);const s=await fetch(`/api/signatures/${t}/activate`,{method:"PATCH"});d(!1),s.ok?(l.success("Signature activated!"),u()):l.error("Failed to activate signature.")}function j(){if(a.current){const t=a.current.getCanvas(),s=t.getContext("2d");if(s){const i=t.height-80;s.save(),s.strokeStyle="#d1d5db",s.lineWidth=1,s.beginPath(),s.moveTo(40,i),s.lineTo(t.width-40,i),s.stroke(),s.restore()}}}return r.useEffect(()=>{x&&a.current&&(a.current.clear(),j())},[x]),e.jsxs(E,{breadcrumbs:G,children:[e.jsx(L,{title:"E‑Signatures"}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(O,{title:"E‑Signatures",description:"Upload or draw your signature image."}),e.jsxs("div",{children:[e.jsx(n,{size:"sm",onClick:()=>m(!0),children:"Draw Signature"}),o&&e.jsx("span",{className:"ml-2 text-sm",children:"Uploading..."})]})]}),e.jsx("p",{className:"font-medium",children:"Active Signature"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[g.map(t=>e.jsxs("div",{className:`border rounded p-3 flex flex-col items-center gap-2 bg-white ${t.active?"ring-2 ring-green-500":""}`,children:[e.jsx("img",{src:`/storage/${t.image_path}`,className:"max-h-24 object-contain"}),e.jsx(n,{size:"sm",variant:t.active?"secondary":"default",onClick:()=>k(t.id),children:t.active?"Active":"Set Active"})]},t.id)),!g.length&&e.jsx("p",{className:"text-sm col-span-full",children:"No signatures."})]}),e.jsx(A,{open:x,onOpenChange:m,children:e.jsxs(B,{className:"max-w-4xl w-full p-0",children:[e.jsxs("div",{className:"p-8 flex flex-col gap-6",children:[e.jsx(F,{children:e.jsx(_,{className:"text-xl font-semibold mb-2",children:"Create Your Signature"})}),e.jsxs(W,{value:f,onValueChange:t=>S(t),className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(H,{className:"flex gap-2",children:[e.jsxs(w,{value:"draw",className:"px-4 py-1 text-sm flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"})," Draw"]}),e.jsxs(w,{value:"upload",className:"px-4 py-1 text-sm flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"})," Upload"]})]}),f==="draw"&&e.jsxs(n,{size:"sm",variant:"secondary",className:"ml-4",onClick:()=>{var t;(t=a.current)==null||t.clear(),j()},children:[e.jsx(R,{className:"w-4 h-4 inline"}),"Clear"]})]}),e.jsxs("div",{className:"w-full mt-4",children:[e.jsx(N,{value:"draw",className:"w-full flex flex-col justify-center items-center",children:e.jsx("div",{className:"w-full flex flex-col gap-2 items-center",children:e.jsx("div",{className:"flex justify-center w-full",children:e.jsx(P,{ref:a,penColor:"black",backgroundColor:"rgba(0,0,0,0)",minWidth:2,maxWidth:4,velocityFilterWeight:.7,canvasProps:{width:690,height:300,className:"border border-zinc-300 rounded bg-zinc-100 shadow-lg mx-auto",style:{cursor:"crosshair"}}})})})}),e.jsxs(N,{value:"upload",className:"w-full flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"w-full h-[180px] border-2 border-dashed border-neutral-300 rounded flex flex-col items-center justify-center bg-neutral-50 cursor-pointer transition hover:border-primary",onDrop:t=>{var s;t.preventDefault(),(s=t.dataTransfer.files)!=null&&s[0]&&h({target:{files:t.dataTransfer.files}})},onDragOver:t=>t.preventDefault(),children:[e.jsx(y,{className:"w-8 h-8 mb-2 text-neutral-400"}),e.jsx("span",{className:"text-sm text-neutral-500 mb-2",children:"Drag & drop PNG here, or click to select"}),e.jsx("input",{id:"signature-upload",type:"file",accept:"image/png",onChange:h,className:"hidden"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{var t;return(t=document.getElementById("signature-upload"))==null?void 0:t.click()},children:"Browse"})]}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Upload transparent PNG (max 1MB)."})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between w-full mt-4",children:[e.jsx("span",{className:"text-xs text-neutral-600",children:"I understand this is a legal representation of my signature."}),e.jsxs("div",{className:"flex gap-2",children:[f==="draw"&&e.jsx(n,{size:"sm",onClick:C,disabled:o,children:o?"Saving...":"Save Signature"}),e.jsx(n,{size:"sm",variant:"secondary",onClick:()=>m(!1),children:"Cancel"})]})]})]}),o&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center z-50 rounded-lg",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("span",{className:"text-sm text-primary",children:"Saving signature..."})]})})]})})]})})]})}export{We as default};
