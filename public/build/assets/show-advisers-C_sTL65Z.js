import{r,a as g,j as e}from"./app-BAKMM9W6.js";import{T as Y,a as $,b as A,c as C,d as J,e as j}from"./table-B43wWAfS.js";import{B as x}from"./button-CVeIta7K.js";import{I as K}from"./input-BRk-fvKd.js";import{D as O,d as E,a as F,e as P,b as U,c as V,f as I}from"./dialog-Fyk91gvx.js";import{S as y}from"./skeleton-tKFykgei.js";import{A as X,a as Z}from"./avatar-BvAeIlgK.js";import{P as ee,a as se,b as re}from"./popover-PrBd-iYP.js";import{C as ae,a as te,b as ie,c as ne,d as oe}from"./command-4azl6iTd.js";import{U as le}from"./users-t5r6UxGv.js";import{L as B}from"./loader-circle-Ci098EBy.js";import{U as H}from"./user-plus-w31WTm09.js";import{S as de}from"./search-DuDncY0P.js";import{T as ce,C as me}from"./trash-D_3nkKOw.js";import{C as xe}from"./check-DCZqiU_u.js";import"./utils-jAU0Cazi.js";import"./index-CEqJL0NP.js";import"./index-DZZQifJx.js";import"./index-Chzm2fti.js";import"./index-CUQ5MhIm.js";import"./index-DScCZkqp.js";import"./x-BVoq4DiS.js";import"./createLucideIcon-BSNBS9Xz.js";import"./index-DUmeJSti.js";import"./index-BHprz6Pm.js";import"./floating-ui.react-dom-CqLEll0E.js";import"./index-CEy3VqYv.js";function ue(a){var t,c,i,n;const l=((c=(t=a.first_name)==null?void 0:t.trim())==null?void 0:c[0])??"",u=((n=(i=a.last_name)==null?void 0:i.trim())==null?void 0:n[0])??"";return(l+u).toUpperCase()||"U"}function Qe(){const[a,l]=r.useState([]),[u,t]=r.useState(!1),[c,i]=r.useState(!0),[n,Q]=r.useState(""),[h,b]=r.useState(""),[R,p]=r.useState([]),[L,z]=r.useState(!1),[d,S]=r.useState(null),[q,v]=r.useState(!1),[m,w]=r.useState(null),[D,_]=r.useState(!1),[G,o]=r.useState(!1),f=r.useRef(null);r.useEffect(()=>{g.get("/api/coordinator/advisers").then(s=>l(s.data)).finally(()=>i(!1))},[]),r.useEffect(()=>{if(f.current&&clearTimeout(f.current),h.length<2){p([]),o(!1);return}return z(!0),o(!0),f.current=setTimeout(()=>{g.get("/api/coordinator/advisers/search",{params:{query:h}}).then(s=>{p(s.data),o(s.data.length>0)}).finally(()=>z(!1))},300),()=>{f.current&&clearTimeout(f.current)}},[h]);const k=a.filter(s=>s.first_name.toLowerCase().includes(n.toLowerCase())||s.last_name.toLowerCase().includes(n.toLowerCase())||s.email.toLowerCase().includes(n.toLowerCase())||s.program.toLowerCase().includes(n.toLowerCase())),M=async()=>{var s,N;if(d){_(!0);try{await g.post("/api/coordinator/advisers",{adviser_id:d.id});const T=await g.get("/api/coordinator/advisers");l(T.data),t(!1),b(""),S(null),p([]),o(!1)}catch(T){alert(((N=(s=T.response)==null?void 0:s.data)==null?void 0:N.error)||"Failed to register adviser")}finally{_(!1)}}},W=async()=>{m&&(await g.delete(`/api/coordinator/advisers/${m.id}`),l(a.filter(s=>s.id!==m.id)),v(!1),w(null))};return c?e.jsxs("div",{className:"w-full min-h-[70vh] bg-zinc-100 flex flex-col gap-4 p-0 m-0",children:[e.jsx(y,{className:"h-6 w-1/6 rounded bg-zinc-300 mt-8 mx-8"}),e.jsx(y,{className:"h-12 w-3/4 rounded bg-zinc-300 mx-8"}),e.jsx(y,{className:"h-12 w-2/3 rounded bg-zinc-300 mx-8"}),e.jsx(y,{className:"h-[400px] w-full rounded bg-zinc-300 mt-4"})]}):e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-auto rounded-xl pt-5 pr-7 pl-7 relative bg-white",children:[e.jsxs("div",{className:"w-full border border-border rounded-lg overflow-hidden mb-1 bg-white",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between w-full p-3 border-b bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-blue-500/10 border border-blue-500",children:e.jsx(le,{className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"My Advisers"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"This page lists all advisers under your coordination. You can add, search, and manage advisers here."})]})]}),e.jsxs(O,{open:u,onOpenChange:s=>{t(s),s||(b(""),S(null),p([]),o(!1))},children:[e.jsx(E,{asChild:!0,children:e.jsx(x,{className:"h-8 px-4 py-1 text-sm",children:"Register an Adviser"})}),e.jsxs(F,{children:[e.jsxs(P,{children:[e.jsx(U,{children:"Register an Adviser"}),e.jsx(V,{children:"Search and select an adviser to register to your program."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(ee,{open:G,onOpenChange:o,children:[e.jsx(se,{asChild:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search Adviser"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Type name or email (min 2 characters)...",value:h,onChange:s=>b(s.target.value),onFocus:()=>{h.length>=2&&R.length>0&&o(!0)},className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"}),L&&e.jsx(B,{className:"absolute right-3 top-2.5 h-4 w-4 animate-spin text-muted-foreground"})]})]})}),e.jsx(re,{className:"w-[400px] p-0",align:"start",children:e.jsx(ae,{children:e.jsxs(te,{children:[e.jsx(ie,{children:L?"Searching...":"No advisers found."}),e.jsx(ne,{children:R.map(s=>e.jsxs(oe,{value:s.name||s.email,onSelect:()=>{S(s),b(s.name||""),p([]),o(!1)},className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.email," â€¢ ",s.program]})]})]},s.id))})]})})})]}),d&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/50 p-3 space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Selected Adviser:"}),e.jsx("div",{className:"text-sm",children:d.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:d.email}),e.jsx("div",{className:"text-xs text-muted-foreground",children:d.program})]})]}),e.jsx(I,{className:"mt-4",children:e.jsx(x,{onClick:M,disabled:!d||D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Registering..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Register Adviser"]})})})]})]})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between w-full p-3 border-t bg-white",children:[e.jsx(K,{type:"text",startIcon:de,placeholder:"Search...",value:n,onChange:s=>Q(s.target.value),className:"max-w-xs text-sm py-1 h-8"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-sm whitespace-nowrap",children:"Shareable Coordinator Code:"}),e.jsx(he,{})]})]})]}),e.jsx("div",{className:"rounded-md overflow-x-auto w-full max-w-full border border-border bg-white",children:e.jsxs(Y,{children:[e.jsx($,{children:e.jsxs(A,{children:[e.jsx(C,{children:"Name"}),e.jsx(C,{children:"Email"}),e.jsx(C,{children:"Program"}),e.jsx(C,{children:"Actions"})]})}),e.jsx(J,{children:k.length===0?e.jsx(A,{children:e.jsx(j,{colSpan:4,className:"py-8 text-center text-sm text-muted-foreground",children:"No advisers found."})}):k.map(s=>e.jsxs(A,{children:[e.jsxs(j,{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-8 w-8",children:e.jsx(Z,{children:ue(s)})}),e.jsxs("span",{children:[s.first_name," ",s.middle_name?s.middle_name[0]+".":""," ",s.last_name]})]}),e.jsx(j,{children:s.email}),e.jsx(j,{children:s.program}),e.jsx(j,{children:e.jsxs(O,{open:q&&(m==null?void 0:m.id)===s.id,onOpenChange:N=>{N||(v(!1),w(null))},children:[e.jsx(E,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon","aria-label":"Remove adviser",onClick:()=>{w(s),v(!0)},children:e.jsx(ce,{size:18})})}),e.jsxs(F,{children:[e.jsx(P,{children:e.jsx(U,{children:"Remove Adviser"})}),e.jsxs("div",{className:"py-2",children:["Are you sure you want to remove ",e.jsxs("b",{children:[s.first_name," ",s.last_name]})," from your coordination?"]}),e.jsxs(I,{children:[e.jsx(x,{variant:"outline",onClick:()=>{v(!1),w(null)},className:"mr-2 bg-white text-zinc-900 border-zinc-300",children:"Cancel"}),e.jsx(x,{onClick:W,className:"bg-rose-500 hover:bg-rose-600 text-white border-none",children:"Confirm"})]})]})]})})]},s.id))})]})})]})}function he(){const[a,l]=r.useState(""),[u,t]=r.useState(!1);r.useEffect(()=>{fetch("/api/coordinator/code").then(i=>i.json()).then(i=>l(i.coordinator_code))},[]);const c=()=>{navigator.clipboard.writeText(a),t(!0),setTimeout(()=>t(!1),1500)};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a,readOnly:!0,className:"border rounded px-3 py-1 font-mono w-[120px] text-base bg-transparent",style:{minWidth:"100px"}}),e.jsx(x,{variant:"outline",size:"icon",onClick:c,disabled:!a,className:"border-gray-300 h-8 w-8","aria-label":"Copy coordinator code",children:u?e.jsx(xe,{size:16}):e.jsx(me,{size:16})})]})}export{he as CoordinatorCodeBox,Qe as default};
