import{r as l,j as e}from"./app-BubHmeqC.js";import{D as G,a as _,e as E,b as V,c as I}from"./dialog-ywfV6j7b.js";import{B as O}from"./button-CX84Ig4W.js";import{I as P}from"./input-y4wBi6jo.js";import{S as q,a as B,b as U,c as A,e as H}from"./select-wHGTrFCR.js";import{t as m}from"./index-Bqixm_LI.js";function L({open:i,onOpenChange:y,defenseRequest:o,trigger:N,asPage:c=!1,onGenerated:u}){const[v,D]=l.useState([]),[n,w]=l.useState(null),[f,k]=l.useState([]),[h,x]=l.useState({}),[p,j]=l.useState(!1),[d,g]=l.useState(null);l.useEffect(()=>{(i||c)&&fetch("/api/document-templates").then(t=>t.json()).then(D)},[i,c]),l.useEffect(()=>{n&&fetch(`/api/document-templates/${n}`).then(t=>t.json()).then(t=>{k(t.fields||[]);const a={};(t.fields||[]).forEach(s=>{a[s.key]=T(s.key,o)}),x(a)})},[n,o]);function T(t,a){const s=t.split(".");let r=a;for(const S of s)if(r&&typeof r=="object"&&S in r)r=r[S];else return"";return typeof r=="string"?r:""}async function F(){var t;j(!0),g(null);try{const s=await(await fetch("/api/generate-document",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""},body:JSON.stringify({template_id:n,defense_request_id:o.id,fields:h})})).json();s.ok&&s.download_url?(g(s.download_url),m.success("Document generated!"),u&&u(s.download_url)):m.error(s.error||"Failed to generate document")}catch{m.error("Network error")}finally{j(!1)}}function C(){return d?e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Preview:"}),e.jsx("iframe",{src:d,title:"Generated PDF",style:{width:"100%",height:"500px",border:"1px solid #ccc"}}),e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-block text-blue-600 underline",children:"Download PDF"})]}):null}const b=e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Select Template"}),e.jsxs(q,{value:n?String(n):"",onValueChange:t=>w(Number(t)),children:[e.jsx(B,{className:"w-full",children:e.jsx(U,{placeholder:"Choose a template"})}),e.jsx(A,{children:v.map(t=>e.jsx(H,{value:String(t.id),children:t.name},t.id))})]})]}),f.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Field Values"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:f.map(t=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:t.label||t.key}),e.jsx(P,{value:h[t.key]||"",onChange:a=>x(s=>({...s,[t.key]:a.target.value})),className:"w-full"})]},t.key))})]}),e.jsx(O,{onClick:F,disabled:!n||p,className:"w-full",children:p?"Generating...":"Generate Document"}),e.jsx(C,{})]});return c?e.jsxs("div",{className:"max-w-xl mx-auto py-10",children:[e.jsx("h1",{className:"text-xl font-bold mb-4",children:"Generate Document"}),b]}):e.jsxs(G,{open:i,onOpenChange:y,children:[N,e.jsxs(_,{className:"max-w-xl",children:[e.jsxs(E,{children:[e.jsx(V,{children:"Generate Document"}),e.jsx(I,{children:"Select a template and generate a document for this defense request."})]}),b]})]})}export{L as D};
