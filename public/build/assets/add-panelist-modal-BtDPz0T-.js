import{r as p,j as e}from"./app-DW0Mt5c9.js";import{D as B,a as H,e as V,b as U,c as $,f as J}from"./dialog-D7L72BhV.js";import{B as A}from"./button-BZf0VdIO.js";import{I as j}from"./input-Ch6RmxP_.js";import{L as m}from"./label-Dk8neUpq.js";import{S as F,a as k,b as T,c as R,e as x}from"./select-cV-UjAs3.js";import{A as L,b as O}from"./alert-Dap4gtF9.js";import{C as h}from"./circle-alert-CV2dla6l.js";import{L as X}from"./loader-circle-EY4lXEgZ.js";import{C as z}from"./circle-check-C1QAq6HU.js";import"./index-BMNAwHVU.js";import"./index-DHu7YzAG.js";import"./index-RzYQM1sh.js";import"./index-Bh88FqJG.js";import"./utils-jAU0Cazi.js";import"./x-CW6T59GI.js";import"./createLucideIcon-S0dKkUVo.js";import"./index-DZZQifJx.js";import"./index-dxfJWdT_.js";import"./index-I9YLalqX.js";import"./index-Au_TdUcj.js";import"./index-xrb8sl6P.js";import"./floating-ui.react-dom-DEJ-U2zP.js";import"./index-D1ThX8Vn.js";import"./chevron-down-B7XKdsxY.js";import"./check-C1Ca0PY3.js";const S={pfirst_name:"",pmiddle_name:"",plast_name:"",role:"Member",defense_type:"Proposal",received_date:""};function _e({show:v,onClose:N,onAddPanelist:q,programId:_}){const[a,w]=p.useState(S),[r,u]=p.useState({}),[i,b]=p.useState(!1),[y,n]=p.useState(null);p.useEffect(()=>{v||(w(S),u({}),b(!1),n(null))},[v]);const I=()=>{const s={};if(a.pfirst_name.trim()||(s.pfirst_name="First name is required"),a.plast_name.trim()||(s.plast_name="Last name is required"),!a.received_date)s.received_date="Received date is required";else{const o=new Date(a.received_date),c=new Date;o.setHours(0,0,0,0),c.setHours(0,0,0,0),o>c&&(s.received_date="Received date cannot be in the future")}return u(s),Object.keys(s).length===0},d=(s,o)=>{w(c=>({...c,[s]:o})),r[s]&&u(c=>{const t={...c};return delete t[s],t}),y&&n(null)},K=async(s,o,c)=>{var t;return await fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},body:JSON.stringify(o),signal:c})},D=async()=>{if(n(null),!I())return;if(!_){n("Program ID is missing. Cannot add panelist.");return}b(!0);const s=`/programs/${_}/panelists`;console.log("Posting panelist to:",s,"programId:",_);const o=new AbortController,c=setTimeout(()=>o.abort(),15e3);try{const t=await K(s,a,o.signal);if(o.signal.aborted)throw new Error("Request aborted (timeout).");if(t.ok){const g=await t.json();q(g.panelist),w(S),N();return}const M=t.headers.get("content-type")||"";let l=null;try{l=M.includes("application/json")?await t.json():{text:await t.text()}}catch{l={text:"Unable to parse response body"}}if(t.status===422&&l.errors){const g={};for(const E of Object.keys(l.errors)){const C=l.errors[E];g[E]=Array.isArray(C)?C.join(" "):String(C)}u(g),n("Please fix the validation errors.")}else t.status===419?n("CSRF token mismatch or session expired."):t.status===404?n("Endpoint not found (404). Check backend route."):n((l==null?void 0:l.message)||(l==null?void 0:l.text)||`Server returned status ${t.status}`)}catch(t){t.name==="AbortError"?n("Request timed out. The server did not respond within 15 seconds."):n(t.message||"An unknown error occurred.")}finally{clearTimeout(c),b(!1)}},f=s=>{s.key==="Enter"&&!P&&!i&&(s.preventDefault(),D())},P=!a.pfirst_name||!a.plast_name||!a.received_date||i;return e.jsx(B,{open:v,onOpenChange:i?void 0:N,children:e.jsxs(H,{className:"max-w-3xl min-w-100 w-full overflow-auto max-h-[90vh]",children:[e.jsxs(V,{children:[e.jsx(U,{className:"text-xl",children:"Add New Panelist"}),e.jsx($,{children:"Fill in the details below to add a new panelist to the system."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[y&&e.jsxs(L,{variant:"destructive",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(O,{children:y})]}),Object.keys(r).length>0&&e.jsxs(L,{variant:"destructive",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(O,{children:"Please fix the errors below before submitting."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(m,{htmlFor:"pfirst_name",className:"text-right",children:["First Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"col-span-3 flex flex-col gap-1",children:[e.jsx(j,{id:"pfirst_name",value:a.pfirst_name,onChange:s=>d("pfirst_name",s.target.value),className:r.pfirst_name?"border-destructive":"",placeholder:"Enter first name",onKeyDown:f,disabled:i}),r.pfirst_name&&e.jsxs("p",{className:"text-destructive text-xs flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"})," ",r.pfirst_name]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{htmlFor:"pmiddle_name",className:"text-right",children:"Middle Name"}),e.jsx("div",{className:"col-span-3 flex flex-col gap-1",children:e.jsx(j,{id:"pmiddle_name",value:a.pmiddle_name,onChange:s=>d("pmiddle_name",s.target.value),className:r.pmiddle_name||r.pmiddle_name?"border-destructive":"",placeholder:"Enter middle name (optional)",onKeyDown:f,disabled:i})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(m,{htmlFor:"plast_name",className:"text-right",children:["Last Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"col-span-3 flex flex-col gap-1",children:[e.jsx(j,{id:"plast_name",value:a.plast_name,onChange:s=>d("plast_name",s.target.value),className:r.plast_name?"border-destructive":"",placeholder:"Enter last name",onKeyDown:f,disabled:i}),r.plast_name&&e.jsxs("p",{className:"text-destructive text-xs flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"})," ",r.plast_name]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{className:"text-right",children:"Role"}),e.jsxs(F,{value:a.role,onValueChange:s=>d("role",s),disabled:i,children:[e.jsx(k,{className:"col-span-3",children:e.jsx(T,{placeholder:"Select a role"})}),e.jsxs(R,{children:[e.jsx(x,{value:"Chair",children:"Chair"}),e.jsx(x,{value:"Member",children:"Member"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(m,{className:"text-right",children:"Defense Type"}),e.jsxs(F,{value:a.defense_type,onValueChange:s=>d("defense_type",s),disabled:i,children:[e.jsx(k,{className:"col-span-3",children:e.jsx(T,{placeholder:"Select a defense type"})}),e.jsxs(R,{children:[e.jsx(x,{value:"Proposal",children:"Proposal"}),e.jsx(x,{value:"Pre-final",children:"Pre-final"}),e.jsx(x,{value:"Final",children:"Final"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(m,{htmlFor:"received_date",className:"text-right",children:["Received Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"col-span-3 flex flex-col gap-1",children:[e.jsx(j,{id:"received_date",type:"date",value:a.received_date,onChange:s=>d("received_date",s.target.value),className:r.received_date?"border-destructive":"",onKeyDown:f,disabled:i}),r.received_date&&e.jsxs("p",{className:"text-destructive text-xs flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"})," ",r.received_date]})]})]})]}),e.jsxs(J,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(A,{onClick:N,variant:"outline",className:"w-full sm:w-auto",disabled:i,children:"Cancel"}),e.jsx(A,{onClick:D,disabled:P,className:"w-full sm:w-auto",children:i?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4"})," Save Panelist"]})})]})]})})}export{_e as default};
