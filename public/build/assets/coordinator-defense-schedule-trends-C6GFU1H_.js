import{r as l,j as e}from"./app-BDkuJsct.js";import{C as u,a as x,b as j,d as p,c as g,e as T}from"./card-BJFJPDio.js";import{C as N,a as E,b as A}from"./chart-7aubccfQ.js";import{S as M,a as q,b as W,c as _,e as C}from"./select-D1tIJaem.js";import{L as $,a as F}from"./LineChart-DP9WQaks.js";import{C as Y}from"./CartesianGrid-CTAPJDM6.js";import{X as K}from"./YAxis-B7UrdJFR.js";import"./utils-jAU0Cazi.js";import"./generateCategoricalChart-BOHwT1p9.js";import"./index-CoS1vLG5.js";import"./index-Chjiymov.js";import"./index-BhbofC_p.js";import"./index-DMsjTEK4.js";import"./index-BdhkuEJx.js";import"./index-BKBXBDOv.js";import"./index-LRezjsDo.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./index-Dia2ik6c.js";import"./index-D-bfryUZ.js";import"./chevron-down-DMxaecxw.js";import"./createLucideIcon-CEmaZ7tj.js";import"./check-BUlQxyEc.js";const O={defenses:{label:"Defenses",color:"#e11d48"}};function de(){const[y,w]=l.useState([]),[S,D]=l.useState(!0),[b,k]=l.useState(0),[f,v]=l.useState(0),[i,L]=l.useState("month");return l.useEffect(()=>{fetch("/defense-requests",{headers:{Accept:"application/json"}}).then(o=>{if(!o.ok)throw new Error("Failed to fetch");return o.json()}).then(o=>{const h=(Array.isArray(o)?o:o.defenseRequests??[]).filter(t=>t.scheduled_date!==null);k(h.length);let n=[];if(i==="week"){const t={},s=new Date,a=new Date(s.getTime()-84*24*60*60*1e3);h.forEach(r=>{const c=new Date(r.scheduled_date);if(c>=a){const m=`W${12-Math.floor((s.getTime()-c.getTime())/6048e5)}`;t[m]=(t[m]||0)+1}}),n=Array.from({length:12},(r,c)=>({label:`W${c+1}`,defenses:t[`W${c+1}`]||0}))}else if(i==="month"){const t={};h.forEach(r=>{const d=new Date(r.scheduled_date).toLocaleDateString("en-US",{month:"short",year:"numeric"});t[d]=(t[d]||0)+1}),n=Object.keys(t).sort((r,c)=>{const d=new Date(r),m=new Date(c);return d.getTime()-m.getTime()}).slice(-6).map(r=>({label:r.split(" ")[0],defenses:t[r]}))}else if(i==="year"){const t={};h.forEach(s=>{const r=new Date(s.scheduled_date).getFullYear().toString();t[r]=(t[r]||0)+1}),n=Object.entries(t).sort(([s],[a])=>s.localeCompare(a)).slice(-5).map(([s,a])=>({label:s,defenses:a}))}if(w(n),n.length>1){const t=n[n.length-1].defenses,s=n[n.length-2].defenses,a=s>0?(t-s)/s*100:0;v(Number(a.toFixed(1)))}}).catch(o=>{console.error("Error fetching defense requests:",o),w([])}).finally(()=>{D(!1)})},[i]),S?e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(j,{children:"Defense Schedule Trends"}),e.jsx(p,{children:"Loading..."})]}),e.jsx(g,{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading chart data..."})})]}):y.length===0?e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(j,{children:"Defense Schedule Trends"}),e.jsx(p,{children:"No data available"})]}),e.jsx(g,{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"No scheduled defense requests found"})})]}):e.jsxs(u,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Defense Schedule Trends"}),e.jsx(p,{children:i==="week"?"Last 12 weeks":i==="month"?"Last 6 months":"Last 5 years"})]}),e.jsxs(M,{value:i,onValueChange:L,children:[e.jsx(q,{className:"w-[120px] h-8 text-xs",children:e.jsx(W,{})}),e.jsxs(_,{children:[e.jsx(C,{value:"week",children:"Weekly"}),e.jsx(C,{value:"month",children:"Monthly"}),e.jsx(C,{value:"year",children:"Yearly"})]})]})]})}),e.jsx(g,{children:e.jsx(N,{config:O,children:e.jsxs($,{accessibilityLayer:!0,data:y,margin:{left:12,right:12},children:[e.jsx(Y,{vertical:!1}),e.jsx(K,{dataKey:"label",tickLine:!1,axisLine:!1,tickMargin:8}),e.jsx(E,{cursor:!1,content:e.jsx(A,{hideLabel:!0})}),e.jsx(F,{dataKey:"defenses",type:"monotone",stroke:"var(--color-defenses)",strokeWidth:2,dot:{fill:"var(--color-defenses)",r:4},activeDot:{r:6}})]})})}),e.jsx(T,{className:"flex-col items-start gap-2 text-sm",children:e.jsxs("div",{className:"flex gap-2 font-medium leading-none",children:["Total of ",b," scheduled defenses ",f>=0?`(+${f}%)`:`(${f}%)`]})})]})}export{de as CoordinatorDefenseScheduleTrends};
