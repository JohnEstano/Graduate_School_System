import{r as a,j as e,a as A}from"./app-OOvd0qGy.js";import{T as ee,a as se,b as B,c as D,d as te,e as y}from"./table-CmM6ti-o.js";import{B as p}from"./button-Bvl2ELDv.js";import{I as Z}from"./input-CzcDJDbH.js";import{D as H,d as P,a as Q,e as K,b as X,c as $,f as M}from"./dialog-DgFd6e46.js";import{S as O}from"./skeleton-bTWQssEl.js";import{A as I,a as U}from"./avatar-DboJvblb.js";import{L as ae}from"./loader-circle-CMHK7v9W.js";import{S as V}from"./search-BBppaIz6.js";import{U as re}from"./users-EStqJIUY.js";import{T as ne,C as ie}from"./trash-D6d7rvqG.js";import{C as de}from"./check-CihXD7iu.js";import"./utils-jAU0Cazi.js";import"./index-ChOW5_O6.js";import"./index-DZZQifJx.js";import"./index-B2wwfcIF.js";import"./index-DQ9rqnvl.js";import"./index-4w5oLsoB.js";import"./x-DrNmi13E.js";import"./createLucideIcon-Cvkj7Hkp.js";import"./index-kQq3evoo.js";import"./index-B9sjBiRz.js";const W=A.create();W.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var J;W.defaults.headers.common["X-CSRF-TOKEN"]=((J=document.querySelector('meta[name="csrf-token"]'))==null?void 0:J.getAttribute("content"))||"";function le({onSelect:l,placeholder:f="Search students by name, email, or ID...",className:b="",disabled:c=!1,value:d,onChange:h}){const[o,N]=a.useState(d||""),[r,j]=a.useState([]),[R,v]=a.useState(!1),[k,m]=a.useState(!1),[x,u]=a.useState(-1),S=a.useRef(null),g=a.useRef(null),i=d!==void 0?d:o,z=h||N;a.useEffect(()=>{d!==void 0&&N(d)},[d]),a.useEffect(()=>{const n=setTimeout(async()=>{if(i.length<2){j([]),m(!1);return}v(!0);try{const s=await W.get("/api/students/search",{params:{q:i}});j(s.data),m(!0),u(-1)}catch(s){console.error("Failed to search students:",s),j([])}finally{v(!1)}},300);return()=>clearTimeout(n)},[i]);const L=t=>{const n=t.target.value;z(n),d||N(n)},E=t=>{l(t),m(!1),u(-1)},q=t=>{if(!(!k||r.length===0))switch(t.key){case"ArrowDown":t.preventDefault(),u(n=>n<r.length-1?n+1:0);break;case"ArrowUp":t.preventDefault(),u(n=>n>0?n-1:r.length-1);break;case"Enter":t.preventDefault(),x>=0&&x<r.length&&E(r[x]);break;case"Escape":m(!1),u(-1);break}},F=t=>{var w,C,_,T;const n=((C=(w=t.first_name)==null?void 0:w.trim())==null?void 0:C[0])??"",s=((T=(_=t.last_name)==null?void 0:_.trim())==null?void 0:T[0])??"";return(n+s).toUpperCase()||"U"};return a.useEffect(()=>{const t=n=>{g.current&&!g.current.contains(n.target)&&S.current&&!S.current.contains(n.target)&&(m(!1),u(-1))};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),e.jsxs("div",{className:`relative ${b}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{ref:S,type:"text",placeholder:f,value:i,onChange:L,onKeyDown:q,onFocus:()=>i.length>=2&&r.length>0&&m(!0),disabled:c,className:"pr-8"}),e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:R?e.jsx(ae,{className:"h-4 w-4 animate-spin text-gray-400"}):e.jsx(V,{className:"h-4 w-4 text-gray-400"})})]}),k&&r.length>0&&e.jsx("div",{ref:g,className:"absolute z-[9999] w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto dark:bg-zinc-800 dark:border-zinc-700",children:r.map((t,n)=>e.jsxs("div",{className:`px-3 py-2 cursor-pointer flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-zinc-700 ${n===x?"bg-gray-50 dark:bg-zinc-700":""}`,onClick:()=>E(t),children:[e.jsx(I,{className:"h-8 w-8",children:e.jsx(U,{className:"text-xs",children:F(t)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate dark:text-white",children:t.display_name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:[t.email," • ",t.school_id]}),t.program&&e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 truncate",children:t.program})]})]},t.id))}),k&&!R&&r.length===0&&i.length>=2&&e.jsx("div",{ref:g,className:"absolute z-[9999] w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg p-3 dark:bg-zinc-800 dark:border-zinc-700",children:e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:['No students found for "',i,'"']})})]})}function ce(){const[l,f]=a.useState(""),[b,c]=a.useState(!1);a.useEffect(()=>{fetch("/api/adviser/code").then(h=>h.json()).then(h=>f(h.adviser_code))},[]);const d=()=>{navigator.clipboard.writeText(l),c(!0),setTimeout(()=>c(!1),1500)};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:l,readOnly:!0,className:"border rounded px-3 py-1 font-mono w-[120px] text-base bg-transparent",style:{minWidth:"100px"}}),e.jsx(p,{variant:"outline",size:"icon",onClick:d,disabled:!l,className:"border-gray-300 h-8 w-8","aria-label":"Copy adviser code",children:b?e.jsx(de,{size:16}):e.jsx(ie,{size:16})})]})}function G(l){var c,d,h,o;const f=((d=(c=l.first_name)==null?void 0:c.trim())==null?void 0:d[0])??"",b=((o=(h=l.last_name)==null?void 0:h.trim())==null?void 0:o[0])??"";return(f+b).toUpperCase()||"U"}function Re(){var t,n;const[l,f]=a.useState([]),[b,c]=a.useState(!1),[d,h]=a.useState(!0),[o,N]=a.useState(""),[r,j]=a.useState(null),[R,v]=a.useState(""),[k,m]=a.useState(!1),[x,u]=a.useState(null),[S,g]=a.useState(!1),[i,z]=a.useState(null);a.useEffect(()=>{A.get("/api/adviser/students").then(s=>f(s.data)).finally(()=>h(!1))},[]);const L=l.filter(s=>{var w,C,_,T,Y;return((w=s.student_number)==null?void 0:w.toLowerCase().includes(o.toLowerCase()))||((C=s.first_name)==null?void 0:C.toLowerCase().includes(o.toLowerCase()))||((_=s.last_name)==null?void 0:_.toLowerCase().includes(o.toLowerCase()))||((T=s.email)==null?void 0:T.toLowerCase().includes(o.toLowerCase()))||((Y=s.program)==null?void 0:Y.toLowerCase().includes(o.toLowerCase()))}),E=()=>{r&&(z(r),g(!0))},q=async()=>{if(i)try{await A.post("/api/adviser/students",{student_id:i.id});const s=await A.get("/api/adviser/students");f(s.data),c(!1),j(null),v(""),g(!1),z(null)}catch(s){console.error("Failed to register student:",s),g(!1)}},F=async()=>{x&&(await A.delete(`/api/adviser/students/${x.id}`),f(l.filter(s=>s.id!==x.id)),m(!1),u(null))};return d?e.jsxs("div",{className:"w-full min-h-[70vh] bg-zinc-100 flex flex-col gap-4 p-0 m-0",children:[e.jsx(O,{className:"h-6 w-1/6 rounded bg-zinc-300 mt-8 mx-8"}),e.jsx(O,{className:"h-12 w-3/4 rounded bg-zinc-300 mx-8"}),e.jsx(O,{className:"h-12 w-2/3 rounded bg-zinc-300 mx-8"}),e.jsx(O,{className:"h-[400px] w-full rounded bg-zinc-300 mt-4"})]}):e.jsxs("div",{className:`flex h-full flex-1 flex-col gap-4 overflow-auto rounded-xl pt-5 pr-7 pl-7 relative
      bg-white dark:bg-zinc-900 transition-colors`,children:[e.jsxs("div",{className:`w-full border border-border rounded-lg overflow-hidden mb-1
        bg-white dark:bg-zinc-800 dark:border-zinc-700`,children:[e.jsxs("div",{className:`flex flex-row items-center justify-between w-full p-3 border-b
          bg-white dark:bg-zinc-800 dark:border-zinc-700`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-rose-500/10 border border-rose-500",children:e.jsx(re,{className:"h-5 w-5 text-rose-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"My Students"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"This page lists all students registered under your advisership. You can add, search, and manage students here."})]})]}),e.jsxs(H,{open:b,onOpenChange:s=>{c(s),s||(j(null),v(""))},children:[e.jsx(P,{asChild:!0,children:e.jsx(p,{className:"h-8 px-4 py-1 text-sm",onClick:()=>c(!0),children:"Register a Student"})}),e.jsxs(Q,{children:[e.jsxs(K,{children:[e.jsx(X,{children:"Register a Student"}),e.jsx($,{children:"Search for a student by name, email, or ID to register them under your supervision."})]}),e.jsxs("div",{className:"flex flex-col gap-3 mt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search and select a student:"}),e.jsx(le,{placeholder:"Type student name, email, or ID (e.g., 'gdiapana')...",onSelect:s=>{j(s),v(s.display_name)},value:R,onChange:v})]}),r&&e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-md border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-10 w-10",children:e.jsx(U,{children:(((t=r.first_name)==null?void 0:t[0])||"")+(((n=r.last_name)==null?void 0:n[0])||"")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:r.display_name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.school_id," • ",r.program]})]})]})})]}),e.jsx(M,{className:"mt-4",children:e.jsx(p,{onClick:E,disabled:!r,children:"Register Student"})})]})]})]}),e.jsxs("div",{className:`flex flex-row items-center justify-between w-full p-3 border-t
          bg-white dark:bg-zinc-800 dark:border-zinc-700`,children:[e.jsx(Z,{type:"text",startIcon:V,placeholder:"Search...",value:o,onChange:s=>N(s.target.value),className:"max-w-xs text-sm py-1 h-8"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-sm whitespace-nowrap",children:"Shareable Adviser Code:"}),e.jsx(ce,{})]})]})]}),e.jsx("div",{className:`rounded-md overflow-x-auto w-full max-w-full border border-border
        bg-white dark:bg-zinc-800 dark:border-zinc-700`,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(B,{children:[e.jsx(D,{className:"dark:text-zinc-300",children:"Name"}),e.jsx(D,{className:"dark:text-zinc-300",children:"Student #"}),e.jsx(D,{className:"dark:text-zinc-300",children:"Email"}),e.jsx(D,{className:"dark:text-zinc-300",children:"Program"}),e.jsx(D,{className:"dark:text-zinc-300",children:"Actions"})]})}),e.jsx(te,{children:L.length===0?e.jsx(B,{children:e.jsx(y,{colSpan:5,className:"py-8 text-center text-sm text-muted-foreground dark:text-zinc-400",children:"No students found."})}):L.map(s=>e.jsxs(B,{className:"dark:hover:bg-zinc-700",children:[e.jsxs(y,{className:"flex items-center gap-3 dark:text-zinc-200",children:[e.jsx(I,{className:"h-8 w-8",children:e.jsx(U,{children:G(s)})}),e.jsxs("span",{children:[s.first_name||""," ",s.middle_name?s.middle_name[0]+".":""," ",s.last_name||""]})]}),e.jsx(y,{className:"dark:text-zinc-200",children:s.student_number||"N/A"}),e.jsx(y,{className:"dark:text-zinc-200",children:s.email||"N/A"}),e.jsx(y,{className:"dark:text-zinc-200",children:s.program||"N/A"}),e.jsx(y,{children:e.jsxs(H,{open:k&&(x==null?void 0:x.id)===s.id,onOpenChange:w=>{w||(m(!1),u(null))},children:[e.jsx(P,{asChild:!0,children:e.jsx(p,{variant:"outline",size:"icon",className:"border-zinc-300 dark:border-zinc-500 dark:text-zinc-300","aria-label":"Remove student",onClick:()=>{u(s),m(!0)},children:e.jsx(ne,{size:18})})}),e.jsxs(Q,{children:[e.jsxs(K,{children:[e.jsx(X,{children:"Remove Student"}),e.jsx($,{children:"This action will remove the student from your advisership. This action cannot be undone."})]}),e.jsxs("div",{className:"py-2 dark:text-zinc-200",children:["Are you sure you want to remove ",e.jsxs("b",{children:[s.first_name," ",s.last_name]})," from your advisership?"]}),e.jsxs(M,{children:[e.jsx(p,{variant:"outline",onClick:()=>{m(!1),u(null)},className:"mr-2 bg-white text-zinc-900 border-zinc-300 dark:bg-zinc-900 dark:text-zinc-100 dark:border-zinc-600",children:"Cancel"}),e.jsx(p,{onClick:F,className:"bg-rose-500 hover:bg-rose-600 text-white border-none dark:bg-rose-500 dark:hover:bg-rose-600 dark:text-white",children:"Confirm"})]})]})]})})]},s.id))})]})}),e.jsx(H,{open:S,onOpenChange:g,children:e.jsxs(Q,{children:[e.jsxs(K,{children:[e.jsx(X,{children:"Add Student to Advisership"}),e.jsx($,{children:"You are about to add this student to your list of advisees. Once added, you will be able to manage their academic progress and provide guidance."})]}),i&&e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 dark:bg-zinc-800 rounded-lg",children:[e.jsx(I,{className:"h-12 w-12",children:e.jsx(U,{className:"bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300",children:G(i)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i.display_name||"Unknown Student"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.email||"No email"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:[i.program||"N/A"," • ",i.student_number||"N/A"]})]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-3",children:["Are you sure you want to add ",e.jsx("span",{className:"font-medium",children:i.display_name||"this student"})," to your advisership?"]})]}),e.jsxs(M,{children:[e.jsx(p,{variant:"outline",onClick:()=>{g(!1),z(null)},className:"mr-2 bg-white text-zinc-900 border-zinc-300 dark:bg-zinc-900 dark:text-zinc-100 dark:border-zinc-600",children:"Cancel"}),e.jsx(p,{onClick:q,className:"bg-blue-600 hover:bg-blue-700 text-white border-none dark:bg-blue-600 dark:hover:bg-blue-700 dark:text-white",children:"Add Student"})]})]})})]})}export{ce as AdviserCodeBox,Re as default};
