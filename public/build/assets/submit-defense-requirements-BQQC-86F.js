import{K,r as n,m as W,j as e}from"./app-BFhJ_rhz.js";import{L as l}from"./label-1vsVmE7Q.js";import{I as i}from"./input-BIzgsiDe.js";import{B as c}from"./button-CKae6SRa.js";import{S as Q}from"./Stepper-DpP2VZye.js";import{D as k,a as $,b as O,c as z,d as I}from"./dialog-D7W9x4ad.js";import{P as f}from"./paperclip-Dlg1S261.js";import{C as V}from"./check-C9G5qvCx.js";import"./index-BxKqTWPD.js";import"./index-XUnuFccv.js";import"./utils-jAU0Cazi.js";import"./index-DZZQifJx.js";import"./index-B3ixvT_X.js";import"./index-D0wd6wGz.js";import"./x-CnUa_NpO.js";import"./createLucideIcon-KZz7-iiu.js";function pe({onFinish:v,open:N,onOpenChange:m,acceptDefense:E=!0}){var C,D,R,w,F;const{props:p}=K(),r=((C=p==null?void 0:p.auth)==null?void 0:C.user)||{},t=Array.isArray(r.advisers)&&r.advisers.length>0?r.advisers[0]:null,g=n.useRef(null),_=n.useRef(null),y=n.useRef(null),b=n.useRef(null),{data:a,setData:x,post:M,processing:q,reset:A}=W({first_name:r.first_name||"",middle_name:r.middle_name||"",last_name:r.last_name||"",school_id:r.school_id||"",program:r.program||"",thesis_title:"",adviser:t?`${t.first_name} ${t.middle_name?t.middle_name+" ":""}${t.last_name}`:"",adviser_id:t?t.id:null,status:"pending",defense_type:"",rec_endorsement:null,proof_of_payment:null,reference_no:"",manuscript_proposal:null,similarity_index:null}),[X,Z]=n.useState(!1),[d,j]=n.useState(0),[L,P]=n.useState(!1);function u(s){return o=>{var T;if((T=o.target.files)!=null&&T[0]){const h=o.target.files[0],H=200*1024*1024,J=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg"];if(h.size>H){alert(`File size too large. Maximum allowed size is 200MB. Your file is ${(h.size/(1024*1024)).toFixed(2)}MB.`),o.target.value="";return}if(!J.includes(h.type)){alert("File type not allowed. Please upload PDF, Word documents, or images (JPEG, PNG)."),o.target.value="";return}x(s,h)}}}function B(){M(route("defense-requirements.store"),{forceFormData:!0,onSuccess:()=>{P(!0),v&&v()},onError:s=>{if(console.error("Submission failed:",s),s.message&&s.message.includes("POST Content-Length"))alert("File upload failed: Files are too large. Please ensure each file is under 200MB and try again.");else if(s.message&&s.message.includes("PostTooLargeException"))alert("Upload size limit exceeded. Please reduce file sizes and try again.");else{const o=Object.values(s).flat().join(`
`);alert(`Submission failed:
${o}`)}},onProgress:s=>{console.log("Upload progress:",s)}})}function G(){d<S.length-1?j(d+1):B()}function U(){d>0&&j(d-1)}function Y(s){m(s),s||(j(0),A(),P(!1))}const S=[{title:"Personal Information",content:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"First Name"}),e.jsx(i,{value:a.first_name,readOnly:!0,disabled:!0,placeholder:"First Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Middle Name"}),e.jsx(i,{value:a.middle_name,readOnly:!0,disabled:!0,placeholder:"Middle Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Last Name"}),e.jsx(i,{value:a.last_name,readOnly:!0,disabled:!0,placeholder:"Last Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"School ID"}),e.jsx(i,{value:a.school_id,readOnly:!0,disabled:!0,placeholder:"School ID",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Program"}),e.jsx(i,{value:a.program,readOnly:!0,disabled:!0,placeholder:"Program",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Adviser"}),e.jsx(i,{value:t?`${t.first_name} ${t.middle_name?t.middle_name+" ":""}${t.last_name}`:"No adviser registered",readOnly:!0,disabled:!0,placeholder:"Adviser",className:"h-8 text-sm"})]})]})},{title:"Defense Type & Thesis Information",content:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs mb-2 block",children:"Type of Defense"}),e.jsx("div",{className:"flex gap-2 mb-4",children:[{value:"Proposal",label:"Proposal"},{value:"Prefinal",label:"Prefinal"},{value:"Final",label:"Final"}].map(s=>e.jsx("button",{type:"button",onClick:()=>x("defense_type",s.value),className:`rounded-md px-4 py-2 text-xs font-medium cursor-pointer border
                                        ${a.defense_type===s.value?"bg-rose-500 text-white border-rose-500":"bg-white text-zinc-700 border-zinc-200"}`,"aria-pressed":a.defense_type===s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Thesis Title"}),e.jsx(i,{value:a.thesis_title,onChange:s=>x("thesis_title",s.target.value),placeholder:"Thesis Title",className:"h-8 text-sm"})]})]})},{title:"Attachments",content:e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx(l,{className:"text-xs",children:"Reference No."}),e.jsx(i,{value:a.reference_no,onChange:s=>x("reference_no",s.target.value),placeholder:"Reference No.",className:"h-8 text-sm"}),e.jsx(l,{className:"text-xs",children:"REC Endorsement"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.rec_endorsement?a.rec_endorsement.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(c,{variant:"outline",type:"button",onClick:()=>{var s;return(s=y.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(f,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:y,className:"hidden",onChange:u("rec_endorsement")})]}),e.jsx(l,{className:"text-xs",children:"Proof of Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.proof_of_payment?a.proof_of_payment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(c,{variant:"outline",type:"button",onClick:()=>{var s;return(s=b.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(f,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:b,className:"hidden",onChange:u("proof_of_payment")})]}),e.jsx(l,{className:"text-xs",children:"Manuscript for Proposal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.manuscript_proposal?a.manuscript_proposal.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(c,{variant:"outline",type:"button",onClick:()=>{var s;return(s=g.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(f,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:g,className:"hidden",onChange:u("manuscript_proposal")})]}),e.jsx(l,{className:"text-xs",children:"Similarity Index"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.similarity_index?a.similarity_index.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(c,{variant:"outline",type:"button",onClick:()=>{var s;return(s=_.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(f,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:_,className:"hidden",onChange:u("similarity_index")})]})]})},{title:"Review Submission",content:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-lg border border-rose-200 bg-rose-50 p-4 text-sm",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Personal Info"}),e.jsxs("div",{children:["Name: ",`${a.first_name} ${a.middle_name} ${a.last_name}`]}),e.jsxs("div",{children:["School ID: ",a.school_id]}),e.jsxs("div",{children:["Program: ",a.program]}),e.jsxs("div",{children:["Type of Defense: ",a.defense_type]}),e.jsxs("div",{children:["Thesis Title: ",a.thesis_title]}),e.jsxs("div",{children:["Adviser: ",a.adviser]}),e.jsxs("div",{children:["Reference No.: ",a.reference_no]}),e.jsxs("div",{children:["Recommendation Endorsement: ",((D=a.rec_endorsement)==null?void 0:D.name)||"—"]}),e.jsxs("div",{children:["Proof of Payment: ",((R=a.proof_of_payment)==null?void 0:R.name)||"—"]}),e.jsxs("div",{children:["Manuscript Proposal: ",((w=a.manuscript_proposal)==null?void 0:w.name)||"—"]}),e.jsxs("div",{children:["Similarity Index: ",((F=a.similarity_index)==null?void 0:F.name)||"—"]})]})})}];return E?e.jsx(k,{open:N,onOpenChange:Y,children:e.jsxs($,{className:"flex h-[95vh] w-full max-w-3xl flex-col",children:[e.jsxs(O,{children:[e.jsx(z,{children:"Submit Defense Requirements"}),e.jsx(I,{children:"Fill up all necessary information"})]}),L?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center space-y-6 px-4",children:[e.jsx(V,{size:48,className:"text-rose-500"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Requirements Submitted!"}),e.jsx("p",{className:"text-center text-gray-600",children:"Your defense requirements have been saved successfully."}),e.jsx(c,{onClick:()=>m(!1),children:"Done"})]}):e.jsx("div",{className:"flex-1 overflow-auto px-2",children:e.jsx(Q,{steps:S,currentStep:d,onNext:G,onPrev:U,loading:q,className:"h-full"})})]})}):e.jsx(k,{open:N,onOpenChange:m,children:e.jsxs($,{children:[e.jsxs(O,{children:[e.jsx(z,{children:"Defense Requirement Submission Closed"}),e.jsx(I,{children:"The coordinator has disabled defense requirement submissions. Please try again later or contact your coordinator."})]}),e.jsx(c,{onClick:()=>m(!1),children:"Close"})]})})}export{pe as default};
