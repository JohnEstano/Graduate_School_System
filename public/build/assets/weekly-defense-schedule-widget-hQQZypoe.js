import{r as x,j as s}from"./app-OOvd0qGy.js";import{S as W}from"./skeleton-bTWQssEl.js";import{c as f}from"./utils-jAU0Cazi.js";import{C as k}from"./calendar-h4nCOpBr.js";import{C as A}from"./chevron-right-BsU_TN8l.js";import{G as I}from"./graduation-cap-CCWiuwHf.js";import{a as S,f as L}from"./format-HX8DKPSU.js";import{i as v}from"./isSameDay-DUlCFK42.js";import{p as N}from"./parseISO-CbXPh3Al.js";import"./createLucideIcon-Cvkj7Hkp.js";import"./en-US-BA9orzCf.js";const $=["Coordinator","Administrative Assistant","Dean"];function M(l,i){const n=S(i,{weekStartsOn:0});return new Date(n.getFullYear(),n.getMonth(),n.getDate()+l)}function D(l){if(!l)return"";const[i,n]=l.split(":").map(c=>parseInt(c,10)),m=new Date(2020,0,1,i,n,0);return L(m,"h:mm a")}function V(l){const{weekDays:i,selectedDay:n,setSelectedDay:m,approvedDefenses:c,loading:_=!1,referenceDate:p,studentId:u,userRole:z,canManage:C}=l,[b,E]=x.useState([]),[R,y]=x.useState(!1);x.useEffect(()=>{const t=S(p,{weekStartsOn:0}),r=new Date(t);r.setDate(r.getDate()+6);const o=`?from=${encodeURIComponent(t.toISOString())}&to=${encodeURIComponent(r.toISOString())}`;y(!0),fetch("/api/calendar/events"+o).then(e=>e.json()).then(e=>{E(e.filter(a=>a.origin==="event"))}).catch(()=>{}).finally(()=>y(!1))},[p]);const g=M(n,p),w=x.useMemo(()=>{const t=c.filter(e=>e.status==="Approved"&&e.date_of_defense).filter(e=>v(N(e.date_of_defense),g)).map(e=>({id:"def-"+e.id,kind:"defense",title:e.thesis_title||"Defense",start:e.start_time||null,end:e.end_time||null,color:"#059669",raw:e,owner:u&&e.submitted_by===u})),r=b.filter(e=>{const a=N(e.start);return v(a,g)}).map(e=>{const[a,d]=e.start.split(" "),h=e.end?e.end.split(" ")[1]:void 0;return{id:e.id,kind:"event",title:e.title||"Event",start:e.allDay?null:(d==null?void 0:d.slice(0,5))||null,end:e.allDay?null:(h==null?void 0:h.slice(0,5))||null,color:e.color||"#2563eb",raw:e,owner:!1}});return[...t,...r].sort((e,a)=>e.start===a.start?e.title.localeCompare(a.title):e.start===null?-1:a.start===null?1:e.start.localeCompare(a.start))},[c,b,g,u]),j=_||R,O=C||$.includes(z||"");return s.jsxs("div",{className:"w-full md:w-[580px] border rounded-xl p-5 bg-white dark:bg-zinc-900 flex flex-col min-h-[340px]",children:[s.jsxs("a",{href:"/schedules",className:"flex items-center justify-between mb-2 group cursor-pointer select-none",style:{textDecoration:"none"},children:[s.jsx("div",{children:s.jsx("div",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"This Week's Schedules"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-rose-500 p-2",children:s.jsx(k,{className:"size-6 text-white"})}),s.jsx(A,{className:"size-6 text-gray-400 transition-transform transition-colors duration-200 group-hover:text-rose-500 group-hover:translate-x-1"})]})]}),s.jsx("div",{className:"h-2"}),s.jsx("div",{className:"flex flex-nowrap gap-2 mb-3 justify-between",children:i.map(t=>s.jsx("button",{className:f("flex-1 px-2.5 py-1 rounded-full text-xs font-semibold  cursor-pointer whitespace-nowrap text-center",n===t.value?"bg-rose-500 text-white":"bg-gray-100 dark:bg-zinc-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-zinc-700"),onClick:()=>m(t.value),disabled:j,style:{minWidth:0},children:t.label},t.value))}),s.jsx("div",{className:"flex flex-col gap-2",children:j?s.jsx("div",{children:[...Array(4)].map((t,r)=>s.jsx(W,{className:"h-7 w-full mb-2 bg-gray-100 dark:bg-zinc-800"},r))}):w.length===0?s.jsx("div",{className:"flex items-center justify-center h-24",children:s.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"No schedules."})}):w.map(t=>{const r=t.kind==="defense",o=t.start?D(t.start):t.start===null?"All Day":"",e=t.end?D(t.end):"",a=o&&e?`${o} – ${e}`:o,d=r?"Defense":"Event";return s.jsxs("div",{className:f("group flex items-center gap-2 px-2 py-2 rounded border max-w-full text-xs",r?"border-emerald-500/60 bg-emerald-50 dark:bg-emerald-900/20":"border-gray-300 bg-gray-50 dark:border-zinc-700 dark:bg-zinc-800/60"),style:{minWidth:0},title:t.title,children:[r?s.jsx(I,{className:f("flex-shrink-0",t.owner?"text-emerald-600":"text-emerald-500"),size:18}):s.jsx(k,{className:"text-gray-500 dark:text-gray-400 flex-shrink-0",size:18}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-semibold truncate max-w-[200px] text-gray-800 dark:text-gray-200",children:t.title}),s.jsx("span",{className:f("px-1.5 py-[1px] rounded-full text-[9px] font-bold tracking-wide shrink-0",r?"bg-emerald-500 text-white":"bg-gray-400 text-white dark:bg-zinc-600"),children:d}),t.owner&&s.jsx("span",{className:"px-1 py-[1px] rounded-full text-[9px] font-semibold bg-rose-500 text-white shrink-0",children:"You"})]}),a&&s.jsx("div",{className:"text-[10px] text-gray-600 dark:text-gray-400 truncate",children:a}),r&&O&&t.raw.defense_type&&s.jsxs("div",{className:"text-[10px] text-gray-500 dark:text-gray-500 truncate italic",children:[t.raw.defense_type,t.raw.defense_mode?` • ${t.raw.defense_mode}`:""]})]})]},t.id)})})]})}export{V as default};
