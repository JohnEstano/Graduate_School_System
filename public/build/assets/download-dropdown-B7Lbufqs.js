import{r as k,j as f,a as g}from"./app-DW0Mt5c9.js";import{B as E}from"./button-BZf0VdIO.js";import F from"./html2canvas.esm-CBrSDip1.js";import x from"./jspdf.es.min-Bf9V0y7q.js";import{D as R}from"./download-BwN388zE.js";import"./index-RzYQM1sh.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./typeof-QjJsDpFa.js";import"./createLucideIcon-S0dKkUVo.js";function O({record:a,panelists:h,onClick:l}){const[d,c]=k.useState(!1),u=async()=>{var o,p;c(!0);try{let r;try{const i=await g.get(`/api/honorarium/${a.id}/download-pdf`,{responseType:"blob",params:{record_id:a.id,panelists:h.map(t=>t.id)},headers:{Accept:"application/pdf","Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},timeout:15e3});r=new Blob([i.data],{type:"application/pdf"})}catch(i){console.warn("API PDF generation failed, trying fallback route...",i);try{const t=await g.get(`/honorarium-summary/${a.id}/download-pdf`,{responseType:"blob",headers:{Accept:"application/pdf","Content-Type":"application/json","X-CSRF-TOKEN":((p=document.querySelector('meta[name="csrf-token"]'))==null?void 0:p.getAttribute("content"))||""},timeout:15e3});r=new Blob([t.data],{type:"application/pdf"})}catch(t){throw console.warn("Both backend PDF methods failed, falling back to client-side PDF...",t),new Error("Backend methods failed")}}const e=window.URL.createObjectURL(r),n=document.createElement("a");n.href=e,n.download=`honorarium-${a.name||a.id}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(e)}catch(r){console.warn("All backend methods failed, using client-side fallback...",r);try{const e=document.getElementById("honorarium-details");if(!e){alert("PDF Export Error: Content area not found.");return}const i=(await F(e,{scale:2,useCORS:!0,logging:!1})).toDataURL("image/png"),t=new x("p","mm","a4"),b=t.internal.pageSize.getWidth(),y=t.internal.pageSize.getHeight(),s=t.getImageProperties(i),m=Math.min(b/s.width,y/s.height),P=s.width*m,D=s.height*m;t.addImage(i,"PNG",0,0,P,D),t.save(`${a.name}_honorarium.pdf`)}catch(e){console.error("Client-side PDF generation also failed:",e),alert("Failed to generate PDF with all methods. Please try again or contact support.")}}finally{c(!1)}},w=o=>{o.stopPropagation(),l&&l(o),o.defaultPrevented||u()};return f.jsxs(E,{variant:"outline",className:"rounded-md px-3 py-2 h-auto text-xs flex items-center gap-1",disabled:d,onClick:w,children:[f.jsx(R,{size:16}),d?"Generating PDF...":"Download PDF"]})}export{O as default};
