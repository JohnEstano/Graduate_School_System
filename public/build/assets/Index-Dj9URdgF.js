import{K as E,r as i,j as e,L as O}from"./app-cp5Xxmuq.js";import{A}from"./app-layout-FVyShlvS.js";import{B as l}from"./button-HcUz4N3c.js";import D from"./display-applications-BYaXwuZd.js";import S from"./compre-exam-form-JWDgj0Gz.js";import{D as I,a as R,b as M,c as B,d as P,e as q}from"./dialog-BrgoPxJ8.js";import{B as N}from"./badge-CD31ww1M.js";import{G as z}from"./graduation-cap-DiPQsR-i.js";import{c as b}from"./createLucideIcon-fPg6f676.js";import{R as L}from"./refresh-ccw-YXtF6Jlg.js";import{I as T}from"./info-CTXSwM4X.js";import"./index-BiaJJerR.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./input-CozWEoae.js";import"./index-DbUO4osX.js";import"./index-BwY1skv1.js";import"./index-BkV9g7de.js";import"./x-ChVMmgUr.js";import"./tooltip-CP7U2y76.js";import"./floating-ui.react-dom-CclZEsZs.js";import"./separator-DqvAWWgV.js";import"./index-B7grp9yP.js";import"./chevron-right-u5yeAyLv.js";import"./dropdown-menu-gg636D7H.js";import"./index-DGSzJOj5.js";import"./index-w2GBgPnQ.js";import"./index-KWoA_zXX.js";import"./index-DgxNXxEZ.js";import"./avatar-BVnHwuNv.js";import"./settings-BJpfwdNG.js";import"./chevrons-up-down-CUkeUAhf.js";import"./file-text-Brb8dGUd.js";import"./dollar-sign-OqGbvCP2.js";import"./users-Dgf5XU-g.js";import"./credit-card-BumryUWt.js";import"./circle-check-big-D0Jy2-20.js";import"./sun-BdlRNmMn.js";import"./chevron-down-CRKR2eDe.js";import"./book-open-DtRim5tR.js";import"./hourglass-D3ZOeZeu.js";import"./circle-x-DL_-XZRU.js";import"./badge-check-C8c_P0Yu.js";import"./formatDistanceToNow-Bo4ytHt0.js";import"./constructNow-Chb2L4Vx.js";import"./en-US-BA9orzCf.js";import"./getRoundingMethod-Btu-7J5l.js";import"./differenceInCalendarMonths-HUNRrXGm.js";import"./endOfDay-UBg8OSOW.js";import"./endOfMonth-CK_ShA5m.js";import"./format-HX8DKPSU.js";import"./heading-small-kTcc9Ebo.js";import"./label-BLxT7CIS.js";import"./Stepper-C4ck5SmD.js";import"./calendar-BnO3dmDg.js";import"./endOfWeek-QFyZPl43.js";import"./normalizeInterval-CdMCNNY-.js";import"./isSameDay-DUlCFK42.js";import"./isSameMonth-CQd3m9St.js";import"./chevron-left-Lq9k-s81.js";import"./calendar-CPOz5vlg.js";import"./plus-Bna1wD4l.js";import"./check-BKTDNJDu.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]],X=b("CalendarX",G);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],K=b("ShieldAlert",F);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],H=b("ShieldCheck",$),Y=[{title:"Dashboard",href:"/dashboard"},{title:"Comprehensive Exam",href:"/comprehensive-exam"}];function st(){var C;const{props:k}=E(),{application:t}=k,[v,x]=i.useState(!1),[o,h]=i.useState({examOpen:null,gradesComplete:null,documentsComplete:null,noOutstandingBalance:null,loading:!0,error:null}),[w,m]=i.useState(!1);async function j(){var s;h(a=>({...a,loading:!0,error:null}));try{console.log("=== FETCHING ELIGIBILITY ===");const a=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),n=await fetch("/api/comprehensive-exam/eligibility",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":a||""}});if(console.log("API Response Status:",n.status),console.log("API Response OK:",n.ok),!n.ok)throw new Error(`API error: ${n.status}`);const p=await n.json();console.log("=== API RESPONSE DATA ===",p),console.log("Requirements array:",p.requirements),console.log("Data keys:",Object.keys(p));const y=p.requirements||[],d=y.find(f=>f.name==="Complete documents submitted"),u=y.find(f=>f.name==="Complete grades (registrar verified)");console.log("Documents Requirement found:",d),console.log("Grades Requirement found:",u),h({examOpen:!0,gradesComplete:(u==null?void 0:u.completed)??!1,documentsComplete:(d==null?void 0:d.completed)??!1,noOutstandingBalance:!0,loading:!1,error:null})}catch(a){console.error("=== API ERROR ===",a),h({examOpen:null,gradesComplete:null,documentsComplete:null,noOutstandingBalance:null,loading:!1,error:a instanceof Error?a.message:"API call failed"})}}i.useEffect(()=>{j()},[]);const r=i.useMemo(()=>!!(o.examOpen&&o.gradesComplete&&o.documentsComplete&&o.noOutstandingBalance),[o]),g=o.examOpen===!1,c=t?((C=t.final_approval_status)==null?void 0:C.toLowerCase())==="pending":!1,_=i.useMemo(()=>[{label:"Exam window is open",ok:o.examOpen},{label:"Complete grades (registrar verified)",ok:o.gradesComplete},{label:"Complete documents submitted",ok:o.documentsComplete},{label:"No outstanding tuition balance",ok:o.noOutstandingBalance}],[o]);return e.jsxs(A,{breadcrumbs:Y,children:[e.jsx(O,{title:"Comprehensive Exam"}),e.jsx("div",{className:"flex flex-col px-7 pt-5 pb-5 w-full",children:e.jsxs("div",{className:"w-full bg-white border border-zinc-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"flex flex-row items-center justify-between w-full p-3 border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-rose-500/10 border border-rose-500",children:e.jsx(z,{className:"h-5 w-5 text-rose-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"Comprehensive Exam"}),e.jsx("p",{className:"block text-xs text-muted-foreground",children:"Submit and track your comprehensive exam application."}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx(N,{variant:r?"secondary":"outline",className:g?"border-rose-300 text-rose-700 bg-rose-50":r?"border-green-300 text-green-700 bg-green-50":"",children:g?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3.5 w-3.5"}),"Closed"]}):r?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),"Eligible"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3.5 w-3.5"}),"Not eligible"]})}),e.jsxs(l,{size:"sm",variant:"outline",className:"h-7 px-2 text-xs",onClick:j,disabled:o.loading,children:[e.jsx(L,{className:`h-3.5 w-3.5 mr-1 ${o.loading?"animate-spin":""}`}),"Refresh"]}),e.jsxs(l,{size:"sm",variant:"ghost",className:"h-7 px-2 text-xs",onClick:()=>m(!0),children:[e.jsx(T,{className:"h-3.5 w-3.5 mr-1"}),"Details"]})]})]})]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(l,{className:"bg-rose-500 text-sm px-5 rounded-md",onClick:()=>x(!0),disabled:!r||!!t&&c,title:g?"Exam is closed":r?c?"Application pending":"Submit application":"You are not eligible yet",children:"Submit application"}),e.jsx(S,{open:v,onOpenChange:x}),e.jsx("div",{children:t?e.jsx(D,{application:{id:t.application_id,first_name:t.first_name,middle_initial:t.middle_name?t.middle_name[0]:null,last_name:t.last_name,program:t.program,school_year:t.school_year,office_address:t.office_address??null,mobile_no:t.contact_number??null,telephone_no:t.telephone_number??null,email:t.email,status:t.final_approval_status||"Pending",subjects:t.subjects,created_at:t.created_at??null}}):e.jsx("div",{className:"p-6 text-center text-sm text-muted-foreground",children:"No application submitted yet."})})]}),e.jsx(I,{open:w,onOpenChange:m,children:e.jsxs(R,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsx(B,{children:"Comprehensive Exam Eligibility"}),e.jsx(P,{children:"You must meet all the requirements below before you can submit an application."})]}),e.jsx("div",{className:"space-y-2",children:_.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{className:"text-sm",children:s.label}),e.jsx(N,{variant:"outline",className:s.ok===!0?"border-green-300 text-green-700 bg-green-50":s.ok===!1?"border-rose-300 text-rose-700 bg-rose-50":"text-zinc-600",children:s.ok===!0?"OK":s.ok===!1?"Missing":"Unknown"})]},a))}),e.jsxs(q,{className:"mt-2",children:[e.jsx(l,{variant:"outline",onClick:()=>m(!1),children:"Close"}),e.jsx(l,{onClick:()=>{m(!1),r&&!c&&x(!0)},disabled:!r||c,children:"Apply Now"})]})]})})]})})]})}export{st as default};
