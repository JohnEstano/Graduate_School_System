import{r,j as e,K as re,L as le}from"./app-DVscOEu2.js";import{a as R,b as A,U as z,A as ie}from"./app-layout-B3GcPYH9.js";import{B as m}from"./button-Ce0hhOYY.js";import{I as M}from"./input-r876wPDn.js";import{B as L}from"./badge-CoIL-rL9.js";import{D as ne,b as ce,a as oe,c as de,d as me}from"./dialog-Gw886jlU.js";import{S as H,a as J,b as Q,c as Y,e as y}from"./select-ClGRW4po.js";import{c as j}from"./utils-jAU0Cazi.js";import{S as P}from"./search-DGUjJ3eE.js";import{c as N}from"./createLucideIcon-D7oluGz7.js";import{X as xe}from"./x-DOc550yR.js";import{P as he}from"./plus-DzSUvAbQ.js";import{E as pe}from"./ellipsis-vertical-BM-swwjJ.js";import{P as ue}from"./paperclip-BAL1sxRt.js";import{M as je}from"./message-square-XNRLjw0M.js";import"./index-DZo2EVCJ.js";import"./index-Cf9FYmS9.js";import"./index-DMoMDHfQ.js";import"./index-y5_JTaNr.js";import"./index-Bje6bX72.js";import"./Combination-h-yS1RMD.js";import"./floating-ui.react-dom-B8YvmuRi.js";import"./index-BkWARksf.js";import"./tooltip-CF62-_BS.js";import"./separator-D0jXpuQ_.js";import"./chevron-right-BTIB9cEh.js";import"./dropdown-menu-COhy0mIG.js";import"./card-d-byv3Vx.js";import"./index-C2BJiM1j.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]],fe=N("Filter",ge);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],Ne=N("GraduationCap",ye);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],be=N("Phone",ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Se=N("Send",we);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],_e=N("Smile",Ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],Te=N("UserCheck",ke);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],De=N("Video",Me);function Ue({selectedUsers:p,onUserSelect:$,onUserRemove:D,conversationType:U,className:i}){const[o,C]=r.useState(""),[v,u]=r.useState([]),[I,F]=r.useState(!1),[x,b]=r.useState("all"),[_,E]=r.useState(!1);r.useEffect(()=>{const f=setTimeout(async()=>{if(o.trim().length<2){u([]);return}F(!0);try{let d=`/messages/search-users?query=${encodeURIComponent(o)}`;x!=="all"&&(d+=`&role=${encodeURIComponent(x)}`);const T=await(await fetch(d)).json();u(T.users||[])}catch(d){console.error("Failed to search users:",d),u([])}finally{F(!1)}},300);return()=>clearTimeout(f)},[o,x]);const w=t=>t.split(" ").map(f=>f[0]).join("").toUpperCase(),S=t=>{switch(t.toLowerCase()){case"student":return e.jsx(Ne,{className:"h-4 w-4"});case"dean":case"coordinator":case"administrative assistant":return e.jsx(Te,{className:"h-4 w-4"});default:return e.jsx(z,{className:"h-4 w-4"})}},g=t=>{switch(t.toLowerCase()){case"student":return"bg-blue-100 text-blue-800";case"dean":return"bg-purple-100 text-purple-800";case"coordinator":return"bg-green-100 text-green-800";case"administrative assistant":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},h=()=>p.map(t=>v.find(d=>d.id===t)).filter(Boolean);return e.jsxs("div",{className:j("space-y-3",i),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(M,{value:o,onChange:t=>C(t.target.value),placeholder:"Search by name, email, role, school ID, or program...",className:"pl-9"})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>E(!_),className:j(_&&"bg-gray-100"),children:e.jsx(fe,{className:"h-4 w-4"})})]}),_&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-md space-y-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Filter by Role"}),e.jsxs(H,{value:x,onValueChange:b,children:[e.jsx(J,{className:"h-8",children:e.jsx(Q,{})}),e.jsxs(Y,{children:[e.jsx(y,{value:"all",children:"All Roles"}),e.jsx(y,{value:"Student",children:"Students"}),e.jsx(y,{value:"Coordinator",children:"Coordinators"}),e.jsx(y,{value:"Dean",children:"Deans"}),e.jsx(y,{value:"Administrative Assistant",children:"Administrative Assistants"})]})]})]})})]}),p.length>0&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-md",children:[e.jsxs("div",{className:"text-xs font-medium text-blue-700 mb-2",children:["Selected ",U==="private"?"User":"Users"," (",p.length,"):"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h().map(t=>t?e.jsxs("div",{className:"flex items-center space-x-1 bg-white rounded-md px-2 py-1 border",children:[e.jsx(R,{className:"h-5 w-5",children:e.jsx(A,{className:"text-xs",children:w(t.name)})}),e.jsx("span",{className:"text-xs font-medium",children:t.name}),e.jsx("button",{onClick:()=>D(t.id),className:"ml-1 hover:text-red-500 text-gray-400",children:e.jsx(xe,{className:"h-3 w-3"})})]},t.id):null)})]}),e.jsx("div",{className:"border rounded-md max-h-64 overflow-y-auto",children:I?e.jsxs("div",{className:"text-center py-8 text-sm text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),"Searching users..."]}):o.length>=2?v.length===0?e.jsxs("div",{className:"text-center py-8 text-sm text-gray-500",children:[e.jsx(z,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),'No users found matching "',o,'"',x!=="all"&&e.jsxs("div",{className:"mt-1",children:['with role "',x,'"']})]}):e.jsx("div",{className:"divide-y",children:v.map(t=>e.jsxs("div",{className:j("flex items-center space-x-3 p-3 hover:bg-gray-50 cursor-pointer transition-colors",p.includes(t.id)&&"bg-blue-50 hover:bg-blue-100"),onClick:()=>$(t),children:[e.jsx(R,{className:"h-8 w-8",children:e.jsx(A,{className:"text-xs",children:w(t.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),p.includes(t.id)&&e.jsx(L,{variant:"default",className:"text-xs",children:"Selected"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[S(t.role),e.jsx(L,{className:j("text-xs",g(t.role)),children:t.role})]}),t.program&&e.jsx(L,{variant:"outline",className:"text-xs",children:t.program})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.email}),t.school_id&&e.jsxs("p",{className:"text-xs text-gray-400",children:["ID: ",t.school_id]})]}),e.jsx("div",{className:"flex-shrink-0",children:p.includes(t.id)?e.jsx("div",{className:"text-blue-500",children:"✓"}):e.jsx("div",{className:"text-gray-300",children:"+"})})]},t.id))}):e.jsxs("div",{className:"text-center py-8 text-sm text-gray-500",children:[e.jsx(P,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),"Type at least 2 characters to search users",e.jsx("div",{className:"mt-2 text-xs",children:"You can search by name, email, role, school ID, or program"})]})}),o.length===0&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 p-3 rounded-md",children:[e.jsx("strong",{children:"Search Tips:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[e.jsx("li",{children:"• Search by first name, last name, or full name"}),e.jsx("li",{children:"• Use email addresses to find specific users"}),e.jsx("li",{children:"• Filter by role (Student, Coordinator, Dean, etc.)"}),e.jsx("li",{children:"• Search by school ID or academic program"})]})]})]})}const Ie=[{title:"Dashboard",href:"/dashboard"},{title:"Messages",href:"/messages"}];function cs(){var K,X;const{conversations:p,users:$}=re().props,[D,U]=r.useState(p),[i,o]=r.useState(null),[C,v]=r.useState([]),[u,I]=r.useState(""),[F,x]=r.useState(!1),[b,_]=r.useState(""),[E,w]=r.useState(!1),[S,g]=r.useState([]),[h,t]=r.useState("private"),[f,d]=r.useState(""),[k,T]=r.useState(""),O=r.useRef(null),W=()=>{var s;(s=O.current)==null||s.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{W()},[C]);const V=async s=>{x(!0);try{const l=await(await fetch(`/messages/conversations/${s}/messages`)).json();v(l.messages),U(n=>n.map(c=>c.id===s?{...c,unread_count:0}:c))}catch(a){console.error("Failed to load messages:",a)}finally{x(!1)}},B=async()=>{var s;if(!(!u.trim()||!i))try{const l=await(await fetch("/messages/send",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({conversation_id:i.id,content:u,type:"text"})})).json();v(n=>[...n,l.message]),I(""),U(n=>n.map(c=>c.id===i.id?{...c,latest_message:{content:l.message.content,user_name:l.message.user.name,created_at:l.message.created_at,formatted_time:l.message.formatted_time},last_message_at:l.message.created_at}:c).sort((c,ae)=>new Date(ae.last_message_at).getTime()-new Date(c.last_message_at).getTime()))}catch(a){console.error("Failed to send message:",a)}},Z=async()=>{var s;if(!(!k.trim()||S.length===0))try{const l=await(await fetch("/messages/conversations",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({participants:S,message:k,type:h,title:h==="group"?f:null})})).json();if(l.exists){const n=D.find(c=>c.id===l.conversation_id);n&&(o(n),V(n.id))}else window.location.reload();w(!1),g([]),T(""),d("")}catch(a){console.error("Failed to create conversation:",a)}},ee=s=>{g(h==="private"?[s.id]:a=>a.includes(s.id)?a.filter(l=>l!==s.id):[...a,s.id])},se=s=>{g(a=>a.filter(l=>l!==s))},q=D.filter(s=>s.title.toLowerCase().includes(b.toLowerCase())||s.participants.some(a=>a.name.toLowerCase().includes(b.toLowerCase()))),G=s=>s.split(" ").map(a=>a[0]).join("").toUpperCase(),te=(s,a)=>a?s.formatted_date!==a.formatted_date:!0;return e.jsxs(ie,{breadcrumbs:Ie,children:[e.jsx(le,{title:"Messages"}),e.jsx("div",{className:"h-full flex-1 flex-col gap-4 overflow-hidden rounded-xl",children:e.jsxs("div",{className:"flex h-[calc(100vh-8rem)] bg-white rounded-lg shadow-sm border overflow-hidden",children:[e.jsxs("div",{className:"w-80 border-r flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Messages"}),e.jsxs(ne,{open:E,onOpenChange:w,children:[e.jsx(ce,{asChild:!0,children:e.jsx(m,{size:"sm",className:"h-8 w-8 p-0",children:e.jsx(he,{className:"h-4 w-4"})})}),e.jsxs(oe,{className:"sm:max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsx(me,{children:"Start New Conversation"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Type"}),e.jsxs(H,{value:h,onValueChange:s=>t(s),children:[e.jsx(J,{children:e.jsx(Q,{})}),e.jsxs(Y,{children:[e.jsx(y,{value:"private",children:"Private"}),e.jsx(y,{value:"group",children:"Group"})]})]})]}),h==="group"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Group Title"}),e.jsx(M,{value:f,onChange:s=>d(s.target.value),placeholder:"Enter group title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:h==="private"?"Select User":"Select Users"}),e.jsx(Ue,{selectedUsers:S,onUserSelect:ee,onUserRemove:se,conversationType:h})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Initial Message"}),e.jsx(M,{value:k,onChange:s=>T(s.target.value),placeholder:"Type your message..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",onClick:()=>{w(!1),g([]),T(""),d("")},children:"Cancel"}),e.jsx(m,{onClick:Z,disabled:S.length===0||!k.trim(),children:"Start Conversation"})]})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(M,{placeholder:"Search conversations...",value:b,onChange:s=>_(s.target.value),className:"pl-9"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:q.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:b?"No conversations found":"No conversations yet"}):q.map(s=>{var a;return e.jsx("div",{onClick:()=>{o(s),V(s.id)},className:j("p-3 border-b cursor-pointer hover:bg-gray-50 transition-colors",(i==null?void 0:i.id)===s.id&&"bg-blue-50 border-blue-200"),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"h-10 w-10",children:e.jsx(A,{children:s.type==="group"?e.jsx(z,{className:"h-5 w-5"}):G(((a=s.participants[0])==null?void 0:a.name)||"U")})}),s.unread_count>0&&e.jsx(L,{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 text-xs",children:s.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),s.latest_message&&e.jsx("span",{className:"text-xs text-gray-500",children:s.latest_message.formatted_time})]}),s.latest_message&&e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:[s.latest_message.user_name,": ",s.latest_message.content]})]})]})},s.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{className:"h-10 w-10",children:e.jsx(A,{children:i.type==="group"?e.jsx(z,{className:"h-5 w-5"}):G(((K=i.participants[0])==null?void 0:K.name)||"U")})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.title}),e.jsx("p",{className:"text-sm text-gray-500",children:i.type==="group"?`${i.participants.length} members`:(X=i.participants[0])==null?void 0:X.role})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:"ghost",size:"sm",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",children:e.jsx(pe,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[F?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):C.map((s,a)=>{const l=a>0?C[a-1]:null,n=te(s,l);return e.jsxs("div",{children:[n&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-600",children:s.formatted_date})}),e.jsx("div",{className:j("flex",s.is_own?"justify-end":"justify-start"),children:e.jsxs("div",{className:j("max-w-xs lg:max-w-md px-4 py-2 rounded-2xl",s.is_own?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[!s.is_own&&i.type==="group"&&e.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:s.user.name}),e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:j("text-xs mt-1",s.is_own?"text-blue-100":"text-gray-500"),children:s.formatted_time})]})})]},s.id)}),e.jsx("div",{ref:O})]}),e.jsx("div",{className:"p-4 border-t bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:"ghost",size:"sm",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(M,{value:u,onChange:s=>I(s.target.value),placeholder:"Type a message...",onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),B())},className:"pr-10"}),e.jsx(m,{variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-8 w-8 p-0",children:e.jsx(_e,{className:"h-4 w-4"})})]}),e.jsx(m,{onClick:B,disabled:!u.trim(),size:"sm",children:e.jsx(Se,{className:"h-4 w-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(je,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})})]})}export{cs as default};
