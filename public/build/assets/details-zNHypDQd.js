import{j as e,L as ne,S as re,r as j}from"./app-BubHmeqC.js";import{A as ie,C as Ee}from"./app-layout-yLDvQPzP.js";import{d as Te}from"./dayjs.min-BgzfR48W.js";import{T as De,t as S}from"./index-Bqixm_LI.js";import{B as y}from"./button-CX84Ig4W.js";import{I as F}from"./input-y4wBi6jo.js";import{B as le}from"./badge-Dd_ET0uG.js";import{S as R}from"./separator-B1kTuyS6.js";import{C as Fe,a as Re,c as qe,d as $e,e as Le}from"./command-BtB-gsVk.js";import{C as Me}from"./calendar-1djviplC.js";import{S as ze,a as Oe,b as Ue,c as Be,e as oe}from"./select-wHGTrFCR.js";import{P as je,a as ge,b as _e}from"./popover-DbNLJDwL.js";import{D as Ie,a as Ve,b as He,c as We}from"./dialog-ywfV6j7b.js";import{c as Ke}from"./utils-jAU0Cazi.js";import{A as Ye,a as Xe}from"./avatar-DijVPJCE.js";import{T as de,a as Je,b as ce,c as me}from"./tabs-DVolEiAR.js";import{T as Ge,a as Qe,b as ue,c as T,d as Ze,e as D}from"./table-CLIx8tAs.js";import{A as es}from"./arrow-left-DLzhx_b2.js";import{F as q}from"./file-text-B1gFNyH7.js";import{C as B}from"./calendar-B4x-YT-4.js";import{C as ss}from"./circle-check-big-BRigqRsr.js";import{C as fe}from"./circle-x-vhKPM2HU.js";import{C as pe}from"./circle-arrow-left-CTHOH67p.js";import{U as xe}from"./users-wdb3-6X2.js";import{C as I}from"./clock-CyI1Boga.js";import{S as he}from"./signature--oYNZqdI.js";import{S as ts}from"./send-DnHCHsKV.js";import{U as as}from"./user-check-DLoTdIld.js";import{U as ns}from"./user-DRyx2ySC.js";import{C as rs}from"./check-CZ9c_sEg.js";import{f as $}from"./format-HX8DKPSU.js";import"./index-CAAZlwhj.js";import"./index-DZZQifJx.js";import"./index-Bsel9b7o.js";import"./index-PQN_369Y.js";import"./index-DyQT7xcZ.js";import"./x-DS6n0ElR.js";import"./createLucideIcon-Biu-y2hB.js";import"./tooltip-tJz5bvEu.js";import"./floating-ui.react-dom-DwEbxQiH.js";import"./chevron-right-BRo8ahWW.js";import"./dropdown-menu-BExp8GpF.js";import"./index-6aAr3Pmv.js";import"./index-CVQNv_Nf.js";import"./index-1EFpZ92o.js";import"./index-CBu7v5lz.js";import"./index-Zto0mrax.js";import"./settings-Uvo0cGb6.js";import"./graduation-cap-B7M__5Eh.js";import"./dollar-sign-DESWnaQ9.js";import"./credit-card-DhKiqKDR.js";import"./info-DGWfuZKp.js";import"./sun-BLOPCje7.js";import"./search-BpG6I48V.js";import"./en-US-BA9orzCf.js";import"./endOfWeek-QFyZPl43.js";import"./differenceInCalendarMonths-HUNRrXGm.js";import"./normalizeInterval-CdMCNNY-.js";import"./endOfMonth-CK_ShA5m.js";import"./isSameDay-DUlCFK42.js";import"./isSameMonth-CQd3m9St.js";import"./chevron-left-BtmPIa6j.js";import"./chevron-down-2lGOOBZZ.js";import"./index-dLIx9e4I.js";const L=m=>String(m??"").trim().toLowerCase();function M(m){const l=String(m??"").trim().toLowerCase().replace(/[\s\-_]+/g,"");return l?l.includes("proposal")?"proposal":l.includes("prefinal")||l.includes("pre")&&l.includes("final")?"prefinal":l.includes("final")?"final":"":""}function V(m){const l=L(m);return l==="masteral"?"masteral":l==="doctorate"?"doctorate":""}function z(m){const l=L(m);return l?/(^|\s)(ms|msc|ma|mba|m\s*\.?\s*s|m\s*\.?\s*a|master)/.test(l)?"masteral":/(^|\s)(phd|ph\.?\s*d|dr|doctor|doctoral|doctorate)/.test(l)?"doctorate":l.includes("master")?"masteral":l.includes("doctor")?"doctorate":"":""}function ve(m,l){const d=L(m),p=L(l),g=o=>o.includes("chair"),t=o=>o.includes("panel")&&!g(o),_=o=>o.includes("advis");return g(p)?g(d):t(p)?t(d):_(p)?_(d):d.includes(p)||p.includes(d)}function is(m,l,d,p){if(!Array.isArray(m)||!l||!d||!p)return null;const g=V(l)||z(l),t=M(d);if(!g||!t)return null;const _=m.find(u=>{const b=V(u.program_level)||z(u.program_level),w=M(u.defense_type);return b===g&&w===t&&ve(u.type||"",p)});if(!_)return null;const o=Number(_.amount);return Number.isFinite(o)?o:null}function ls(m,l,d,p){if(!Array.isArray(m)||!l||!d||!p)return null;const g=z(l),t=M(d);if(!g||!t)return null;const _=m.find(u=>{const b=V(u.program_level)||z(u.program_level),w=M(u.defense_type);return b===g&&w===t&&ve(u.type||"",p)});if(!_)return null;const o=Number(_.amount);return Number.isFinite(o)?o:null}function os(m,l){if(!l||!Array.isArray(m))return null;const d=String(l).trim();if(!d)return null;const p=m.find(t=>String(t.id)===d);if(p)return p;if(/^\d+$/.test(d)){const t=m.find(_=>String(_.id)===d||String(_.id).endsWith(`-${d}`));if(t)return t}const g=d.toLowerCase();return m.find(t=>String(t.name||"").trim().toLowerCase()===g)||null}function ds({label:m,value:l,onChange:d,options:p,disabled:g,taken:t}){const[_,o]=j.useState(!1),[u,b]=j.useState(""),w=j.useMemo(()=>{if(!u)return p;const x=u.toLowerCase();return p.filter(N=>N.name.toLowerCase().includes(x)||N.email&&N.email.toLowerCase().includes(x))},[u,p]);return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:m}),e.jsxs(je,{open:_,onOpenChange:x=>{o(x),x||b("")},children:[e.jsx(ge,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full h-9 px-3 flex items-center justify-between rounded-md border bg-background text-sm text-left focus:outline-none focus:ring-2 focus:ring-primary/40 hover:bg-accent disabled:opacity-50",disabled:g,children:[e.jsx("span",{className:`truncate ${l?"":"text-muted-foreground"}`,children:l||`Select ${m}`}),e.jsx(Ee,{size:14,className:"opacity-50"})]})}),e.jsx(_e,{className:"w-[320px] p-0",align:"start",sideOffset:4,onOpenAutoFocus:x=>x.preventDefault(),children:e.jsxs(Fe,{shouldFilter:!1,children:[e.jsx(Re,{value:u,onValueChange:b,placeholder:"Search...",className:"h-9",autoFocus:!0}),e.jsx(qe,{className:"py-8 text-sm text-muted-foreground text-center",children:"No matches."}),e.jsx($e,{className:"max-h-72 overflow-auto",children:w.map(x=>{const N=x.name===l,A=t.has(x.name)&&!N;return e.jsxs(Le,{value:x.name,disabled:A,onSelect:()=>{A||(d(x.name),o(!1),b(""))},className:`flex flex-col items-start gap-0.5 px-3 py-2
                      ${N?"bg-muted":""}
                      ${A?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center w-full gap-2",children:[e.jsx(rs,{size:14,className:N?"opacity-100 text-muted-foreground":"opacity-0"}),e.jsx("span",{className:"text-sm truncate",children:x.name})]}),x.email&&e.jsx("span",{className:"pl-5 text-[11px] text-muted-foreground truncate max-w-[250px]",children:x.email}),A&&!N&&e.jsx("span",{className:"pl-5 text-[10px] text-muted-foreground",children:"Already chosen"})]},x.id)})})]})})]})]})}function Ct(m){var ae;const l=m||{},d=l.defenseRequest||null,p=l.userRole||"",g=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/defense-request"}];if(d!=null&&d.id){const s=(((ae=d.thesis_title)==null?void 0:ae.length)||0)>60?d.thesis_title.slice(0,57)+"...":d.thesis_title||`Request #${d.id}`;g.push({title:s,href:`/coordinator/defense-requests/${d.id}/details`})}if(!d)return e.jsxs(ie,{breadcrumbs:g,children:[e.jsx(ne,{title:"Defense Request - Not Found"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-red-500",children:"No defense request loaded. Use the list page and click Details again."}),e.jsx(y,{variant:"outline",onClick:()=>re.visit("/defense-request"),children:"Back to list"})]})]});const[t,_]=j.useState(d),[o,u]=j.useState({open:!1,action:null,sendEmail:!1}),[b,w]=j.useState(!1),[x,N]=j.useState([]),[A,H]=j.useState(!1),[W,K]=j.useState(null),[Y,X]=j.useState([]);j.useEffect(()=>{let s=!0;async function n(){H(!0),K(null);const i=["/coordinator/defense/panel-members-all","/api/panel-members"];let a=!1;for(const r of i)try{const c=await fetch(r,{headers:{Accept:"application/json"}});if(!c.ok){console.warn("Panel member fetch failed",r,c.status);continue}const v=await c.json();s&&(N(Array.isArray(v)?v:[]),a=!0);break}catch(c){console.warn("Fetch error",r,c)}!a&&s&&(N([]),K("Could not load panel members.")),s&&H(!1)}return n(),()=>{s=!1}},[]),j.useEffect(()=>{let s=!0;return(async()=>{try{const i=await(await fetch("/dean/payment-rates/data",{headers:{Accept:"application/json"}})).json(),a=Array.isArray(i==null?void 0:i.rates)?i.rates:Array.isArray(i)?i:[];s&&X(a)}catch{s&&X([])}})(),()=>{s=!1}},[]);const[h,be]=j.useState({defense_chairperson:t.defense_chairperson??"",defense_panelist1:t.defense_panelist1??"",defense_panelist2:t.defense_panelist2??"",defense_panelist3:t.defense_panelist3??"",defense_panelist4:t.defense_panelist4??""}),[f,P]=j.useState({scheduled_date:t.scheduled_date??"",scheduled_time:t.scheduled_time??"",scheduled_end_time:t.scheduled_end_time??"",defense_mode:t.defense_mode??"",defense_venue:t.defense_venue??"",scheduling_notes:t.scheduling_notes??""}),[cs,ms]=j.useState(!1),[us,fs]=j.useState(!1),Ne=j.useMemo(()=>new Set(Object.values(h).filter(Boolean)),[h]),C=["Coordinator","Administrative Assistant","Dean"].includes(p);async function J(){var s;try{return await fetch("/sanctum/csrf-cookie",{credentials:"same-origin"}),((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""}catch{return""}}async function G(s,n,i=!0){n.headers||(n.headers={}),n.headers["X-CSRF-TOKEN"]=await J();let a;try{a=await fetch(s,n)}catch{throw new Error("network")}if(a.status===419&&i){n.headers["X-CSRF-TOKEN"]=await J();try{a=await fetch(s,n)}catch{throw new Error("network")}}return a}async function O(s){if(!t.id)return;w(!0);let n="Pending";s==="approve"?n="Approved":s==="reject"?n="Rejected":s==="retrieve"&&(n="Pending");try{const i={status:n,send_email:o.sendEmail};s==="approve"&&(i.panels={defense_chairperson:h.defense_chairperson,defense_panelist1:h.defense_panelist1,defense_panelist2:h.defense_panelist2,defense_panelist3:h.defense_panelist3,defense_panelist4:h.defense_panelist4},i.schedule={scheduled_date:f.scheduled_date,scheduled_time:f.scheduled_time,scheduled_end_time:f.scheduled_end_time,defense_mode:f.defense_mode,defense_venue:f.defense_venue,scheduling_notes:f.scheduling_notes});const a=await G(`/defense-requests/${t.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)});let r={};try{r=await a.json()}catch{r={error:"Invalid response from server."}}if(a.ok)r.request?_(r.request):_(c=>({...c,coordinator_status:n,workflow_state:r.workflow_state||c.workflow_state,workflow_history:r.workflow_history||c.workflow_history,status:r.status||c.status})),S.success(`Coordinator status set to ${n}`);else if(a.status===422&&(r!=null&&r.conflicts)){const c=(r.conflicts||[]).map(v=>`${v.person} has a conflict (${v.time_range}) with ${v.student_name}`).join(`
`);s==="approve"&&window.confirm(`Scheduling conflicts detected:
`+c+`

Click OK to force approve and override, Cancel to abort.`)&&await ye(),S.error((r==null?void 0:r.error)||`Failed to update status (${a.status})`)}else S.error((r==null?void 0:r.error)||`Failed to update status (${a.status})`)}catch(i){i instanceof Error&&i.message==="network"?S.error("Network error updating status. Please check your connection and try again."):S.error("Unknown error updating status.")}finally{w(!1),u({open:!1,action:null,sendEmail:!1})}}async function ye(){if(t.id){w(!0);try{const s={status:"Approved",send_email:o.sendEmail,force:!0,panels:{defense_chairperson:h.defense_chairperson,defense_panelist1:h.defense_panelist1,defense_panelist2:h.defense_panelist2,defense_panelist3:h.defense_panelist3,defense_panelist4:h.defense_panelist4},schedule:{scheduled_date:f.scheduled_date,scheduled_time:f.scheduled_time,scheduled_end_time:f.scheduled_end_time,defense_mode:f.defense_mode,defense_venue:f.defense_venue,scheduling_notes:f.scheduling_notes}},n=await G(`/defense-requests/${t.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)}),i=await n.json().catch(()=>({}));n.ok?(i.request&&_(i.request),S.success("Coordinator status set to Approved (forced)")):S.error((i==null?void 0:i.error)||`Failed to force approve (${n.status})`)}catch{S.error("Network error while forcing approval")}finally{w(!1),u({open:!1,action:null,sendEmail:!1})}}}function Q(s){if(!s)return"—";try{return $(new Date(s),"PPP")}catch{return s}}function k(s){return s?/^https?:\/\//i.test(s)||s.startsWith("/storage/")?s:`/storage/${s.replace(/^\/?storage\//,"")}`:null}const Z=[{label:"Adviser’s Endorsement",url:k(t.advisers_endorsement)},{label:"REC Endorsement",url:k(t.rec_endorsement)},{label:"Proof of Payment",url:k(t.proof_of_payment)},{label:"Manuscript",url:k(t.manuscript_proposal)},{label:"Similarity Index",url:k(t.similarity_index)},{label:"Avisee-Adviser File",url:k(t.avisee_adviser_attachment)},{label:"AI Detection Certificate",url:k(t.ai_detection_certificate)},{label:"Endorsement Form",url:k(t.endorsement_form)}];function we(s){var E;const n=s.event_type||s.action||s.status_change||s.status||s.type||"Event",i=s.description||s.details||s.note||s.notes||s.remarks||"",a=s.from_state||s.from||s.previous_state,r=s.to_state||s.to||s.new_state,c=s.created_at||s.timestamp||s.performed_at||s.date||"",v=s.user_name||((E=s.user)==null?void 0:E.name)||s.actor_name||s.actor||s.performed_by_name||s.performed_by||"";return{event:n,desc:i,from:a,to:r,created:c,userName:v}}const U="rounded-lg border p-5 space-y-3";function Ce(s){var a,r,c,v;const n=((r=(a=s.first_name)==null?void 0:a.trim())==null?void 0:r[0])??"",i=((v=(c=s.last_name)==null?void 0:c.trim())==null?void 0:v[0])??"";return(n+i).toUpperCase()||"U"}function ke(s){if(!s)return"";try{return $(new Date(s),"PPpp")}catch{return s}}const Se=[{key:"submitted",label:"Submitted",icon:e.jsx(ts,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:e.jsx(as,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:e.jsx(he,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected by Coordinator",icon:e.jsx(fe,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved (Set to Pending)",icon:e.jsx(pe,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:e.jsx(ns,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:e.jsx(I,{className:"h-5 w-5"})}];function Ae(s){return s=(s||"").toLowerCase(),s.includes("submit")?"submitted":s.includes("adviser")?"adviser-approved":s.includes("rejected")?"rejected":s.includes("retrieved")?"retrieved":s.includes("coordinator")?"coordinator-approved":s.includes("panel")?"panels-assigned":s.includes("schedule")?"scheduled":""}function ee(s){if(!s)return"";const[n,i]=s.split(":"),a=new Date;return a.setHours(Number(n),Number(i)),$(a,"hh:mm a")}const[se,te]=j.useState("details");return e.jsxs(ie,{breadcrumbs:g,children:[e.jsx(De,{position:"bottom-right",richColors:!0,closeButton:!0}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsx(ne,{title:t.thesis_title||`Defense Request #${t.id}`}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>re.visit("/defense-request"),className:"h-8 px-2",children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(de,{value:se,onValueChange:s=>te(s),children:e.jsxs(Je,{className:"h-8",children:[e.jsxs(ce,{value:"details",className:"flex items-center gap-1 text-sm px-3",children:[e.jsx(q,{className:"h-4 w-4"})," Details"]}),e.jsxs(ce,{value:"assign-schedule",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(B,{className:"h-4 w-4"}),"Assign & Schedule"]})]})})]}),C&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"approve",sendEmail:!1}),disabled:b||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(ss,{className:"h-4 w-4 mr-1 text-green-600"}),"Approve"]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"reject",sendEmail:!1}),disabled:b||t.coordinator_status==="Rejected"||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(fe,{className:"h-4 w-4 mr-1 text-red-600"}),"Reject"]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"retrieve",sendEmail:!1}),disabled:b||!["Rejected","Approved"].includes(t.coordinator_status||"")||t.workflow_state==="completed",children:[e.jsx(pe,{className:"h-4 w-4 mr-1 text-blue-600"}),"Retrieve"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-5 mb-2",children:[e.jsx("div",{className:"w-full md:max-w-3xl mx-auto flex flex-col gap-5",children:e.jsxs(de,{value:se,onValueChange:s=>te(s),className:"w-full",children:[e.jsxs(me,{value:"details",className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold",children:t.thesis_title}),e.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),e.jsx("div",{className:"flex flex-col md:items-end gap-1",children:t.coordinator_status&&e.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${t.coordinator_status==="Approved"?"bg-green-100 text-green-600":t.coordinator_status==="Rejected"?"bg-red-100 text-red-600":t.coordinator_status==="Needs Signature"?"bg-blue-100 text-blue-600":t.coordinator_status==="Not Scheduled"?"bg-yellow-100 text-yellow-700":t.coordinator_status==="No Assigned Panelists"?"bg-orange-100 text-orange-600":"bg-gray-100 text-gray-600"}`,children:["Coordinator Status: ",t.coordinator_status]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{className:"h-8 w-8",children:e.jsx(Xe,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:Ce(t)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm leading-tight",children:[t.first_name," ",t.middle_name?`${t.middle_name} `:"",t.last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:t.school_id})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),e.jsx("div",{className:"font-medium text-sm",children:t.program})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),e.jsx(le,{variant:"secondary",className:"text-xs font-medium",children:t.defense_type??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),e.jsx("div",{className:"font-medium text-sm",children:Q(t.scheduled_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduled_time?`${ee(t.scheduled_time)}${t.scheduled_end_time?" - "+ee(t.scheduled_end_time):""}`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx("div",{className:"font-medium text-sm",children:t.defense_venue||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsx("div",{className:"font-medium text-sm",children:t.defense_mode?t.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduling_notes||"—"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-5 space-y-3",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"})," Committee"]}),e.jsx(R,{}),(()=>{const s=(a,r)=>{const c=os(x,a);return{displayName:(c==null?void 0:c.name)||a||"—",email:(c==null?void 0:c.email)||"",rawValue:a||"",role:r}},n=[{key:"adviser",info:s(t.defense_adviser,"Adviser")},{key:"defense_chairperson",info:s(h.defense_chairperson||t.defense_chairperson,"Panel Chair")},{key:"defense_panelist1",info:s(h.defense_panelist1||t.defense_panelist1,"Panel Member")},{key:"defense_panelist2",info:s(h.defense_panelist2||t.defense_panelist2,"Panel Member")},{key:"defense_panelist3",info:s(h.defense_panelist3||t.defense_panelist3,"Panel Member")},{key:"defense_panelist4",info:s(h.defense_panelist4||t.defense_panelist4,"Panel Member")}].map(a=>{const r=!!(a.info.rawValue||a.info.displayName&&a.info.displayName!=="—"),c=!!a.info.email,v=r?c?"Assigned":"Pending confirmation":"—",E=r?t.program_level?is(Y,t.program_level,t.defense_type,a.info.role):ls(Y,t.program,t.defense_type,a.info.role):null;return{name:a.info.displayName,email:a.info.email||"—",role:a.info.role,status:v,receivable:E}}),i=a=>typeof a=="number"?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(a):a??"—";return e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Ge,{children:[e.jsx(Qe,{children:e.jsxs(ue,{children:[e.jsx(T,{className:"min-w-[180px]",children:"Name"}),e.jsx(T,{className:"min-w-[220px]",children:"Email"}),e.jsx(T,{className:"min-w-[120px]",children:"Role"}),e.jsx(T,{className:"min-w-[120px]",children:"Status"}),e.jsx(T,{className:"min-w-[160px] text-right",children:"Receivable"})]})}),e.jsx(Ze,{children:n.map((a,r)=>e.jsxs(ue,{children:[e.jsx(D,{className:"font-medium",children:a.name}),e.jsx(D,{className:"text-xs text-muted-foreground",children:a.email||"—"}),e.jsx(D,{children:a.role}),e.jsx(D,{children:e.jsx(le,{variant:"secondary",className:a.status==="Assigned"?"bg-green-100 text-green-700":a.status==="Pending confirmation"?"bg-yellow-100 text-amber-700":"bg-amber-100 text-amber-700",children:a.status})}),e.jsx(D,{className:"text-right",children:i(a.receivable)})]},r))})]})})})()]}),e.jsxs("div",{className:U,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"})," Attachments"]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[Z.filter(s=>!!s.url).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),Z.filter(s=>!!s.url).map(s=>{var n;return e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(n=s.url)==null?void 0:n.split("/").pop()})]},s.label)}),t.reference_no&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Reference No."}),e.jsx("span",{className:"ml-auto text-xs",children:t.reference_no})]})]})]})]}),e.jsxs(me,{value:"assign-schedule",className:"space-y-5",children:[e.jsxs("div",{className:U,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"})," Panel Assignment"]}),e.jsx(R,{}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:[{label:"Chairperson",key:"defense_chairperson"},{label:"Panelist 1",key:"defense_panelist1"},{label:"Panelist 2",key:"defense_panelist2"},{label:"Panelist 3",key:"defense_panelist3"},{label:"Panelist 4",key:"defense_panelist4"}].map(({label:s,key:n})=>e.jsx(ds,{label:s,value:h[n],onChange:i=>be(a=>({...a,[n]:i})),options:x,disabled:!C||A,taken:Ne},n))}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Changes to panel assignments are saved when you Approve the request."})}),W&&e.jsx("div",{className:"text-xs text-red-500 mt-2",children:W})]}),e.jsxs("div",{className:U,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"})," Scheduling"]}),e.jsx(R,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Date"}),e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:Ke("w-full justify-start text-left font-normal",!f.scheduled_date&&"text-muted-foreground"),disabled:!C,children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),f.scheduled_date?Q(f.scheduled_date):"Pick a date"]})}),e.jsx(_e,{className:"w-auto p-0",align:"start",children:e.jsx(Me,{mode:"single",selected:f.scheduled_date?new Date(f.scheduled_date):void 0,onSelect:s=>{P(n=>({...n,scheduled_date:s?$(s,"yyyy-MM-dd"):""}))},initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Start Time"}),e.jsx(F,{type:"time",value:f.scheduled_time,onChange:s=>P(n=>({...n,scheduled_time:s.target.value})),disabled:!C})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"End Time"}),e.jsx(F,{type:"time",value:f.scheduled_end_time,onChange:s=>P(n=>({...n,scheduled_end_time:s.target.value})),disabled:!C})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsxs(ze,{value:f.defense_mode,onValueChange:s=>P(n=>({...n,defense_mode:s})),disabled:!C,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"Select mode"})}),e.jsxs(Be,{children:[e.jsx(oe,{value:"face-to-face",children:"Face-to-Face"}),e.jsx(oe,{value:"online",children:"Online"})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx(F,{value:f.defense_venue,onChange:s=>P(n=>({...n,defense_venue:s.target.value})),disabled:!C})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx(F,{value:f.scheduling_notes,onChange:s=>P(n=>({...n,scheduling_notes:s.target.value})),disabled:!C})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Scheduling changes will be persisted when you Approve the request."})})]})]})]})}),e.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:e.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 sticky top-24 h-fit",children:[e.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"})," Workflow Progress"]}),e.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(t.workflow_history)&&t.workflow_history.length>0?t.workflow_history.map((s,n)=>{const{event:i,created:a,userName:r}=we(s),c=Ae(i),v=Se.find(Pe=>Pe.key===c)||{label:i.charAt(0).toUpperCase()+i.slice(1),icon:e.jsx(I,{className:"h-5 w-5 text-gray-500"})},E=Array.isArray(t.workflow_history)&&n===t.workflow_history.length-1;return e.jsxs("div",{className:"flex items-start gap-3 relative",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:v.icon}),!E&&e.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:"font-semibold text-xs",children:v.label}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[r&&e.jsx("span",{children:r}),a&&e.jsxs("span",{children:[" ","· ",ke(a)]})]})]})]},n)}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["Last updated by:"," ",t.last_status_updated_by_name||t.last_status_updated_by||"—"," ",t.last_status_updated_at?`(${Te(t.last_status_updated_at).format("YYYY-MM-DD [at] h:mm A")})`:""]})]}),e.jsx(Ie,{open:o.open,onOpenChange:s=>{s||u({open:!1,action:null,sendEmail:!1})},children:e.jsxs(Ve,{children:[e.jsx(He,{children:"Confirm Action"}),e.jsx(We,{children:o.action==="approve"?"Please review before approving.":o.action==="reject"?"Are you sure you want to reject this defense request?":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[e.jsxs("p",{children:["Set request to"," ",e.jsx("span",{className:"font-semibold",children:o.action==="approve"?"Approved":o.action==="reject"?"Rejected":"Pending"}),"?"]}),o.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(he,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving this defense request authorizes the use of your signature on the official defense documents."})]})]}),o.action==="approve"||o.action==="reject"?e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Would you like to send email notifications to all parties?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"ghost",className:"flex-1",onClick:()=>u({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(y,{variant:"outline",className:"flex-1",onClick:()=>{u(s=>({...s,sendEmail:!1})),o.action&&O(o.action)},disabled:b,children:"Skip Email"}),e.jsx(y,{className:"flex-1",onClick:()=>{u(s=>({...s,sendEmail:!0})),o.action&&O(o.action)},disabled:b,children:"Send Emails"})]})]}):e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(y,{variant:"ghost",onClick:()=>u({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(y,{onClick:()=>o.action&&O(o.action),disabled:b,children:"Confirm"})]})]})})]})}export{Ct as default};
