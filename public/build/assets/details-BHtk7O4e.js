import{j as e,L as xe,S as fe,r as c}from"./app-DW0Mt5c9.js";import{A as pe,C as Me}from"./app-layout-CPwLq_xH.js";import{d as $e}from"./dayjs.min-D31ZKPdx.js";import{T as Le,t as P}from"./index-ByTeG7FR.js";import{B as h}from"./button-BZf0VdIO.js";import{I as D}from"./input-Ch6RmxP_.js";import{B as z}from"./badge-B7OUzsXL.js";import{S as T}from"./separator-4d5ucxHB.js";import{C as ze,a as Oe,b as Be,c as Ie,d as Ue}from"./command-74ZhXW_a.js";import{C as Ve}from"./calendar-DLLmg6PV.js";import{S as He,a as We,b as Xe,c as Ye,e as he}from"./select-cV-UjAs3.js";import{P as we,a as Ce,b as ke}from"./popover-D7yVk8xU.js";import{D as Je,a as Ke,b as Ge,c as Qe}from"./dialog-D7L72BhV.js";import{c as O}from"./utils-jAU0Cazi.js";import{A as Ze,a as es}from"./avatar-B3rD_VQk.js";import{T as je,a as ss,b as ge,c as ve}from"./tabs-3Dm9feNm.js";import{T as ts,a as as,b as be,c as B,d as rs,e as I}from"./table-CYsX4eCK.js";import{A as ns}from"./arrow-left-DClE7kxt.js";import{F as E}from"./file-text-Dpj0IN7n.js";import{C as U}from"./calendar-BCyjqlGy.js";import{C as is}from"./circle-check-big-CG9wjNDm.js";import{C as _e}from"./circle-x-C4V9EZEC.js";import{C as Ne}from"./circle-arrow-left-BUa1uPht.js";import{U as V}from"./users-CFj_s0Ga.js";import{C as H}from"./clock-CNQjyXBL.js";import{S as ye}from"./signature-D_iqDcqD.js";import{S as ls}from"./send-BUfb6BoG.js";import{U as ds}from"./user-check-CRf546ie.js";import{X as os}from"./x-CW6T59GI.js";import{C as cs}from"./check-C1Ca0PY3.js";import{f as R}from"./format-HX8DKPSU.js";import"./index-RzYQM1sh.js";import"./index-DZZQifJx.js";import"./index-BMNAwHVU.js";import"./index-DHu7YzAG.js";import"./index-Bh88FqJG.js";import"./tooltip-3yEC6fE6.js";import"./floating-ui.react-dom-DEJ-U2zP.js";import"./createLucideIcon-S0dKkUVo.js";import"./chevron-right-x7vIKCyG.js";import"./dropdown-menu-FJcetjAu.js";import"./index-dxfJWdT_.js";import"./index-I9YLalqX.js";import"./index-xrb8sl6P.js";import"./index-Au_TdUcj.js";import"./index-Bwn0NV8Z.js";import"./settings-DPsrAkv5.js";import"./graduation-cap-d15gjgNL.js";import"./dollar-sign-DVIUp7aq.js";import"./credit-card-Bzx9FpUt.js";import"./info-Dl-vg0Zq.js";import"./sun-C_6rnlvD.js";import"./search-Ck6Ms1BF.js";import"./en-US-BA9orzCf.js";import"./endOfWeek-QFyZPl43.js";import"./differenceInCalendarMonths-HUNRrXGm.js";import"./normalizeInterval-CdMCNNY-.js";import"./endOfMonth-CK_ShA5m.js";import"./isSameDay-DUlCFK42.js";import"./isSameMonth-CQd3m9St.js";import"./chevron-left-DlVNtzPQ.js";import"./chevron-down-B7XKdsxY.js";import"./index-D1ThX8Vn.js";function ms(v,j){if(!j||!Array.isArray(v))return null;const o=String(j).trim();if(!o)return null;const _=v.find(t=>String(t.id)===o);if(_)return _;if(/^\d+$/.test(o)){const t=v.find(k=>String(k.id)===o||String(k.id).endsWith(`-${o}`));if(t)return t}const N=o.toLowerCase();return v.find(t=>String(t.name||"").trim().toLowerCase()===N)||null}function us({label:v,value:j,onChange:o,options:_,disabled:N,taken:t}){const[k,m]=c.useState(!1),[u,g]=c.useState(""),q=c.useMemo(()=>{if(!u)return _;const l=u.toLowerCase();return _.filter(f=>f.name.toLowerCase().includes(l)||f.email&&f.email.toLowerCase().includes(l))},[u,_]);return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:v}),e.jsxs(we,{open:k,onOpenChange:l=>{m(l),l||g("")},children:[e.jsx(Ce,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full h-9 px-3 flex items-center justify-between rounded-md border bg-background text-sm text-left focus:outline-none focus:ring-2 focus:ring-primary/40 hover:bg-accent disabled:opacity-50",disabled:N,children:[e.jsx("span",{className:`truncate flex-1 ${j?"":"text-muted-foreground"}`,children:j||`Select ${v}`}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[j&&!N&&e.jsx("button",{type:"button",onClick:l=>{l.stopPropagation(),o("")},className:"h-5 w-5 rounded-sm hover:bg-muted flex items-center justify-center transition-colors",children:e.jsx(os,{className:"h-3 w-3"})}),e.jsx(Me,{size:14,className:"opacity-50"})]})]})}),e.jsx(ke,{className:"w-[320px] p-0",align:"start",sideOffset:4,onOpenAutoFocus:l=>l.preventDefault(),children:e.jsxs(ze,{shouldFilter:!1,children:[e.jsx(Oe,{value:u,onValueChange:g,placeholder:"Search...",className:"h-9",autoFocus:!0}),e.jsx(Be,{className:"py-8 text-sm text-muted-foreground text-center",children:"No matches."}),e.jsx(Ie,{className:"max-h-72 overflow-auto",children:q.map(l=>{const f=l.name===j,S=t.has(l.name)&&!f;return e.jsxs(Ue,{value:l.name,disabled:S,onSelect:()=>{S||(o(l.name),m(!1),g(""))},className:`flex flex-col items-start gap-0.5 px-3 py-2
                      ${f?"bg-muted":""}
                      ${S?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center w-full gap-2",children:[e.jsx(cs,{size:14,className:f?"opacity-100 text-muted-foreground":"opacity-0"}),e.jsx("span",{className:"text-sm truncate",children:l.name})]}),l.email&&e.jsx("span",{className:"pl-5 text-[11px] text-muted-foreground truncate max-w-[250px]",children:l.email}),S&&!f&&e.jsx("span",{className:"pl-5 text-[10px] text-muted-foreground",children:"Already chosen"})]},l.id)})})]})})]})]})}function kt(v){var te,ae,re,ne,ie,le,de,oe,ce,me;const j=v||{},o=j.defenseRequest||null,_=j.userRole||"",N=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/defense-request"}];if(o!=null&&o.id){const s=(((te=o.thesis_title)==null?void 0:te.length)||0)>60?o.thesis_title.slice(0,57)+"...":o.thesis_title||`Request #${o.id}`;N.push({title:s,href:`/coordinator/defense-requests/${o.id}/details`})}if(!o)return e.jsxs(pe,{breadcrumbs:N,children:[e.jsx(xe,{title:"Defense Request - Not Found"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-red-500",children:"No defense request loaded. Use the list page and click Details again."}),e.jsx(h,{variant:"outline",onClick:()=>fe.visit("/defense-request"),children:"Back to list"})]})]});const[t,k]=c.useState(o),[m,u]=c.useState({open:!1,action:null,sendEmail:!1}),[g,q]=c.useState(!1),[l,f]=c.useState([]),[S,W]=c.useState(!1),[X,Y]=c.useState(null),[Se,J]=c.useState([]);c.useEffect(()=>{let s=!0;async function r(){W(!0),Y(null);const n=["/coordinator/defense/panel-members-all","/api/panel-members"];let a=!1;for(const d of n)try{const i=await fetch(d,{headers:{Accept:"application/json"}});if(!i.ok){console.warn("Panel member fetch failed",d,i.status);continue}const x=await i.json();s&&(f(Array.isArray(x)?x:[]),a=!0);break}catch(i){console.warn("Fetch error",d,i)}!a&&s&&(f([]),Y("Could not load panel members.")),s&&W(!1)}return r(),()=>{s=!1}},[]),c.useEffect(()=>{let s=!0;return(async()=>{try{const n=await(await fetch("/dean/payment-rates/data",{headers:{Accept:"application/json"}})).json(),a=Array.isArray(n==null?void 0:n.rates)?n.rates:Array.isArray(n)?n:[];s&&J(a)}catch{s&&J([])}})(),()=>{s=!1}},[]);const[b,K]=c.useState({defense_chairperson:t.defense_chairperson??"",defense_panelist1:t.defense_panelist1??"",defense_panelist2:t.defense_panelist2??"",defense_panelist3:t.defense_panelist3??"",defense_panelist4:t.defense_panelist4??""}),[p,C]=c.useState({scheduled_date:t.scheduled_date??"",scheduled_time:t.scheduled_time??"",scheduled_end_time:t.scheduled_end_time??"",defense_mode:t.defense_mode??"",defense_venue:t.defense_venue??"",scheduling_notes:t.scheduling_notes??""}),[xs,fs]=c.useState(!1),[ps,hs]=c.useState(!1),Ae=c.useMemo(()=>new Set(Object.values(b).filter(Boolean)),[b]),y=["Coordinator","Administrative Assistant","Dean"].includes(_);async function G(){var s;try{return await fetch("/sanctum/csrf-cookie",{credentials:"same-origin"}),((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""}catch{return""}}async function F(s,r,n=!0){r.headers||(r.headers={}),r.headers["X-CSRF-TOKEN"]=await G();let a;try{a=await fetch(s,r)}catch{throw new Error("network")}if(a.status===419&&n){r.headers["X-CSRF-TOKEN"]=await G();try{a=await fetch(s,r)}catch{throw new Error("network")}}return a}async function M(s,r=!1){if(t.id){q(!0);try{s==="approve"&&(await F(`/coordinator/defense-requests/${t.id}/panels`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(b)}),await F(`/coordinator/defense-requests/${t.id}/schedule-json`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(p)}));const n=await F(`/defense-requests/${t.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({decision:s==="approve"?"approve":s==="reject"?"reject":"retrieve",comment:null,send_email:r})});let a={};try{a=await n.json()}catch{a={error:"Invalid response from server."}}console.log("updateStatus response:",{ok:n.ok,status:n.status,data:a}),n.ok&&a.ok?(a.request&&(k(a.request),K({defense_chairperson:a.request.defense_chairperson||"",defense_panelist1:a.request.defense_panelist1||"",defense_panelist2:a.request.defense_panelist2||"",defense_panelist3:a.request.defense_panelist3||"",defense_panelist4:a.request.defense_panelist4||""}),C({scheduled_date:a.request.scheduled_date||"",scheduled_time:a.request.scheduled_time||"",scheduled_end_time:a.request.scheduled_end_time||"",defense_mode:a.request.defense_mode||"",defense_venue:a.request.defense_venue||"",scheduling_notes:a.request.scheduling_notes||""})),P.success(`Defense request ${s==="approve"?"approved":s==="reject"?"rejected":"retrieved"} successfully`)):a.missing_fields?P.error("Missing required fields: "+a.missing_fields.join(", ")):P.error((a==null?void 0:a.error)||`Failed to update status (${n.status})`)}catch(n){n instanceof Error&&n.message==="network"?P.error("Network error updating status. Please check your connection and try again."):P.error("Unknown error updating status.")}finally{q(!1),u({open:!1,action:null,sendEmail:!1})}}}function $(s){if(!s)return"—";try{return R(new Date(s),"PPP")}catch{return s}}function w(s){return s?/^https?:\/\//i.test(s)||s.startsWith("/storage/")?s:`/storage/${s.replace(/^\/?storage\//,"")}`:null}const Q=[{label:"Adviser’s Endorsement",url:w(((ae=t.attachments)==null?void 0:ae.advisers_endorsement)||t.advisers_endorsement)},{label:"REC Endorsement",url:w(((re=t.attachments)==null?void 0:re.rec_endorsement)||t.rec_endorsement)},{label:"Proof of Payment",url:w(((ne=t.attachments)==null?void 0:ne.proof_of_payment)||t.proof_of_payment)},{label:"Manuscript",url:w(((ie=t.attachments)==null?void 0:ie.manuscript_proposal)||t.manuscript_proposal)},{label:"Similarity Index",url:w(((le=t.attachments)==null?void 0:le.similarity_index)||t.similarity_index)},{label:"Avisee-Adviser File",url:w(((de=t.attachments)==null?void 0:de.avisee_adviser_attachment)||t.avisee_adviser_attachment)},{label:"AI Detection Certificate",url:w(((oe=t.attachments)==null?void 0:oe.ai_detection_certificate)||t.ai_detection_certificate)},{label:"Endorsement Form",url:w(((ce=t.attachments)==null?void 0:ce.endorsement_form)||t.endorsement_form)}];function Pe(s){var A;const r=s.event_type||s.action||s.status_change||s.status||s.type||"Event",n=s.description||s.details||s.note||s.notes||s.remarks||"",a=s.from_state||s.from||s.previous_state,d=s.to_state||s.to||s.new_state,i=s.created_at||s.timestamp||s.performed_at||s.date||"",x=s.user_name||((A=s.user)==null?void 0:A.name)||s.actor_name||s.actor||s.performed_by_name||s.performed_by||"";return{event:r,desc:n,from:a,to:d,created:i,userName:x}}const L="rounded-lg border p-5 space-y-3";function Te(s){var a,d,i,x;const r=((d=(a=s.first_name)==null?void 0:a.trim())==null?void 0:d[0])??"",n=((x=(i=s.last_name)==null?void 0:i.trim())==null?void 0:x[0])??"";return(r+n).toUpperCase()||"U"}function qe(s){if(!s)return"";try{return R(new Date(s),"PPpp")}catch{return s}}const De=[{key:"submitted",label:"Submitted",icon:e.jsx(ls,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:e.jsx(ds,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:e.jsx(V,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:e.jsx(H,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:e.jsx(ye,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected by Coordinator",icon:e.jsx(_e,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved",icon:e.jsx(Ne,{className:"h-5 w-5"})}];function Ee(s){return s=(s||"").toLowerCase(),s.includes("submit")?"submitted":s.includes("adviser")?"adviser-approved":s.includes("rejected")?"rejected":s.includes("retrieved")?"retrieved":s.includes("coordinator")?"coordinator-approved":s.includes("panel")?"panels-assigned":s.includes("schedule")?"scheduled":""}function Z(s){if(!s)return"";const[r,n]=s.split(":"),a=new Date;return a.setHours(Number(r),Number(n)),R(a,"hh:mm a")}const[ee,se]=c.useState("details");function Re(s){if(!t.program_level||!t.defense_type)return null;let r="";s==="Adviser"?r="Adviser":r="Panel Chair";const n=i=>i.toLowerCase().replace(/[^a-z]/g,""),a=n(t.defense_type),d=Se.find(i=>{const x=i.program_level===t.program_level,A=i.type===r,ue=n(i.defense_type||"")===a;return x&&A&&ue});return d?Number(d.amount):null}return e.jsxs(pe,{breadcrumbs:N,children:[e.jsx(Le,{position:"bottom-right",richColors:!0,closeButton:!0}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsx(xe,{title:t.thesis_title||`Defense Request #${t.id}`}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"outline",onClick:()=>fe.visit("/defense-request"),className:"h-8 px-2",children:e.jsx(ns,{className:"h-4 w-4"})}),e.jsx(je,{value:ee,onValueChange:s=>se(s),children:e.jsxs(ss,{className:"h-8",children:[e.jsxs(ge,{value:"details",className:"flex items-center gap-1 text-sm px-3",children:[e.jsx(E,{className:"h-4 w-4"})," Details"]}),e.jsxs(ge,{value:"assign-schedule",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(U,{className:"h-4 w-4"}),"Assign & Schedule"]})]})})]}),y&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"approve",sendEmail:!1}),disabled:g||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(is,{className:"h-4 w-4 mr-1 text-green-600"}),"Approve"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"reject",sendEmail:!1}),disabled:g||t.coordinator_status==="Rejected"||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(_e,{className:"h-4 w-4 mr-1 text-red-600"}),"Reject"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"retrieve",sendEmail:!1}),disabled:g||!["Rejected","Approved"].includes(t.coordinator_status||"")||t.workflow_state==="completed",children:[e.jsx(Ne,{className:"h-4 w-4 mr-1 text-blue-600"}),"Retrieve"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-5 mb-2",children:[e.jsx("div",{className:"w-full md:max-w-3xl mx-auto flex flex-col gap-5",children:e.jsxs(je,{value:ee,onValueChange:s=>se(s),className:"w-full",children:[e.jsxs(ve,{value:"details",className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-start md:justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-2xl font-semibold",children:t.thesis_title}),e.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),e.jsx("div",{className:"flex flex-col md:items-end gap-1",children:t.adviser_status&&e.jsxs(z,{variant:"secondary",className:O("text-xs font-semibold px-3 py-1",t.adviser_status==="Approved"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":t.adviser_status==="Rejected"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:["Adviser Status: ",t.adviser_status==="Approved"?"Endorsed":t.adviser_status]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{className:"h-8 w-8",children:e.jsx(es,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:Te(t)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm leading-tight",children:[t.first_name," ",t.middle_name?`${t.middle_name} `:"",t.last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:t.school_id})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),e.jsx("div",{className:"font-medium text-sm",children:t.program})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),e.jsx(z,{variant:"secondary",className:"text-xs font-medium",children:t.defense_type??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Submitted At"}),e.jsx("div",{className:"font-medium text-sm",children:$(t.submitted_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program Coordinator"}),e.jsx("div",{className:"font-medium text-sm",children:((me=t.coordinator)==null?void 0:me.name)||"Rogelio O. Badiang (rbadiang@uic.edu.ph)"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Coordinator Status"}),e.jsx(z,{variant:"secondary",className:O("text-xs font-semibold",t.coordinator_status==="Approved"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":t.coordinator_status==="Rejected"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:t.coordinator_status||"Pending"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(T,{className:"my-2"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),e.jsx("div",{className:"font-medium text-sm",children:$(t.scheduled_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduled_time?`${Z(t.scheduled_time)}${t.scheduled_end_time?" - "+Z(t.scheduled_end_time):""}`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx("div",{className:"font-medium text-sm",children:t.defense_venue||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsx("div",{className:"font-medium text-sm capitalize",children:t.defense_mode?t.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduling_notes||"—"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-5 space-y-3",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"})," Committee"]}),e.jsx(T,{}),(()=>{const s=(a,d)=>{const i=ms(l,a);return{displayName:(i==null?void 0:i.name)||a||"—",email:(i==null?void 0:i.email)||"",rawValue:a||"",role:d}},r=[{key:"adviser",info:s(t.defense_adviser,"Adviser")},{key:"defense_chairperson",info:s(b.defense_chairperson||t.defense_chairperson,"Panel Chair")},{key:"defense_panelist1",info:s(b.defense_panelist1||t.defense_panelist1,"Panel Member 1")},{key:"defense_panelist2",info:s(b.defense_panelist2||t.defense_panelist2,"Panel Member 2")},{key:"defense_panelist3",info:s(b.defense_panelist3||t.defense_panelist3,"Panel Member 3")},{key:"defense_panelist4",info:s(b.defense_panelist4||t.defense_panelist4,"Panel Member 4")}].map(a=>{const i=!!(a.info.rawValue||a.info.displayName&&a.info.displayName!=="—")?Re(a.info.role):null;return{name:a.info.displayName,email:a.info.email||"—",role:a.info.role,receivable:i}}),n=a=>typeof a=="number"?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(a):a??"—";return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ts,{className:"border-0",children:[e.jsx(as,{children:e.jsxs(be,{children:[e.jsx(B,{className:"min-w-[200px]",children:"Name & Email"}),e.jsx(B,{className:"min-w-[100px]",children:"Role"}),e.jsx(B,{className:"min-w-[140px] text-right",children:"Receivable"})]})}),e.jsx(rs,{children:r.map((a,d)=>e.jsxs(be,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm",children:a.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.email})]})}),e.jsx(I,{className:"text-xs",children:a.role}),e.jsx(I,{className:"text-right text-xs font-medium",children:n(a.receivable)})]},d))})]})})})()]}),e.jsxs("div",{className:L,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"})," Attachments"]}),e.jsx(T,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[Q.filter(s=>!!s.url).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),Q.filter(s=>!!s.url).map(s=>{var r;return e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(r=s.url)==null?void 0:r.split("/").pop()})]},s.label)}),t.reference_no&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Reference No."}),e.jsx("span",{className:"ml-auto text-xs",children:t.reference_no})]})]})]})]}),e.jsxs(ve,{value:"assign-schedule",className:"space-y-5",children:[e.jsxs("div",{className:L,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"})," Panel Assignment"]}),e.jsx(T,{}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:[{label:"Chairperson",key:"defense_chairperson"},{label:"Panelist 1",key:"defense_panelist1"},{label:"Panelist 2",key:"defense_panelist2"},{label:"Panelist 3",key:"defense_panelist3"},{label:"Panelist 4",key:"defense_panelist4"}].map(({label:s,key:r})=>e.jsx(us,{label:s,value:b[r],onChange:n=>K(a=>({...a,[r]:n})),options:l,disabled:!y||S,taken:Ae},r))}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Changes to panel assignments are saved when you Approve the request."})}),X&&e.jsx("div",{className:"text-xs text-red-500 mt-2",children:X})]}),e.jsxs("div",{className:L,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"})," Scheduling"]}),e.jsx(T,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Date"}),e.jsxs(we,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:O("w-full justify-start text-left font-normal",!p.scheduled_date&&"text-muted-foreground"),disabled:!y,children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),p.scheduled_date?$(p.scheduled_date):"Pick a date"]})}),e.jsx(ke,{className:"w-auto p-0",align:"start",children:e.jsx(Ve,{mode:"single",selected:p.scheduled_date?new Date(p.scheduled_date):void 0,onSelect:s=>{C(r=>({...r,scheduled_date:s?R(s,"yyyy-MM-dd"):""}))},initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Start Time"}),e.jsx(D,{type:"time",value:p.scheduled_time,onChange:s=>C(r=>({...r,scheduled_time:s.target.value})),disabled:!y})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"End Time"}),e.jsx(D,{type:"time",value:p.scheduled_end_time,onChange:s=>C(r=>({...r,scheduled_end_time:s.target.value})),disabled:!y})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsxs(He,{value:p.defense_mode,onValueChange:s=>C(r=>({...r,defense_mode:s})),disabled:!y,children:[e.jsx(We,{children:e.jsx(Xe,{placeholder:"Select mode"})}),e.jsxs(Ye,{children:[e.jsx(he,{value:"face-to-face",children:"Face-to-Face"}),e.jsx(he,{value:"online",children:"Online"})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx(D,{value:p.defense_venue,onChange:s=>C(r=>({...r,defense_venue:s.target.value})),disabled:!y})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx(D,{value:p.scheduling_notes,onChange:s=>C(r=>({...r,scheduling_notes:s.target.value})),disabled:!y})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Scheduling changes will be persisted when you Approve the request."})})]})]})]})}),e.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:e.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 sticky top-24 h-fit",children:[e.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"})," Workflow Progress"]}),e.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(t.workflow_history)&&t.workflow_history.length>0?t.workflow_history.map((s,r)=>{const{event:n,created:a,userName:d}=Pe(s),i=Ee(n),x=De.find(Fe=>Fe.key===i)||{label:n.charAt(0).toUpperCase()+n.slice(1),icon:e.jsx(H,{className:"h-5 w-5 text-gray-500"})},A=Array.isArray(t.workflow_history)&&r===t.workflow_history.length-1;return e.jsxs("div",{className:"flex items-start gap-3 relative",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:x.icon}),!A&&e.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:"font-semibold text-xs",children:x.label}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[d&&e.jsx("span",{children:d}),a&&e.jsxs("span",{children:[" ","· ",qe(a)]})]})]})]},r)}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["Last updated by:"," ",t.last_status_updated_by_name||t.last_status_updated_by||"—"," ",t.last_status_updated_at?`(${$e(t.last_status_updated_at).format("YYYY-MM-DD [at] h:mm A")})`:""]})]}),e.jsx(Je,{open:m.open,onOpenChange:s=>{s||u({open:!1,action:null,sendEmail:!1})},children:e.jsxs(Ke,{children:[e.jsx(Ge,{children:"Confirm Action"}),e.jsx(Qe,{children:m.action==="approve"?"Please review before approving.":m.action==="reject"?"Are you sure you want to reject this defense request?":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[e.jsxs("p",{children:["Set request to"," ",e.jsx("span",{className:"font-semibold",children:m.action==="approve"?"Approved":m.action==="reject"?"Rejected":"Pending"}),"?"]}),m.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(ye,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving this defense request authorizes the use of your signature on the official defense documents."})]})]}),m.action==="approve"||m.action==="reject"?e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Would you like to send email notifications to all parties?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"ghost",className:"flex-1",onClick:()=>u({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(h,{variant:"outline",className:"flex-1",onClick:()=>{m.action&&M(m.action,!1)},disabled:g,children:"Skip Email"}),e.jsx(h,{className:"flex-1",onClick:()=>{m.action&&M(m.action,!0)},disabled:g,children:"Send Emails"})]})]}):e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(h,{variant:"ghost",onClick:()=>u({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(h,{onClick:()=>m.action&&M(m.action,!1),disabled:g,children:"Confirm"})]})]})})]})}export{kt as default};
