import{r as D,j as e,L as _,a as S}from"./app-DW0Mt5c9.js";import{T as p,a as j,b as r,c as l,d as f,e as i}from"./table-CYsX4eCK.js";import{B as u}from"./button-BZf0VdIO.js";import{D as P,a as k,e as C,b as F,c as R,g as $}from"./dialog-D7L72BhV.js";import{A,a as E}from"./avatar-B3rD_VQk.js";import T from"./html2canvas.esm-CBrSDip1.js";import L from"./jspdf.es.min-Bf9V0y7q.js";import{X as B}from"./x-CW6T59GI.js";import{C as z}from"./chevron-down-B7XKdsxY.js";import{C as I}from"./chevron-right-x7vIKCyG.js";import{S as M}from"./square-pen-DAuFRdnq.js";import{D as H}from"./download-BwN388zE.js";import{f as g}from"./format-HX8DKPSU.js";import"./utils-jAU0Cazi.js";import"./index-RzYQM1sh.js";import"./index-DZZQifJx.js";import"./index-BMNAwHVU.js";import"./index-DHu7YzAG.js";import"./index-Bh88FqJG.js";import"./index-I9YLalqX.js";import"./index-xrb8sl6P.js";import"./typeof-QjJsDpFa.js";import"./createLucideIcon-S0dKkUVo.js";import"./en-US-BA9orzCf.js";function xe({record:t,onClose:N}){const[m,b]=D.useState(null),y=async s=>{try{const a=await S.get(`/payments/${s.id}/download-pdf`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([a.data],{type:"application/pdf"})),d=document.createElement("a");d.href=n,d.setAttribute("download",`payment-${s.id}.pdf`),document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(n)}catch(a){console.warn("Backend PDF failed, using client-side fallback...",a);try{const n=document.getElementById(`payment-${s.id}-pdf`);if(!n)return alert("PDF Export Error: content not found.");const x=(await T(n,{scale:2,useCORS:!0})).toDataURL("image/png"),o=new L("p","mm","a4"),w=o.internal.pageSize.getWidth(),v=o.internal.pageSize.getHeight(),c=o.getImageProperties(x),h=Math.min(w/c.width,v/c.height);o.addImage(x,"PNG",0,0,c.width*h,c.height*h),o.save(`payment-${s.id}.pdf`)}catch(n){console.error("Client-side PDF generation failed:",n),alert("Failed to generate PDF. Please try again.")}}};return e.jsx(P,{open:!!t,onOpenChange:s=>{s||N()},children:e.jsx(k,{className:"max-w-3xl min-w-280 min-h-90 w-full max-h-[90vh] flex flex-col p-0 gap-0",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{className:"sticky top-0 z-20 bg-white dark:bg-[#121212] border-b p-4 flex flex-row justify-between items-center m-2",children:[e.jsxs("div",{children:[e.jsx(F,{children:`${t.first_name} ${t.middle_name||""} ${t.last_name}`.trim()}),e.jsxs(R,{children:["Student ID: ",t.student_id||"-"]})]}),e.jsx($,{asChild:!0,children:e.jsx("button",{className:`ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground 
                 absolute top-4 right-4 rounded-xs opacity-70 transition-opacity 
                 hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden 
                 disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 
                 [&_svg:not([class*='size-'])]:size-4`,"aria-label":"Close",children:e.jsx(B,{})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto py-2 px-6",children:[e.jsx(_,{title:"Individual Record"}),e.jsxs("div",{className:"rounded-md overflow-x-auto border bg-white dark:bg-[#121212] p-4",children:[e.jsx("div",{className:"overflow-x-auto border-b bg-white dark:bg-[#121212] p-4",children:e.jsxs("div",{className:"flex items-start space-x-6",children:[e.jsx(A,{className:"w-36 h-36 mt-5",children:e.jsx(E,{className:"text-4xl",children:t.first_name.charAt(0)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 flex-1 pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"First Name"}),e.jsx("p",{className:"font-medium",children:t.first_name}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Middle Name"}),e.jsx("p",{className:"font-medium",children:t.middle_name||"-"}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Last Name"}),e.jsx("p",{className:"font-medium",children:t.last_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gender"}),e.jsx("p",{className:"font-medium",children:t.gender||"-"}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"School Year"}),e.jsx("p",{className:"font-medium",children:t.school_year||"-"}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Student ID"}),e.jsx("p",{className:"font-medium",children:t.student_id||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Course & Section"}),e.jsx("p",{className:"font-medium",children:t.course_section||"-"}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Birthdate"}),e.jsx("p",{className:"font-medium",children:t.birthdate?new Date(t.birthdate).toLocaleDateString():"-"}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Academic Status"}),e.jsx("p",{className:"font-medium",children:t.academic_status||"-"})]})]})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Defense Schedule"}),e.jsxs(p,{className:"min-w-full text-sm",children:[e.jsx(j,{children:e.jsxs(r,{children:[e.jsx(l,{className:"w-8"}),e.jsx(l,{children:"Defense Date"}),e.jsx(l,{children:"Defense Type"}),e.jsx(l,{children:"Defense Status"}),e.jsx(l,{children:"OR Number"}),e.jsx(l,{children:"Payment Date"}),e.jsx(l,{className:"text-right",children:"Amount"}),e.jsx(l,{className:"text-center",children:"Action"})]})}),e.jsx(f,{children:t.payments&&t.payments.length>0?t.payments.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(r,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>b(m===s.id?null:s.id),children:[e.jsx(i,{className:"w-8",children:m===s.id?e.jsx(z,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"})}),e.jsx(i,{children:s.defense_date?g(new Date(s.defense_date),"yyyy-MM-dd"):"-"}),e.jsx(i,{children:s.defense_type||"-"}),e.jsx(i,{children:s.defense_status||"-"}),e.jsx(i,{children:s.or_number||"-"}),e.jsx(i,{children:s.payment_date?g(new Date(s.payment_date),"yyyy-MM-dd"):"-"}),e.jsxs(i,{className:"text-right",children:["₱",Number(s.total_amount||0).toFixed(2)]}),e.jsx(i,{className:"text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",className:"rounded-md h-auto px-2 py-1 flex items-center",onClick:a=>{a.stopPropagation(),console.log("Edit clicked for payment",s.id)},children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(u,{variant:"outline",size:"sm",className:"rounded-md h-auto px-2 py-1 flex items-center",onClick:a=>{a.stopPropagation(),y(s)},children:e.jsx(H,{className:"w-4 h-4"})})]})})]},s.id),e.jsxs("div",{id:`payment-${s.id}-pdf`,style:{position:"absolute",left:"-9999px"},children:[e.jsx("h3",{children:"Payment Summary"}),e.jsxs("p",{children:["Student: ",t.first_name," ",t.last_name]}),e.jsxs("p",{children:["Defense Date: ",t.defense_date]}),e.jsxs("p",{children:["Defense Type: ",t.defense_type]}),e.jsxs("p",{children:["Defense Status: ",s.defense_status]}),e.jsxs("p",{children:["Amount: ₱",Number(s.amount).toFixed(2)]}),s.panelists&&s.panelists.map((a,n)=>e.jsxs("p",{children:[a.role,": ",a.pfirst_name," ",a.plast_name," ₱",Number(a.amount).toFixed(2)]},n))]}),m===s.id&&e.jsx(r,{children:e.jsx(i,{colSpan:8,children:e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("h4",{className:"font-semibold text-gray-600 mb-3",children:"Payment Breakdown"}),e.jsx("div",{className:"border rounded-lg bg-white overflow-hidden",children:e.jsxs(p,{children:[e.jsx(j,{children:e.jsxs(r,{className:"bg-gray-100",children:[e.jsx(l,{className:"font-medium w-1/4 py-3",children:"Role"}),e.jsx(l,{className:"font-medium w-1/2 py-3",children:"Panelist Name"}),e.jsx(l,{className:"font-medium w-1/4 text-right py-3",children:"Amount"})]})}),e.jsx(f,{children:s.panelists&&s.panelists.length>0?e.jsxs(e.Fragment,{children:[s.panelists.map((a,n)=>e.jsxs(r,{className:"hover:bg-gray-50",children:[e.jsx(i,{className:"font-medium py-3",children:a.role||"Not specified"}),e.jsx(i,{className:"py-3",children:a.pfirst_name&&a.plast_name?`${a.pfirst_name} ${a.plast_name}`:"Name not available"}),e.jsx(i,{className:"text-right py-3",children:a.amount?`₱${Number(a.amount).toFixed(2)}`:"₱0.00"})]},`${s.id}-${a.id||n}`)),e.jsxs(r,{className:"border-t bg-gray-50",children:[e.jsx(i,{colSpan:2,className:"font-semibold text-right py-3 pr-4",children:"Expected Amount:"}),e.jsxs(i,{className:"font-semibold text-right py-3",children:["₱",s.panelists.reduce((a,n)=>a+Number(n.amount||0),0).toFixed(2)]})]}),e.jsxs(r,{className:"bg-gray-50",children:[e.jsx(i,{colSpan:2,className:"font-semibold text-right py-3 pr-4",children:"Paid Amount:"}),e.jsxs(i,{className:"font-semibold text-right py-3",children:["₱",Number(s.total_amount||0).toFixed(2)]})]})]}):e.jsx(r,{children:e.jsx(i,{colSpan:3,className:"text-center py-4 text-gray-500",children:"No panelists found for this payment."})})})]})})]})})})]})):e.jsx(r,{children:e.jsx(i,{colSpan:8,className:"text-center py-4",children:"No payments found."})})})]})]})]})]})]})})})}export{xe as default};
