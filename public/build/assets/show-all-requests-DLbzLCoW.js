import{j as e,r as i,L as Q,S as U}from"./app-CQngmq00.js";import{t as d,T as Y}from"./index-Vwkg4oTI.js";import{B as l}from"./button-Cw9tQIeO.js";import{C as F}from"./checkbox-D0LzfNbG.js";import{I as Z}from"./input-izsDzGd9.js";import ee from"./table-defense-requests-BgkAp82-.js";import{D as se,a as te,b as re,c as ie}from"./dialog-D-tH9FDm.js";import{C as oe}from"./calendar-BpWedVzv.js";import{P as k,a as D,b as q}from"./popover-C8pU6zmg.js";import{A as ne}from"./app-layout-C76KB2Lm.js";import{G as ae}from"./graduation-cap-DHFIPOzN.js";import{S as le}from"./search-yiLKmxcv.js";import{C as M}from"./circle-plus-dBJ4iWWo.js";import{C as ce}from"./calendar-Bi5dAEy5.js";import{X as de}from"./x-B3RMhnUQ.js";import{S as me}from"./signature-CMYTxh5x.js";import{C as pe,a as fe}from"./chevrons-right-BTxST5nY.js";import{C as ue}from"./chevron-left-BphKULEz.js";import{C as he}from"./chevron-right-QGs8lTP5.js";import{s as L,f as O}from"./format-HX8DKPSU.js";import{e as xe}from"./endOfDay-UBg8OSOW.js";import{i as je}from"./isWithinInterval-BTvWHy0U.js";import"./index-DRp-GX9j.js";import"./index-CDDLQrUy.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-ahz1tZ6M.js";import"./index-VBHUZLOo.js";import"./index-CgLqTVh4.js";import"./index-BJk2QW0A.js";import"./index-Csh4Fj4k.js";import"./check-BEGkAg7k.js";import"./createLucideIcon-pjYyoixj.js";import"./table-BEEQP98I.js";import"./badge-BsPMjMb7.js";import"./circle-check-big-PSYRp90q.js";import"./circle-x-CSxHo4yb.js";import"./clock-Cn1v7f4i.js";import"./circle-check-B6ukRmdw.js";import"./banknote-DWaOIUXL.js";import"./dollar-sign-CkMbILE9.js";import"./hourglass-Ck8E1KPu.js";import"./index-BSk2xfhC.js";import"./index-BZgaE142.js";import"./en-US-BA9orzCf.js";import"./endOfWeek-QFyZPl43.js";import"./differenceInCalendarMonths-HUNRrXGm.js";import"./normalizeInterval-CdMCNNY-.js";import"./endOfMonth-CK_ShA5m.js";import"./isSameDay-DUlCFK42.js";import"./isSameMonth-CQd3m9St.js";import"./chevron-down-Bg3q2iyP.js";import"./floating-ui.react-dom-DL84dtXf.js";import"./tooltip-BvePKNvs.js";import"./separator-CMC4qrzs.js";import"./dropdown-menu-BQlfF7jf.js";import"./index-BfMlnZ5P.js";import"./avatar-DUph8BC-.js";import"./settings-CDLWUJwV.js";import"./users-DZ67WViD.js";import"./file-text-Buh9X5tE.js";import"./send-BvMnN6yE.js";import"./credit-card-Cid_txJ6.js";import"./tabs-DJOYkXMD.js";import"./info-BJ9Jpdwx.js";import"./sun-5m6UvoyG.js";function ge({page:o,totalPages:c,onPageChange:n}){return e.jsxs("div",{className:"flex justify-between items-center gap-2 px-4 py-4 bg-background sticky bottom-0 z-10",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Page ",o," of ",c]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"lg",variant:"outline",disabled:o===1,onClick:()=>n(1),children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx(l,{size:"lg",variant:"outline",disabled:o===1,onClick:()=>n(o-1),children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsx(l,{size:"lg",variant:"outline",disabled:o===c,onClick:()=>n(o+1),children:e.jsx(he,{className:"w-5 h-5"})}),e.jsx(l,{size:"lg",variant:"outline",disabled:o===c,onClick:()=>n(c),children:e.jsx(fe,{className:"w-5 h-5"})})]})]})}function E({defenseRequests:o,onStatusChange:c}){const[n,h]=i.useState({open:!1,id:null,action:null});function _(){const s=document.querySelector('meta[name="csrf-token"]');return(s==null?void 0:s.content)||""}const v=s=>s.map(t=>({...t,date_of_defense:t.date_of_defense||t.scheduled_date||void 0,mode_defense:t.mode_defense||t.defense_mode||void 0})),[R,j]=i.useState(()=>o?v(o):[]);i.useEffect(()=>{o&&j(v(o))},[o]);const[x,T]=i.useState(""),[m,b]=i.useState([]),[p,C]=i.useState([]),[r,w]=i.useState(),[g,I]=i.useState(null),[N,A]=i.useState(1),[B]=i.useState({title:!0,presenter:!0,adviser:!0,program:!0,status:!0}),[ve,be]=i.useState(!1),[Ce,we]=i.useState(null),[Ne,ye]=i.useState(!1),[X,z]=i.useState(!1),P=i.useCallback(async()=>{const s=d.loading("Fetching table data...");z(!0);try{const t=await fetch("/coordinator/defense-requests/all-defense-requests");if(t.ok){const a=await t.json();j(v(a)),d.success("Table data loaded!",{id:s})}else d.error("Failed to fetch defense requests",{id:s})}catch{d.error("Error fetching defense requests",{id:s})}finally{z(!1),setTimeout(()=>d.dismiss(s),1e3)}},[]);i.useEffect(()=>{P()},[P]);const y=i.useMemo(()=>{let s=R;if(x){const t=x.toLowerCase();s=s.filter(a=>`${a.first_name} ${a.last_name} ${a.thesis_title}`.toLowerCase().includes(t))}if(m.length&&(s=s.filter(t=>m.includes(t.status))),p.length&&(s=s.filter(t=>p.includes(t.defense_type))),r!=null&&r.from&&(r!=null&&r.to)){const t=L(r.from),a=xe(r.to);s=s.filter(f=>{if(!f.date_of_defense)return!0;const u=L(new Date(f.date_of_defense));return je(u,{start:t,end:a})})}return s},[x,m,p,R,r]),$=i.useMemo(()=>g?[...y].sort((s,t)=>{const a=s.date_of_defense?new Date(s.date_of_defense).getTime():0,f=t.date_of_defense?new Date(t.date_of_defense).getTime():0;return g==="asc"?a-f:f-a}):y,[y,g]),G=Math.max(1,Math.ceil($.length/10)),H=$.slice((N-1)*10,N*10),J=()=>I(s=>s==="asc"?"desc":s==="desc"?null:"asc"),K=async(s,t)=>{try{(await fetch(`/defense-requests/${s}/priority`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":_(),Accept:"application/json"},body:JSON.stringify({priority:t})})).ok?(j(f=>f.map(u=>u.id===s?{...u,priority:t}:u)),d.success("Priority updated")):d.error("Failed to update priority")}catch{d.error("Error updating priority")}},V=i.useCallback(async(s,t)=>{try{(await fetch(`/defense-requests/${s}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":_(),Accept:"application/json"},body:JSON.stringify({status:t})})).ok?(j(f=>f.map(u=>u.id===s?{...u,status:t}:u)),c==null||c(s,t),d.success(`Request #${s} set to ${t}`)):d.error("Failed to update status")}catch{d.error("Error updating status")}},[c]);function S(s,t){h({open:!0,id:s,action:t})}async function W(){if(!n.id||!n.action){h({open:!1,id:null,action:null});return}let s="Pending";n.action==="approve"?s="Approved":n.action==="reject"?s="Rejected":n.action==="retrieve"&&(s="Pending"),await V(n.id,s),h({open:!1,id:null,action:null})}return console.log("Initial defenseRequests prop:",o),e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Defense Requests"}),e.jsx(Y,{richColors:!0,position:"bottom-right"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-2 overflow-auto rounded-xl pt-5 pr-3 pl-3 relative",children:[e.jsxs("div",{className:"w-full bg-white dark:bg-zinc-900 border border-border rounded-lg overflow-hidden mb-2",children:[e.jsx("div",{className:"flex flex-row dark:bg-zinc-900 items-center justify-between w-full p-3 border-b bg-white",children:e.jsxs("div",{className:"flex dark:bg-zinc-900 items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-rose-100 dark:bg-rose-900 border border-rose-500",children:e.jsx(ae,{className:"h-5 w-5 text-rose-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"Defense Requests"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"This section shows all defense requests. Search, filter, and manage requests."})]})]})}),e.jsx("div",{className:"flex dark:bg-zinc-900 items-center justify-between gap-2 px-4 py-3 border-b bg-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{type:"text",startIcon:le,placeholder:"Search...",value:x,onChange:s=>{T(s.target.value),A(1)},className:"max-w-xs text-sm h-8",disabled:X}),e.jsxs(k,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Status",m.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:m.length>1?`${m.length} selected`:m[0]})]})}),e.jsxs(q,{className:"w-44 p-1",side:"bottom",align:"start",children:[["Pending","Approved","Rejected"].map(s=>e.jsxs("div",{onClick:()=>b(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]),className:"flex items-center gap-2 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(F,{checked:m.includes(s)}),e.jsx("span",{className:"text-sm",children:s})]},s)),e.jsx(l,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>b([]),children:"Clear"})]})]}),e.jsxs(k,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Type",p.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:p.length>1?`${p.length} selected`:p[0]})]})}),e.jsxs(q,{className:"w-44 p-1",side:"bottom",align:"start",children:[["Proposal","Prefinal","Final"].map(s=>e.jsxs("div",{onClick:()=>C(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]),className:"flex items-center gap-2 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(F,{checked:p.includes(s)}),e.jsx("span",{className:"text-sm",children:s})]},s)),e.jsx(l,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>C([]),children:"Clear"})]})]}),e.jsxs(k,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(ce,{size:14}),"Date",(r==null?void 0:r.from)&&(r==null?void 0:r.to)&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:`${O(r.from,"MMM dd")} - ${O(r.to,"MMM dd")}`})]})}),e.jsxs(q,{className:"w-auto p-2",side:"bottom",align:"start",children:[e.jsx(oe,{mode:"range",selected:r,onSelect:w}),e.jsx(l,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>w(void 0),children:"Clear Dates"})]})]}),(m.length>0||p.length>0||(r==null?void 0:r.from)||x.trim())&&e.jsxs(l,{variant:"ghost",size:"sm",className:"h-8 px-3 flex items-center gap-1",onClick:()=>{b([]),C([]),w(void 0),T("")},children:[e.jsx(de,{size:14})," Reset"]})]})})]}),e.jsx("div",{className:"w-full flex-1 flex flex-col min-h-0 overflow-hidden",children:e.jsx(ee,{paged:H,columns:B,toggleSort:J,sortDir:g,onPriorityChange:K,tabType:void 0,onViewDetails:s=>U.visit(`/coordinator/defense-requests/${s}/details`),onRowApprove:s=>S(s,"approve"),onRowReject:s=>S(s,"reject"),onRowRetrieve:s=>S(s,"retrieve"),highlightMissingDateMode:!1,hideActions:!1,hideSelect:!0})}),e.jsx(ge,{page:N,totalPages:G,onPageChange:A})]}),e.jsx(se,{open:n.open,onOpenChange:s=>{s||h({open:!1,id:null,action:null})},children:e.jsxs(te,{children:[e.jsx(re,{children:"Confirm Action"}),e.jsx(ie,{children:n.action==="approve"?"Please review before approving.":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[n.id&&e.jsxs("p",{children:["Request #",n.id,": Set to"," ",e.jsx("span",{className:"font-semibold",children:n.action==="approve"?"Approved":n.action==="reject"?"Rejected":"Pending"}),"?"]}),n.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(me,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving this defense request authorizes the use of your signature on the official defense documents."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(l,{variant:"ghost",onClick:()=>h({open:!1,id:null,action:null}),children:"Cancel"}),e.jsx(l,{onClick:W,children:"Confirm"})]})]})})]})}function Ms(o){if(o.withLayout){const c=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/defense-request"}];return e.jsx(ne,{breadcrumbs:c,children:e.jsx(E,{...o})})}return e.jsx(E,{...o})}export{Ms as default};
