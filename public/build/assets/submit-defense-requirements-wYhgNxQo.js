import{K as de,r,m as oe,j as e}from"./app-BDkuJsct.js";import{L as l}from"./label-MiJboLk1.js";import{I as n}from"./input-BmPXXlp0.js";import{B as x}from"./button-DggClj9M.js";import{S as h}from"./separator-DaKqQg6m.js";import{S as ce}from"./Stepper-CN-_nE1p.js";import{D as I,a as B,d as K,b as U,c as V}from"./dialog-DeUj0iLU.js";import{A as me,b as xe,c as he,d as pe,e as fe,f as ue,h as je}from"./alert-dialog-DdsprEOQ.js";import{P as v}from"./paperclip-CfL61ESm.js";import{C as ge}from"./check-BUlQxyEc.js";import{C as ve}from"./circle-alert-BxXeSR-n.js";import{f as C}from"./format-Cze4Gw5q.js";import"./index-BhbofC_p.js";import"./index-B_a1aFVM.js";import"./utils-jAU0Cazi.js";import"./index-DZZQifJx.js";import"./index-LRezjsDo.js";import"./index-CWqpdCTP.js";import"./index-D-bfryUZ.js";import"./x-CtfT_1vN.js";import"./createLucideIcon-CEmaZ7tj.js";function Ue({onFinish:Ne,open:F,onOpenChange:N,acceptDefense:G=!0}){var k,E,L,q,$,z;const{props:D}=de(),d=((k=D==null?void 0:D.auth)==null?void 0:k.user)||{},i=Array.isArray(d.advisers)&&d.advisers.length>0?d.advisers[0]:null,A=r.useRef(null),R=r.useRef(null),M=r.useRef(null),T=r.useRef(null),O=r.useRef(null),[y,H]=r.useState([]),{data:s,setData:c,post:Y,processing:J,reset:W}=oe({first_name:d.first_name||"",middle_name:d.middle_name||"",last_name:d.last_name||"",school_id:d.school_id||"",program:d.program||"",thesis_title:"",adviser:i?`${i.first_name} ${i.middle_name?i.middle_name+" ":""}${i.last_name}`:"",adviser_id:i?i.id:null,status:"pending",defense_type:"",rec_endorsement:null,proof_of_payment:null,reference_no:"",payment_date:null,manuscript_proposal:null,similarity_index:null,avisee_adviser_attachment:null,amount:""}),[ye,_e]=r.useState(!1),[o,_]=r.useState(0),[Q,X]=r.useState(!1),[Z,m]=r.useState(!1),[ee,p]=r.useState("");r.useEffect(()=>{fetch("/dean/payment-rates/data").then(a=>a.json()).then(a=>{a.rates&&H(a.rates)}).catch(a=>console.error("Failed to fetch payment rates:",a))},[]),r.useEffect(()=>{if(!s.defense_type||!s.program||y.length===0){c("amount","");return}let a="Masteral";const t=s.program.toLowerCase().trim();["doctor","doctorate","doctoral","phd","ph.d","ph. d","dba","edd","ed.d","dsc","dpm","dpa"].some(f=>t.includes(f))?a="Doctorate":a="Masteral";const b=s.defense_type;console.log("Payment calculation:",{program:s.program,mappedLevel:a,defenseType:b,availableRates:y});const P=y.filter(f=>{const w=f.program_level===a,ie=f.defense_type.toLowerCase()===b.toLowerCase();return w&&ie});console.log("Matching rates:",P);const S=P.reduce((f,w)=>f+Number(w.amount),0);console.log("Total calculated amount:",S),c("amount",S>0?S.toFixed(2):"0.00")},[s.defense_type,s.program,y]);function u(a){return t=>{var j;if((j=t.target.files)!=null&&j[0]){const g=t.target.files[0],b=200*1024*1024,P=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg","image/gif","image/webp"];if(g.size>b){p(`File size too large. Maximum allowed size is 200MB. Your file is ${(g.size/(1024*1024)).toFixed(2)}MB.`),m(!0),t.target.value="";return}if(!P.includes(g.type)){p("File type not allowed. Please upload PDF, Word documents, or images (JPEG, PNG)."),m(!0),t.target.value="";return}c(a,g)}}}function se(){const a={firstName:s.first_name,middleName:s.middle_name,lastName:s.last_name,schoolId:s.school_id,program:s.program,thesisTitle:s.thesis_title,defenseAdviser:s.adviser,defenseType:s.defense_type,recEndorsement:s.rec_endorsement,proofOfPayment:s.proof_of_payment,referenceNo:s.reference_no,paymentDate:s.payment_date?C(s.payment_date,"yyyy-MM-dd"):null,amount:s.amount,manuscriptProposal:s.manuscript_proposal,similarityIndex:s.similarity_index,aviseeAdviserAttachment:s.avisee_adviser_attachment};Y(route("defense-requirements.store"),{data:a,forceFormData:!0,onSuccess:()=>{window.location.reload()},onError:t=>{if(console.error("Submission failed:",t),t.message&&t.message.includes("POST Content-Length"))p("File upload failed: Files are too large. Please ensure each file is under 200MB and try again."),m(!0);else if(t.message&&t.message.includes("PostTooLargeException"))p("Upload size limit exceeded. Please reduce file sizes and try again."),m(!0);else{const j=Object.values(t).flat().join(`
`);p(`Submission failed:
${j}`),m(!0)}},onProgress:t=>{console.log("Upload progress:",t)}})}function ae(){return!(!s.defense_type||!s.thesis_title.trim()||!s.manuscript_proposal||!s.similarity_index||!s.proof_of_payment||!s.reference_no.trim()||!s.payment_date||s.amount===""||s.amount===null||s.amount===void 0||s.defense_type==="Proposal"&&!s.avisee_adviser_attachment||(s.defense_type==="Pre-final"||s.defense_type==="Final")&&!s.rec_endorsement)}function te(){if(o===0){_(o+1);return}if(o===1){if(!ae()){p("Please fill in all required fields and upload all required documents before proceeding."),m(!0);return}_(o+1);return}o===2&&se()}function le(){o>0&&_(o-1)}function ne(a){N(a),a||(_(0),W(),X(!1))}const re=[{title:"Personal Information",content:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Student Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"First Name"}),e.jsx(n,{value:s.first_name,readOnly:!0,disabled:!0,placeholder:"First Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Middle Name"}),e.jsx(n,{value:s.middle_name,readOnly:!0,disabled:!0,placeholder:"Middle Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Last Name"}),e.jsx(n,{value:s.last_name,readOnly:!0,disabled:!0,placeholder:"Last Name",className:"h-8 text-sm"})]})]})]}),e.jsx(h,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"School ID"}),e.jsx(n,{value:s.school_id,readOnly:!0,disabled:!0,placeholder:"School ID",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Program"}),e.jsx(n,{value:s.program,readOnly:!0,disabled:!0,placeholder:"Program",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Adviser"}),e.jsx(n,{value:i?`${i.first_name} ${i.middle_name?i.middle_name+" ":""}${i.last_name}`:"No adviser registered",readOnly:!0,disabled:!0,placeholder:"Adviser",className:"h-8 text-sm"})]})]})]})},{title:"Defense Type & Thesis Information",content:e.jsxs("div",{className:"space-y-6 pb-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Defense Details"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[{value:"Proposal",label:"Proposal"},{value:"Pre-final",label:"Pre-final"},{value:"Final",label:"Final"}].map(a=>e.jsx("button",{type:"button",onClick:()=>c("defense_type",a.value),className:`rounded-md px-4 py-2 text-xs font-medium cursor-pointer border
                                        ${s.defense_type===a.value?"bg-rose-500 text-white border-rose-500":"bg-white text-zinc-700 border-zinc-200"}`,"aria-pressed":s.defense_type===a.value,children:a.label},a.value))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select the type of defense you are applying for."})]}),e.jsx(h,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Thesis Information"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Thesis Title ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx(n,{value:s.thesis_title,onChange:a=>c("thesis_title",a.target.value),placeholder:"Thesis Title",className:"h-8 text-sm"})]})})]}),e.jsx(h,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Document Uploads"}),e.jsxs("p",{className:"text-xs text-gray-600 mb-3",children:["Please upload the required documents below. ",e.jsx("strong",{children:"PDF files only"})," are accepted. ",e.jsx("br",{})]}),e.jsxs("div",{className:"space-y-4",children:[(s.defense_type==="Pre-final"||s.defense_type==="Final")&&e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["REC Endorsement ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{readOnly:!0,value:s.rec_endorsement?s.rec_endorsement.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(x,{variant:"outline",type:"button",onClick:()=>{var a;return(a=M.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(v,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:M,className:"hidden",onChange:u("rec_endorsement")})]})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Manuscript ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{readOnly:!0,value:s.manuscript_proposal?s.manuscript_proposal.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(x,{variant:"outline",type:"button",onClick:()=>{var a;return(a=A.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(v,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:A,className:"hidden",onChange:u("manuscript_proposal")})]})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Similarity Form ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{readOnly:!0,value:s.similarity_index?s.similarity_index.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(x,{variant:"outline",type:"button",onClick:()=>{var a;return(a=R.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(v,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:R,className:"hidden",onChange:u("similarity_index")})]})]}),s.defense_type==="Proposal"&&e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Avisee-Adviser Attachment ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{readOnly:!0,value:s.avisee_adviser_attachment?s.avisee_adviser_attachment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(x,{variant:"outline",type:"button",onClick:()=>{var a;return(a=O.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(v,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:O,className:"hidden",onChange:u("avisee_adviser_attachment")})]})]})]})]}),e.jsx(h,{className:"my-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Payment"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs mb-1",children:["Proof of Payment ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{readOnly:!0,value:s.proof_of_payment?s.proof_of_payment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(x,{variant:"outline",type:"button",onClick:()=>{var a;return(a=T.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(v,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:T,className:"hidden",onChange:u("proof_of_payment")})]})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs mb-1 flex items-center gap-1",children:["Amount ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-700",children:"₱"}),e.jsx(n,{type:"text",value:s.amount?parseFloat(s.amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):s.defense_type?"0.00":"",readOnly:!0,disabled:!0,placeholder:s.defense_type?"Calculating...":"Select defense type first",className:"h-8 text-sm w-48 bg-gray-50"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please ensure that the submitted proof of payment matches the amount reflected above."})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs mb-1",children:["Payment Date ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx(n,{type:"date",value:s.payment_date?C(s.payment_date,"yyyy-MM-dd"):"",onChange:a=>{const t=a.target.value;c("payment_date",t?new Date(t):null)},className:"h-8 text-sm w-full",required:!0})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs mb-1",children:["Reference No. ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx(n,{value:s.reference_no,onChange:a=>c("reference_no",a.target.value),placeholder:"Reference No.",className:"h-8 text-sm"})]})]})]})]})},{title:"Review Submission",content:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"rounded-lg border border-rose-200 bg-rose-50 p-4 text-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",`${s.first_name} ${s.middle_name} ${s.last_name}`]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"School ID:"})," ",s.school_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Program:"})," ",s.program]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Adviser:"})," ",s.adviser]})]})]}),e.jsx(h,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Defense Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Type of Defense:"})," ",s.defense_type]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Thesis Title:"})," ",s.thesis_title]})]})]}),e.jsx(h,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Document Uploads"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[(s.defense_type==="Pre-final"||s.defense_type==="Final")&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"REC Endorsement:"})," ",((E=s.rec_endorsement)==null?void 0:E.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Manuscript:"})," ",((L=s.manuscript_proposal)==null?void 0:L.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Similarity Form:"})," ",((q=s.similarity_index)==null?void 0:q.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),s.defense_type==="Proposal"&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Avisee-Adviser Attachment:"})," ",(($=s.avisee_adviser_attachment)==null?void 0:$.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]})]})]}),e.jsx(h,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Payment"}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Proof of Payment:"})," ",((z=s.proof_of_payment)==null?void 0:z.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reference No.:"})," ",s.reference_no]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Payment Date:"})," ",s.payment_date?C(s.payment_date,"PPP"):e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"}),s.amount?e.jsxs("span",{children:["₱ ",parseFloat(s.amount).toLocaleString(void 0,{minimumFractionDigits:2})]}):e.jsx("span",{className:"text-muted-foreground",children:"—"})]})]})]})]})})}];return G?e.jsxs(I,{open:F,onOpenChange:ne,children:[e.jsxs(B,{className:"flex h-[95vh] w-full max-w-3xl flex-col",children:[e.jsxs(K,{children:[e.jsx(U,{children:"Submit Defense Requirements"}),e.jsx(V,{children:"Fill up all necessary information"})]}),Q?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center space-y-6 px-4",children:[e.jsx(ge,{size:48,className:"text-rose-500"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Requirements Submitted!"}),e.jsx("p",{className:"text-center text-gray-600",children:"Your defense requirements have been saved successfully."}),e.jsx(x,{onClick:()=>N(!1),children:"Done"})]}):e.jsx("div",{className:"flex-1 overflow-auto px-2",children:e.jsx(ce,{steps:re,currentStep:o,onNext:te,onPrev:le,loading:J,className:"h-full"})})]}),e.jsx(me,{open:Z,onOpenChange:m,children:e.jsxs(xe,{children:[e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-amber-100",children:e.jsx(ve,{className:"h-5 w-5 text-amber-600"})}),e.jsx(pe,{className:"text-lg",children:"Required Fields Missing"})]}),e.jsx(fe,{className:"pt-3 text-base whitespace-pre-line",children:ee})]}),e.jsx(ue,{children:e.jsx(je,{className:"bg-rose-600 hover:bg-rose-700",children:"OK"})})]})})]}):e.jsx(I,{open:F,onOpenChange:N,children:e.jsxs(B,{children:[e.jsxs(K,{children:[e.jsx(U,{children:"Defense Requirement Submission Closed"}),e.jsx(V,{children:"The coordinator has disabled defense requirement submissions. Please try again later or contact your coordinator."})]}),e.jsx(x,{onClick:()=>N(!1),children:"Close"})]})})}export{Ue as default};
