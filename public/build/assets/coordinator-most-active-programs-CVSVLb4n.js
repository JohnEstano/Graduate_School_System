import{r as o,j as e}from"./app-CQngmq00.js";import{C as i,a as c,b as l,d,c as u,e as C}from"./card-C_emSl4Q.js";import{C as q,a as y,b as v}from"./chart-BC_ZPf9S.js";import{B as b}from"./BarChart-C9yfhd02.js";import{Y as A,X as N}from"./YAxis-CFpew_UZ.js";import{B as L}from"./generateCategoricalChart-RpaH3faT.js";import"./utils-jAU0Cazi.js";import"./index-BGXDct6C.js";import"./index-Chjiymov.js";const k={requests:{label:"Requests",color:"#e11d48"}};function X(){const[a,h]=o.useState([]),[x,p]=o.useState(!0),[E,j]=o.useState(0);return o.useEffect(()=>{fetch("/defense-requests",{headers:{Accept:"application/json"}}).then(r=>{if(!r.ok)throw new Error("Failed to fetch");return r.json()}).then(r=>{const m=(Array.isArray(r)?r:r.defenseRequests??[]).filter(s=>s.workflow_state==="coordinator-approved"||s.scheduled_date!==null);j(m.length);const n={};m.forEach(s=>{var f;const t=s.program||((f=s.user)==null?void 0:f.program)||"Unknown Program";n[t]=(n[t]||0)+1});const g=Object.entries(n).map(([s,t])=>({program:s.length>25?s.substring(0,25)+"...":s,requests:t})).sort((s,t)=>t.requests-s.requests).slice(0,5);h(g)}).catch(r=>{console.error("Error fetching defense requests:",r),h([])}).finally(()=>{p(!1)})},[]),x?e.jsxs(i,{children:[e.jsxs(c,{children:[e.jsx(l,{children:"Most Active Programs"}),e.jsx(d,{children:"Loading..."})]}),e.jsx(u,{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading chart data..."})})]}):a.length===0?e.jsxs(i,{children:[e.jsxs(c,{children:[e.jsx(l,{children:"Most Active Programs"}),e.jsx(d,{children:"No data available"})]}),e.jsx(u,{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"No scheduled or approved defense requests found"})})]}):e.jsxs(i,{children:[e.jsxs(c,{children:[e.jsx(l,{children:"Most Active Programs"}),e.jsx(d,{children:"Top 5 programs by defense requests"})]}),e.jsx(u,{children:e.jsx(q,{config:k,children:e.jsxs(b,{accessibilityLayer:!0,data:a,layout:"vertical",margin:{left:0},children:[e.jsx(A,{dataKey:"program",type:"category",tickLine:!1,tickMargin:10,axisLine:!1,tickFormatter:r=>r}),e.jsx(N,{dataKey:"requests",type:"number",hide:!0}),e.jsx(y,{cursor:!1,content:e.jsx(v,{hideLabel:!0})}),e.jsx(L,{dataKey:"requests",fill:"var(--color-requests)",radius:5})]})})}),e.jsx(C,{className:"flex-col items-start gap-2 text-sm",children:e.jsxs("div",{className:"flex gap-2 font-medium leading-none",children:["Top program: ",a[0].program," (",a[0].requests,")"]})})]})}export{X as CoordinatorMostActivePrograms};
