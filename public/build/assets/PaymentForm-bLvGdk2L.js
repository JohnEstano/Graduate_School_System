import{r as a,m as M,j as e}from"./app-BDkuJsct.js";import{L as x}from"./label-MiJboLk1.js";import{I as j}from"./input-BmPXXlp0.js";import{B as h}from"./button-DggClj9M.js";import{P as O,a as D,b as I}from"./popover-CxnVWzfd.js";import{C as S}from"./calendar-BhsmegxW.js";import{S as E}from"./separator-DaKqQg6m.js";import{C as $}from"./calendar-CI-DWPmu.js";import{P as q}from"./paperclip-CfL61ESm.js";import{c as A}from"./createLucideIcon-CEmaZ7tj.js";import{p as T}from"./parse-BrgCSArQ.js";import{f as P}from"./format-Cze4Gw5q.js";import"./index-BhbofC_p.js";import"./index-B_a1aFVM.js";import"./utils-jAU0Cazi.js";import"./index-DZZQifJx.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./index-D-bfryUZ.js";import"./endOfWeek-BqBOMalL.js";import"./differenceInCalendarMonths-BlVIDW-K.js";import"./normalizeInterval-6lUcOLZ2.js";import"./endOfMonth-DvPI_8Ds.js";import"./isSameDay-DsAL-Hdb.js";import"./isSameMonth-C-hFGgGu.js";import"./chevron-right-BpKiIXqV.js";import"./chevron-down-DMxaecxw.js";import"./index-LRezjsDo.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],B=A("Image",z);function fe({canSubmit:d,payment:t,onSuccess:f}){const[l,p]=a.useState(null),[g,n]=a.useState(""),b=a.useRef(null),[R,N]=a.useState(!1),_=a.useMemo(()=>{if(t!=null&&t.payment_date)try{return T(t.payment_date,"yyyy-MM-dd",new Date)}catch{return}},[t==null?void 0:t.payment_date]),[o,v]=a.useState(_),{data:C,setData:m,post:k,processing:c,errors:i,reset:w}=M({or_number:(t==null?void 0:t.or_number)??"",payment_date:(t==null?void 0:t.payment_date)??"",receipt_image:null,amount_paid:(t==null?void 0:t.amount_paid)??null});a.useEffect(()=>{o?m("payment_date",P(o,"yyyy-MM-dd")):m("payment_date","")},[o]),a.useEffect(()=>{if(!g&&(t!=null&&t.receipt_image)){const r=t.receipt_image.split("/").pop()||t.receipt_image;n(r)}},[t==null?void 0:t.receipt_image,g]),a.useEffect(()=>()=>{l&&URL.revokeObjectURL(l)},[l]);function U(){var r;(r=b.current)==null||r.click()}function L(r){var u;const s=((u=r.currentTarget.files)==null?void 0:u[0])??null;m("receipt_image",s),l&&URL.revokeObjectURL(l),s?(n(s.name),p(URL.createObjectURL(s))):(n(""),p(null))}function F(r){r.preventDefault(),k(route("payment.store"),{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{p(null),n(""),w("receipt_image"),f==null||f()}})}return e.jsxs("div",{className:"rounded-lg bg-white",children:[e.jsxs("div",{className:"py-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Payment Form"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Submit your official receipt for verification."})]}),e.jsx("div",{className:"p-2",children:e.jsxs("form",{onSubmit:F,encType:"multipart/form-data",className:"grid gap-5 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-sm",children:"OR number"}),e.jsx(j,{className:"mt-1 h-9",value:C.or_number,placeholder:"e.g. 2025-OR-000123",inputMode:"text",autoCapitalize:"characters",autoCorrect:"off",spellCheck:!1,pattern:"^[A-Z0-9-]+$",title:"Use only capital letters, numbers, and dashes",onChange:r=>{const s=r.target.value.toUpperCase().replace(/[^A-Z0-9-]/g,"");m("or_number",s)},disabled:!d||c,maxLength:50,required:!0}),i.or_number&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.or_number})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm",children:"Amount Paid"}),e.jsx(j,{type:"number",step:"0.01",min:"0",className:"mt-1 h-9",value:C.amount_paid??"",placeholder:"e.g. 100.00",inputMode:"decimal",onChange:r=>{const s=r.target.value,u=s===""?null:Number.parseFloat(s);m("amount_paid",Number.isFinite(u)?u:null)},disabled:!d||c,required:!0}),i.amount_paid&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.amount_paid})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm",children:"Payment date"}),e.jsxs(O,{open:R,onOpenChange:N,children:[" ",e.jsx(D,{asChild:!0,children:e.jsxs(h,{variant:"outline",type:"button",disabled:!d||c,className:`mt-1 h-9 w-full justify-start text-left font-normal ${o?"":"text-muted-foreground"}`,children:[e.jsx($,{className:"mr-2 h-4 w-4"}),o?P(o,"MM/dd/yyyy"):e.jsx("span",{children:"Select date"})]})}),e.jsx(I,{className:"z-[1001] w-auto p-0 pointer-events-auto",align:"start",side:"bottom",children:e.jsx(S,{mode:"single",selected:o,onSelect:r=>{r&&v(r),N(!1)},initialFocus:!0})})]}),i.payment_date&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.payment_date})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{className:"text-sm",children:"Receipt image"}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center gap-2",children:[e.jsx(j,{readOnly:!0,value:g||"",placeholder:"No file chosen",className:"flex-1 h-9"}),e.jsxs(h,{variant:"outline",type:"button",onClick:U,disabled:!d||c,className:"h-9",children:[e.jsx(q,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",name:"receipt_image",className:"hidden",onChange:L,required:!(t!=null&&t.receipt_image)})]}),i.receipt_image&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.receipt_image}),l?e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:l,alt:"Receipt preview",className:"h-36 w-auto rounded-md border border-slate-200 dark:border-slate-700 object-contain bg-white"})}):t!=null&&t.receipt_image?e.jsx("div",{className:"mt-2 text-sm",children:e.jsxs("a",{className:"inline-flex items-center gap-1 text-primary underline hover:no-underline",href:`/storage/${t.receipt_image}`,target:"_blank",rel:"noreferrer",children:[e.jsx(B,{className:"h-4 w-4"}),"View current receipt"]})}):null]}),e.jsx(E,{className:"md:col-span-2"}),e.jsxs("div",{className:"md:col-span-2 flex items-center justify-end gap-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>{p(null),n(""),w(),v(_)},disabled:c,className:"h-9",children:"Clear"}),e.jsx(h,{type:"submit",className:"bg-rose-500 h-9",disabled:!d||c,children:c?"Submittingâ€¦":t?"Update Payment":"Submit Payment"})]})]})})]})}export{fe as default};
