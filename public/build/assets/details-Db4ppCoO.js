import{r as x,j as s,L as te,S as B}from"./app-DW0Mt5c9.js";import{A as ae}from"./app-layout-CPwLq_xH.js";import{B as g}from"./badge-B7OUzsXL.js";import{S as h}from"./separator-4d5ucxHB.js";import{A as ne,a as oe}from"./avatar-B3rD_VQk.js";import{B as U}from"./button-BZf0VdIO.js";import{t as N}from"./index-ByTeG7FR.js";import{T as ie,a as ce,b as q,c as v,d as me,e as y}from"./table-CYsX4eCK.js";import{c as I}from"./utils-jAU0Cazi.js";import{A as le}from"./arrow-left-DClE7kxt.js";import{C as de}from"./circle-check-big-CG9wjNDm.js";import{U as O}from"./user-IcA54EZW.js";import{F as w}from"./file-text-Dpj0IN7n.js";import{C as _}from"./clock-CNQjyXBL.js";import{S as xe}from"./send-BUfb6BoG.js";import{U as fe}from"./user-check-CRf546ie.js";import{S as ue}from"./signature-D_iqDcqD.js";import{C as pe}from"./circle-x-C4V9EZEC.js";import{C as he}from"./circle-arrow-left-BUa1uPht.js";import{f as k}from"./format-HX8DKPSU.js";import"./index-RzYQM1sh.js";import"./index-DZZQifJx.js";import"./input-Ch6RmxP_.js";import"./index-BMNAwHVU.js";import"./index-DHu7YzAG.js";import"./index-Bh88FqJG.js";import"./x-CW6T59GI.js";import"./createLucideIcon-S0dKkUVo.js";import"./tooltip-3yEC6fE6.js";import"./floating-ui.react-dom-DEJ-U2zP.js";import"./chevron-right-x7vIKCyG.js";import"./dropdown-menu-FJcetjAu.js";import"./index-dxfJWdT_.js";import"./index-I9YLalqX.js";import"./index-xrb8sl6P.js";import"./index-Au_TdUcj.js";import"./index-Bwn0NV8Z.js";import"./check-C1Ca0PY3.js";import"./settings-DPsrAkv5.js";import"./users-CFj_s0Ga.js";import"./graduation-cap-d15gjgNL.js";import"./dollar-sign-DVIUp7aq.js";import"./credit-card-Bzx9FpUt.js";import"./tabs-3Dm9feNm.js";import"./info-Dl-vg0Zq.js";import"./sun-C_6rnlvD.js";import"./en-US-BA9orzCf.js";function V(c){if(!c)return"—";try{return k(new Date(c),"PPP")}catch{return c}}function K(c){if(!c)return"";const[e,d]=(c||"").split(":");if(e===void 0||d===void 0)return c||"";const l=new Date;return l.setHours(Number(e),Number(d)),k(l,"hh:mm a")}function je(c){var l,u,j,f;const e=((u=(l=c.first_name)==null?void 0:l.trim())==null?void 0:u[0])??"",d=((f=(j=c.last_name)==null?void 0:j.trim())==null?void 0:f[0])??"";return(e+d).toUpperCase()||"U"}function ds({defenseRequest:c}){var S,T,R,F,D,E,M,z,H,L;const[e,d]=x.useState(c??null),[l,u]=x.useState([]),[j,f]=x.useState(!1),[W,P]=x.useState([]);x.useEffect(()=>{let r=!0;async function n(){f(!0);try{const a=await fetch("/api/panel-members",{headers:{Accept:"application/json"}});if(a.ok){const t=await a.json();r&&u(Array.isArray(t)?t:[])}}catch(a){console.warn("Failed to load panel members",a)}finally{r&&f(!1)}}return n(),()=>{r=!1}},[]),x.useEffect(()=>{let r=!0;return(async()=>{try{const a=await(await fetch("/dean/payment-rates/data",{headers:{Accept:"application/json"}})).json(),t=Array.isArray(a==null?void 0:a.rates)?a.rates:Array.isArray(a)?a:[];r&&P(t)}catch{r&&P([])}})(),()=>{r=!1}},[]);function X(r){return r?l.find(n=>n.name===r):null}function G(r){if(!(e!=null&&e.program_level)||!(e!=null&&e.defense_type))return null;let n="";r==="Adviser"?n="Adviser":n="Panel Chair";const a=o=>o.toLowerCase().replace(/[^a-z]/g,""),t=a(e.defense_type),i=W.find(o=>{const p=o.program_level===e.program_level,b=o.type===n,$=a(o.defense_type||"")===t;return p&&b&&$});return i?Number(i.amount):null}const A=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/assistant/all-defense-list"}];if(e!=null&&e.id){const r=(((S=e.thesis_title)==null?void 0:S.length)||0)>60?e.thesis_title.slice(0,57)+"...":e.thesis_title||`Request #${e.id}`;A.push({title:r,href:`/assistant/all-defense-list/${e.id}/details`})}function J(r){var i;const n=r.event_type||r.action||r.status_change||r.status||r.type||"Event",a=r.created_at||r.timestamp||r.performed_at||r.date||"",t=r.user_name||((i=r.user)==null?void 0:i.name)||r.actor_name||r.actor||r.performed_by_name||r.performed_by||"";return{event:n,created:a,userName:t}}function Q(r){if(!r)return"";try{return k(new Date(r),"PPpp")}catch{return r}}function m(r){return r?/^https?:\/\//i.test(r)||r.startsWith("/storage/")?r:`/storage/${r.replace(/^\/?storage\//,"")}`:null}const C=[{label:"Adviser's Endorsement",url:m((T=e==null?void 0:e.attachments)==null?void 0:T.advisers_endorsement)},{label:"REC Endorsement",url:m((R=e==null?void 0:e.attachments)==null?void 0:R.rec_endorsement)},{label:"Proof of Payment",url:m((F=e==null?void 0:e.attachments)==null?void 0:F.proof_of_payment)},{label:"Manuscript",url:m((D=e==null?void 0:e.attachments)==null?void 0:D.manuscript_proposal)},{label:"Similarity Index",url:m((E=e==null?void 0:e.attachments)==null?void 0:E.similarity_index)},{label:"Avisee-Adviser File",url:m((M=e==null?void 0:e.attachments)==null?void 0:M.avisee_adviser_attachment)},{label:"AI Detection Certificate",url:m((z=e==null?void 0:e.attachments)==null?void 0:z.ai_detection_certificate)},{label:"Endorsement Form",url:m((H=e==null?void 0:e.attachments)==null?void 0:H.endorsement_form)}],Y="rounded-lg border p-5 space-y-3",Z=[{key:"submitted",label:"Submitted",icon:s.jsx(xe,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:s.jsx(fe,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:s.jsx(ue,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:s.jsx(O,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:s.jsx(_,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected",icon:s.jsx(pe,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved",icon:s.jsx(he,{className:"h-5 w-5"})}];function ee(r){return r=(r||"").toLowerCase(),r.includes("submit")?"submitted":r.includes("adviser-approved")||r.includes("endorsed")?"adviser-approved":r.includes("coordinator-approved")?"coordinator-approved":r.includes("panel")?"panels-assigned":r.includes("schedule")?"scheduled":r.includes("rejected")?"rejected":r.includes("retrieved")?"retrieved":""}async function se(){var r;if(e)try{const n=await fetch(`/defense-requests/${e.id}/complete`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)||""}}),a=await n.json();n.ok&&a.success?(d({...e,status:"Completed",workflow_state:"completed"}),N.success("Defense marked as completed and honorarium payments created!"),setTimeout(()=>{B.visit("/assistant/all-defense-list")},1500)):N.error(a.error||"Failed to mark as completed")}catch(n){console.error("Error marking as completed:",n),N.error("Error marking as completed")}}return s.jsxs(ae,{breadcrumbs:A,children:[s.jsx(te,{title:(e==null?void 0:e.thesis_title)||`Defense Request #${(e==null?void 0:e.id)??""}`}),s.jsxs("div",{className:"p-5 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap mb-4",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(U,{variant:"outline",onClick:()=>B.visit("/assistant/all-defense-list"),className:"h-8 px-2",children:s.jsx(le,{className:"h-4 w-4"})})}),(e==null?void 0:e.status)!=="Completed"&&s.jsxs(U,{size:"sm",variant:"outline",onClick:se,className:"gap-2",children:[s.jsx(de,{className:"h-4 w-4 text-green-600"}),"Mark as Completed"]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"md:col-span-2 space-y-6",children:[s.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[s.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-start md:justify-between gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-2xl font-semibold",children:e==null?void 0:e.thesis_title}),s.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),s.jsx(g,{variant:"secondary",className:I("text-xs font-semibold px-3 py-1 h-fit",(e==null?void 0:e.status)==="Completed"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":(e==null?void 0:e.status)==="Approved"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":(e==null?void 0:e.status)==="Rejected"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:(e==null?void 0:e.status)||"Pending"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ne,{className:"h-8 w-8",children:s.jsx(oe,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:je({first_name:e==null?void 0:e.first_name,last_name:e==null?void 0:e.last_name})})}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-sm leading-tight",children:[e==null?void 0:e.first_name," ",e!=null&&e.middle_name?`${e.middle_name} `:"",e==null?void 0:e.last_name]}),s.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:e==null?void 0:e.school_id})]})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),s.jsx("div",{className:"font-medium text-sm",children:e==null?void 0:e.program})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),s.jsx(g,{variant:"secondary",className:"text-xs font-medium",children:(e==null?void 0:e.defense_type)??"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Submitted At"}),s.jsx("div",{className:"font-medium text-sm",children:V(e==null?void 0:e.submitted_at)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program Coordinator"}),s.jsx("div",{className:"font-medium text-sm",children:((L=e==null?void 0:e.coordinator)==null?void 0:L.name)||"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Coordinator Status"}),s.jsx(g,{variant:"secondary",className:I("text-xs font-semibold",(e==null?void 0:e.coordinator_status)==="Approved"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":(e==null?void 0:e.coordinator_status)==="Rejected"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:(e==null?void 0:e.coordinator_status)||"Pending"})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(h,{className:"my-2"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Expected Amount"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.expected_rate?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(e.expected_rate):"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Amount Paid"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.amount?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(e.amount):"—"})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(h,{className:"my-2"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),s.jsx("div",{className:"font-medium text-sm",children:V(e==null?void 0:e.scheduled_date)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.scheduled_time?`${K(e.scheduled_time)}${e.scheduled_end_time?" - "+K(e.scheduled_end_time):""}`:"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.defense_venue)||"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),s.jsx("div",{className:"font-medium text-sm capitalize",children:e!=null&&e.defense_mode?e.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.scheduling_notes)||"—"})]})]})]}),s.jsxs("div",{className:"rounded-lg border p-5 space-y-3",children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(O,{className:"h-4 w-4"})," Committee"]}),s.jsx(h,{}),(()=>{const r=(t,i)=>{const o=X(t);return{displayName:(o==null?void 0:o.name)||t||"—",email:(o==null?void 0:o.email)||"",rawValue:t||"",role:i}},n=[{key:"adviser",info:r(e==null?void 0:e.defense_adviser,"Adviser")},{key:"chairperson",info:r(e==null?void 0:e.defense_chairperson,"Panel Chair")},{key:"panelist1",info:r(e==null?void 0:e.defense_panelist1,"Panel Member 1")},{key:"panelist2",info:r(e==null?void 0:e.defense_panelist2,"Panel Member 2")},{key:"panelist3",info:r(e==null?void 0:e.defense_panelist3,"Panel Member 3")},{key:"panelist4",info:r(e==null?void 0:e.defense_panelist4,"Panel Member 4")}].map(t=>{const o=!!(t.info.rawValue||t.info.displayName&&t.info.displayName!=="—")?G(t.info.role):null;return{name:t.info.displayName,email:t.info.email||"—",role:t.info.role,receivable:o}}),a=t=>t!==null?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(t):"—";return s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ie,{className:"border-0",children:[s.jsx(ce,{children:s.jsxs(q,{children:[s.jsx(v,{className:"min-w-[200px]",children:"Name & Email"}),s.jsx(v,{className:"min-w-[100px]",children:"Role"}),s.jsx(v,{className:"min-w-[140px] text-right",children:"Receivable"})]})}),s.jsx(me,{children:n.map((t,i)=>s.jsxs(q,{children:[s.jsx(y,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"font-medium text-sm",children:t.name}),s.jsx("span",{className:"text-xs text-muted-foreground",children:t.email})]})}),s.jsx(y,{className:"text-xs",children:t.role}),s.jsx(y,{className:"text-right text-xs font-medium",children:a(t.receivable)})]},i))})]})})})()]}),s.jsxs("div",{className:Y,children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(w,{className:"h-4 w-4"})," Attachments"]}),s.jsx(h,{}),s.jsxs("div",{className:"space-y-2 text-sm",children:[C.filter(r=>!!r.url).length===0&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),C.filter(r=>!!r.url).map(r=>{var n;return s.jsxs("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[s.jsx(w,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:r.label}),s.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(n=r.url)==null?void 0:n.split("/").pop()})]},r.label)}),(e==null?void 0:e.reference_no)&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[s.jsx(w,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"Reference No."}),s.jsx("span",{className:"ml-auto text-xs",children:e.reference_no})]})]})]})]}),s.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:s.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 sticky top-24 h-fit",children:[s.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[s.jsx(_,{className:"h-4 w-4"})," Workflow Progress"]}),s.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(e==null?void 0:e.workflow_history)&&e.workflow_history.length>0?e.workflow_history.map((r,n)=>{const{event:a,created:t,userName:i}=J(r),o=ee(a),p=Z.find(re=>re.key===o)||{label:a.charAt(0).toUpperCase()+a.slice(1),icon:s.jsx(_,{className:"h-5 w-5 text-gray-500"})},b=Array.isArray(e.workflow_history)&&n===e.workflow_history.length-1;return s.jsxs("div",{className:"flex items-start gap-3 relative",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:p.icon}),!b&&s.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),s.jsxs("div",{className:"pb-4",children:[s.jsx("div",{className:"font-semibold text-xs",children:p.label}),s.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[i&&s.jsx("span",{children:i}),t&&s.jsxs("span",{children:[" ","· ",Q(t)]})]})]})]},n)}):s.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]})]})]})}export{ds as default};
