import{K as S,r as n,j as e,L as A}from"./app-OOvd0qGy.js";import{A as M}from"./app-layout-4BSfGYAy.js";import{B as l}from"./button-Bvl2ELDv.js";import B from"./display-applications-D6uylaQv.js";import z from"./compre-exam-form-C0zeieC2.js";import{D as R,a as I,e as L,b as P,c as X,f as $}from"./dialog-DgFd6e46.js";import{B as w}from"./badge-9siNCstt.js";import{G as T}from"./graduation-cap-CCWiuwHf.js";import{c as y}from"./createLucideIcon-Cvkj7Hkp.js";import{R as q}from"./refresh-ccw-BVSvxwEp.js";import{I as F}from"./info-CIHMpyv0.js";import"./index-ChOW5_O6.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./input-CzcDJDbH.js";import"./index-B2wwfcIF.js";import"./index-DQ9rqnvl.js";import"./index-4w5oLsoB.js";import"./x-DrNmi13E.js";import"./tooltip-BFmjF_jJ.js";import"./floating-ui.react-dom-BrG2AUyT.js";import"./separator-Cye1ujSm.js";import"./index-B9sjBiRz.js";import"./chevron-right-BsU_TN8l.js";import"./dropdown-menu-JMbXV8S0.js";import"./index-DcZRhvrv.js";import"./index-kQq3evoo.js";import"./index-C9drr0Qb.js";import"./index-CQ9en90x.js";import"./index-C7ezi2Q7.js";import"./avatar-DboJvblb.js";import"./settings-BGemkvqC.js";import"./file-text-DLuaZQHd.js";import"./dollar-sign-4LNVBfuJ.js";import"./users-EStqJIUY.js";import"./credit-card-Bfq-rBsk.js";import"./tabs-BvigrSxv.js";import"./circle-check-big-Ddw5Ycw8.js";import"./sun-Ch86N1Y-.js";import"./chevron-down-CgfVHQYn.js";import"./book-open-zOvnsNoh.js";import"./hourglass-PkVD7duv.js";import"./circle-x-Cfzvg8iR.js";import"./badge-check-D9AtGDnO.js";import"./formatDistanceToNow-Bo4ytHt0.js";import"./constructNow-Chb2L4Vx.js";import"./en-US-BA9orzCf.js";import"./getRoundingMethod-Btu-7J5l.js";import"./differenceInCalendarMonths-HUNRrXGm.js";import"./endOfDay-UBg8OSOW.js";import"./endOfMonth-CK_ShA5m.js";import"./format-HX8DKPSU.js";import"./heading-small-BYfkW5vg.js";import"./label-CWMX11o4.js";import"./Stepper-SsStzHEi.js";import"./proxy-BaOzGSOe.js";import"./popover-Bp-FQuXL.js";import"./calendar--1HgbcTb.js";import"./endOfWeek-QFyZPl43.js";import"./normalizeInterval-CdMCNNY-.js";import"./isSameDay-DUlCFK42.js";import"./isSameMonth-CQd3m9St.js";import"./chevron-left-DIKbIxDb.js";import"./calendar-h4nCOpBr.js";import"./plus-7hsPCuko.js";import"./check-CihXD7iu.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]],G=y("CalendarX",K);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],V=y("ShieldAlert",H);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],U=y("ShieldCheck",Y),W=[{title:"Dashboard",href:"/dashboard"},{title:"Comprehensive Exam",href:"/comprehensive-exam"}];function ct(){var v;const{props:_}=S(),{application:t}=_,[E,d]=n.useState(!1),[o,u]=n.useState({examOpen:null,gradesComplete:null,documentsComplete:null,noOutstandingBalance:null,loading:!0,error:null}),[O,m]=n.useState(!1),[N,k]=n.useState(0);async function x(){var s;u(a=>({...a,loading:!0,error:null}));try{const a=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),g=await fetch("/api/comprehensive-exam/eligibility",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":a||""}});if(!g.ok)throw new Error(`API error: ${g.status}`);const f=(await g.json()).requirements||[],b=f.find(r=>r.name==="Complete documents submitted"),j=f.find(r=>r.name==="Complete grades (registrar verified)"),C=f.find(r=>r.name==="No outstanding tuition balance"),p={examOpen:!0,gradesComplete:(j==null?void 0:j.completed)??null,documentsComplete:(b==null?void 0:b.completed)??null,noOutstandingBalance:(C==null?void 0:C.completed)??null,loading:!1,error:null};u(p),p.gradesComplete===null&&p.documentsComplete===null&&p.noOutstandingBalance===null?N<5&&(console.log(`Data still loading, will retry in 3 seconds (attempt ${N+1}/5)`),setTimeout(()=>{k(r=>r+1),x()},3e3)):k(0)}catch(a){console.error("=== API ERROR ===",a),u({examOpen:null,gradesComplete:null,documentsComplete:null,noOutstandingBalance:null,loading:!1,error:a instanceof Error?a.message:"API call failed"})}}n.useEffect(()=>{x()},[]);const i=n.useMemo(()=>!!(o.examOpen&&o.gradesComplete&&o.documentsComplete&&o.noOutstandingBalance),[o]),h=o.examOpen===!1,c=t?((v=t.final_approval_status)==null?void 0:v.toLowerCase())==="pending":!1,D=n.useMemo(()=>[{label:"Exam window is open",ok:o.examOpen},{label:"Complete grades (registrar verified)",ok:o.gradesComplete},{label:"Complete documents submitted",ok:o.documentsComplete},{label:"No outstanding tuition balance",ok:o.noOutstandingBalance}],[o]);return e.jsxs(M,{breadcrumbs:W,children:[e.jsx(A,{title:"Comprehensive Exam"}),e.jsx("div",{className:"flex flex-col px-7 pt-5 pb-5 w-full",children:e.jsxs("div",{className:"w-full bg-white border border-zinc-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"flex flex-row items-center justify-between w-full p-3 border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-rose-500/10 border border-rose-500",children:e.jsx(T,{className:"h-5 w-5 text-rose-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"Comprehensive Exam"}),e.jsx("p",{className:"block text-xs text-muted-foreground",children:"Submit and track your comprehensive exam application."}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx(w,{variant:i?"secondary":"outline",className:h?"border-rose-300 text-rose-700 bg-rose-50":i?"border-green-300 text-green-700 bg-green-50":"",children:h?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),"Closed"]}):i?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),"Eligible"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3.5 w-3.5"}),"Not eligible"]})}),e.jsxs(l,{size:"sm",variant:"outline",className:"h-7 px-2 text-xs",onClick:x,disabled:o.loading,children:[e.jsx(q,{className:`h-3.5 w-3.5 mr-1 ${o.loading?"animate-spin":""}`}),"Refresh"]}),e.jsxs(l,{size:"sm",variant:"ghost",className:"h-7 px-2 text-xs",onClick:()=>m(!0),children:[e.jsx(F,{className:"h-3.5 w-3.5 mr-1"}),"Details"]})]})]})]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(l,{className:"bg-rose-500 text-sm px-5 rounded-md",onClick:()=>d(!0),disabled:!i||!!t&&c,title:h?"Exam is closed":i?c?"Application pending":"Submit application":"You are not eligible yet",children:"Submit application"}),e.jsx(z,{open:E,onOpenChange:d}),e.jsx("div",{children:t?e.jsx(B,{application:{id:t.application_id,first_name:t.first_name,middle_initial:t.middle_name?t.middle_name[0]:null,last_name:t.last_name,program:t.program,school_year:t.school_year,office_address:t.office_address??null,mobile_no:t.contact_number??null,telephone_no:t.telephone_number??null,email:t.email,status:t.final_approval_status||"Pending",subjects:t.subjects,created_at:t.created_at??null}}):e.jsx("div",{className:"p-6 text-center text-sm text-muted-foreground",children:"No application submitted yet."})})]}),e.jsx(R,{open:O,onOpenChange:m,children:e.jsxs(I,{className:"sm:max-w-md",children:[e.jsxs(L,{children:[e.jsx(P,{children:"Comprehensive Exam Eligibility"}),e.jsx(X,{children:"You must meet all the requirements below before you can submit an application."})]}),e.jsx("div",{className:"space-y-2",children:D.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{className:"text-sm",children:s.label}),e.jsx(w,{variant:"outline",className:s.ok===!0?"border-green-300 text-green-700 bg-green-50":s.ok===!1?"border-rose-300 text-rose-700 bg-rose-50":"text-zinc-600",children:s.ok===!0?"OK":s.ok===!1?"Missing":"Unknown"})]},a))}),e.jsxs($,{className:"mt-2",children:[e.jsx(l,{variant:"outline",onClick:()=>m(!1),children:"Close"}),e.jsx(l,{onClick:()=>{m(!1),i&&!c&&d(!0)},disabled:!i||c,children:"Apply Now"})]})]})})]})})]})}export{ct as default};
