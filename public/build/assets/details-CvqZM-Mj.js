import{r as h,j as s,L as K,S as W}from"./app-BubHmeqC.js";import{A as X}from"./app-layout-yLDvQPzP.js";import{d as J}from"./dayjs.min-BgzfR48W.js";import{B as G}from"./badge-Dd_ET0uG.js";import{S as R}from"./separator-B1kTuyS6.js";import{A as Q,a as Z}from"./avatar-DijVPJCE.js";import{B as z}from"./button-CX84Ig4W.js";import{t as v}from"./index-Bqixm_LI.js";import{T as L,a as ee,b as U,c as B}from"./tabs-DVolEiAR.js";import se from"./payment-validation-DF-YBX5y.js";import{A as te}from"./arrow-left-DLzhx_b2.js";import{C as re}from"./circle-check-big-BRigqRsr.js";import{U as ae}from"./users-wdb3-6X2.js";import{F as b}from"./file-text-B1gFNyH7.js";import{C as g}from"./clock-CyI1Boga.js";import{S as ne}from"./send-DnHCHsKV.js";import{U as oe}from"./user-check-DLoTdIld.js";import{S as ie}from"./signature--oYNZqdI.js";import{C as le}from"./circle-x-vhKPM2HU.js";import{C as ce}from"./circle-arrow-left-CTHOH67p.js";import{U as de}from"./user-DRyx2ySC.js";import{f as N}from"./format-HX8DKPSU.js";import"./index-CAAZlwhj.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./input-y4wBi6jo.js";import"./index-Bsel9b7o.js";import"./index-PQN_369Y.js";import"./index-DyQT7xcZ.js";import"./x-DS6n0ElR.js";import"./createLucideIcon-Biu-y2hB.js";import"./tooltip-tJz5bvEu.js";import"./floating-ui.react-dom-DwEbxQiH.js";import"./chevron-right-BRo8ahWW.js";import"./dropdown-menu-BExp8GpF.js";import"./index-6aAr3Pmv.js";import"./index-CVQNv_Nf.js";import"./index-1EFpZ92o.js";import"./index-CBu7v5lz.js";import"./index-Zto0mrax.js";import"./check-CZ9c_sEg.js";import"./settings-Uvo0cGb6.js";import"./graduation-cap-B7M__5Eh.js";import"./dollar-sign-DESWnaQ9.js";import"./credit-card-DhKiqKDR.js";import"./info-DGWfuZKp.js";import"./sun-BLOPCje7.js";import"./badge-dollar-sign-BSVEc7FB.js";import"./en-US-BA9orzCf.js";function me(r){if(!r)return"—";try{return N(new Date(r),"PPP")}catch{return r}}function M(r){if(!r)return"";const[i,e]=(r||"").split(":");if(i===void 0||e===void 0)return r||"";const n=new Date;return n.setHours(Number(i),Number(e)),N(n,"hh:mm a")}function xe(r){var n,f,c,l;const i=((f=(n=r.first_name)==null?void 0:n.trim())==null?void 0:f[0])??"",e=((l=(c=r.last_name)==null?void 0:c.trim())==null?void 0:l[0])??"";return(i+e).toUpperCase()||"U"}function cs({id:r,defenseRequest:i}){var C,A,S,P,T,D,F,E,$;const[e,n]=h.useState(i??null),[f,c]=h.useState(!i),[l,_]=h.useState("details");h.useEffect(()=>{e||r&&(c(!0),fetch(`/api/defense-request/${r}`).then(t=>t.json()).then(t=>{n(t),c(!1)}))},[r,e]);const y=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/assistant/all-defense-list"}];if(e!=null&&e.id){const t=(((C=e.thesis_title)==null?void 0:C.length)||0)>60?e.thesis_title.slice(0,57)+"...":e.thesis_title||`Request #${e.id}`;y.push({title:t,href:`/assistant/all-defense-list/${e.id}/details`})}function q(t){var p;const o=t.event_type||t.action||t.status_change||t.status||t.type||"Event",d=t.description||t.details||t.note||t.notes||t.remarks||"",m=t.from_state||t.from||t.previous_state,x=t.to_state||t.to||t.new_state,j=t.created_at||t.timestamp||t.performed_at||t.date||"",u=t.user_name||((p=t.user)==null?void 0:p.name)||t.actor_name||t.actor||t.performed_by_name||t.performed_by||"";return{event:o,desc:d,from:m,to:x,created:j,userName:u}}function V(t){if(!t)return"";try{return N(new Date(t),"PPpp")}catch{return t}}function a(t){return t?/^https?:\/\//i.test(t)||t.startsWith("/storage/")?t:`/storage/${t.replace(/^\/?storage\//,"")}`:null}const w=[{label:"Adviser’s Endorsement",url:a((A=e==null?void 0:e.attachments)==null?void 0:A.advisers_endorsement)},{label:"REC Endorsement",url:a((S=e==null?void 0:e.attachments)==null?void 0:S.rec_endorsement)},{label:"Proof of Payment",url:a((P=e==null?void 0:e.attachments)==null?void 0:P.proof_of_payment)},{label:"Manuscript",url:a((T=e==null?void 0:e.attachments)==null?void 0:T.manuscript_proposal)},{label:"Similarity Index",url:a((D=e==null?void 0:e.attachments)==null?void 0:D.similarity_index)},{label:"Avisee-Adviser File",url:a((F=e==null?void 0:e.attachments)==null?void 0:F.avisee_adviser_attachment)},{label:"AI Detection Certificate",url:a((E=e==null?void 0:e.attachments)==null?void 0:E.ai_detection_certificate)},{label:"Endorsement Form",url:a(($=e==null?void 0:e.attachments)==null?void 0:$.endorsement_form)}],k="rounded-lg border p-5 space-y-3",Y=[{key:"submitted",label:"Submitted",icon:s.jsx(ne,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:s.jsx(oe,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:s.jsx(ie,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected by Coordinator",icon:s.jsx(le,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved (Set to Pending)",icon:s.jsx(ce,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:s.jsx(de,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:s.jsx(g,{className:"h-5 w-5"})}];function H(t){return t=(t||"").toLowerCase(),t.includes("submit")?"submitted":t.includes("adviser")?"adviser-approved":t.includes("rejected")?"rejected":t.includes("retrieved")?"retrieved":t.includes("coordinator")?"coordinator-approved":t.includes("panel")?"panels-assigned":t.includes("schedule")?"scheduled":""}async function I(){var t;if(e)try{(await fetch(`/defense-requests/${e.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""},body:JSON.stringify({status:"Completed"})})).ok?(n({...e,status:"Completed",workflow_state:"completed"}),v.success("Marked as Completed")):v.error("Failed to mark as completed")}catch{v.error("Error marking as completed")}}return s.jsxs(X,{breadcrumbs:y,children:[s.jsx(K,{title:(e==null?void 0:e.thesis_title)||`Defense Request #${(e==null?void 0:e.id)??""}`}),s.jsxs("div",{className:"p-5 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(z,{variant:"outline",onClick:()=>W.visit("/assistant/all-defense-list"),className:"h-8 px-2",children:s.jsx(te,{className:"h-4 w-4"})}),s.jsx(L,{value:l,onValueChange:t=>_(t),children:s.jsxs(ee,{children:[s.jsx(U,{value:"details",children:"Details"}),s.jsx(U,{value:"payment",children:"Payment Validation"})]})})]}),(e==null?void 0:e.status)!=="Completed"&&l==="details"&&s.jsxs(z,{size:"sm",variant:"outline",onClick:I,className:"gap-2",children:[s.jsx(re,{className:"h-4 w-4 text-green-600"}),"Mark as Completed"]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[s.jsx("div",{className:"md:col-span-2 space-y-6",children:s.jsxs(L,{value:l,onValueChange:t=>_(t),children:[s.jsxs(B,{value:"details",children:[s.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[s.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-semibold",children:e==null?void 0:e.thesis_title}),s.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),s.jsx("div",{className:"flex flex-col md:items-end gap-1",children:(e==null?void 0:e.status)&&s.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${e.status==="Approved"?"bg-green-100 text-green-600":e.status==="Rejected"?"bg-red-100 text-red-600":e.status==="Pending"?"bg-yellow-100 text-yellow-700":e.status==="Completed"?"bg-gray-800 text-white":"bg-gray-100 text-gray-600"}`,children:["Status: ",e.status]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Q,{className:"h-8 w-8",children:s.jsx(Z,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:xe(e)})}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-sm leading-tight",children:[e==null?void 0:e.first_name," ",e!=null&&e.middle_name?`${e.middle_name} `:"",e==null?void 0:e.last_name]}),(e==null?void 0:e.school_id)&&s.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:e.school_id})]})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),s.jsx("div",{className:"font-medium text-sm",children:e==null?void 0:e.program})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),s.jsx(G,{variant:"secondary",className:"text-xs font-medium",children:(e==null?void 0:e.defense_type)??"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),s.jsx("div",{className:"font-medium text-sm",children:me(e==null?void 0:e.scheduled_date)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.scheduled_time?`${M(e.scheduled_time)}${e.scheduled_end_time?" - "+M(e.scheduled_end_time):""}`:"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.defense_venue)||"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.defense_mode?e.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.scheduling_notes)||"—"})]})]})]}),s.jsxs("div",{className:k,children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(ae,{className:"h-4 w-4"})," Committee"]}),s.jsx(R,{}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] text-muted-foreground uppercase tracking-wide",children:"Adviser"}),s.jsx("div",{className:"font-medium",children:(e==null?void 0:e.defense_adviser)||(e==null?void 0:e.adviser)||"—"})]}),[{label:"Chairperson",v:e==null?void 0:e.defense_chairperson},{label:"Panelist 1",v:e==null?void 0:e.defense_panelist1},{label:"Panelist 2",v:e==null?void 0:e.defense_panelist2},{label:"Panelist 3",v:e==null?void 0:e.defense_panelist3},{label:"Panelist 4",v:e==null?void 0:e.defense_panelist4}].map(t=>s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] text-muted-foreground uppercase tracking-wide",children:t.label}),s.jsx("div",{className:"font-medium",children:t.v||"—"})]},t.label))]})]}),s.jsxs("div",{className:k,children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(b,{className:"h-4 w-4"})," Attachments"]}),s.jsx(R,{}),s.jsxs("div",{className:"space-y-2 text-sm",children:[w.filter(t=>!!t.url).length===0&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),w.filter(t=>!!t.url).map(t=>{var o;return s.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[s.jsx(b,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:t.label}),s.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(o=t.url)==null?void 0:o.split("/").pop()})]},t.label)}),(e==null?void 0:e.reference_no)&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[s.jsx(b,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"Reference No."}),s.jsx("span",{className:"ml-auto text-xs",children:e.reference_no})]})]})]}),s.jsxs("div",{className:"text-[11px] text-muted-foreground mt-4",children:["Last updated by:"," ",(e==null?void 0:e.last_status_updated_by_name)||(e==null?void 0:e.last_status_updated_by)||"—"," ",e!=null&&e.last_status_updated_at?`(${J(e.last_status_updated_at).format("YYYY-MM-DD [at] h:mm A")})`:""]})]}),s.jsx(B,{value:"payment",children:s.jsx(se,{details:e,resolveFileUrl:a})})]})}),s.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:s.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900",children:[s.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[s.jsx(g,{className:"h-4 w-4"})," Workflow Progress"]}),s.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(e==null?void 0:e.workflow_history)&&e.workflow_history.length>0?e.workflow_history.map((t,o)=>{const{event:d,created:m,userName:x}=q(t),j=H(d),u=Y.find(O=>O.key===j)||{label:d.charAt(0).toUpperCase()+d.slice(1),icon:s.jsx(g,{className:"h-5 w-5 text-gray-500"})},p=o===e.workflow_history.length-1;return s.jsxs("div",{className:"flex items-start gap-3 relative",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:u.icon}),!p&&s.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),s.jsxs("div",{className:"pb-4",children:[s.jsx("div",{className:"font-semibold text-xs",children:u.label}),s.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[x&&s.jsx("span",{children:x}),m&&s.jsxs("span",{children:[" ","· ",V(m)]})]})]})]},o)}):s.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]})]})]})}export{cs as default};
