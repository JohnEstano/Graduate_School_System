import{g as et,R as g,r as O,j as s}from"./app-CQngmq00.js";import{C as N,a as w,b as R,d as L,c as F,e as nt}from"./card-C_emSl4Q.js";import{C as rt,a as at,b as it,c as ot,d as st}from"./chart-BC_ZPf9S.js";import{e as S,D as ct,k as I,m as M,A as lt,o as _,r as ut,t as dt,G as ft,x as $,U as pt,p as k,P as q,g as mt,Q as vt}from"./generateCategoricalChart-RpaH3faT.js";import{a as W}from"./utils-jAU0Cazi.js";import{c as ht,b as Q,a as yt,P as gt}from"./PolarAngleAxis-J6U1uu9p.js";import"./index-BGXDct6C.js";import"./index-Chjiymov.js";var T,z;function bt(){if(z)return T;z=1;function e(t){return t&&t.length?t[0]:void 0}return T=e,T}var K,G;function xt(){return G||(G=1,K=bt()),K}var At=xt();const jt=et(At);var Pt=["key"];function j(e){"@babel/helpers - typeof";return j=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(e)}function Ot(e,t){if(e==null)return{};var r=Et(e,t),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Et(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},C.apply(this,arguments)}function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H(Object(r),!0).forEach(function(n){x(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function St(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,X(n.key),n)}}function _t(e,t,r){return t&&V(e.prototype,t),r&&V(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ct(e,t,r){return t=D(t),Dt(e,U()?Reflect.construct(t,r||[],D(e).constructor):t.apply(e,r))}function Dt(e,t){if(t&&(j(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nt(e)}function Nt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(U=function(){return!!e})()}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},D(e)}function wt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},B(e,t)}function x(e,t,r){return t=X(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e){var t=Rt(e,"string");return j(t)=="symbol"?t:t+""}function Rt(e,t){if(j(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(j(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var P=function(e){function t(){var r;St(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=Ct(this,t,[].concat(a)),x(r,"state",{isAnimationFinished:!1}),x(r,"handleAnimationEnd",function(){var i=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),S(i)&&i()}),x(r,"handleAnimationStart",function(){var i=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),S(i)&&i()}),x(r,"handleMouseEnter",function(i){var c=r.props.onMouseEnter;c&&c(r.props,i)}),x(r,"handleMouseLeave",function(i){var c=r.props.onMouseLeave;c&&c(r.props,i)}),r}return wt(t,e),_t(t,[{key:"renderDots",value:function(n){var a=this.props,o=a.dot,i=a.dataKey,c=I(this.props,!1),p=I(o,!0),f=n.map(function(u,m){var l=d(d(d({key:"dot-".concat(m),r:3},c),p),{},{dataKey:i,cx:u.x,cy:u.y,index:m,payload:u});return t.renderDotItem(o,l)});return g.createElement(M,{className:"recharts-radar-dots"},f)}},{key:"renderPolygonStatically",value:function(n){var a=this.props,o=a.shape,i=a.dot,c=a.isRange,p=a.baseLinePoints,f=a.connectNulls,u;return g.isValidElement(o)?u=g.cloneElement(o,d(d({},this.props),{},{points:n})):S(o)?u=o(d(d({},this.props),{},{points:n})):u=g.createElement(ht,C({},I(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:n,baseLinePoints:c?p:null,connectNulls:f})),g.createElement(M,{className:"recharts-radar-polygon"},u,i?this.renderDots(n):null)}},{key:"renderPolygonWithAnimation",value:function(){var n=this,a=this.props,o=a.points,i=a.isAnimationActive,c=a.animationBegin,p=a.animationDuration,f=a.animationEasing,u=a.animationId,m=this.state.prevPoints;return g.createElement(lt,{begin:c,duration:p,isActive:i,easing:f,from:{t:0},to:{t:1},key:"radar-".concat(u),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(l){var v=l.t,h=m&&m.length/o.length,b=o.map(function(y,E){var A=m&&m[Math.floor(E*h)];if(A){var Y=_(A.x,y.x),J=_(A.y,y.y);return d(d({},y),{},{x:Y(v),y:J(v)})}var Z=_(y.cx,y.x),tt=_(y.cy,y.y);return d(d({},y),{},{x:Z(v),y:tt(v)})});return n.renderPolygonStatically(b)})}},{key:"renderPolygon",value:function(){var n=this.props,a=n.points,o=n.isAnimationActive,i=n.isRange,c=this.state.prevPoints;return o&&a&&a.length&&!i&&(!c||!ut(c,a))?this.renderPolygonWithAnimation():this.renderPolygonStatically(a)}},{key:"render",value:function(){var n=this.props,a=n.hide,o=n.className,i=n.points,c=n.isAnimationActive;if(a||!i||!i.length)return null;var p=this.state.isAnimationFinished,f=W("recharts-radar",o);return g.createElement(M,{className:f},this.renderPolygon(),(!c||p)&&dt.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"renderDotItem",value:function(n,a){var o;if(g.isValidElement(n))o=g.cloneElement(n,a);else if(S(n))o=n(a);else{var i=a.key,c=Ot(a,Pt);o=g.createElement(ct,C({},c,{key:i,className:W("recharts-radar-dot",typeof n!="boolean"?n.className:"")}))}return o}}])}(O.PureComponent);x(P,"displayName","Radar");x(P,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!ft.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});x(P,"getComposedData",function(e){var t=e.radiusAxis,r=e.angleAxis,n=e.displayedData,a=e.dataKey,o=e.bandSize,i=r.cx,c=r.cy,p=!1,f=[],u=r.type!=="number"?o??0:0;n.forEach(function(l,v){var h=$(l,r.dataKey,v),b=$(l,a),y=r.scale(h)+u,E=Array.isArray(b)?pt(b):b,A=k(E)?void 0:t.scale(E);Array.isArray(b)&&b.length>=2&&(p=!0),f.push(d(d({},q(i,c,A,y)),{},{name:h,value:b,cx:i,cy:c,radius:A,angle:y,payload:l}))});var m=[];return p&&f.forEach(function(l){if(Array.isArray(l.value)){var v=jt(l.value),h=k(v)?void 0:t.scale(v);m.push(d(d({},l),{},{radius:h},q(i,c,h,l.angle)))}else m.push(l)}),{points:f,isRange:p,baseLinePoints:m}});var Lt=mt({chartName:"RadarChart",GraphicalChild:P,axisComponents:[{axisType:"angleAxis",AxisComp:Q},{axisType:"radiusAxis",AxisComp:yt}],formatAxisMap:vt,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const Ft={students:{label:"Students",color:"#e11d48"},capacity:{label:"Capacity",color:"hsl(var(--muted))"}};function Wt(){const[e,t]=O.useState([]),[r,n]=O.useState(!0),[a,o]=O.useState({totalAdvisers:0,totalStudents:0,avgRatio:0});return O.useEffect(()=>{fetch("/api/coordinator/advisers",{headers:{Accept:"application/json"}}).then(i=>{if(!i.ok)throw new Error("Failed to fetch");return i.json()}).then(i=>{const c=Array.isArray(i)?i:i.advisers??[],p=c.filter(l=>l.status==="active").map(l=>{const v=l.assigned_students_count||0,h=`${l.first_name} ${l.last_name}`.trim();return{adviser:h.length>15?h.substring(0,15)+"...":h,students:v,capacity:10}}).slice(0,6);t(p);const f=c.reduce((l,v)=>l+(v.assigned_students_count||0),0),u=c.filter(l=>l.status==="active").length,m=u>0?(f/u).toFixed(1):0;o({totalAdvisers:u,totalStudents:f,avgRatio:Number(m)})}).catch(i=>{console.error("Error fetching advisers:",i),t([])}).finally(()=>{n(!1)})},[]),r?s.jsxs(N,{children:[s.jsxs(w,{children:[s.jsx(R,{children:"Adviser-Student Distribution"}),s.jsx(L,{children:"Loading..."})]}),s.jsx(F,{className:"h-[300px] flex items-center justify-center",children:s.jsx("div",{className:"text-muted-foreground",children:"Loading chart data..."})})]}):e.length===0?s.jsxs(N,{children:[s.jsxs(w,{children:[s.jsx(R,{children:"Adviser-Student Distribution"}),s.jsx(L,{children:"No data available"})]}),s.jsx(F,{className:"h-[300px] flex items-center justify-center",children:s.jsx("div",{className:"text-muted-foreground",children:"No active advisers found"})})]}):s.jsxs(N,{children:[s.jsxs(w,{className:"items-center pb-4",children:[s.jsx(R,{children:"Adviser-Student Distribution"}),s.jsx(L,{children:"Student load per adviser vs ideal capacity"})]}),s.jsx(F,{className:"pb-0",children:s.jsx(rt,{config:Ft,className:"mx-auto aspect-square max-h-[250px]",children:s.jsxs(Lt,{data:e,margin:{top:-40,bottom:-10},children:[s.jsx(at,{cursor:!1,content:s.jsx(it,{indicator:"line"})}),s.jsx(Q,{dataKey:"adviser"}),s.jsx(gt,{}),s.jsx(P,{dataKey:"students",fill:"var(--color-students)",fillOpacity:.6}),s.jsx(P,{dataKey:"capacity",fill:"var(--color-capacity)",fillOpacity:.3}),s.jsx(ot,{className:"mt-8",content:s.jsx(st,{})})]})})}),s.jsx(nt,{className:"flex-col gap-2 pt-4 text-sm",children:s.jsxs("div",{className:"flex items-center gap-2 font-medium leading-none",children:[a.totalStudents," students across ",a.totalAdvisers," advisers"]})})]})}export{Wt as CoordinatorAdviserStudentRatio};
