import{j as e,r as o,L as U,S as Y}from"./app-BDkuJsct.js";import{t as d,T as Z}from"./index-By5vkq0G.js";import{B as l}from"./button-DggClj9M.js";import{C as F}from"./checkbox-CR1JIwzI.js";import{I as ee}from"./input-BmPXXlp0.js";import se from"./table-defense-requests-D89ok-Dr.js";import{D as te,a as re,b as oe,c as ie}from"./dialog-DeUj0iLU.js";import{C as ne}from"./calendar-BhsmegxW.js";import{P as S,a as D,b as q}from"./popover-CxnVWzfd.js";import{A as ae}from"./app-layout-Cr_DtTkJ.js";import{G as le}from"./graduation-cap-Cszrlop1.js";import{S as ce}from"./search-oqoQW3gm.js";import{C as L}from"./circle-plus-C8aRXmTg.js";import{C as de}from"./calendar-CI-DWPmu.js";import{X as me}from"./x-CtfT_1vN.js";import{S as pe}from"./signature-B6fTe-ja.js";import{c as I}from"./createLucideIcon-CEmaZ7tj.js";import{C as fe}from"./isSameMonth-C-hFGgGu.js";import{C as ue}from"./chevron-right-BpKiIXqV.js";import{s as M,f as O}from"./format-Cze4Gw5q.js";import{e as he}from"./endOfDay-Ci94Ylrd.js";import{i as xe}from"./isWithinInterval-BawuBiIN.js";import"./index-BhbofC_p.js";import"./index-B_a1aFVM.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-LRezjsDo.js";import"./index-BdhkuEJx.js";import"./index-DMsjTEK4.js";import"./index-Dia2ik6c.js";import"./index-QFmRa-KD.js";import"./check-BUlQxyEc.js";import"./table-CnA6sFiR.js";import"./badge-BJdX7_A9.js";import"./circle-check-big-CKfkcUFR.js";import"./circle-x-DUEw59KP.js";import"./clock-BykI6stH.js";import"./circle-check-_tJ384BC.js";import"./banknote-Cl0WRxxf.js";import"./dollar-sign-CSALIIUa.js";import"./hourglass-BE6hGw0v.js";import"./index-CWqpdCTP.js";import"./index-D-bfryUZ.js";import"./endOfWeek-BqBOMalL.js";import"./differenceInCalendarMonths-BlVIDW-K.js";import"./normalizeInterval-6lUcOLZ2.js";import"./endOfMonth-DvPI_8Ds.js";import"./isSameDay-DsAL-Hdb.js";import"./chevron-down-DMxaecxw.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./tooltip-CWM4FSMS.js";import"./separator-DaKqQg6m.js";import"./dropdown-menu-B7sOazTG.js";import"./index-BKBXBDOv.js";import"./avatar-DpsgA3Kf.js";import"./settings-BITCJcnj.js";import"./users-BTr8E8QO.js";import"./file-text-rxgzo2tt.js";import"./send-9CEFXyiZ.js";import"./credit-card-CM3Zlvhr.js";import"./tabs-BOuSS6lC.js";import"./info-DwFda8kE.js";import"./sun-B3PIUh1_.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],ge=I("ChevronsLeft",je);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],be=I("ChevronsRight",ve);function Ce({page:i,totalPages:c,onPageChange:n}){return e.jsxs("div",{className:"flex justify-between items-center gap-2 px-4 py-4 bg-background sticky bottom-0 z-10",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Page ",i," of ",c]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"lg",variant:"outline",disabled:i===1,onClick:()=>n(1),children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx(l,{size:"lg",variant:"outline",disabled:i===1,onClick:()=>n(i-1),children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx(l,{size:"lg",variant:"outline",disabled:i===c,onClick:()=>n(i+1),children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsx(l,{size:"lg",variant:"outline",disabled:i===c,onClick:()=>n(c),children:e.jsx(be,{className:"w-5 h-5"})})]})]})}function E({defenseRequests:i,onStatusChange:c}){const[n,h]=o.useState({open:!1,id:null,action:null});function _(){const s=document.querySelector('meta[name="csrf-token"]');return(s==null?void 0:s.content)||""}const v=s=>s.map(t=>({...t,date_of_defense:t.date_of_defense||t.scheduled_date||void 0,mode_defense:t.mode_defense||t.defense_mode||void 0})),[R,j]=o.useState(()=>i?v(i):[]);o.useEffect(()=>{i&&j(v(i))},[i]);const[x,T]=o.useState(""),[m,b]=o.useState([]),[p,C]=o.useState([]),[r,N]=o.useState(),[g,B]=o.useState(null),[w,z]=o.useState(1),[X]=o.useState({title:!0,presenter:!0,adviser:!0,program:!0,status:!0}),[Ne,we]=o.useState(!1),[ye,ke]=o.useState(null),[Se,De]=o.useState(!1),[G,A]=o.useState(!1),P=o.useCallback(async()=>{const s=d.loading("Fetching table data...");A(!0);try{const t=await fetch("/coordinator/defense-requests/all-defense-requests");if(t.ok){const a=await t.json();j(v(a)),d.success("Table data loaded!",{id:s})}else d.error("Failed to fetch defense requests",{id:s})}catch{d.error("Error fetching defense requests",{id:s})}finally{A(!1),setTimeout(()=>d.dismiss(s),1e3)}},[]);o.useEffect(()=>{P()},[P]);const y=o.useMemo(()=>{let s=R;if(x){const t=x.toLowerCase();s=s.filter(a=>`${a.first_name} ${a.last_name} ${a.thesis_title}`.toLowerCase().includes(t))}if(m.length&&(s=s.filter(t=>m.includes(t.status))),p.length&&(s=s.filter(t=>p.includes(t.defense_type))),r!=null&&r.from&&(r!=null&&r.to)){const t=M(r.from),a=he(r.to);s=s.filter(f=>{if(!f.date_of_defense)return!0;const u=M(new Date(f.date_of_defense));return xe(u,{start:t,end:a})})}return s},[x,m,p,R,r]),$=o.useMemo(()=>g?[...y].sort((s,t)=>{const a=s.date_of_defense?new Date(s.date_of_defense).getTime():0,f=t.date_of_defense?new Date(t.date_of_defense).getTime():0;return g==="asc"?a-f:f-a}):y,[y,g]),H=Math.max(1,Math.ceil($.length/10)),J=$.slice((w-1)*10,w*10),K=()=>B(s=>s==="asc"?"desc":s==="desc"?null:"asc"),V=async(s,t)=>{try{(await fetch(`/defense-requests/${s}/priority`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":_(),Accept:"application/json"},body:JSON.stringify({priority:t})})).ok?(j(f=>f.map(u=>u.id===s?{...u,priority:t}:u)),d.success("Priority updated")):d.error("Failed to update priority")}catch{d.error("Error updating priority")}},W=o.useCallback(async(s,t)=>{try{(await fetch(`/defense-requests/${s}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":_(),Accept:"application/json"},body:JSON.stringify({status:t})})).ok?(j(f=>f.map(u=>u.id===s?{...u,status:t}:u)),c==null||c(s,t),d.success(`Request #${s} set to ${t}`)):d.error("Failed to update status")}catch{d.error("Error updating status")}},[c]);function k(s,t){h({open:!0,id:s,action:t})}async function Q(){if(!n.id||!n.action){h({open:!1,id:null,action:null});return}let s="Pending";n.action==="approve"?s="Approved":n.action==="reject"?s="Rejected":n.action==="retrieve"&&(s="Pending"),await W(n.id,s),h({open:!1,id:null,action:null})}return console.log("Initial defenseRequests prop:",i),e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Defense Requests"}),e.jsx(Z,{richColors:!0,position:"bottom-right"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-2 overflow-auto rounded-xl pt-5 pr-3 pl-3 relative",children:[e.jsxs("div",{className:"w-full bg-white dark:bg-zinc-900 border border-border rounded-lg overflow-hidden mb-2",children:[e.jsx("div",{className:"flex flex-row dark:bg-zinc-900 items-center justify-between w-full p-3 border-b bg-white",children:e.jsxs("div",{className:"flex dark:bg-zinc-900 items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-rose-100 dark:bg-rose-900 border border-rose-500",children:e.jsx(le,{className:"h-5 w-5 text-rose-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"Defense Requests"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"This section shows all defense requests. Search, filter, and manage requests."})]})]})}),e.jsx("div",{className:"flex dark:bg-zinc-900 items-center justify-between gap-2 px-4 py-3 border-b bg-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{type:"text",startIcon:ce,placeholder:"Search...",value:x,onChange:s=>{T(s.target.value),z(1)},className:"max-w-xs text-sm h-8",disabled:G}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Status",m.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:m.length>1?`${m.length} selected`:m[0]})]})}),e.jsxs(q,{className:"w-44 p-1",side:"bottom",align:"start",children:[["Pending","Approved","Rejected"].map(s=>e.jsxs("div",{onClick:()=>b(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]),className:"flex items-center gap-2 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(F,{checked:m.includes(s)}),e.jsx("span",{className:"text-sm",children:s})]},s)),e.jsx(l,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>b([]),children:"Clear"})]})]}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Type",p.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:p.length>1?`${p.length} selected`:p[0]})]})}),e.jsxs(q,{className:"w-44 p-1",side:"bottom",align:"start",children:[["Proposal","Prefinal","Final"].map(s=>e.jsxs("div",{onClick:()=>C(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]),className:"flex items-center gap-2 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(F,{checked:p.includes(s)}),e.jsx("span",{className:"text-sm",children:s})]},s)),e.jsx(l,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>C([]),children:"Clear"})]})]}),e.jsxs(S,{children:[e.jsx(D,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(de,{size:14}),"Date",(r==null?void 0:r.from)&&(r==null?void 0:r.to)&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:`${O(r.from,"MMM dd")} - ${O(r.to,"MMM dd")}`})]})}),e.jsxs(q,{className:"w-auto p-2",side:"bottom",align:"start",children:[e.jsx(ne,{mode:"range",selected:r,onSelect:N}),e.jsx(l,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>N(void 0),children:"Clear Dates"})]})]}),(m.length>0||p.length>0||(r==null?void 0:r.from)||x.trim())&&e.jsxs(l,{variant:"ghost",size:"sm",className:"h-8 px-3 flex items-center gap-1",onClick:()=>{b([]),C([]),N(void 0),T("")},children:[e.jsx(me,{size:14})," Reset"]})]})})]}),e.jsx("div",{className:"w-full flex-1 flex flex-col min-h-0 overflow-hidden",children:e.jsx(se,{paged:J,columns:X,toggleSort:K,sortDir:g,onPriorityChange:V,tabType:void 0,onViewDetails:s=>Y.visit(`/coordinator/defense-requests/${s}/details`),onRowApprove:s=>k(s,"approve"),onRowReject:s=>k(s,"reject"),onRowRetrieve:s=>k(s,"retrieve"),highlightMissingDateMode:!1,hideActions:!1,hideSelect:!0})}),e.jsx(Ce,{page:w,totalPages:H,onPageChange:z})]}),e.jsx(te,{open:n.open,onOpenChange:s=>{s||h({open:!1,id:null,action:null})},children:e.jsxs(re,{children:[e.jsx(oe,{children:"Confirm Action"}),e.jsx(ie,{children:n.action==="approve"?"Please review before approving.":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[n.id&&e.jsxs("p",{children:["Request #",n.id,": Set to"," ",e.jsx("span",{className:"font-semibold",children:n.action==="approve"?"Approved":n.action==="reject"?"Rejected":"Pending"}),"?"]}),n.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(pe,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving this defense request authorizes the use of your signature on the official defense documents."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(l,{variant:"ghost",onClick:()=>h({open:!1,id:null,action:null}),children:"Cancel"}),e.jsx(l,{onClick:Q,children:"Confirm"})]})]})})]})}function Ls(i){if(i.withLayout){const c=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/defense-request"}];return e.jsx(ae,{breadcrumbs:c,children:e.jsx(E,{...i})})}return e.jsx(E,{...i})}export{Ls as default};
