import{j as e,L as ve,S as be,r as m}from"./app-BDkuJsct.js";import{A as Ne,C as Ie}from"./app-layout-Cr_DtTkJ.js";import{T as Ue,t as P}from"./index-By5vkq0G.js";import{B as p}from"./button-DggClj9M.js";import{I as D}from"./input-BmPXXlp0.js";import{B as z}from"./badge-BJdX7_A9.js";import{S as q}from"./separator-DaKqQg6m.js";import{C as Ve,a as He,c as We,d as Xe,e as Je}from"./command-Bcon7hVX.js";import{C as Ke}from"./calendar-BhsmegxW.js";import{S as Ge,a as Qe,b as Ye,c as Ze,e as _e}from"./select-D1tIJaem.js";import{P as Te,a as De,b as Re}from"./popover-CxnVWzfd.js";import{D as es,a as ss,b as ts,c as as}from"./dialog-DeUj0iLU.js";import{c as B}from"./utils-jAU0Cazi.js";import{A as rs,a as ns}from"./avatar-DpsgA3Kf.js";import{T as ye,a as is,b as we,c as Ce}from"./tabs-BOuSS6lC.js";import{T as ls,a as os,b as ke,c as I,d as ds,e as U}from"./table-CnA6sFiR.js";import cs from"./coordinator-approve-dialog-C1MuTH3o.js";import{A as ms}from"./arrow-left-Dc-Yamg5.js";import{F as R}from"./file-text-rxgzo2tt.js";import{C as V}from"./calendar-CI-DWPmu.js";import{C as us}from"./circle-check-big-CKfkcUFR.js";import{C as Se}from"./circle-x-DUEw59KP.js";import{C as Ae}from"./circle-arrow-left-CALWzfs1.js";import{U as H}from"./users-BTr8E8QO.js";import{C as W}from"./clock-BykI6stH.js";import{S as Pe}from"./signature-B6fTe-ja.js";import{S as xs}from"./send-9CEFXyiZ.js";import{U as fs}from"./user-check-BI6QpplU.js";import{X as ps}from"./x-CtfT_1vN.js";import{C as hs}from"./check-BUlQxyEc.js";import{f as E}from"./format-Cze4Gw5q.js";import"./index-B_a1aFVM.js";import"./index-DZZQifJx.js";import"./index-CWqpdCTP.js";import"./index-BhbofC_p.js";import"./index-D-bfryUZ.js";import"./tooltip-CWM4FSMS.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./createLucideIcon-CEmaZ7tj.js";import"./chevron-right-BpKiIXqV.js";import"./dropdown-menu-B7sOazTG.js";import"./index-DMsjTEK4.js";import"./index-BdhkuEJx.js";import"./index-LRezjsDo.js";import"./index-BKBXBDOv.js";import"./index-QFmRa-KD.js";import"./settings-BITCJcnj.js";import"./graduation-cap-Cszrlop1.js";import"./dollar-sign-CSALIIUa.js";import"./credit-card-CM3Zlvhr.js";import"./info-DwFda8kE.js";import"./sun-B3PIUh1_.js";import"./search-oqoQW3gm.js";import"./endOfWeek-BqBOMalL.js";import"./differenceInCalendarMonths-BlVIDW-K.js";import"./normalizeInterval-6lUcOLZ2.js";import"./endOfMonth-DvPI_8Ds.js";import"./isSameDay-DsAL-Hdb.js";import"./isSameMonth-C-hFGgGu.js";import"./chevron-down-DMxaecxw.js";import"./index-Dia2ik6c.js";import"./scroll-area-CWTliVrd.js";import"./alert-CzZoorjr.js";import"./label-MiJboLk1.js";import"./index-BrbnoEXB.js";import"./typeof-QjJsDpFa.js";import"./index-CoS1vLG5.js";import"./index-Chjiymov.js";import"./eye-BIV30vbs.js";import"./loader-circle-xEC7kKhV.js";import"./refresh-cw-B6toqFMV.js";import"./circle-alert-BxXeSR-n.js";import"./pencil-BymrdZQ3.js";import"./trash-2-CUp06ccZ.js";function js(g,h){if(!h||!Array.isArray(g))return null;const c=String(h).trim();if(!c)return null;const b=g.find(t=>String(t.id)===c);if(b)return b;if(/^\d+$/.test(c)){const t=g.find(S=>String(S.id)===c||String(S.id).endsWith(`-${c}`));if(t)return t}const N=c.toLowerCase();return g.find(t=>String(t.name||"").trim().toLowerCase()===N)||null}function qe({label:g,value:h,onChange:c,options:b,disabled:N,taken:t}){const[S,T]=m.useState(!1),[C,u]=m.useState(""),_=m.useMemo(()=>{if(!C)return b;const o=C.toLowerCase();return b.filter(x=>x.name.toLowerCase().includes(o)||x.email&&x.email.toLowerCase().includes(o))},[C,b]);return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:g}),e.jsxs(Te,{open:S,onOpenChange:o=>{T(o),o||u("")},children:[e.jsx(De,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full h-9 px-3 flex items-center justify-between rounded-md border bg-background text-sm text-left focus:outline-none focus:ring-2 focus:ring-primary/40 hover:bg-accent disabled:opacity-50",disabled:N,children:[e.jsx("span",{className:`truncate flex-1 ${h?"":"text-muted-foreground"}`,children:h||`Select ${g}`}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[h&&!N&&e.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),c("")},className:"h-5 w-5 rounded-sm hover:bg-muted flex items-center justify-center transition-colors",children:e.jsx(ps,{className:"h-3 w-3"})}),e.jsx(Ie,{size:14,className:"opacity-50"})]})]})}),e.jsx(Re,{className:"w-[320px] p-0",align:"start",sideOffset:4,onOpenAutoFocus:o=>o.preventDefault(),children:e.jsxs(Ve,{shouldFilter:!1,children:[e.jsx(He,{value:C,onValueChange:u,placeholder:"Search...",className:"h-9",autoFocus:!0}),e.jsx(We,{className:"py-8 text-sm text-muted-foreground text-center",children:"No matches."}),e.jsx(Xe,{className:"max-h-72 overflow-auto",children:_.map(o=>{const x=o.name===h,y=t.has(o.name)&&!x;return e.jsxs(Je,{value:o.name,disabled:y,onSelect:()=>{y||(c(o.name),T(!1),u(""))},className:`flex flex-col items-start gap-0.5 px-3 py-2
                      ${x?"bg-muted":""}
                      ${y?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center w-full gap-2",children:[e.jsx(hs,{size:14,className:x?"opacity-100 text-muted-foreground":"opacity-0"}),e.jsx("span",{className:"text-sm truncate",children:o.name})]}),o.email&&e.jsx("span",{className:"pl-5 text-[11px] text-muted-foreground truncate max-w-[250px]",children:o.email}),y&&!x&&e.jsx("span",{className:"pl-5 text-[10px] text-muted-foreground",children:"Already chosen"})]},o.id)})})]})})]})]})}function It(g){var ie,le,oe,de,ce,me,ue,xe,fe,pe,he,je;const h=g||{},c=h.defenseRequest||null,b=h.userRole||"",N=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/coordinator/defense-requests"}];if(c!=null&&c.id){const s=(((ie=c.thesis_title)==null?void 0:ie.length)||0)>60?c.thesis_title.slice(0,57)+"...":c.thesis_title||`Request #${c.id}`;N.push({title:s,href:`/coordinator/defense-requests/${c.id}/details`})}if(!c)return e.jsxs(Ne,{breadcrumbs:N,children:[e.jsx(ve,{title:"Defense Request - Not Found"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-red-500",children:"No defense request loaded. Use the list page and click Details again."}),e.jsx(p,{variant:"outline",onClick:()=>be.visit("/coordinator/defense-requests"),children:"Back to list"})]})]});const[t,S]=m.useState(c),[T,C]=m.useState(!1),[u,_]=m.useState({open:!1,action:null,sendEmail:!1}),[o,x]=m.useState(!1),[y,X]=m.useState([]),[J,K]=m.useState(!1),[G,Q]=m.useState(null),[Ee,Y]=m.useState([]);m.useEffect(()=>{let s=!0;async function a(){K(!0),Q(null);const n=["/coordinator/defense/panel-members-all","/api/panel-members"];let r=!1;for(const i of n)try{const l=await fetch(i,{headers:{Accept:"application/json"}});if(!l.ok){console.warn("Panel member fetch failed",i,l.status);continue}const d=await l.json();s&&(X(Array.isArray(d)?d:[]),r=!0);break}catch(l){console.warn("Fetch error",i,l)}!r&&s&&(X([]),Q("Could not load panel members.")),s&&K(!1)}return a(),()=>{s=!1}},[]),m.useEffect(()=>{let s=!0;return(async()=>{try{const n=await(await fetch("/dean/payment-rates/data",{headers:{Accept:"application/json"}})).json(),r=Array.isArray(n==null?void 0:n.rates)?n.rates:Array.isArray(n)?n:[];s&&Y(r)}catch{s&&Y([])}})(),()=>{s=!1}},[]);const[j,F]=m.useState({defense_chairperson:t.defense_chairperson??"",defense_panelist1:t.defense_panelist1??"",defense_panelist2:t.defense_panelist2??"",defense_panelist3:t.defense_panelist3??"",defense_panelist4:t.defense_panelist4??""}),[f,k]=m.useState({scheduled_date:t.scheduled_date??"",scheduled_time:t.scheduled_time??"",scheduled_end_time:t.scheduled_end_time??"",defense_mode:t.defense_mode??"",defense_venue:t.defense_venue??"",scheduling_notes:t.scheduling_notes??""}),[gs,vs]=m.useState(!1),[bs,Ns]=m.useState(!1),Z=m.useMemo(()=>new Set(Object.values(j).filter(Boolean)),[j]),v=["Coordinator","Administrative Assistant","Dean"].includes(b),ee=m.useMemo(()=>{var n;const s=(t.defense_adviser||"").toLowerCase().trim(),a=(((n=t.coordinator)==null?void 0:n.email)||"").toLowerCase().trim();return y.filter(r=>{const i=(r.type||"").toLowerCase(),l=(r.name||"").toLowerCase(),d=(r.email||"").toLowerCase();return!(i.includes("advis")||s&&l&&(l===s||l.includes(s)||s.includes(l))||a&&d&&d===a)})},[y]);async function se(){var s;try{return await fetch("/sanctum/csrf-cookie",{credentials:"same-origin"}),((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""}catch{return""}}async function L(s,a,n=!0){a.headers||(a.headers={}),a.headers["X-CSRF-TOKEN"]=await se();let r;try{r=await fetch(s,a)}catch{throw new Error("network")}if(r.status===419&&n){a.headers["X-CSRF-TOKEN"]=await se();try{r=await fetch(s,a)}catch{throw new Error("network")}}return r}async function M(s,a=!1){if(t.id){x(!0);try{s==="approve"&&(await L(`/coordinator/defense-requests/${t.id}/panels`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(j)}),await L(`/coordinator/defense-requests/${t.id}/schedule-json`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(f)}));const n=await L(`/defense-requests/${t.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({decision:s==="approve"?"approve":s==="reject"?"reject":"retrieve",comment:null,send_email:a})});let r={};try{r=await n.json()}catch{r={error:"Invalid response from server."}}console.log("updateStatus response:",{ok:n.ok,status:n.status,data:r}),n.ok&&r.ok?(r.request&&(S(r.request),F({defense_chairperson:r.request.defense_chairperson||"",defense_panelist1:r.request.defense_panelist1||"",defense_panelist2:r.request.defense_panelist2||"",defense_panelist3:r.request.defense_panelist3||"",defense_panelist4:r.request.defense_panelist4||""}),k({scheduled_date:r.request.scheduled_date||"",scheduled_time:r.request.scheduled_time||"",scheduled_end_time:r.request.scheduled_end_time||"",defense_mode:r.request.defense_mode||"",defense_venue:r.request.defense_venue||"",scheduling_notes:r.request.scheduling_notes||""})),P.success(`Defense request ${s==="approve"?"approved":s==="reject"?"rejected":"retrieved"} successfully`)):r.missing_fields?P.error("Missing required fields: "+r.missing_fields.join(", ")):P.error((r==null?void 0:r.error)||`Failed to update status (${n.status})`)}catch(n){n instanceof Error&&n.message==="network"?P.error("Network error updating status. Please check your connection and try again."):P.error("Unknown error updating status.")}finally{x(!1),_({open:!1,action:null,sendEmail:!1})}}}function O(s){if(!s)return"—";try{return E(new Date(s),"PPP")}catch{return s}}function w(s){return s?/^https?:\/\//i.test(s)||s.startsWith("/storage/")?s:`/storage/${s.replace(/^\/?storage\//,"")}`:null}const te=[{label:"Adviser’s Endorsement",url:w(((le=t.attachments)==null?void 0:le.advisers_endorsement)||t.advisers_endorsement)},{label:"REC Endorsement",url:w(((oe=t.attachments)==null?void 0:oe.rec_endorsement)||t.rec_endorsement)},{label:"Proof of Payment",url:w(((de=t.attachments)==null?void 0:de.proof_of_payment)||t.proof_of_payment)},{label:"Manuscript",url:w(((ce=t.attachments)==null?void 0:ce.manuscript_proposal)||t.manuscript_proposal)},{label:"Similarity Form",url:w(((me=t.attachments)==null?void 0:me.similarity_index)||t.similarity_index)},{label:"Avisee-Adviser File",url:w(((ue=t.attachments)==null?void 0:ue.avisee_adviser_attachment)||t.avisee_adviser_attachment)},{label:"AI Declaration Form",url:w(((xe=t.attachments)==null?void 0:xe.ai_detection_certificate)||t.ai_detection_certificate)},{label:"Endorsement Form",url:w(((fe=t.attachments)==null?void 0:fe.endorsement_form)||t.endorsement_form)}];function Fe(s){var A;const a=s.event_type||s.action||s.status_change||s.status||s.type||"Event",n=s.description||s.details||s.note||s.notes||s.remarks||"",r=s.from_state||s.from||s.previous_state,i=s.to_state||s.to||s.new_state,l=s.created_at||s.timestamp||s.performed_at||s.date||"",d=s.user_name||((A=s.user)==null?void 0:A.name)||s.actor_name||s.actor||s.performed_by_name||s.performed_by||"";return{event:a,desc:n,from:r,to:i,created:l,userName:d}}const $="rounded-lg border p-5 space-y-3";function Le(s){var r,i,l,d;const a=((i=(r=s.first_name)==null?void 0:r.trim())==null?void 0:i[0])??"",n=((d=(l=s.last_name)==null?void 0:l.trim())==null?void 0:d[0])??"";return(a+n).toUpperCase()||"U"}function Me(s){if(!s)return"";try{return E(new Date(s),"PPpp")}catch{return s}}const Oe=[{key:"submitted",label:"Submitted",icon:e.jsx(xs,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:e.jsx(fs,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:e.jsx(H,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:e.jsx(W,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:e.jsx(Pe,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected by Coordinator",icon:e.jsx(Se,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved",icon:e.jsx(Ae,{className:"h-5 w-5"})}];function $e(s){return s=(s||"").toLowerCase(),s.includes("submit")?"submitted":s.includes("adviser")?"adviser-approved":s.includes("rejected")?"rejected":s.includes("retrieved")?"retrieved":s.includes("coordinator")?"coordinator-approved":s.includes("panel")?"panels-assigned":s.includes("schedule")?"scheduled":""}function ae(s){if(!s)return"";const[a,n]=s.split(":"),r=new Date;return r.setHours(Number(a),Number(n)),E(r,"hh:mm a")}const[re,ne]=m.useState("details");function ze(s){if(!t.program_level||!t.defense_type)return null;let a="";s==="Adviser"?a="Adviser":a="Panel Chair";const n=l=>l.toLowerCase().replace(/[^a-z]/g,""),r=n(t.defense_type),i=Ee.find(l=>{const d=l.program_level===t.program_level,A=l.type===a,ge=n(l.defense_type||"")===r;return d&&A&&ge});return i?Number(i.amount):null}return e.jsxs(Ne,{breadcrumbs:N,children:[e.jsx(Ue,{position:"bottom-right",richColors:!0,closeButton:!0}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsx(ve,{title:t.thesis_title||`Defense Request #${t.id}`}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>be.visit("/defense-request"),className:"h-8 px-2",children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsx(ye,{value:re,onValueChange:s=>ne(s),children:e.jsxs(is,{className:"h-8",children:[e.jsxs(we,{value:"details",className:"flex items-center gap-1 text-sm px-3",children:[e.jsx(R,{className:"h-4 w-4"})," Details"]}),e.jsxs(we,{value:"assign-schedule",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(V,{className:"h-4 w-4"}),"Assign & Schedule"]})]})})]}),v&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>C(!0),disabled:o||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(us,{className:"h-4 w-4 mr-1 text-green-600"}),"Approve & Sign"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>_({open:!0,action:"reject",sendEmail:!1}),disabled:o||t.coordinator_status==="Rejected"||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(Se,{className:"h-4 w-4 mr-1 text-red-600"}),"Reject"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>_({open:!0,action:"retrieve",sendEmail:!1}),disabled:o||!["Rejected","Approved"].includes(t.coordinator_status||"")||t.workflow_state==="completed",children:[e.jsx(Ae,{className:"h-4 w-4 mr-1 text-blue-600"}),"Retrieve"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-5 mb-2",children:[e.jsx("div",{className:"w-full md:max-w-3xl mx-auto flex flex-col gap-5",children:e.jsxs(ye,{value:re,onValueChange:s=>ne(s),className:"w-full",children:[e.jsxs(Ce,{value:"details",className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-start md:justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-2xl font-semibold",children:t.thesis_title}),e.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),e.jsx("div",{className:"flex flex-col md:items-end gap-1",children:t.adviser_status&&e.jsxs(z,{variant:"secondary",className:B("text-xs font-semibold px-3 py-1",t.adviser_status==="Approved"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":t.adviser_status==="Rejected"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:["Adviser Status: ",t.adviser_status==="Approved"?"Endorsed":t.adviser_status]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rs,{className:"h-8 w-8",children:e.jsx(ns,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:Le(t)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm leading-tight",children:[t.first_name," ",t.middle_name?`${t.middle_name} `:"",t.last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:t.school_id})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),e.jsx("div",{className:"font-medium text-sm",children:t.program})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),e.jsx(z,{variant:"secondary",className:"text-xs font-medium",children:t.defense_type??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Submitted At"}),e.jsx("div",{className:"font-medium text-sm",children:O(t.submitted_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program Coordinator"}),e.jsx("div",{className:"font-medium text-sm",children:((pe=t.coordinator)==null?void 0:pe.name)||"Rogelio O. Badiang (rbadiang@uic.edu.ph)"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Coordinator Status"}),e.jsx(z,{variant:"secondary",className:B("text-xs font-semibold",t.coordinator_status==="Approved"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":t.coordinator_status==="Rejected"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:t.coordinator_status||"Pending"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(q,{className:"my-2"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),e.jsx("div",{className:"font-medium text-sm",children:O(t.scheduled_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduled_time?`${ae(t.scheduled_time)}${t.scheduled_end_time?" - "+ae(t.scheduled_end_time):""}`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx("div",{className:"font-medium text-sm",children:t.defense_venue||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsx("div",{className:"font-medium text-sm capitalize",children:t.defense_mode?t.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduling_notes||"—"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-5 space-y-3",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"})," Committee"]}),e.jsx(q,{}),(()=>{const s=(i,l)=>{const d=js(y,i);return{displayName:(d==null?void 0:d.name)||i||"—",email:(d==null?void 0:d.email)||"",rawValue:i||"",role:l}},a=[{key:"adviser",info:s(t.defense_adviser,"Adviser")},{key:"defense_chairperson",info:s(j.defense_chairperson||t.defense_chairperson,"Panel Chair")},{key:"defense_panelist1",info:s(j.defense_panelist1||t.defense_panelist1,"Panel Member 1")},{key:"defense_panelist2",info:s(j.defense_panelist2||t.defense_panelist2,"Panel Member 2")}];t.program_level==="Doctorate"&&a.push({key:"defense_panelist3",info:s(j.defense_panelist3||t.defense_panelist3,"Panel Member 3")},{key:"defense_panelist4",info:s(j.defense_panelist4||t.defense_panelist4,"Panel Member 4")});const n=a.map(i=>{const d=!!(i.info.rawValue||i.info.displayName&&i.info.displayName!=="—")?ze(i.info.role):null;return{name:i.info.displayName,email:i.info.email||"—",role:i.info.role,receivable:d}}),r=i=>typeof i=="number"?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(i):i??"—";return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ls,{className:"border-0",children:[e.jsx(os,{children:e.jsxs(ke,{children:[e.jsx(I,{className:"min-w-[200px]",children:"Name & Email"}),e.jsx(I,{className:"min-w-[100px]",children:"Role"}),e.jsx(I,{className:"min-w-[140px] text-right",children:"Receivable"})]})}),e.jsx(ds,{children:n.map((i,l)=>e.jsxs(ke,{children:[e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm",children:i.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i.email})]})}),e.jsx(U,{className:"text-xs",children:i.role}),e.jsx(U,{className:"text-right text-xs font-medium",children:r(i.receivable)})]},l))})]})})})()]}),e.jsxs("div",{className:$,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"})," Attachments"]}),e.jsx(q,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[te.filter(s=>!!s.url).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),te.filter(s=>!!s.url).map(s=>{var a;return e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(a=s.url)==null?void 0:a.split("/").pop()})]},s.label)}),t.reference_no&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Reference No."}),e.jsx("span",{className:"ml-auto text-xs",children:t.reference_no})]})]})]})]}),e.jsxs(Ce,{value:"assign-schedule",className:"space-y-5",children:[e.jsxs("div",{className:$,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"})," Panel Assignment"]}),e.jsx(q,{}),e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:t.program_level==="Doctorate"?"Doctorate program: 4 panel members required (Chairperson + 3 Panelists)":"Masteral program: 3 panel members required (Chairperson + 2 Panelists)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[[{label:"Chairperson",key:"defense_chairperson"},{label:"Panelist 1",key:"defense_panelist1"},{label:"Panelist 2",key:"defense_panelist2"}].map(({label:s,key:a})=>e.jsx(qe,{label:s,value:j[a],onChange:n=>F(r=>({...r,[a]:n})),options:ee,disabled:!v||J,taken:Z},a)),t.program_level==="Doctorate"&&[{label:"Panelist 3",key:"defense_panelist3"},{label:"Panelist 4",key:"defense_panelist4"}].map(({label:s,key:a})=>e.jsx(qe,{label:s,value:j[a],onChange:n=>F(r=>({...r,[a]:n})),options:ee,disabled:!v||J,taken:Z},a))]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Changes to panel assignments are saved when you Approve the request."})}),G&&e.jsx("div",{className:"text-xs text-red-500 mt-2",children:G})]}),e.jsxs("div",{className:$,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"})," Scheduling"]}),e.jsx(q,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Date"}),e.jsxs(Te,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:B("w-full justify-start text-left font-normal",!f.scheduled_date&&"text-muted-foreground"),disabled:!v,children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),f.scheduled_date?O(f.scheduled_date):"Pick a date"]})}),e.jsx(Re,{className:"w-auto p-0",align:"start",children:e.jsx(Ke,{mode:"single",selected:f.scheduled_date?new Date(f.scheduled_date):void 0,onSelect:s=>{k(a=>({...a,scheduled_date:s?E(s,"yyyy-MM-dd"):""}))},initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Start Time"}),e.jsx(D,{type:"time",value:f.scheduled_time,onChange:s=>k(a=>({...a,scheduled_time:s.target.value})),disabled:!v})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"End Time"}),e.jsx(D,{type:"time",value:f.scheduled_end_time,onChange:s=>k(a=>({...a,scheduled_end_time:s.target.value})),disabled:!v})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsxs(Ge,{value:f.defense_mode,onValueChange:s=>k(a=>({...a,defense_mode:s})),disabled:!v,children:[e.jsx(Qe,{children:e.jsx(Ye,{placeholder:"Select mode"})}),e.jsxs(Ze,{children:[e.jsx(_e,{value:"face-to-face",children:"Face-to-Face"}),e.jsx(_e,{value:"online",children:"Online"})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx(D,{value:f.defense_venue,onChange:s=>k(a=>({...a,defense_venue:s.target.value})),disabled:!v})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx(D,{value:f.scheduling_notes,onChange:s=>k(a=>({...a,scheduling_notes:s.target.value})),disabled:!v})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Scheduling changes will be persisted when you Approve the request."})})]})]})]})}),e.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:e.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 sticky top-24 h-fit",children:[e.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"})," Workflow Progress"]}),e.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(t.workflow_history)&&t.workflow_history.length>0?t.workflow_history.map((s,a)=>{const{event:n,created:r,userName:i}=Fe(s),l=$e(n),d=Oe.find(Be=>Be.key===l)||{label:n.charAt(0).toUpperCase()+n.slice(1),icon:e.jsx(W,{className:"h-5 w-5 text-gray-500"})},A=Array.isArray(t.workflow_history)&&a===t.workflow_history.length-1;return e.jsxs("div",{className:"flex items-start gap-3 relative",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:d.icon}),!A&&e.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:"font-semibold text-xs",children:d.label}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[i&&e.jsx("span",{children:i}),r&&e.jsxs("span",{children:[" ","· ",Me(r)]})]})]})]},a)}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]})]}),e.jsx(cs,{open:T,onOpenChange:C,defenseRequest:t,coordinatorId:(he=t.coordinator)==null?void 0:he.id,coordinatorName:((je=t.coordinator)==null?void 0:je.name)||"Coordinator",onApproveComplete:()=>{window.location.reload()}}),e.jsx(es,{open:u.open,onOpenChange:s=>{s||_({open:!1,action:null,sendEmail:!1})},children:e.jsxs(ss,{children:[e.jsx(ts,{children:"Confirm Action"}),e.jsx(as,{children:u.action==="approve"?"Please review before approving.":u.action==="reject"?"Are you sure you want to reject this defense request?":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[e.jsxs("p",{children:["Set request to"," ",e.jsx("span",{className:"font-semibold",children:u.action==="approve"?"Approved":u.action==="reject"?"Rejected":"Pending"}),"?"]}),u.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(Pe,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving this defense request authorizes the use of your signature on the official defense documents."})]})]}),u.action==="approve"||u.action==="reject"?e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Would you like to send email notifications to all parties?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"ghost",className:"flex-1",onClick:()=>_({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(p,{variant:"outline",className:"flex-1",onClick:()=>{u.action&&M(u.action,!1)},disabled:o,children:"Skip Email"}),e.jsx(p,{className:"flex-1",onClick:()=>{u.action&&M(u.action,!0)},disabled:o,children:"Send Emails"})]})]}):e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(p,{variant:"ghost",onClick:()=>_({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(p,{onClick:()=>u.action&&M(u.action,!1),disabled:o,children:"Confirm"})]})]})})]})}export{It as default};
