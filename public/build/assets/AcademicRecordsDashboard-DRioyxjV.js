import{r as n,j as e}from"./app-c5ij2Uy8.js";import{C as m,a as h,b as j,c as x}from"./card-BNsNXpUP.js";import{S as _,a as E,b as R,c as k,d as P}from"./select-CdAxdG97.js";import{T as I,a as A,b as y,c as r,d as H,e as c}from"./table-B_bp0TeV.js";import{S as a}from"./skeleton-CGx7kAgr.js";import{c as M}from"./createLucideIcon-QXbACLHs.js";import{P as W}from"./printer-D3edrfgz.js";import"./utils-jAU0Cazi.js";import"./index-DQWsGEEw.js";import"./index-CV-6as2J.js";import"./index-bpbdPemA.js";import"./index-B09PGLNS.js";import"./floating-ui.react-dom-Dei2gU0X.js";import"./index-Dy381sfG.js";import"./index-CQBUWWAm.js";import"./chevron-down-DGQt6VpT.js";import"./check--NhZ1PHA.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],F=M("RefreshCw",L),te=()=>{const[i,p]=n.useState(!0),[u,f]=n.useState(null),[l,v]=n.useState(null),[o,S]=n.useState(void 0),N=n.useRef(null),[g,C]=n.useState(180),b=()=>{p(!0),f(null);const t="/legacy/academic-records"+(o?`?semester_id=${o}`:"");fetch(t,{headers:{Accept:"application/json"}}).then(async s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);const d=await s.json();v(d.data)}).catch(s=>f(s.message)).finally(()=>p(!1))};n.useEffect(()=>{b()},[]),n.useEffect(()=>{o&&b()},[o]);const T=()=>{const t=document.getElementById("academic-records-table");if(!t)return;const s=window.open("","","width=900,height=600");s&&(s.document.write("<html><head><title>Print Academic Records</title>"),s.document.write("<style>table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ccc;padding:6px;text-align:center;}th{text-align:center;}body{font-family:sans-serif;}</style>"),s.document.write("</head><body>"),s.document.write(t.outerHTML),s.document.write("</body></html>"),s.document.close(),s.focus(),s.print())};return n.useEffect(()=>{if(N.current&&(l!=null&&l.semesters)){const t=l.semesters.reduce((d,w)=>d.label.length>w.label.length?d:w,{label:""}),s=document.createElement("span");s.style.visibility="hidden",s.style.position="absolute",s.style.fontSize="16px",s.style.fontWeight="400",s.style.padding="8px",s.innerText=t.label||"Select semester",document.body.appendChild(s),C(s.offsetWidth+40),document.body.removeChild(s)}},[l==null?void 0:l.semesters]),e.jsxs("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-3 py-2 rounded border flex items-center gap-2 disabled:opacity-50",disabled:i,title:"Reload",children:e.jsx(F,{size:18,className:i?"animate-spin":""})}),e.jsx("button",{onClick:T,className:"px-3 py-2 rounded border flex items-center gap-2",title:"Print Table",disabled:i,children:e.jsx(W,{size:18})})]})}),i&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{className:"rounded-xl border mb-4 shadow-none w-full",children:[e.jsx(h,{children:e.jsx(j,{children:e.jsx(a,{className:"h-6 w-1/3 bg-gray-200"})})}),e.jsxs(x,{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full",children:[e.jsxs("div",{children:[e.jsx(a,{className:"h-4 w-24 mb-2 bg-gray-200"}),e.jsx(a,{className:"h-4 w-32 mb-2 bg-gray-200"}),e.jsx(a,{className:"h-4 w-40 mb-2 bg-gray-200"}),e.jsx(a,{className:"h-4 w-28 mb-2 bg-gray-200"}),e.jsx(a,{className:"h-4 w-20 mt-2 bg-gray-200"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(a,{className:"h-4 w-24 mb-2 bg-gray-200"}),e.jsx(a,{className:"h-10 bg-gray-200",style:{width:g}}),e.jsx(a,{className:"h-3 w-32 mt-2 bg-gray-200"})]})]})]}),e.jsxs(m,{className:"rounded-xl border shadow-none w-full",children:[e.jsx(h,{children:e.jsx(j,{children:e.jsx(a,{className:"h-6 w-1/4 bg-gray-200"})})}),e.jsxs(x,{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 w-full",children:[e.jsx(a,{className:"h-5 w-24 bg-gray-200"}),e.jsx(a,{className:"h-4 w-12 bg-gray-200"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsx("div",{className:"min-w-[700px] w-full",children:[...Array(3)].map((t,s)=>e.jsx(a,{className:"h-8 w-full mb-2 bg-gray-200"},s))})})]})]})]}),u&&e.jsx(m,{className:"rounded-xl border mb-4 shadow-none",children:e.jsxs(x,{className:"bg-red-50 text-red-700",children:["Failed to load: ",u," — try logging out/in if session expired."]})}),!i&&!u&&l&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{className:"rounded-xl border mb-4 shadow-none w-full",children:[e.jsx(h,{children:e.jsx(j,{children:"Student Information & Semester"})}),e.jsxs(x,{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium text-gray-500 mb-2",children:"Student"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"School ID:"})," ",l.student.student_number||"—"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",l.student.name||"—"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Program:"})," ",l.student.program||"—"]}),l.gwa&&e.jsxs("p",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"GWA:"})," ",l.gwa]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-500 mb-2",children:"Semester"}),e.jsx("div",{ref:N,style:{width:g},children:e.jsxs(_,{value:o??l.current_semester_id??"",onValueChange:t=>S(t),children:[e.jsx(E,{className:"w-full bg-gray-100 border rounded",style:{width:g},children:e.jsx(R,{placeholder:"Select semester"})}),e.jsx(k,{children:l.semesters.map(t=>e.jsx(P,{value:t.id,children:t.label},t.id))})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Select a semester to reload real grades."})]})]})]}),e.jsxs(m,{className:"rounded-xl border shadow-none w-full",children:[e.jsx(h,{children:e.jsx(j,{children:"Courses"})}),e.jsxs(x,{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 w-full",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Courses"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[l.records.length," rows"]})]}),l.records.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No records returned for this semester."}):e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs(I,{id:"academic-records-table",children:[e.jsx(A,{children:e.jsxs(y,{children:[e.jsx(r,{children:"Code"}),e.jsx(r,{children:"Title"}),e.jsx(r,{children:"Units"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Prelim"}),e.jsx(r,{children:"Midterm"}),e.jsx(r,{children:"Finals"}),e.jsx(r,{children:"Average"}),e.jsx(r,{children:"Units Earned"}),e.jsx(r,{children:"Section"})]})}),e.jsx(H,{children:l.records.map((t,s)=>{const d=t.average||t.average_var||"";return e.jsxs(y,{className:"hover:bg-gray-50",children:[e.jsx(c,{children:t.code}),e.jsx(c,{children:t.title}),e.jsx(c,{className:"text-center",children:t.units}),e.jsx(c,{className:"text-center",children:t.course_type}),e.jsx(c,{className:"text-center",children:t.prelim}),e.jsx(c,{className:"text-center",children:t.midterm}),e.jsx(c,{className:"text-center",children:t.finals}),e.jsxs(c,{className:"text-center",children:[d,d&&t.units_earned!==null?` / ${t.units_earned}`:""]}),e.jsx(c,{className:"text-center",children:t.units_earned}),e.jsx(c,{className:"text-center",children:t.section})]},s)})})]})})]})]})]})]})};export{te as default};
