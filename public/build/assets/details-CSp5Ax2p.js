import{r as x,j as s,L as ie,S as I}from"./app-BDkuJsct.js";import{A as ce}from"./app-layout-Cr_DtTkJ.js";import{B as y}from"./badge-BJdX7_A9.js";import{S as b}from"./separator-DaKqQg6m.js";import{A as me,a as le}from"./avatar-DpsgA3Kf.js";import{B as p}from"./button-DggClj9M.js";import{t as f}from"./index-By5vkq0G.js";import{T as de,a as xe,b as q,c as w,d as fe,e as k}from"./table-CnA6sFiR.js";import{c as O}from"./utils-jAU0Cazi.js";import{A as ue}from"./arrow-left-Dc-Yamg5.js";import{A as pe}from"./arrow-right-DTnDefOT.js";import{H as K}from"./hourglass-BE6hGw0v.js";import{B as V}from"./banknote-Cl0WRxxf.js";import{C as X}from"./circle-check-_tJ384BC.js";import{D as he}from"./dollar-sign-CSALIIUa.js";import{C as v}from"./clock-BykI6stH.js";import{U as W}from"./user-IY2-Ii15.js";import{F as A}from"./file-text-rxgzo2tt.js";import{S as je}from"./send-9CEFXyiZ.js";import{U as be}from"./user-check-BI6QpplU.js";import{S as ve}from"./signature-B6fTe-ja.js";import{C as _e}from"./circle-x-DUEw59KP.js";import{C as ge}from"./circle-arrow-left-CALWzfs1.js";import{f as C}from"./format-Cze4Gw5q.js";import"./index-B_a1aFVM.js";import"./index-DZZQifJx.js";import"./input-BmPXXlp0.js";import"./index-CWqpdCTP.js";import"./index-BhbofC_p.js";import"./index-D-bfryUZ.js";import"./x-CtfT_1vN.js";import"./createLucideIcon-CEmaZ7tj.js";import"./tooltip-CWM4FSMS.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./chevron-right-BpKiIXqV.js";import"./dropdown-menu-B7sOazTG.js";import"./index-DMsjTEK4.js";import"./index-BdhkuEJx.js";import"./index-LRezjsDo.js";import"./index-BKBXBDOv.js";import"./index-QFmRa-KD.js";import"./check-BUlQxyEc.js";import"./settings-BITCJcnj.js";import"./users-BTr8E8QO.js";import"./graduation-cap-Cszrlop1.js";import"./credit-card-CM3Zlvhr.js";import"./tabs-BOuSS6lC.js";import"./circle-check-big-CKfkcUFR.js";import"./info-DwFda8kE.js";import"./sun-B3PIUh1_.js";function J(c){if(!c)return"â€”";try{return C(new Date(c),"PPP")}catch{return c}}function G(c){if(!c)return"";const[e,l]=(c||"").split(":");if(e===void 0||l===void 0)return c||"";const d=new Date;return d.setHours(Number(e),Number(l)),C(d,"hh:mm a")}function Ne(c){var d,h,_,u;const e=((h=(d=c.first_name)==null?void 0:d.trim())==null?void 0:h[0])??"",l=((u=(_=c.last_name)==null?void 0:_.trim())==null?void 0:u[0])??"";return(e+l).toUpperCase()||"U"}function vs({defenseRequest:c}){var R,T,D,E,z,M,$,H,L,B;const[e,l]=x.useState(c??null),[d,h]=x.useState([]),[_,u]=x.useState(!1),[Q,P]=x.useState([]);x.useEffect(()=>{let r=!0;async function n(){u(!0);try{const a=await fetch("/api/panel-members",{headers:{Accept:"application/json"}});if(a.ok){const t=await a.json();r&&h(Array.isArray(t)?t:[])}}catch(a){console.warn("Failed to load panel members",a)}finally{r&&u(!1)}}return n(),()=>{r=!1}},[]),x.useEffect(()=>{let r=!0;return(async()=>{try{const a=await(await fetch("/dean/payment-rates/data",{headers:{Accept:"application/json"}})).json(),t=Array.isArray(a==null?void 0:a.rates)?a.rates:Array.isArray(a)?a:[];r&&P(t)}catch{r&&P([])}})(),()=>{r=!1}},[]);function Y(r){return r?d.find(n=>n.name===r):null}function Z(r){if(!(e!=null&&e.program_level)||!(e!=null&&e.defense_type))return null;let n="";r==="Adviser"?n="Adviser":n="Panel Chair";const a=o=>o.toLowerCase().replace(/[^a-z]/g,""),t=a(e.defense_type),i=Q.find(o=>{const j=o.program_level===e.program_level,N=o.type===n,U=a(o.defense_type||"")===t;return j&&N&&U});return i?Number(i.amount):null}const S=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/assistant/all-defense-list"}];if(e!=null&&e.id){const r=(((R=e.thesis_title)==null?void 0:R.length)||0)>60?e.thesis_title.slice(0,57)+"...":e.thesis_title||`Request #${e.id}`;S.push({title:r,href:`/assistant/all-defense-list/${e.id}/details`})}function ee(r){var i;const n=r.event_type||r.action||r.status_change||r.status||r.type||"Event",a=r.created_at||r.timestamp||r.performed_at||r.date||"",t=r.user_name||((i=r.user)==null?void 0:i.name)||r.actor_name||r.actor||r.performed_by_name||r.performed_by||"";return{event:n,created:a,userName:t}}function se(r){if(!r)return"";try{return C(new Date(r),"PPpp")}catch{return r}}function m(r){return r?/^https?:\/\//i.test(r)||r.startsWith("/storage/")?r:`/storage/${r.replace(/^\/?storage\//,"")}`:null}const F=[{label:"Adviser's Endorsement",url:m((T=e==null?void 0:e.attachments)==null?void 0:T.advisers_endorsement)},{label:"REC Endorsement",url:m((D=e==null?void 0:e.attachments)==null?void 0:D.rec_endorsement)},{label:"Proof of Payment",url:m((E=e==null?void 0:e.attachments)==null?void 0:E.proof_of_payment)},{label:"Manuscript",url:m((z=e==null?void 0:e.attachments)==null?void 0:z.manuscript_proposal)},{label:"Similarity Form",url:m((M=e==null?void 0:e.attachments)==null?void 0:M.similarity_index)},{label:"Avisee-Adviser File",url:m(($=e==null?void 0:e.attachments)==null?void 0:$.avisee_adviser_attachment)},{label:"AI Declaration Form",url:m((H=e==null?void 0:e.attachments)==null?void 0:H.ai_detection_certificate)},{label:"Endorsement Form",url:m((L=e==null?void 0:e.attachments)==null?void 0:L.endorsement_form)}],re="rounded-lg border p-5 space-y-3",te=[{key:"submitted",label:"Submitted",icon:s.jsx(je,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:s.jsx(be,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:s.jsx(ve,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:s.jsx(W,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:s.jsx(v,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected",icon:s.jsx(_e,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved",icon:s.jsx(ge,{className:"h-5 w-5"})}];function ae(r){return r=(r||"").toLowerCase(),r.includes("submit")?"submitted":r.includes("adviser-approved")||r.includes("endorsed")?"adviser-approved":r.includes("coordinator-approved")?"coordinator-approved":r.includes("panel")?"panels-assigned":r.includes("schedule")?"scheduled":r.includes("rejected")?"rejected":r.includes("retrieved")?"retrieved":""}async function ne(){var r;if(e)try{const n=await fetch(`/defense-requests/${e.id}/complete`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.content)||""}}),a=await n.json();n.ok&&a.success?(l({...e,status:"Completed",workflow_state:"completed",aa_verification_status:"completed"}),f.success("Defense marked as completed and honorarium payments created!"),setTimeout(()=>{I.visit("/assistant/all-defense-list")},1500)):f.error(a.error||"Failed to mark as completed")}catch(n){console.error("Error marking as completed:",n),f.error("Error marking as completed")}}async function g(r){var n;if(e)try{const a=e.aa_verification_id,t=await fetch(`/assistant/aa-verification/${e.id}/status`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content)||""},body:JSON.stringify({status:r})}),i=await t.json();if(t.ok&&i.success){l({...e,aa_verification_status:r,aa_verification_id:i.aa_verification_id});const o={ready_for_finance:"Ready for Finance",in_progress:"In Progress",paid:"Paid",completed:"Completed"};f.success(`AA status updated to ${o[r]}`)}else f.error(i.error||"Failed to update AA status")}catch(a){console.error("Error updating AA status:",a),f.error("Error updating AA status")}}return s.jsxs(ce,{breadcrumbs:S,children:[s.jsx(ie,{title:(e==null?void 0:e.thesis_title)||`Defense Request #${(e==null?void 0:e.id)??""}`}),s.jsxs("div",{className:"p-5 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap mb-4",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(p,{variant:"outline",onClick:()=>I.visit("/assistant/all-defense-list"),className:"h-8 px-2",children:s.jsx(ue,{className:"h-4 w-4"})})}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs(p,{size:"sm",variant:"outline",onClick:()=>g("ready_for_finance"),disabled:(e==null?void 0:e.aa_verification_status)==="completed"||(e==null?void 0:e.aa_verification_status)==="ready_for_finance",className:"gap-2",children:[s.jsx(pe,{className:"h-4 w-4 text-blue-600"}),"Ready for Finance"]}),s.jsxs(p,{size:"sm",variant:"outline",onClick:()=>g("in_progress"),disabled:(e==null?void 0:e.aa_verification_status)==="completed"||(e==null?void 0:e.aa_verification_status)==="in_progress",className:"gap-2",children:[s.jsx(K,{className:"h-4 w-4 text-amber-600"}),"In Progress"]}),s.jsxs(p,{size:"sm",variant:"outline",onClick:()=>g("paid"),disabled:(e==null?void 0:e.aa_verification_status)==="completed"||(e==null?void 0:e.aa_verification_status)==="paid",className:"gap-2",children:[s.jsx(V,{className:"h-4 w-4 text-emerald-600"}),"Paid"]}),s.jsxs(p,{size:"sm",variant:"outline",onClick:ne,disabled:(e==null?void 0:e.aa_verification_status)==="completed",className:"gap-2",children:[s.jsx(X,{className:"h-4 w-4 text-green-600"}),"Mark as Completed"]})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"md:col-span-2 space-y-6",children:[s.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[s.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-start md:justify-between gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-2xl font-semibold",children:e==null?void 0:e.thesis_title}),s.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),s.jsxs(y,{variant:"secondary",className:O("text-xs font-semibold px-3 py-1 h-fit flex items-center gap-1.5",(e==null?void 0:e.aa_verification_status)==="completed"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":(e==null?void 0:e.aa_verification_status)==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900 dark:text-emerald-300":(e==null?void 0:e.aa_verification_status)==="ready_for_finance"?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":(e==null?void 0:e.aa_verification_status)==="in_progress"?"bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:[(e==null?void 0:e.aa_verification_status)==="completed"&&s.jsx(X,{className:"h-3.5 w-3.5"}),(e==null?void 0:e.aa_verification_status)==="paid"&&s.jsx(V,{className:"h-3.5 w-3.5"}),(e==null?void 0:e.aa_verification_status)==="ready_for_finance"&&s.jsx(he,{className:"h-3.5 w-3.5"}),(e==null?void 0:e.aa_verification_status)==="in_progress"&&s.jsx(K,{className:"h-3.5 w-3.5"}),!(e!=null&&e.aa_verification_status)&&s.jsx(v,{className:"h-3.5 w-3.5"}),(e==null?void 0:e.aa_verification_status)==="completed"?"Completed":(e==null?void 0:e.aa_verification_status)==="paid"?"Paid":(e==null?void 0:e.aa_verification_status)==="ready_for_finance"?"Ready for Finance":(e==null?void 0:e.aa_verification_status)==="in_progress"?"In Progress":"Pending"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(me,{className:"h-8 w-8",children:s.jsx(le,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:Ne({first_name:e==null?void 0:e.first_name,last_name:e==null?void 0:e.last_name})})}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-sm leading-tight",children:[e==null?void 0:e.first_name," ",e!=null&&e.middle_name?`${e.middle_name} `:"",e==null?void 0:e.last_name]}),s.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:e==null?void 0:e.school_id})]})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),s.jsx("div",{className:"font-medium text-sm",children:e==null?void 0:e.program})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),s.jsx(y,{variant:"secondary",className:"text-xs font-medium",children:(e==null?void 0:e.defense_type)??"â€”"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Submitted At"}),s.jsx("div",{className:"font-medium text-sm",children:J(e==null?void 0:e.submitted_at)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program Coordinator"}),s.jsx("div",{className:"font-medium text-sm",children:((B=e==null?void 0:e.coordinator)==null?void 0:B.name)||"â€”"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Coordinator Status"}),s.jsx(y,{variant:"secondary",className:O("text-xs font-semibold",(e==null?void 0:e.coordinator_status)==="Approved"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":(e==null?void 0:e.coordinator_status)==="Rejected"?"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300"),children:(e==null?void 0:e.coordinator_status)||"Pending"})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(b,{className:"my-2"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Amount"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.amount?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(e.amount):"â€”"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Reference No."}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.reference_no)||"â€”"})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(b,{className:"my-2"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),s.jsx("div",{className:"font-medium text-sm",children:J(e==null?void 0:e.scheduled_date)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.scheduled_time?`${G(e.scheduled_time)}${e.scheduled_end_time?" - "+G(e.scheduled_end_time):""}`:"â€”"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.defense_venue)||"â€”"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),s.jsx("div",{className:"font-medium text-sm capitalize",children:e!=null&&e.defense_mode?e.defense_mode==="face-to-face"?"Face-to-Face":"Online":"â€”"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.scheduling_notes)||"â€”"})]})]})]}),s.jsxs("div",{className:"rounded-lg border p-5 space-y-3",children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(W,{className:"h-4 w-4"})," Committee"]}),s.jsx(b,{}),(()=>{const r=(t,i)=>{const o=Y(t);return{displayName:(o==null?void 0:o.name)||t||"â€”",email:(o==null?void 0:o.email)||"",rawValue:t||"",role:i}},n=[{key:"adviser",info:r(e==null?void 0:e.defense_adviser,"Adviser")},{key:"chairperson",info:r(e==null?void 0:e.defense_chairperson,"Panel Chair")},{key:"panelist1",info:r(e==null?void 0:e.defense_panelist1,"Panel Member 1")},{key:"panelist2",info:r(e==null?void 0:e.defense_panelist2,"Panel Member 2")},{key:"panelist3",info:r(e==null?void 0:e.defense_panelist3,"Panel Member 3")},{key:"panelist4",info:r(e==null?void 0:e.defense_panelist4,"Panel Member 4")}].map(t=>{const o=!!(t.info.rawValue||t.info.displayName&&t.info.displayName!=="â€”")?Z(t.info.role):null;return{name:t.info.displayName,email:t.info.email||"â€”",role:t.info.role,receivable:o}}),a=t=>t!==null?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(t):"â€”";return s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(de,{className:"border-0",children:[s.jsx(xe,{children:s.jsxs(q,{children:[s.jsx(w,{className:"min-w-[200px]",children:"Name & Email"}),s.jsx(w,{className:"min-w-[100px]",children:"Role"}),s.jsx(w,{className:"min-w-[140px] text-right",children:"Receivable"})]})}),s.jsx(fe,{children:n.map((t,i)=>s.jsxs(q,{children:[s.jsx(k,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"font-medium text-sm",children:t.name}),s.jsx("span",{className:"text-xs text-muted-foreground",children:t.email})]})}),s.jsx(k,{className:"text-xs",children:t.role}),s.jsx(k,{className:"text-right text-xs font-medium",children:a(t.receivable)})]},i))})]})})})()]}),s.jsxs("div",{className:re,children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(A,{className:"h-4 w-4"})," Attachments"]}),s.jsx(b,{}),s.jsxs("div",{className:"space-y-2 text-sm",children:[F.filter(r=>!!r.url).length===0&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),F.filter(r=>!!r.url).map(r=>{var n;return s.jsxs("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[s.jsx(A,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:r.label}),s.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(n=r.url)==null?void 0:n.split("/").pop()})]},r.label)}),(e==null?void 0:e.reference_no)&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[s.jsx(A,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"Reference No."}),s.jsx("span",{className:"ml-auto text-xs",children:e.reference_no})]})]})]})]}),s.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:s.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 sticky top-24 h-fit",children:[s.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[s.jsx(v,{className:"h-4 w-4"})," Workflow Progress"]}),s.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(e==null?void 0:e.workflow_history)&&e.workflow_history.length>0?e.workflow_history.map((r,n)=>{const{event:a,created:t,userName:i}=ee(r),o=ae(a),j=te.find(oe=>oe.key===o)||{label:a.charAt(0).toUpperCase()+a.slice(1),icon:s.jsx(v,{className:"h-5 w-5 text-gray-500"})},N=Array.isArray(e.workflow_history)&&n===e.workflow_history.length-1;return s.jsxs("div",{className:"flex items-start gap-3 relative",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:j.icon}),!N&&s.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),s.jsxs("div",{className:"pb-4",children:[s.jsx("div",{className:"font-semibold text-xs",children:j.label}),s.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[i&&s.jsx("span",{children:i}),t&&s.jsxs("span",{children:[" ","Â· ",se(t)]})]})]})]},n)}):s.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]})]})]})}export{vs as default};
