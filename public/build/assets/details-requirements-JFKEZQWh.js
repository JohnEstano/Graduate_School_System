import{r as o,j as e,L as Z,S as ee}from"./app-BubHmeqC.js";import{A as te}from"./app-layout-yLDvQPzP.js";import{d as U}from"./dayjs.min-BgzfR48W.js";import{T as we,t as l}from"./index-Bqixm_LI.js";import{B as u}from"./button-CX84Ig4W.js";import{B as ke}from"./badge-Dd_ET0uG.js";import{S as w}from"./separator-B1kTuyS6.js";import{A as Ce,a as Ae}from"./avatar-DijVPJCE.js";import{D as De,a as Se,b as Re,c as Fe}from"./dialog-ywfV6j7b.js";import{T as se,a as Ee,b as re,c as ae}from"./tabs-DVolEiAR.js";import{I as ie}from"./input-y4wBi6jo.js";import{A as Te}from"./arrow-left-DLzhx_b2.js";import{F as h}from"./file-text-B1gFNyH7.js";import{C as ze}from"./circle-check-big-BRigqRsr.js";import{C as k}from"./circle-x-vhKPM2HU.js";import{C as P}from"./circle-arrow-left-CTHOH67p.js";import{U as ne}from"./users-wdb3-6X2.js";import{C as Y}from"./clock-CyI1Boga.js";import{S as le}from"./signature--oYNZqdI.js";import{S as qe}from"./send-DnHCHsKV.js";import{U as Ue}from"./user-check-DLoTdIld.js";import"./index-CAAZlwhj.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-Bsel9b7o.js";import"./index-PQN_369Y.js";import"./index-DyQT7xcZ.js";import"./x-DS6n0ElR.js";import"./createLucideIcon-Biu-y2hB.js";import"./tooltip-tJz5bvEu.js";import"./floating-ui.react-dom-DwEbxQiH.js";import"./chevron-right-BRo8ahWW.js";import"./dropdown-menu-BExp8GpF.js";import"./index-6aAr3Pmv.js";import"./index-CVQNv_Nf.js";import"./index-1EFpZ92o.js";import"./index-CBu7v5lz.js";import"./index-Zto0mrax.js";import"./check-CZ9c_sEg.js";import"./settings-Uvo0cGb6.js";import"./graduation-cap-B7M__5Eh.js";import"./dollar-sign-DESWnaQ9.js";import"./credit-card-DhKiqKDR.js";import"./info-DGWfuZKp.js";import"./sun-BLOPCje7.js";function St(j){var Q;const d=j||{},m=d.defenseRequest||null;d.userRole;const[N,$]=o.useState("details"),R=[{title:"Dashboard",href:"/dashboard"},{title:"All Defense Requirements",href:"/all-defense-requirements"}];if(m!=null&&m.id){const t=(((Q=m.thesis_title)==null?void 0:Q.length)||0)>60?m.thesis_title.slice(0,57)+"...":m.thesis_title||`Request #${m.id}`;R.push({title:t,href:`/adviser/defense-requirements/${m.id}/details`})}if(!m)return e.jsxs(te,{breadcrumbs:R,children:[e.jsx(Z,{title:"Defense Request - Not Found"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-red-500",children:"No defense request loaded. Use the list page and click Details again."}),e.jsx(u,{variant:"outline",onClick:()=>ee.visit("/all-defense-requirements"),children:"Back to list"})]})]});const[s,_]=o.useState(m),[f,p]=o.useState({open:!1,action:null}),[C,I]=o.useState(!1),[g,M]=o.useState(null),[v,B]=o.useState(null),[A,O]=o.useState(!1),[D,G]=o.useState(!1),[W,y]=o.useState(!1),F=o.useRef(null),E=o.useRef(null);function de(){var t;return((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""}const[Pe,T]=o.useState(null);async function ce(t){if(!s.id)return;if(t==="approve"){if(!s.ai_detection_certificate||!s.endorsement_form){T("You must upload both the AI Detection Certificate and Endorsement Form before endorsing this request."),p({open:!1,action:null}),l.error("You must upload both the AI Detection Certificate and Endorsement Form before endorsing.");return}if(!x.length||!x[0].id){T("You must have a coordinator linked before you can endorse this request."),p({open:!1,action:null}),l.error("You must have a coordinator linked before you can endorse.");return}}I(!0),T(null);let r="Pending";t==="approve"?r="Approved":t==="reject"?r="Rejected":t==="retrieve"&&(r="Pending");try{const a={adviser_status:r};t==="approve"&&x.length>0&&x[0].id&&(a.coordinator_user_id=x[0].id);const n=await L(`/adviser/defense-requirements/${s.id}/adviser-status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)}),i=await n.json();n.ok?(i.request?_(i.request):_(c=>({...c,adviser_status:r,workflow_history:i.workflow_history||c.workflow_history,workflow_state:i.workflow_state||c.workflow_state})),l.success(`Adviser status set to ${r}`)):l.error((i==null?void 0:i.error)||"Failed to update adviser status")}catch{l.error("Network error updating adviser status")}finally{I(!1),p({open:!1,action:null})}}function me(t){var n,i,c,q;const r=((i=(n=t.first_name)==null?void 0:n.trim())==null?void 0:i[0])??"",a=((q=(c=t.last_name)==null?void 0:c.trim())==null?void 0:q[0])??"";return(r+a).toUpperCase()||"U"}function K(t){if(!t)return"—";try{return U(t).format("YYYY-MM-DD hh:mm A")}catch{return t}}function xe(t){return t?/approved/i.test(t)?"bg-green-100 text-green-600":/reject/i.test(t)?"bg-red-100 text-red-600":"bg-amber-100 text-amber-600":"bg-gray-100 text-gray-600"}function b(t){return t?/^https?:\/\//i.test(t)||t.startsWith("/storage/")?t:`/storage/${t.replace(/^\/?storage\//,"")}`:null}const X=[{label:"Adviser’s Endorsement",url:b(s.advisers_endorsement)},{label:"REC Endorsement",url:b(s.rec_endorsement)},{label:"Proof of Payment",url:b(s.proof_of_payment)},{label:"Reference No.",url:s.reference_no},{label:"Manuscript",url:b(s.manuscript_proposal)},{label:"Similarity Index",url:b(s.similarity_index)},{label:"Avisee-Adviser File",url:b(s.avisee_adviser_attachment)}],ue=[{key:"submitted",label:"Submitted",icon:e.jsx(qe,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:e.jsx(Ue,{className:"h-5 w-5"})},{key:"adviser-rejected",label:"Rejected by Adviser",icon:e.jsx(k,{className:"h-5 w-5"})},{key:"adviser-retrieved",label:"Retrieved by Adviser",icon:e.jsx(P,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:e.jsx(le,{className:"h-5 w-5"})},{key:"coordinator-rejected",label:"Rejected by Coordinator",icon:e.jsx(k,{className:"h-5 w-5"})},{key:"coordinator-retrieved",label:"Retrieved by Coordinator",icon:e.jsx(P,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:e.jsx(ne,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:e.jsx(Y,{className:"h-5 w-5"})}];function fe(t){return t=(t||"").toLowerCase(),t==="submitted"?"submitted":t==="adviser-approved"?"adviser-approved":t==="adviser-rejected"?"adviser-rejected":t==="adviser-retrieved"?"adviser-retrieved":t==="adviser-review"||t==="pending"?"adviser-pending":t==="coordinator-approved"?"coordinator-approved":t==="coordinator-rejected"?"coordinator-rejected":t==="coordinator-retrieved"?"coordinator-retrieved":t==="panels-assigned"?"panels-assigned":t==="scheduled"?"scheduled":""}function pe(t){if(!t)return"";try{return U(t).format("YYYY-MM-DD hh:mm A")}catch{return t}}async function he(t){if(t.preventDefault(),!s.id)return;if(!g&&!v){l.error("Please select at least one document to upload.");return}const r=new FormData;g&&r.append("ai_detection_certificate",g),v&&r.append("endorsement_form",v);try{g&&O(!0),v&&G(!0);const a=await L(`/adviser/defense-requirements/${s.id}/documents`,{method:"POST",body:r}),n=await a.json();a.ok?(_(i=>({...i,ai_detection_certificate:n.ai_detection_certificate||i.ai_detection_certificate,endorsement_form:n.endorsement_form||i.endorsement_form,advisers_endorsement:n.advisers_endorsement||i.advisers_endorsement})),M(null),B(null),l.success("Documents uploaded successfully.")):l.error((n==null?void 0:n.error)||"Failed to upload documents.")}catch{l.error("Network error uploading documents.")}finally{O(!1),G(!1)}}const[je,ge]=o.useState([]),[z,V]=o.useState(!0);o.useEffect(()=>{V(!0),fetch("/api/document-templates").then(t=>t.json()).then(ge).finally(()=>V(!1))},[]);function ve(t){return/proposal/i.test(t)?"Endorsement Form (Proposal)":/prefinal/i.test(t)?"Endorsement Form (Prefinal)":/final/i.test(t)?"Endorsement (Final)":null}async function be(){y(!0),l.loading("Generating document...");const t=ve(s.defense_type||"");if(z){l.error("Templates are still loading. Please wait."),y(!1);return}const r=je.find(a=>a.name===t);if(!r){l.error("No template found for this defense type."),y(!1);return}try{const a=await fetch("/api/generate-document",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/pdf","X-CSRF-TOKEN":de()},body:JSON.stringify({template_id:r.id,defense_request_id:s.id,fields:{}})});if(!a.ok){l.error("Failed to generate document."),y(!1);return}const n=await a.blob(),i=window.URL.createObjectURL(n),c=document.createElement("a");c.href=i,c.download="endorsement_form.pdf",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i),l.success("Endorsement Form generated and downloaded!")}catch{l.error("Network error generating document.")}finally{y(!1),l.dismiss()}}const S="rounded-lg border p-5 space-y-3";function Ne(t){return t==="Approved"?"Endorsed":t==="Rejected"?"Rejected":t||"—"}function _e(t){return t==="Approved"?"Approved":t==="Rejected"?"Rejected":t||"—"}const J=!s.ai_detection_certificate||!s.endorsement_form,H=!s.ai_detection_certificate&&!s.endorsement_form?"*You haven't uploaded the AI Detection Certificate and Endorsement Form yet.":s.ai_detection_certificate?s.endorsement_form?null:"*You haven't uploaded the Endorsement Form yet.":"*You haven't uploaded the AI Detection Certificate yet.",x=d.coordinators??[];return e.jsxs(te,{breadcrumbs:R,children:[e.jsx(we,{position:"bottom-right",richColors:!0,closeButton:!0}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsx(Z,{title:s.thesis_title||`Defense Request #${s.id}`}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>ee.visit("/all-defense-requirements"),className:"h-8 px-2",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(se,{value:N,onValueChange:t=>$(t),children:e.jsxs(Ee,{className:"h-8",children:[e.jsxs(re,{value:"details",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(h,{className:"h-4 w-4"})," Details"]}),e.jsxs(re,{value:"link-documents",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(h,{className:"h-4 w-4"})," Link Documents"]})]})}),J&&e.jsx("span",{className:"ml-4 text-xs text-rose-600 font-medium",children:H})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>p({open:!0,action:"approve"}),disabled:C||s.adviser_status==="Approved"||!x.length||!x[0].id,children:[e.jsx(ze,{className:"h-4 w-4 mr-1 text-green-600"}),"Endorse"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>p({open:!0,action:"reject"}),disabled:C||s.adviser_status==="Rejected",children:[e.jsx(k,{className:"h-4 w-4 mr-1 text-red-600"}),"Reject"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>p({open:!0,action:"retrieve"}),disabled:C||s.adviser_status==="Pending",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Retrieve"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-5 mb-2",children:[e.jsx("div",{className:"w-full md:max-w-3xl mx-auto flex flex-col gap-5",children:e.jsxs(se,{value:N,onValueChange:t=>$(t),className:"w-full",children:[e.jsxs(ae,{value:"details",className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold",children:s.thesis_title}),e.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),e.jsx("div",{className:"flex flex-col md:items-end gap-1",children:e.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full mt-2 md:mt-0 ${s.adviser_status==="Approved"?"bg-green-100 text-green-600":s.adviser_status==="Rejected"?"bg-red-100 text-red-600":s.adviser_status==="Pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:["Adviser Status: ",Ne(s.adviser_status)]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"h-8 w-8",children:e.jsx(Ae,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:me(s)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm leading-tight",children:[s.first_name," ",s.middle_name?`${s.middle_name} `:"",s.last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:s.school_id})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),e.jsx("div",{className:"font-medium text-sm",children:s.program})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),e.jsx(ke,{variant:"secondary",className:"text-xs font-medium",children:s.defense_type??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Submitted At"}),e.jsx("div",{className:"font-medium text-sm",children:K(s.submitted_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program Coordinator"}),e.jsx("div",{className:"font-medium text-sm",children:x.length>0?x.map((t,r)=>e.jsxs("div",{className:"text-sm",children:[t.name,t.email?` (${t.email})`:""]},r)):e.jsx("span",{className:"italic text-zinc-400",children:"No coordinator registered"})})]}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Coordinator Status"}),e.jsx("div",{children:e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full inline-block ${xe(s.coordinator_status)}`,children:_e(s.coordinator_status)})})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(w,{className:"my-2"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),e.jsx("div",{className:"font-medium text-sm",children:K(s.scheduled_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),e.jsx("div",{className:"font-medium text-sm",children:s.scheduled_time?`${s.scheduled_time}${s.scheduled_end_time?" - "+s.scheduled_end_time:""}`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx("div",{className:"font-medium text-sm",children:s.defense_venue||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsx("div",{className:"font-medium text-sm",children:s.defense_mode?s.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx("div",{className:"font-medium text-sm",children:s.scheduling_notes||"—"})]})]})]}),e.jsxs("div",{className:S,children:[e.jsxs("h2",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4"})," Attachments"]}),J&&e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-xs text-rose-600 font-medium",children:H})}),e.jsx(w,{}),e.jsxs("div",{className:"space-y-2 text-sm mt-3",children:[X.filter(t=>t.label!=="AI Detection Certificate"&&t.label!=="Endorsement Form").map(t=>t.url?e.jsxs("a",{href:t.label==="Reference No."?void 0:t.url,target:t.label==="Reference No."?void 0:"_blank",rel:t.label==="Reference No."?void 0:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.label}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:typeof t.url=="string"&&t.label!=="Reference No."?t.url.split("/").pop():t.url||""})]},t.label):null),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"AI Detection Certificate"}),s.ai_detection_certificate?e.jsx("a",{href:s.ai_detection_certificate,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-xs underline truncate max-w-[180px]",children:s.ai_detection_certificate.split("/").pop()}):e.jsx("span",{className:"ml-auto text-xs text-rose-600 font-semibold",children:"Missing"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Endorsement Form"}),s.endorsement_form?e.jsx("a",{href:s.endorsement_form,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-xs underline truncate max-w-[180px]",children:s.endorsement_form.split("/").pop()}):e.jsx("span",{className:"ml-auto text-xs text-rose-600 font-semibold",children:"Missing"})]}),!X.some(t=>t.url)&&!s.ai_detection_certificate&&!s.endorsement_form&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."})]})]}),e.jsxs("div",{className:S,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"})," Committee"]}),e.jsx(w,{}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-muted-foreground uppercase tracking-wide",children:"Adviser"}),e.jsx("div",{className:"font-medium",children:s.defense_adviser||"—"})]})})]})]}),e.jsx(ae,{value:"link-documents",className:"space-y-5",children:e.jsxs("form",{onSubmit:he,className:"space-y-5",children:[e.jsxs("div",{className:S+" text-sm",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(h,{className:"h-5 w-5"})," AI Detection Certificate"]}),e.jsx(w,{}),e.jsx("div",{className:"flex flex-col gap-3 mt-2",children:e.jsxs("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[e.jsx("label",{htmlFor:"ai-detection-upload",className:"block text-xs font-medium text-zinc-700 dark:text-zinc-200",children:"Upload Certificate"}),s.ai_detection_certificate&&!g?e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(ie,{type:"text",value:s.ai_detection_certificate.split("/").pop()||"",disabled:!0,className:"flex-1 bg-zinc-100 text-zinc-700 cursor-default"}),e.jsx(u,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>{_(t=>({...t,ai_detection_certificate:void 0})),F.current&&(F.current.value="")},title:"Remove linked file",children:e.jsx(k,{className:"h-4 w-4 text-black"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"ai-detection-upload",ref:F,type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"flex-1 text-xs file:bg-rose-500 file:text-white file:rounded file:border-0 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:cursor-pointer",style:{maxWidth:220},onChange:t=>{var r;return M(((r=t.target.files)==null?void 0:r[0])||null)},disabled:A}),A&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Uploading..."})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:g?`Selected: ${g.name}`:null})]})})]}),e.jsxs("div",{className:S+" text-sm",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(h,{className:"h-5 w-5"})," Endorsement Form"]}),e.jsx(w,{}),e.jsx("div",{className:"flex flex-col gap-3 mt-2",children:e.jsxs("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[e.jsx("label",{htmlFor:"endorsement-upload",className:"block text-xs font-medium text-zinc-700 dark:text-zinc-200",children:"Upload Endorsement Form"}),s.endorsement_form&&!v?e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(ie,{type:"text",value:s.endorsement_form.split("/").pop()||"",disabled:!0,className:"flex-1 bg-zinc-100 text-zinc-700 cursor-default"}),e.jsx(u,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>{_(t=>({...t,endorsement_form:void 0})),E.current&&(E.current.value="")},title:"Remove linked file",children:e.jsx(k,{className:"h-4 w-4 text-black"})})]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{id:"endorsement-upload",ref:E,type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"flex-1 text-xs file:bg-rose-500 file:text-white file:rounded file:border-0 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:cursor-pointer",style:{maxWidth:220},onChange:t=>{var r;return B(((r=t.target.files)==null?void 0:r[0])||null)},disabled:D})}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:v?`Selected: ${v.name}`:null}),e.jsx("div",{className:"mt-2",children:e.jsx(u,{type:"button",variant:"ghost",onClick:be,disabled:D||W||z,children:W||z?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Generating..."]}):"Auto Generate"})})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{type:"submit",className:"gap-2 bg-rose-500 hover:bg-rose-600 text-white",disabled:A||D,children:A||D?e.jsx("span",{children:"Uploading..."}):e.jsx("span",{children:"Submit Documents"})})})]})})]})}),e.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0 space-y-4",children:e.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 h-fit",children:[e.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"})," Workflow Progress"]}),e.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(s.workflow_history)&&s.workflow_history.length>0?s.workflow_history.map((t,r)=>{let a=t.action;a==="adviser-status-updated"&&t.to_state&&(a=t.to_state),(a==="adviser-review"||a==="pending")&&(a="adviser-review");const n=fe(a),i=ue.find(ye=>ye.key===n)||{label:a.charAt(0).toUpperCase()+a.slice(1),icon:e.jsx(Y,{className:"h-5 w-5 text-gray-500"})},c=r===(s.workflow_history??[]).length-1;return e.jsxs("div",{className:"flex items-start gap-3 relative",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:i.icon}),!c&&e.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:"font-semibold text-xs",children:i.label}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[t.user_name&&e.jsx("span",{children:t.user_name}),t.timestamp&&e.jsxs("span",{children:[" ","· ",pe(t.timestamp)]})]}),t.comment&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t.comment})]})]},r)}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["Last updated by:"," ",s.last_status_updated_by_name||s.last_status_updated_by||"—"," ",s.last_status_updated_at?`(${U(s.last_status_updated_at).format("YYYY-MM-DD [at] h:mm A")})`:""]})]}),e.jsx(De,{open:f.open,onOpenChange:t=>{t||p({open:!1,action:null})},children:e.jsxs(Se,{children:[e.jsx(Re,{children:"Confirm Action"}),e.jsx(Fe,{children:f.action==="approve"?"Please review before endorsing.":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[e.jsxs("p",{children:["Set request to"," ",e.jsx("span",{className:"font-semibold",children:f.action==="approve"?"Endorsed":f.action==="reject"?"Rejected":"Pending"}),"?"]}),f.action==="approve"&&x.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["This will be sent to your coordinator: ",e.jsx("span",{className:"font-semibold",children:x[0].name})]}),f.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(le,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Endorsing this defense request authorizes the use of your signature on the official defense documents."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(u,{variant:"ghost",onClick:()=>p({open:!1,action:null}),children:"Cancel"}),e.jsx(u,{onClick:()=>f.action&&ce(f.action),disabled:C,children:"Confirm"})]})]})})]})}async function L(j,d,m=!0){d.headers={...typeof d.headers=="object"&&d.headers!==null?d.headers:{},"X-CSRF-TOKEN":oe()};const N=await fetch(j,d);return N.status===419&&m?((!d.headers||typeof d.headers!="object")&&(d.headers={}),d.headers["X-CSRF-TOKEN"]=oe(),L(j,d,!1)):N}function oe(){var j;return((j=document.querySelector('meta[name="csrf-token"]'))==null?void 0:j.content)||""}export{St as default};
