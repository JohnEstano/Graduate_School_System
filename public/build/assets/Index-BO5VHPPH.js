import{r as b,j as e,L as B}from"./app-CQngmq00.js";import{A as H}from"./app-layout-C76KB2Lm.js";import{B as j}from"./button-Cw9tQIeO.js";import{I}from"./input-izsDzGd9.js";import{T as D,a as F,b as f,c as g,d as $,e as u}from"./table-BEEQP98I.js";import{D as Y,a as q,e as G,b as J,f as K}from"./dialog-D-tH9FDm.js";import{t as h}from"./index-Vwkg4oTI.js";import{T as L,a as X,b as Q,c as U}from"./tabs-DJOYkXMD.js";import{P as W}from"./printer-BV1DV1RI.js";import{P as Z}from"./pencil-DZXKP1_R.js";import"./index-CDDLQrUy.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-BSk2xfhC.js";import"./index-DRp-GX9j.js";import"./index-BZgaE142.js";import"./x-B3RMhnUQ.js";import"./createLucideIcon-pjYyoixj.js";import"./tooltip-BvePKNvs.js";import"./floating-ui.react-dom-DL84dtXf.js";import"./separator-CMC4qrzs.js";import"./index-ahz1tZ6M.js";import"./chevron-right-QGs8lTP5.js";import"./dropdown-menu-BQlfF7jf.js";import"./index-CgLqTVh4.js";import"./index-VBHUZLOo.js";import"./index-BfMlnZ5P.js";import"./index-Csh4Fj4k.js";import"./check-BEGkAg7k.js";import"./avatar-DUph8BC-.js";import"./settings-CDLWUJwV.js";import"./users-DZ67WViD.js";import"./graduation-cap-DHFIPOzN.js";import"./file-text-Buh9X5tE.js";import"./dollar-sign-CkMbILE9.js";import"./send-BvMnN6yE.js";import"./credit-card-Cid_txJ6.js";import"./badge-BsPMjMb7.js";import"./circle-check-big-PSYRp90q.js";import"./info-BJ9Jpdwx.js";import"./sun-5m6UvoyG.js";const S=["Masteral","Doctorate"],m=["Proposal","Pre-final","Final"],ee=["Adviser","Panel Chair","Panel Member 1","Panel Member 2","Panel Member 3","Panel Member 4","REC Fee","School Share"];function He({rates:A}){const[x,z]=b.useState(A),[l,y]=b.useState(null),[k,v]=b.useState(!1),[N,R]=b.useState(S[0]);function O(s,t,a){var n,r,o,d,i,c;y({program_level:s,type:t,values:{Proposal:((r=(n=x[a.Proposal])==null?void 0:n.amount)==null?void 0:r.toString())??"","Pre-final":((d=(o=x[a["Pre-final"]])==null?void 0:o.amount)==null?void 0:d.toString())??"",Final:((c=(i=x[a.Final])==null?void 0:i.amount)==null?void 0:c.toString())??""},idxs:a})}function w(){y(null)}async function M(){var s;if(l){v(!0);try{const t=[];for(const r of m){const o=l.idxs[r];t.push({program_level:l.program_level,type:l.type,defense_type:r,amount:l.values[r]||0})}const a=await fetch("/dean/payment-rates",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""},body:JSON.stringify({rates:t})});let n=null;try{n=await a.json()}catch{const o=await a.text();h.error("Server error: "+o),v(!1);return}if(a.ok&&n.success){const o=await(await fetch("/dean/payment-rates/data",{headers:{Accept:"application/json"}})).json();z(o.rates),h.success("Rates updated!"),w()}else if(a.status===422&&n&&n.errors){const r=Object.values(n.errors).flat().join(" | ");h.error("Validation error: "+r)}else h.error("Failed to update rates: "+((n==null?void 0:n.message)||a.status))}catch(t){const a=typeof t=="object"&&t!==null&&"message"in t?t.message:String(t);h.error("Network or server error: "+a)}finally{v(!1)}}}function _(s){const t=parseFloat(s);return!s||isNaN(t)||t===0?"--":`₱${t.toLocaleString(void 0,{minimumFractionDigits:2})}`}function E(s){return ee.map(t=>{const a={type:t,values:[],idxs:{}};for(const n of m){const r=x.findIndex(o=>o.program_level===s&&o.type===t&&o.defense_type===n);a.values.push(r!==-1?x[r]:void 0),a.idxs[n]=r}return a})}function V(s){const t=E(s),a=["Type",...m.map(i=>`${i} Defense`)],n=t.map(i=>{const c=m.map((p,T)=>{var C;const P=(C=i.values[T])==null?void 0:C.amount;return P==null?"--":`₱${parseFloat(P).toLocaleString(void 0,{minimumFractionDigits:2})}`});return[i.type,...c]}),r=["TOTAL",...m.map(i=>{const c=x.filter(p=>p.program_level===s&&p.defense_type===i).reduce((p,T)=>p+(parseFloat(String(T.amount))||0),0);return c===0?"--":`₱${c.toLocaleString(void 0,{minimumFractionDigits:2})}`})];let o=`
      <div style="font-family: Arial, sans-serif; padding: 24px; background: #fff; color: #222;">
        <h2 style="margin-bottom: 16px;">${s} Payment Rates</h2>
        <table border="1" cellspacing="0" cellpadding="6" style="border-collapse: collapse; min-width: 600px; font-size: 13px;">
          <thead>
            <tr style="background: #f3f3f3;">
              ${a.map(i=>`<th style="font-weight: bold; text-align: left;">${i}</th>`).join("")}
            </tr>
          </thead>
          <tbody>
            ${n.map(i=>`
              <tr>
                ${i.map((c,p)=>`<td style="text-align: ${p===0?"left":"right"};">${c}</td>`).join("")}
              </tr>
            `).join("")}
            <tr style="background: #f3f3f3; font-weight: bold;">
              ${r.map((i,c)=>`<td style="text-align: ${c===0?"left":"right"};">${i}</td>`).join("")}
            </tr>
          </tbody>
        </table>
        <style>
          @media (prefers-color-scheme: dark) {
            body, div { background: #18181b !important; color: #f3f3f3 !important; }
            table { background: #232329 !important; color: #f3f3f3 !important; }
            th, td { border-color: #444 !important; }
            tr { background: #232329 !important; }
            tr:nth-child(even) { background: #18181b !important; }
            tr[style*="background: #f3f3f3;"] { background: #232329 !important; }
          }
        </style>
      </div>
    `;const d=window.open("","_blank","width=900,height=700");d&&(d.document.write(`
        <html>
          <head>
            <title>${s} Payment Rates</title>
          </head>
          <body>${o}</body>
        </html>
      `),d.document.close(),d.focus(),setTimeout(()=>{d.print(),d.close()},300))}return e.jsxs(H,{breadcrumbs:[{title:"Payment Rates",href:"/dean/payment-rates"}],children:[e.jsx(B,{title:"Payment Rates"}),e.jsxs("div",{className:"w-full px-0 py-8",children:[e.jsxs("div",{className:"px-6 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Payment Rates"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"View and manage payment rates for Masteral and Doctorate programs."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 px-4 sm:px-6 mb-6",children:[e.jsx(L,{value:N,onValueChange:R,className:"",children:e.jsx(X,{children:S.map(s=>e.jsx(Q,{value:s,className:"text-sm",children:s},s))})}),e.jsxs(j,{variant:"outline",className:"flex items-center gap-2 text-sm",onClick:()=>V(N),children:[e.jsx(W,{className:"w-4 h-4"}),"Print"]})]}),e.jsx(L,{value:N,onValueChange:R,className:"px-2 sm:px-6",children:S.map(s=>e.jsx(U,{value:s,children:e.jsxs("div",{className:"mb-10 w-full overflow-x-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:s}),e.jsx("div",{className:"w-full min-w-[700px]",children:e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-zinc-900 shadow-sm rounded-none",children:e.jsxs(D,{className:"min-w-[700px] table-fixed",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"180px"}}),m.map((t,a)=>e.jsx("col",{style:{width:"140px"}},a)),e.jsx("col",{style:{width:"100px"}})]}),e.jsx(F,{children:e.jsxs(f,{children:[e.jsx(g,{className:"text-xs font-medium text-left",children:"Type"}),m.map(t=>e.jsxs(g,{className:"text-xs font-medium text-end",children:[t," Defense"]},t)),e.jsx(g,{className:"text-xs font-medium text-center",children:"Action"})]})}),e.jsxs($,{children:[E(s).map((t,a)=>e.jsxs(f,{className:a%2===0?"even:bg-zinc-50 dark:even:bg-zinc-800":"",children:[e.jsx(u,{className:"font-semibold text-xs text-left",children:t.type}),m.map((n,r)=>{var o;return e.jsx(u,{className:"text-xs text-end",children:_((o=t.values[r])==null?void 0:o.amount)},n)}),e.jsx(u,{className:"text-xs text-center",children:e.jsxs(j,{size:"sm",variant:"outline",className:"px-2 py-1 text-xs flex items-center gap-1 mx-auto",onClick:()=>O(s,t.type,t.idxs),children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Edit"]})})]},t.type)),e.jsxs(f,{className:"bg-zinc-100 dark:bg-zinc-800 border-t border-zinc-400 dark:border-zinc-700",children:[e.jsx(u,{className:"font-bold text-xs text-left",children:"TOTAL"}),m.map(t=>e.jsx(u,{className:"font-bold text-xs text-end",children:(()=>{const a=x.filter(n=>n.program_level===s&&n.defense_type===t).reduce((n,r)=>n+(parseFloat(String(r.amount))||0),0);return a===0?"--":a.toLocaleString(void 0,{minimumFractionDigits:2})})()},t)),e.jsx(u,{})]})]})]})})})]})},s))}),e.jsx(Y,{open:!!l,onOpenChange:w,children:e.jsxs(q,{children:[e.jsx(G,{children:e.jsx(J,{children:"Edit Rates"})}),l!==null&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program Level"}),e.jsx("div",{className:"font-medium text-xs",children:l.program_level})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Type"}),e.jsx("div",{className:"font-medium text-xs",children:l.type})]})]}),e.jsx("div",{children:e.jsxs(D,{className:"overflow-hidden",children:[e.jsx(F,{children:e.jsx(f,{children:m.map(s=>e.jsxs(g,{className:"text-xs text-end",children:[s," Defense"]},s))})}),e.jsx($,{children:e.jsx(f,{children:m.map(s=>e.jsx(u,{className:"text-end",children:e.jsx(I,{type:"number",min:0,value:l.values[s],onChange:t=>y({...l,values:{...l.values,[s]:t.target.value}}),className:"w-32 text-xs mx-auto"})},s))})})]})})]}),e.jsxs(K,{children:[e.jsx(j,{variant:"outline",onClick:w,className:"text-xs",children:"Cancel"}),e.jsx(j,{onClick:M,disabled:k,className:"text-xs",children:k?"Saving...":"Save"})]})]})})]})]})}export{He as default};
