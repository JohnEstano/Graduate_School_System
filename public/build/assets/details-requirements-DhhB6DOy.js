import{r as l,j as e,L as Q,S as Z}from"./app-OOvd0qGy.js";import{A as ee,S as ye}from"./app-layout-4BSfGYAy.js";import{d as te}from"./dayjs.min-CtUKUHq-.js";import{T as we,t as o}from"./index-imi9ZEDw.js";import{B as x}from"./button-Bvl2ELDv.js";import{B as ke}from"./badge-9siNCstt.js";import{S}from"./separator-Cye1ujSm.js";import{A as Ce,a as Ae}from"./avatar-DboJvblb.js";import{D as De,a as Se,b as Re,c as Fe}from"./dialog-DgFd6e46.js";import{T as se,a as Ee,b as re,c as ae}from"./tabs-BvigrSxv.js";import{I as ie}from"./input-CzcDJDbH.js";import{A as Te}from"./arrow-left-SWP0tD1M.js";import{F as p}from"./file-text-DLuaZQHd.js";import{C as ze}from"./circle-check-big-Ddw5Ycw8.js";import{C as w}from"./circle-x-Cfzvg8iR.js";import{C as q}from"./circle-arrow-left-eoVZyPRG.js";import{U as ne}from"./users-EStqJIUY.js";import{C as U}from"./clock-BJgG26g7.js";import{S as le}from"./signature-CJs_z61u.js";import{U as qe}from"./user-check-CLUmSrHp.js";import"./index-ChOW5_O6.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-B2wwfcIF.js";import"./index-DQ9rqnvl.js";import"./index-4w5oLsoB.js";import"./x-DrNmi13E.js";import"./createLucideIcon-Cvkj7Hkp.js";import"./tooltip-BFmjF_jJ.js";import"./floating-ui.react-dom-BrG2AUyT.js";import"./chevron-right-BsU_TN8l.js";import"./dropdown-menu-JMbXV8S0.js";import"./index-DcZRhvrv.js";import"./index-kQq3evoo.js";import"./index-B9sjBiRz.js";import"./index-C9drr0Qb.js";import"./index-CQ9en90x.js";import"./index-C7ezi2Q7.js";import"./settings-BGemkvqC.js";import"./graduation-cap-CCWiuwHf.js";import"./dollar-sign-4LNVBfuJ.js";import"./credit-card-Bfq-rBsk.js";import"./info-CIHMpyv0.js";import"./sun-Ch86N1Y-.js";function At(h){var H;const d=h||{},m=d.defenseRequest||null;d.userRole;const[b,L]=l.useState("details"),R=[{title:"Dashboard",href:"/dashboard"},{title:"All Defense Requirements",href:"/all-defense-requirements"}];if(m!=null&&m.id){const t=(((H=m.thesis_title)==null?void 0:H.length)||0)>60?m.thesis_title.slice(0,57)+"...":m.thesis_title||`Request #${m.id}`;R.push({title:t,href:`/adviser/defense-requirements/${m.id}/details`})}if(!m)return e.jsxs(ee,{breadcrumbs:R,children:[e.jsx(Q,{title:"Defense Request - Not Found"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-red-500",children:"No defense request loaded. Use the list page and click Details again."}),e.jsx(x,{variant:"outline",onClick:()=>Z.visit("/all-defense-requirements"),children:"Back to list"})]})]});const[s,_]=l.useState(m),[u,j]=l.useState({open:!1,action:null}),[k,$]=l.useState(!1),[g,I]=l.useState(null),[v,Y]=l.useState(null),[C,M]=l.useState(!1),[A,O]=l.useState(!1),[B,y]=l.useState(!1),F=l.useRef(null),E=l.useRef(null);function de(){var t;return((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""}const[Ue,G]=l.useState(null);async function ce(t){if(!s.id)return;if(t==="approve"&&(!s.ai_detection_certificate||!s.endorsement_form)){G("You must upload both the AI Detection Certificate and Endorsement Form before endorsing this request."),j({open:!1,action:null}),o.error("You must upload both the AI Detection Certificate and Endorsement Form before endorsing.");return}$(!0),G(null);let r="Pending";t==="approve"?r="Approved":t==="reject"?r="Rejected":t==="retrieve"&&(r="Pending");try{const a={adviser_status:r};t==="approve"&&f.length>0&&f[0].id&&(a.coordinator_user_id=f[0].id);const n=await P(`/adviser/defense-requirements/${s.id}/adviser-status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)}),i=await n.json();n.ok?(i.request?_(i.request):_(c=>({...c,adviser_status:r,workflow_history:i.workflow_history||c.workflow_history,workflow_state:i.workflow_state||c.workflow_state})),o.success(`Adviser status set to ${r}`)):o.error((i==null?void 0:i.error)||"Failed to update adviser status")}catch{o.error("Network error updating adviser status")}finally{$(!1),j({open:!1,action:null})}}function me(t){var n,i,c,z;const r=((i=(n=t.first_name)==null?void 0:n.trim())==null?void 0:i[0])??"",a=((z=(c=t.last_name)==null?void 0:c.trim())==null?void 0:z[0])??"";return(r+a).toUpperCase()||"U"}function W(t){if(!t)return"—";try{return te(t).format("YYYY-MM-DD hh:mm A")}catch{return t}}function N(t){return t?/^https?:\/\//i.test(t)||t.startsWith("/storage/")?t:`/storage/${t.replace(/^\/?storage\//,"")}`:null}const K=[{label:"Adviser’s Endorsement",url:N(s.advisers_endorsement)},{label:"REC Endorsement",url:N(s.rec_endorsement)},{label:"Proof of Payment",url:N(s.proof_of_payment)},{label:"Reference No.",url:s.reference_no},{label:"Manuscript",url:N(s.manuscript_proposal)},{label:"Similarity Index",url:N(s.similarity_index)},{label:"Avisee-Adviser File",url:N(s.avisee_adviser_attachment)}],xe=[{key:"submitted",label:"Submitted",icon:e.jsx(ye,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:e.jsx(qe,{className:"h-5 w-5"})},{key:"adviser-rejected",label:"Rejected by Adviser",icon:e.jsx(w,{className:"h-5 w-5"})},{key:"adviser-retrieved",label:"Retrieved by Adviser",icon:e.jsx(q,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:e.jsx(le,{className:"h-5 w-5"})},{key:"coordinator-rejected",label:"Rejected by Coordinator",icon:e.jsx(w,{className:"h-5 w-5"})},{key:"coordinator-retrieved",label:"Retrieved by Coordinator",icon:e.jsx(q,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:e.jsx(ne,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:e.jsx(U,{className:"h-5 w-5"})}];function ue(t){return t=(t||"").toLowerCase(),t==="submitted"?"submitted":t==="adviser-approved"?"adviser-approved":t==="adviser-rejected"?"adviser-rejected":t==="adviser-retrieved"?"adviser-retrieved":t==="adviser-review"||t==="pending"?"adviser-pending":t==="coordinator-approved"?"coordinator-approved":t==="coordinator-rejected"?"coordinator-rejected":t==="coordinator-retrieved"?"coordinator-retrieved":t==="panels-assigned"?"panels-assigned":t==="scheduled"?"scheduled":""}function fe(t){if(!t)return"";try{return te(t).format("YYYY-MM-DD hh:mm A")}catch{return t}}async function pe(t){if(t.preventDefault(),!s.id)return;if(!g&&!v){o.error("Please select at least one document to upload.");return}const r=new FormData;g&&r.append("ai_detection_certificate",g),v&&r.append("endorsement_form",v);try{g&&M(!0),v&&O(!0);const a=await P(`/adviser/defense-requirements/${s.id}/documents`,{method:"POST",body:r}),n=await a.json();a.ok?(_(i=>({...i,ai_detection_certificate:n.ai_detection_certificate||i.ai_detection_certificate,endorsement_form:n.endorsement_form||i.endorsement_form,advisers_endorsement:n.advisers_endorsement||i.advisers_endorsement})),I(null),Y(null),o.success("Documents uploaded successfully.")):o.error((n==null?void 0:n.error)||"Failed to upload documents.")}catch{o.error("Network error uploading documents.")}finally{M(!1),O(!1)}}const[he,je]=l.useState([]),[T,X]=l.useState(!0);l.useEffect(()=>{X(!0),fetch("/api/document-templates").then(t=>t.json()).then(je).finally(()=>X(!1))},[]);function ge(t){return/proposal/i.test(t)?"Endorsement Form (Proposal)":/prefinal/i.test(t)?"Endorsement Form (Prefinal)":/final/i.test(t)?"Endorsement (Final)":null}async function ve(){y(!0),o.loading("Generating document...");const t=ge(s.defense_type||"");if(T){o.error("Templates are still loading. Please wait."),y(!1);return}const r=he.find(a=>a.name===t);if(!r){o.error("No template found for this defense type."),y(!1);return}try{const a=await fetch("/api/generate-document",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/pdf","X-CSRF-TOKEN":de()},body:JSON.stringify({template_id:r.id,defense_request_id:s.id,fields:{}})});if(!a.ok){o.error("Failed to generate document."),y(!1);return}const n=await a.blob(),i=window.URL.createObjectURL(n),c=document.createElement("a");c.href=i,c.download="endorsement_form.pdf",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i),o.success("Endorsement Form generated and downloaded!")}catch{o.error("Network error generating document.")}finally{y(!1),o.dismiss()}}const D="rounded-lg border p-5 space-y-3";function be(t){return t==="Approved"?"Endorsed":t==="Rejected"?"Rejected":t||"—"}function Ne(t){return t==="Approved"?"Approved":t==="Rejected"?"Rejected":t||"—"}const V=!s.ai_detection_certificate||!s.endorsement_form,J=!s.ai_detection_certificate&&!s.endorsement_form?"*You haven't uploaded the AI Detection Certificate and Endorsement Form yet.":s.ai_detection_certificate?s.endorsement_form?null:"*You haven't uploaded the Endorsement Form yet.":"*You haven't uploaded the AI Detection Certificate yet.",f=d.coordinators??[];return e.jsxs(ee,{breadcrumbs:R,children:[e.jsx(we,{position:"bottom-right",richColors:!0,closeButton:!0}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsx(Q,{title:s.thesis_title||`Defense Request #${s.id}`}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",onClick:()=>Z.visit("/all-defense-requirements"),className:"h-8 px-2",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(se,{value:b,onValueChange:t=>L(t),children:e.jsxs(Ee,{className:"h-8",children:[e.jsxs(re,{value:"details",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(p,{className:"h-4 w-4"})," Details"]}),e.jsxs(re,{value:"link-documents",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(p,{className:"h-4 w-4"})," Link Documents"]})]})}),b==="link-documents"&&V&&e.jsx("span",{className:"ml-4 text-xs text-rose-600 font-medium",children:J})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>j({open:!0,action:"approve"}),disabled:k||s.adviser_status==="Approved",children:[e.jsx(ze,{className:"h-4 w-4 mr-1 text-green-600"}),"Endorse"]}),e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>j({open:!0,action:"reject"}),disabled:k||s.adviser_status==="Rejected",children:[e.jsx(w,{className:"h-4 w-4 mr-1 text-red-600"}),"Reject"]}),e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>j({open:!0,action:"retrieve"}),disabled:k||s.adviser_status==="Pending",children:[e.jsx(q,{className:"h-4 w-4 mr-1 text-blue-600"}),"Retrieve"]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"rounded-lg border bg-white dark:bg-zinc-900 p-4 flex items-center gap-4 shadow-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm mb-1",children:["Your Coordinator",f.length>1?"s":""]}),f.length===0?e.jsx("span",{className:"text-xs text-red-500",children:"No coordinator registered."}):e.jsx("ul",{className:"text-xs",children:f.map((t,r)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:t.name}),t.email&&e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["(",t.email,")"]}),t.id&&e.jsxs("span",{className:"ml-2 text-blue-600",children:["[ID: ",t.id,"]"]})]},r))})]})})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-5 mb-2",children:[e.jsx("div",{className:"w-full md:max-w-3xl mx-auto flex flex-col gap-5",children:e.jsxs(se,{value:b,onValueChange:t=>L(t),className:"w-full",children:[e.jsxs(ae,{value:"details",className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold",children:s.thesis_title}),e.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),e.jsx("div",{className:"flex flex-col md:items-end gap-1",children:e.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full mt-2 md:mt-0 ${s.adviser_status==="Approved"?"bg-green-100 text-green-600":s.adviser_status==="Rejected"?"bg-red-100 text-red-600":s.adviser_status==="Pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:["Adviser Status: ",be(s.adviser_status)]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"h-8 w-8",children:e.jsx(Ae,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:me(s)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm leading-tight",children:[s.first_name," ",s.middle_name?`${s.middle_name} `:"",s.last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:s.school_id})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),e.jsx("div",{className:"font-medium text-sm",children:s.program})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),e.jsx(ke,{variant:"secondary",className:"text-xs font-medium",children:s.defense_type??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Submitted At"}),e.jsx("div",{className:"font-medium text-sm",children:W(s.submitted_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),e.jsx("div",{className:"font-medium text-sm",children:W(s.scheduled_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),e.jsx("div",{className:"font-medium text-sm",children:s.scheduled_time?`${s.scheduled_time}${s.scheduled_end_time?" - "+s.scheduled_end_time:""}`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx("div",{className:"font-medium text-sm",children:s.defense_venue||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsx("div",{className:"font-medium text-sm",children:s.defense_mode?s.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Coordinator Status"}),e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full mt-1 inline-block ${s.coordinator_status==="Approved"?"bg-green-100 text-green-600":s.coordinator_status==="Rejected"?"bg-red-100 text-red-600":s.coordinator_status==="Pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:Ne(s.coordinator_status)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx("div",{className:"font-medium text-sm",children:s.scheduling_notes||"—"})]})]})]}),e.jsxs("div",{className:D,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"})," Attachments"]}),V&&e.jsx("span",{className:"ml-3 text-xs text-rose-600 font-medium",children:J})]}),e.jsx(S,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[K.filter(t=>t.label!=="AI Detection Certificate"&&t.label!=="Endorsement Form").map(t=>t.url?e.jsxs("a",{href:t.label==="Reference No."?void 0:t.url,target:t.label==="Reference No."?void 0:"_blank",rel:t.label==="Reference No."?void 0:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:t.label}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:typeof t.url=="string"&&t.label!=="Reference No."?t.url.split("/").pop():t.url||""})]},t.label):null),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"AI Detection Certificate"}),s.ai_detection_certificate?e.jsx("a",{href:s.ai_detection_certificate,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-xs underline truncate max-w-[180px]",children:s.ai_detection_certificate.split("/").pop()}):e.jsx("span",{className:"ml-auto text-xs text-rose-600 font-semibold",children:"Missing"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Endorsement Form"}),s.endorsement_form?e.jsx("a",{href:s.endorsement_form,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-xs underline truncate max-w-[180px]",children:s.endorsement_form.split("/").pop()}):e.jsx("span",{className:"ml-auto text-xs text-rose-600 font-semibold",children:"Missing"})]}),!K.some(t=>t.url)&&!s.ai_detection_certificate&&!s.endorsement_form&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."})]})]}),e.jsxs("div",{className:D,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"})," Committee"]}),e.jsx(S,{}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-muted-foreground uppercase tracking-wide",children:"Adviser"}),e.jsx("div",{className:"font-medium",children:s.defense_adviser||"—"})]})})]})]}),e.jsx(ae,{value:"link-documents",className:"space-y-5",children:e.jsxs("form",{onSubmit:pe,className:"space-y-5",children:[e.jsxs("div",{className:D+" text-sm",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"})," AI Detection Certificate"]}),e.jsx(S,{}),e.jsx("div",{className:"flex flex-col gap-3 mt-2",children:e.jsxs("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[e.jsx("label",{htmlFor:"ai-detection-upload",className:"block text-xs font-medium text-zinc-700 dark:text-zinc-200",children:"Upload Certificate"}),s.ai_detection_certificate&&!g?e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(ie,{type:"text",value:s.ai_detection_certificate.split("/").pop()||"",disabled:!0,className:"flex-1 bg-zinc-100 text-zinc-700 cursor-default"}),e.jsx(x,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>{_(t=>({...t,ai_detection_certificate:void 0})),F.current&&(F.current.value="")},title:"Remove linked file",children:e.jsx(w,{className:"h-4 w-4 text-black"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"ai-detection-upload",ref:F,type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"flex-1 text-xs file:bg-rose-500 file:text-white file:rounded file:border-0 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:cursor-pointer",style:{maxWidth:220},onChange:t=>{var r;return I(((r=t.target.files)==null?void 0:r[0])||null)},disabled:C}),C&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Uploading..."})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:g?`Selected: ${g.name}`:null})]})})]}),e.jsxs("div",{className:D+" text-sm",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"})," Endorsement Form"]}),e.jsx(S,{}),e.jsx("div",{className:"flex flex-col gap-3 mt-2",children:e.jsxs("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[e.jsx("label",{htmlFor:"endorsement-upload",className:"block text-xs font-medium text-zinc-700 dark:text-zinc-200",children:"Upload Endorsement Form"}),s.endorsement_form&&!v?e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(ie,{type:"text",value:s.endorsement_form.split("/").pop()||"",disabled:!0,className:"flex-1 bg-zinc-100 text-zinc-700 cursor-default"}),e.jsx(x,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>{_(t=>({...t,endorsement_form:void 0})),E.current&&(E.current.value="")},title:"Remove linked file",children:e.jsx(w,{className:"h-4 w-4 text-black"})})]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{id:"endorsement-upload",ref:E,type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"flex-1 text-xs file:bg-rose-500 file:text-white file:rounded file:border-0 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:cursor-pointer",style:{maxWidth:220},onChange:t=>{var r;return Y(((r=t.target.files)==null?void 0:r[0])||null)},disabled:A})}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:v?`Selected: ${v.name}`:null}),e.jsx("div",{className:"mt-2",children:e.jsx(x,{type:"button",variant:"ghost",onClick:ve,disabled:A||B||T,children:B||T?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Generating..."]}):"Auto Generate"})})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(x,{type:"submit",className:"gap-2 bg-rose-500 hover:bg-rose-600 text-white",disabled:C||A,children:C||A?e.jsx("span",{children:"Uploading..."}):e.jsx("span",{children:"Submit Documents"})})})]})})]})}),e.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:e.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 sticky top-24 h-fit",children:[e.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"})," Workflow Progress"]}),e.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(s.workflow_history)&&s.workflow_history.length>0?s.workflow_history.map((t,r)=>{let a=t.action;a==="adviser-status-updated"&&t.to_state&&(a=t.to_state),(a==="adviser-review"||a==="pending")&&(a="adviser-review");const n=ue(a),i=xe.find(_e=>_e.key===n)||{label:a.charAt(0).toUpperCase()+a.slice(1),icon:e.jsx(U,{className:"h-5 w-5 text-gray-500"})},c=r===(s.workflow_history??[]).length-1;return e.jsxs("div",{className:"flex items-start gap-3 relative",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:i.icon}),!c&&e.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:"font-semibold text-xs",children:i.label}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[t.user_name&&e.jsx("span",{children:t.user_name}),t.timestamp&&e.jsxs("span",{children:[" ","· ",fe(t.timestamp)]})]}),t.comment&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t.comment})]})]},r)}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["Last updated by:"," ",s.last_status_updated_by||"—"," ",s.last_status_updated_at?`(${s.last_status_updated_at})`:""]})]}),e.jsx(De,{open:u.open,onOpenChange:t=>{t||j({open:!1,action:null})},children:e.jsxs(Se,{children:[e.jsx(Re,{children:"Confirm Action"}),e.jsx(Fe,{children:u.action==="approve"?"Please review before endorsing.":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[e.jsxs("p",{children:["Set request to"," ",e.jsx("span",{className:"font-semibold",children:u.action==="approve"?"Endorsed":u.action==="reject"?"Rejected":"Pending"}),"?"]}),u.action==="approve"&&f.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["This will be sent to your coordinator: ",e.jsx("span",{className:"font-semibold",children:f[0].name})]}),u.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(le,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Endorsing this defense request authorizes the use of your signature on the official defense documents."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(x,{variant:"ghost",onClick:()=>j({open:!1,action:null}),children:"Cancel"}),e.jsx(x,{onClick:()=>u.action&&ce(u.action),disabled:k,children:"Confirm"})]})]})})]})}async function P(h,d,m=!0){d.headers={...typeof d.headers=="object"&&d.headers!==null?d.headers:{},"X-CSRF-TOKEN":oe()};const b=await fetch(h,d);return b.status===419&&m?((!d.headers||typeof d.headers!="object")&&(d.headers={}),d.headers["X-CSRF-TOKEN"]=oe(),P(h,d,!1)):b}function oe(){var h;return((h=document.querySelector('meta[name="csrf-token"]'))==null?void 0:h.content)||""}export{At as default};
