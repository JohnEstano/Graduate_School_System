import{r as j,j as s,L as H,S as I}from"./app-OOvd0qGy.js";import{A as O,S as K}from"./app-layout-4BSfGYAy.js";import{B as W}from"./badge-9siNCstt.js";import{S as $}from"./separator-Cye1ujSm.js";import{A as X,a as J}from"./avatar-DboJvblb.js";import{B as R}from"./button-Bvl2ELDv.js";import{t as v}from"./index-imi9ZEDw.js";import{A as V}from"./arrow-left-SWP0tD1M.js";import{C as G}from"./circle-check-big-Ddw5Ycw8.js";import{U as Q}from"./users-EStqJIUY.js";import{F as g}from"./file-text-DLuaZQHd.js";import{C as b}from"./clock-BJgG26g7.js";import{U as Y}from"./user-check-CLUmSrHp.js";import{S as Z}from"./signature-CJs_z61u.js";import{C as ee}from"./circle-x-Cfzvg8iR.js";import{C as se}from"./circle-arrow-left-eoVZyPRG.js";import{U as te}from"./user-C6RJWX7A.js";import{f as N}from"./format-HX8DKPSU.js";import"./index-ChOW5_O6.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./input-CzcDJDbH.js";import"./index-B2wwfcIF.js";import"./index-DQ9rqnvl.js";import"./index-4w5oLsoB.js";import"./x-DrNmi13E.js";import"./createLucideIcon-Cvkj7Hkp.js";import"./tooltip-BFmjF_jJ.js";import"./floating-ui.react-dom-BrG2AUyT.js";import"./chevron-right-BsU_TN8l.js";import"./dropdown-menu-JMbXV8S0.js";import"./index-DcZRhvrv.js";import"./index-kQq3evoo.js";import"./index-B9sjBiRz.js";import"./index-C9drr0Qb.js";import"./index-CQ9en90x.js";import"./index-C7ezi2Q7.js";import"./settings-BGemkvqC.js";import"./graduation-cap-CCWiuwHf.js";import"./dollar-sign-4LNVBfuJ.js";import"./credit-card-Bfq-rBsk.js";import"./tabs-BvigrSxv.js";import"./info-CIHMpyv0.js";import"./sun-Ch86N1Y-.js";import"./en-US-BA9orzCf.js";function re(r){if(!r)return"—";try{return N(new Date(r),"PPP")}catch{return r}}function z(r){if(!r)return"";const[i,e]=(r||"").split(":");if(i===void 0||e===void 0)return r||"";const a=new Date;return a.setHours(Number(i),Number(e)),N(a,"hh:mm a")}function ae(r){var a,f,c,d;const i=((f=(a=r.first_name)==null?void 0:a.trim())==null?void 0:f[0])??"",e=((d=(c=r.last_name)==null?void 0:c.trim())==null?void 0:d[0])??"";return(i+e).toUpperCase()||"U"}function Qe({id:r,defenseRequest:i}){var w,k,C,A,S,P,F,D,E;const[e,a]=j.useState(i??null),[f,c]=j.useState(!i);j.useEffect(()=>{e||r&&(c(!0),fetch(`/api/defense-request/${r}`).then(t=>t.json()).then(t=>{a(t),c(!1)}))},[r,e]);const d=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/assistant/all-defense-list"}];if(e!=null&&e.id){const t=(((w=e.thesis_title)==null?void 0:w.length)||0)>60?e.thesis_title.slice(0,57)+"...":e.thesis_title||`Request #${e.id}`;d.push({title:t,href:`/assistant/all-defense-list/${e.id}/details`})}function U(t){var p;const o=t.event_type||t.action||t.status_change||t.status||t.type||"Event",l=t.description||t.details||t.note||t.notes||t.remarks||"",m=t.from_state||t.from||t.previous_state,x=t.to_state||t.to||t.new_state,h=t.created_at||t.timestamp||t.performed_at||t.date||"",u=t.user_name||((p=t.user)==null?void 0:p.name)||t.actor_name||t.actor||t.performed_by_name||t.performed_by||"";return{event:o,desc:l,from:m,to:x,created:h,userName:u}}function L(t){if(!t)return"";try{return N(new Date(t),"PPpp")}catch{return t}}function n(t){return t?/^https?:\/\//i.test(t)||t.startsWith("/storage/")?t:`/storage/${t.replace(/^\/?storage\//,"")}`:null}const _=[{label:"Adviser’s Endorsement",url:n((k=e==null?void 0:e.attachments)==null?void 0:k.advisers_endorsement)},{label:"REC Endorsement",url:n((C=e==null?void 0:e.attachments)==null?void 0:C.rec_endorsement)},{label:"Proof of Payment",url:n((A=e==null?void 0:e.attachments)==null?void 0:A.proof_of_payment)},{label:"Manuscript",url:n((S=e==null?void 0:e.attachments)==null?void 0:S.manuscript_proposal)},{label:"Similarity Index",url:n((P=e==null?void 0:e.attachments)==null?void 0:P.similarity_index)},{label:"Avisee-Adviser File",url:n((F=e==null?void 0:e.attachments)==null?void 0:F.avisee_adviser_attachment)},{label:"AI Detection Certificate",url:n((D=e==null?void 0:e.attachments)==null?void 0:D.ai_detection_certificate)},{label:"Endorsement Form",url:n((E=e==null?void 0:e.attachments)==null?void 0:E.endorsement_form)}],y="rounded-lg border p-5 space-y-3",T=[{key:"submitted",label:"Submitted",icon:s.jsx(K,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:s.jsx(Y,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:s.jsx(Z,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected by Coordinator",icon:s.jsx(ee,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved (Set to Pending)",icon:s.jsx(se,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:s.jsx(te,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:s.jsx(b,{className:"h-5 w-5"})}];function B(t){return t=(t||"").toLowerCase(),t.includes("submit")?"submitted":t.includes("adviser")?"adviser-approved":t.includes("rejected")?"rejected":t.includes("retrieved")?"retrieved":t.includes("coordinator")?"coordinator-approved":t.includes("panel")?"panels-assigned":t.includes("schedule")?"scheduled":""}async function q(){var t;if(e)try{(await fetch(`/defense-requests/${e.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""},body:JSON.stringify({status:"Completed"})})).ok?(a({...e,status:"Completed",workflow_state:"completed"}),v.success("Marked as Completed")):v.error("Failed to mark as completed")}catch{v.error("Error marking as completed")}}return s.jsxs(O,{breadcrumbs:d,children:[s.jsx(H,{title:(e==null?void 0:e.thesis_title)||`Defense Request #${(e==null?void 0:e.id)??""}`}),s.jsxs("div",{className:"p-5 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap mb-4",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(R,{variant:"outline",onClick:()=>I.visit("/assistant/all-defense-list"),className:"h-8 px-2",children:s.jsx(V,{className:"h-4 w-4"})})}),(e==null?void 0:e.status)!=="Completed"&&s.jsxs(R,{size:"sm",variant:"outline",onClick:q,className:"gap-2",children:[s.jsx(G,{className:"h-4 w-4 text-green-600"}),"Mark as Completed"]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"md:col-span-2 space-y-6",children:[s.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[s.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-semibold",children:e==null?void 0:e.thesis_title}),s.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),s.jsx("div",{className:"flex flex-col md:items-end gap-1",children:(e==null?void 0:e.status)&&s.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${e.status==="Approved"?"bg-green-100 text-green-600":e.status==="Rejected"?"bg-red-100 text-red-600":e.status==="Pending"?"bg-yellow-100 text-yellow-700":e.status==="Completed"?"bg-gray-800 text-white":"bg-gray-100 text-gray-600"}`,children:["Status: ",e.status]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(X,{className:"h-8 w-8",children:s.jsx(J,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:ae(e)})}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-sm leading-tight",children:[e==null?void 0:e.first_name," ",e!=null&&e.middle_name?`${e.middle_name} `:"",e==null?void 0:e.last_name]}),(e==null?void 0:e.school_id)&&s.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:e.school_id})]})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),s.jsx("div",{className:"font-medium text-sm",children:e==null?void 0:e.program})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),s.jsx(W,{variant:"secondary",className:"text-xs font-medium",children:(e==null?void 0:e.defense_type)??"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),s.jsx("div",{className:"font-medium text-sm",children:re(e==null?void 0:e.scheduled_date)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.scheduled_time?`${z(e.scheduled_time)}${e.scheduled_end_time?" - "+z(e.scheduled_end_time):""}`:"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.defense_venue)||"—"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),s.jsx("div",{className:"font-medium text-sm",children:e!=null&&e.defense_mode?e.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),s.jsx("div",{className:"font-medium text-sm",children:(e==null?void 0:e.scheduling_notes)||"—"})]})]})]}),s.jsxs("div",{className:y,children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(Q,{className:"h-4 w-4"})," Committee"]}),s.jsx($,{}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] text-muted-foreground uppercase tracking-wide",children:"Adviser"}),s.jsx("div",{className:"font-medium",children:(e==null?void 0:e.defense_adviser)||(e==null?void 0:e.adviser)||"—"})]}),[{label:"Chairperson",v:e==null?void 0:e.defense_chairperson},{label:"Panelist 1",v:e==null?void 0:e.defense_panelist1},{label:"Panelist 2",v:e==null?void 0:e.defense_panelist2},{label:"Panelist 3",v:e==null?void 0:e.defense_panelist3},{label:"Panelist 4",v:e==null?void 0:e.defense_panelist4}].map(t=>s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] text-muted-foreground uppercase tracking-wide",children:t.label}),s.jsx("div",{className:"font-medium",children:t.v||"—"})]},t.label))]})]}),s.jsxs("div",{className:y,children:[s.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[s.jsx(g,{className:"h-4 w-4"})," Attachments"]}),s.jsx($,{}),s.jsxs("div",{className:"space-y-2 text-sm",children:[_.filter(t=>!!t.url).length===0&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),_.filter(t=>!!t.url).map(t=>{var o;return s.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[s.jsx(g,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:t.label}),s.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(o=t.url)==null?void 0:o.split("/").pop()})]},t.label)}),(e==null?void 0:e.reference_no)&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[s.jsx(g,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"Reference No."}),s.jsx("span",{className:"ml-auto text-xs",children:e.reference_no})]})]})]}),s.jsxs("div",{className:"text-[11px] text-muted-foreground mt-4",children:["Last updated by:"," ",(e==null?void 0:e.last_status_updated_by_name)||(e==null?void 0:e.last_status_updated_by)||"—"," ",e!=null&&e.last_status_updated_at?`(${e.last_status_updated_at})`:""]})]}),s.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:s.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900",children:[s.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[s.jsx(b,{className:"h-4 w-4"})," Workflow Progress"]}),s.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(e==null?void 0:e.workflow_history)&&e.workflow_history.length>0?e.workflow_history.map((t,o)=>{const{event:l,created:m,userName:x}=U(t),h=B(l),u=T.find(M=>M.key===h)||{label:l.charAt(0).toUpperCase()+l.slice(1),icon:s.jsx(b,{className:"h-5 w-5 text-gray-500"})},p=o===e.workflow_history.length-1;return s.jsxs("div",{className:"flex items-start gap-3 relative",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:u.icon}),!p&&s.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),s.jsxs("div",{className:"pb-4",children:[s.jsx("div",{className:"font-semibold text-xs",children:u.label}),s.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[x&&s.jsx("span",{children:x}),m&&s.jsxs("span",{children:[" ","· ",L(m)]})]})]})]},o)}):s.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]})]})]})}export{Qe as default};
