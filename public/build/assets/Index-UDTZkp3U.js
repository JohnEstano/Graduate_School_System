import{r,j as e,K as re,L as le}from"./app-BubHmeqC.js";import{A as ie}from"./app-layout-yLDvQPzP.js";import{B as o}from"./button-CX84Ig4W.js";import{I as _}from"./input-y4wBi6jo.js";import{A as M,a as F}from"./avatar-DijVPJCE.js";import{B as I}from"./badge-Dd_ET0uG.js";import{D as ne,d as ce,a as oe,e as de,b as me}from"./dialog-ywfV6j7b.js";import{S as H,a as J,b as Q,c as Y,e as g}from"./select-wHGTrFCR.js";import{c as h}from"./utils-jAU0Cazi.js";import{S as P}from"./search-BpG6I48V.js";import{F as xe}from"./filter-CO-t5fNC.js";import{X as he}from"./x-DS6n0ElR.js";import{U as A}from"./users-wdb3-6X2.js";import{U as pe}from"./user-check-DLoTdIld.js";import{G as ue}from"./graduation-cap-B7M__5Eh.js";import{P as je}from"./plus-Dt1ajQhA.js";import{c as L}from"./createLucideIcon-Biu-y2hB.js";import{E as ge}from"./ellipsis-vertical-BFcHu22P.js";import{P as fe}from"./paperclip-BYkIOGCu.js";import{S as Ne}from"./send-DnHCHsKV.js";import"./index-CAAZlwhj.js";import"./index-DZZQifJx.js";import"./index-Bsel9b7o.js";import"./index-PQN_369Y.js";import"./index-DyQT7xcZ.js";import"./tooltip-tJz5bvEu.js";import"./floating-ui.react-dom-DwEbxQiH.js";import"./separator-B1kTuyS6.js";import"./index-1EFpZ92o.js";import"./chevron-right-BRo8ahWW.js";import"./dropdown-menu-BExp8GpF.js";import"./index-6aAr3Pmv.js";import"./index-CVQNv_Nf.js";import"./index-CBu7v5lz.js";import"./index-Zto0mrax.js";import"./check-CZ9c_sEg.js";import"./settings-Uvo0cGb6.js";import"./file-text-B1gFNyH7.js";import"./dollar-sign-DESWnaQ9.js";import"./credit-card-DhKiqKDR.js";import"./tabs-DVolEiAR.js";import"./circle-check-big-BRigqRsr.js";import"./info-DGWfuZKp.js";import"./sun-BLOPCje7.js";import"./index-dLIx9e4I.js";import"./chevron-down-2lGOOBZZ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],ye=L("MessageSquare",ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],we=L("Phone",be);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Ce=L("Smile",Se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Te=L("Video",_e);function ke({selectedUsers:x,onUserSelect:O,onUserRemove:T,conversationType:k,className:i}){const[d,w]=r.useState(""),[f,N]=r.useState([]),[D,R]=r.useState(!1),[p,v]=r.useState("all"),[S,z]=r.useState(!1);r.useEffect(()=>{const j=setTimeout(async()=>{if(d.trim().length<2){N([]);return}R(!1)},300);return()=>clearTimeout(j)},[d,p]);const y=t=>t.split(" ").map(j=>j[0]).join("").toUpperCase(),b=t=>{switch(t.toLowerCase()){case"student":return e.jsx(ue,{className:"h-4 w-4"});case"dean":case"coordinator":case"administrative assistant":return e.jsx(pe,{className:"h-4 w-4"});default:return e.jsx(A,{className:"h-4 w-4"})}},u=t=>{switch(t.toLowerCase()){case"student":return"bg-blue-100 text-blue-800";case"dean":return"bg-purple-100 text-purple-800";case"coordinator":return"bg-green-100 text-green-800";case"administrative assistant":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},m=()=>x.map(t=>f.find(C=>C.id===t)).filter(Boolean);return e.jsxs("div",{className:h("space-y-3",i),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(_,{value:d,onChange:t=>w(t.target.value),placeholder:"Search by name, email, role, school ID, or program...",className:"pl-9"})]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>z(!S),className:h(S&&"bg-gray-100"),children:e.jsx(xe,{className:"h-4 w-4"})})]}),S&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-md space-y-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Filter by Role"}),e.jsxs(H,{value:p,onValueChange:v,children:[e.jsx(J,{className:"h-8",children:e.jsx(Q,{})}),e.jsxs(Y,{children:[e.jsx(g,{value:"all",children:"All Roles"}),e.jsx(g,{value:"Student",children:"Students"}),e.jsx(g,{value:"Coordinator",children:"Coordinators"}),e.jsx(g,{value:"Dean",children:"Deans"}),e.jsx(g,{value:"Administrative Assistant",children:"Administrative Assistants"})]})]})]})})]}),x.length>0&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-md",children:[e.jsxs("div",{className:"text-xs font-medium text-blue-700 mb-2",children:["Selected ",k==="private"?"User":"Users"," (",x.length,"):"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m().map(t=>t?e.jsxs("div",{className:"flex items-center space-x-1 bg-white rounded-md px-2 py-1 border",children:[e.jsx(M,{className:"h-5 w-5",children:e.jsx(F,{className:"text-xs",children:y(t.name)})}),e.jsx("span",{className:"text-xs font-medium",children:t.name}),e.jsx("button",{onClick:()=>T(t.id),className:"ml-1 hover:text-red-500 text-gray-400",children:e.jsx(he,{className:"h-3 w-3"})})]},t.id):null)})]}),e.jsx("div",{className:"border rounded-md max-h-64 overflow-y-auto",children:D?e.jsxs("div",{className:"text-center py-8 text-sm text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),"Searching users..."]}):d.length>=2?f.length===0?e.jsxs("div",{className:"text-center py-8 text-sm text-gray-500",children:[e.jsx(A,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),'No users found matching "',d,'"',p!=="all"&&e.jsxs("div",{className:"mt-1",children:['with role "',p,'"']})]}):e.jsx("div",{className:"divide-y",children:f.map(t=>e.jsxs("div",{className:h("flex items-center space-x-3 p-3 hover:bg-gray-50 cursor-pointer transition-colors",x.includes(t.id)&&"bg-blue-50 hover:bg-blue-100"),onClick:()=>O(t),children:[e.jsx(M,{className:"h-8 w-8",children:e.jsx(F,{className:"text-xs",children:y(t.name)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),x.includes(t.id)&&e.jsx(I,{variant:"default",className:"text-xs",children:"Selected"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[b(t.role),e.jsx(I,{className:h("text-xs",u(t.role)),children:t.role})]}),t.program&&e.jsx(I,{variant:"outline",className:"text-xs",children:t.program})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.email}),t.school_id&&e.jsxs("p",{className:"text-xs text-gray-400",children:["ID: ",t.school_id]})]}),e.jsx("div",{className:"flex-shrink-0",children:x.includes(t.id)?e.jsx("div",{className:"text-blue-500",children:"✓"}):e.jsx("div",{className:"text-gray-300",children:"+"})})]},t.id))}):e.jsxs("div",{className:"text-center py-8 text-sm text-gray-500",children:[e.jsx(P,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),"Type at least 2 characters to search users",e.jsx("div",{className:"mt-2 text-xs",children:"You can search by name, email, role, school ID, or program"})]})}),d.length===0&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 p-3 rounded-md",children:[e.jsx("strong",{children:"Search Tips:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[e.jsx("li",{children:"• Search by first name, last name, or full name"}),e.jsx("li",{children:"• Use email addresses to find specific users"}),e.jsx("li",{children:"• Filter by role (Student, Coordinator, Dean, etc.)"}),e.jsx("li",{children:"• Search by school ID or academic program"})]})]})]})}const De=[{title:"Dashboard",href:"/dashboard"},{title:"Messages",href:"/messages"}];function bs(){var $,X;const{conversations:x,users:O}=re().props,[T,k]=r.useState(x),[i,d]=r.useState(null),[w,f]=r.useState([]),[N,D]=r.useState(""),[R,p]=r.useState(!1),[v,S]=r.useState(""),[z,y]=r.useState(!1),[b,u]=r.useState([]),[m,t]=r.useState("private"),[j,C]=r.useState(""),[U,E]=r.useState(""),V=r.useRef(null),W=()=>{var s;(s=V.current)==null||s.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{W()},[w]);const B=async s=>{p(!0);try{const l=await(await fetch(`/messages/conversations/${s}/messages`)).json();f(l.messages),k(n=>n.map(c=>c.id===s?{...c,unread_count:0}:c))}catch(a){console.error("Failed to load messages:",a)}finally{p(!1)}},q=async()=>{var s;if(!(!N.trim()||!i))try{const l=await(await fetch("/messages/send",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({conversation_id:i.id,content:N,type:"text"})})).json();f(n=>[...n,l.message]),D(""),k(n=>n.map(c=>c.id===i.id?{...c,latest_message:{content:l.message.content,user_name:l.message.user.name,created_at:l.message.created_at,formatted_time:l.message.formatted_time},last_message_at:l.message.created_at}:c).sort((c,ae)=>new Date(ae.last_message_at).getTime()-new Date(c.last_message_at).getTime()))}catch(a){console.error("Failed to send message:",a)}},Z=async()=>{var s;if(!(!U.trim()||b.length===0))try{const l=await(await fetch("/messages/conversations",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({participants:b,message:U,type:m,title:m==="group"?j:null})})).json();if(l.exists){const n=T.find(c=>c.id===l.conversation_id);n&&(d(n),B(n.id))}else window.location.reload();y(!1),u([]),E(""),C("")}catch(a){console.error("Failed to create conversation:",a)}},ee=s=>{u(m==="private"?[s.id]:a=>a.includes(s.id)?a.filter(l=>l!==s.id):[...a,s.id])},se=s=>{u(a=>a.filter(l=>l!==s))},G=T.filter(s=>s.title.toLowerCase().includes(v.toLowerCase())||s.participants.some(a=>a.name.toLowerCase().includes(v.toLowerCase()))),K=s=>s.split(" ").map(a=>a[0]).join("").toUpperCase(),te=(s,a)=>a?s.formatted_date!==a.formatted_date:!0;return e.jsxs(ie,{breadcrumbs:De,children:[e.jsx(le,{title:"Messages"}),e.jsx("div",{className:"h-full flex-1 flex-col gap-4 overflow-hidden rounded-xl",children:e.jsxs("div",{className:"flex h-[calc(100vh-8rem)] bg-white rounded-lg shadow-sm border overflow-hidden",children:[e.jsxs("div",{className:"w-80 border-r flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Messages"}),e.jsxs(ne,{open:z,onOpenChange:y,children:[e.jsx(ce,{asChild:!0,children:e.jsx(o,{size:"sm",className:"h-8 w-8 p-0",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(oe,{className:"sm:max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsx(me,{children:"Start New Conversation"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Type"}),e.jsxs(H,{value:m,onValueChange:s=>t(s),children:[e.jsx(J,{children:e.jsx(Q,{})}),e.jsxs(Y,{children:[e.jsx(g,{value:"private",children:"Private"}),e.jsx(g,{value:"group",children:"Group"})]})]})]}),m==="group"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Group Title"}),e.jsx(_,{value:j,onChange:s=>C(s.target.value),placeholder:"Enter group title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:m==="private"?"Select User":"Select Users"}),e.jsx(ke,{selectedUsers:b,onUserSelect:ee,onUserRemove:se,conversationType:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Initial Message"}),e.jsx(_,{value:U,onChange:s=>E(s.target.value),placeholder:"Type your message..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{y(!1),u([]),E(""),C("")},children:"Cancel"}),e.jsx(o,{onClick:Z,disabled:b.length===0||!U.trim(),children:"Start Conversation"})]})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Search conversations...",value:v,onChange:s=>S(s.target.value),className:"pl-9"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:G.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:v?"No conversations found":"No conversations yet"}):G.map(s=>{var a;return e.jsx("div",{onClick:()=>{d(s),B(s.id)},className:h("p-3 border-b cursor-pointer hover:bg-gray-50 transition-colors",(i==null?void 0:i.id)===s.id&&"bg-blue-50 border-blue-200"),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"h-10 w-10",children:e.jsx(F,{children:s.type==="group"?e.jsx(A,{className:"h-5 w-5"}):K(((a=s.participants[0])==null?void 0:a.name)||"U")})}),s.unread_count>0&&e.jsx(I,{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 text-xs",children:s.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),s.latest_message&&e.jsx("span",{className:"text-xs text-gray-500",children:s.latest_message.formatted_time})]}),s.latest_message&&e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:[s.latest_message.user_name,": ",s.latest_message.content]})]})]})},s.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"h-10 w-10",children:e.jsx(F,{children:i.type==="group"?e.jsx(A,{className:"h-5 w-5"}):K((($=i.participants[0])==null?void 0:$.name)||"U")})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:i.title}),e.jsx("p",{className:"text-sm text-gray-500",children:i.type==="group"?`${i.participants.length} members`:(X=i.participants[0])==null?void 0:X.role})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[R?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):w.map((s,a)=>{const l=a>0?w[a-1]:null,n=te(s,l);return e.jsxs("div",{children:[n&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-600",children:s.formatted_date})}),e.jsx("div",{className:h("flex",s.is_own?"justify-end":"justify-start"),children:e.jsxs("div",{className:h("max-w-xs lg:max-w-md px-4 py-2 rounded-2xl",s.is_own?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[!s.is_own&&i.type==="group"&&e.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:s.user.name}),e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:h("text-xs mt-1",s.is_own?"text-blue-100":"text-gray-500"),children:s.formatted_time})]})})]},s.id)}),e.jsx("div",{ref:V})]}),e.jsx("div",{className:"p-4 border-t bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(_,{value:N,onChange:s=>D(s.target.value),placeholder:"Type a message...",onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),q())},className:"pr-10"}),e.jsx(o,{variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-8 w-8 p-0",children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsx(o,{onClick:q,disabled:!N.trim(),size:"sm",children:e.jsx(Ne,{className:"h-4 w-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ye,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})})]})}export{bs as default};
