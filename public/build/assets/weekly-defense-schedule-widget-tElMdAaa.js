import{r as u,j as t}from"./app-BDkuJsct.js";import{S as T}from"./skeleton-C1N4Z9e5.js";import{c as W}from"./utils-jAU0Cazi.js";import{C as D}from"./calendar-CI-DWPmu.js";import{C as $}from"./chevron-right-BpKiIXqV.js";import{G as M}from"./graduation-cap-Cszrlop1.js";import{b as E,f as C}from"./format-Cze4Gw5q.js";import{p as b}from"./parseISO-Bx-IO3P2.js";import{i as _}from"./isSameDay-DsAL-Hdb.js";import"./createLucideIcon-CEmaZ7tj.js";const L=["Coordinator","Administrative Assistant","Dean"];function F(d,x){const o=E(x,{weekStartsOn:0});return new Date(o.getFullYear(),o.getMonth(),o.getDate()+d)}function S(d){if(!d)return"";const[x,o]=d.split(":").map(i=>parseInt(i,10)),p=new Date(2020,0,1,x,o,0);return C(p,"h:mm a")}function V(d){const{weekDays:x,selectedDay:o,setSelectedDay:p,approvedDefenses:i,loading:A=!1,referenceDate:g,studentId:h,userRole:R,canManage:z}=d,[v,w]=u.useState([]),[O,k]=u.useState(!1);u.useEffect(()=>{const s=E(g,{weekStartsOn:0}),a=new Date(s);a.setDate(a.getDate()+6);const l=`?from=${encodeURIComponent(s.toISOString())}&to=${encodeURIComponent(a.toISOString())}`;k(!0),fetch("/api/calendar/events"+l).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json()}).then(e=>{console.log("ðŸ“… Weekly Events Response:",e);const n=(Array.isArray(e)?e:[]).filter(c=>c.origin==="event");console.log("ðŸ“… Filtered Events:",n),w(n)}).catch(e=>{console.error("âŒ Error fetching events:",e),w([])}).finally(()=>k(!1))},[g]);const m=F(o,g);u.useEffect(()=>{console.log("ðŸŽ¯ Approved Defenses Input:",i)},[i]);const f=u.useMemo(()=>{const s=i.filter(e=>{const r=e.status==="Approved"||e.workflow_state==="scheduled"||e.workflow_state==="completed",n=e.date_of_defense||e.scheduled_date;return r&&n}).filter(e=>{const r=e.date_of_defense||e.scheduled_date;if(!r)return!1;try{const n=r.includes("T")||r.includes(" ")?b(r.replace(" ","T")):b(r);return _(n,m)}catch{return!1}}).map(e=>{const r=e.start_time||e.scheduled_time,n=e.end_time||e.scheduled_end_time,c=y=>{if(!y)return null;const j=y.split(":");return j.length>=2?`${j[0]}:${j[1]}`:y.substring(0,5)};return{id:"def-"+e.id,kind:"defense",title:e.thesis_title||"Defense",start:c(r),end:c(n),color:"#059669",raw:e,owner:h&&e.submitted_by===h}}),a=v.filter(e=>{try{const r=e.start.replace(" ","T"),n=b(r);return _(n,m)}catch{return!1}}).map(e=>{try{const[r,n]=e.start.split(" "),c=e.end?e.end.split(" ")[1]:void 0;return{id:e.id,kind:"event",title:e.title||"Event",start:e.allDay?null:(n==null?void 0:n.slice(0,5))||null,end:e.allDay?null:(c==null?void 0:c.slice(0,5))||null,color:e.color||"#2563eb",raw:e,owner:!1}}catch{return null}}).filter(e=>e!==null),l=[...s,...a].sort((e,r)=>e.start===r.start?e.title.localeCompare(r.title):e.start===null?-1:r.start===null?1:e.start.localeCompare(r.start));return console.log("ðŸ“Š Combined Schedule for",C(m,"yyyy-MM-dd"),":",{defenseCount:s.length,eventCount:a.length,total:l.length,items:l}),l},[i,v,m,h]),N=A||O,I=z||L.includes(R||"");return t.jsxs("div",{className:"w-full md:w-[580px] border rounded-xl p-5 bg-white dark:bg-zinc-900 flex flex-col min-h-[340px]",children:[t.jsxs("a",{href:"/schedules",className:"flex items-center justify-between mb-2 group cursor-pointer select-none",style:{textDecoration:"none"},children:[t.jsx("div",{children:t.jsx("div",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"This Week's Schedules"})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-rose-500 p-2",children:t.jsx(D,{className:"size-6 text-white"})}),t.jsx($,{className:"size-6 text-gray-400 transition-transform transition-colors duration-200 group-hover:text-rose-500 group-hover:translate-x-1"})]})]}),t.jsx("div",{className:"h-2"}),t.jsx("div",{className:"flex flex-nowrap gap-2 mb-3 justify-between",children:x.map(s=>t.jsx("button",{className:W("flex-1 px-2.5 py-1 rounded-full text-xs font-semibold  cursor-pointer whitespace-nowrap text-center",o===s.value?"bg-rose-500 text-white":"bg-gray-100 dark:bg-zinc-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-zinc-700"),onClick:()=>p(s.value),disabled:N,style:{minWidth:0},children:s.label},s.value))}),t.jsx("div",{className:"flex flex-col gap-2",children:N?t.jsx("div",{children:[...Array(4)].map((s,a)=>t.jsx(T,{className:"h-16 w-full mb-2 bg-gray-100 dark:bg-zinc-800"},a))}):f.length===0?t.jsx("div",{className:"flex items-center justify-center h-24",children:t.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"No schedules."})}):t.jsxs(t.Fragment,{children:[f.slice(0,6).map(s=>{const a=s.kind==="defense",l=s.start?S(s.start):s.start===null?"All Day":"",e=s.end?S(s.end):"",r=l&&e?`${l} â€“ ${e}`:l;return t.jsxs("div",{className:"group flex items-start gap-2 px-2 py-2 rounded border border-gray-200 dark:border-zinc-800",children:[t.jsx("div",{className:"flex-shrink-0 mt-0.5",children:a?t.jsx(M,{className:"size-3.5 text-gray-600 dark:text-gray-400"}):t.jsx(D,{className:"size-3.5 text-gray-600 dark:text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 line-clamp-1",children:s.title}),t.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.owner&&t.jsx("span",{className:"px-1 py-0.5 rounded text-[9px] font-medium border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:"You"}),t.jsx("span",{className:"px-1 py-0.5 rounded text-[9px] font-medium border border-gray-300 dark:border-gray-700 text-gray-600 dark:text-gray-400",children:a?"Defense":"Event"})]})]}),r&&t.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-500 mt-0.5",children:r}),a&&I&&s.raw.defense_type&&t.jsxs("p",{className:"text-[10px] text-gray-500 dark:text-gray-500 mt-0.5",children:[s.raw.defense_type,s.raw.defense_mode?` â€¢ ${s.raw.defense_mode}`:""]})]})]},s.id)}),f.length>6&&t.jsx("div",{className:"text-center pt-1",children:t.jsxs("span",{className:"text-[10px] font-medium text-gray-600 dark:text-gray-400",children:["+",f.length-6," more schedule",f.length-6!==1?"s":""]})})]})})]})}export{V as default};
