import{r as i,j as e}from"./app-BDkuJsct.js";import{C as h,a as T,b as C,d as y,c as x}from"./card-BJFJPDio.js";import{C as D,a as L,b as _,c as M,d as A}from"./chart-7aubccfQ.js";import{S as E,a as O,b as W,c as H,e as u}from"./select-D1tIJaem.js";import{c as I}from"./createLucideIcon-CEmaZ7tj.js";import{U as $}from"./users-BTr8E8QO.js";import{A as K,a as F}from"./AreaChart-D-ENoPw9.js";import{C as U}from"./CartesianGrid-CTAPJDM6.js";import{X as V}from"./YAxis-B7UrdJFR.js";import"./utils-jAU0Cazi.js";import"./generateCategoricalChart-BOHwT1p9.js";import"./index-CoS1vLG5.js";import"./index-Chjiymov.js";import"./index-BhbofC_p.js";import"./index-DMsjTEK4.js";import"./index-BdhkuEJx.js";import"./index-BKBXBDOv.js";import"./index-LRezjsDo.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./index-Dia2ik6c.js";import"./index-D-bfryUZ.js";import"./chevron-down-DMxaecxw.js";import"./check-BUlQxyEc.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16",key:"tarvll"}]],q=I("Laptop",Y),P={faceToFace:{label:"Face-to-face",color:"#e11d48",icon:$},online:{label:"Online",color:"#fb7185",icon:q}};function je(){const[p,j]=i.useState([]),[b,w]=i.useState(!0),[k,v]=i.useState(0),[d,N]=i.useState("month"),[g,S]=i.useState(0);return i.useEffect(()=>{fetch("/defense-requests",{headers:{Accept:"application/json"}}).then(r=>{if(!r.ok)throw new Error("Failed to fetch");return r.json()}).then(r=>{const f=(Array.isArray(r)?r:r.defenseRequests??[]).filter(t=>t.scheduled_date!==null&&t.defense_mode);v(f.length);let s=[];if(d==="week"){const t={},o=new Date,a=new Date(o.getTime()-56*24*60*60*1e3);f.forEach(c=>{const n=new Date(c.scheduled_date);if(n>=a){const l=`W${8-Math.floor((o.getTime()-n.getTime())/6048e5)}`;t[l]||(t[l]={faceToFace:0,online:0}),(c.defense_mode||"Face-to-face")==="Online"?t[l].online++:t[l].faceToFace++}}),s=Array.from({length:8},(c,n)=>{var m,l;return{label:`W${n+1}`,faceToFace:((m=t[`W${n+1}`])==null?void 0:m.faceToFace)||0,online:((l=t[`W${n+1}`])==null?void 0:l.online)||0}})}else if(d==="month"){const t={};f.forEach(a=>{const n=new Date(a.scheduled_date).toLocaleDateString("en-US",{month:"short"});t[n]||(t[n]={faceToFace:0,online:0}),(a.defense_mode||"Face-to-face")==="Online"?t[n].online++:t[n].faceToFace++}),s=Object.keys(t).slice(-6).map(a=>({label:a,faceToFace:t[a].faceToFace,online:t[a].online}))}else if(d==="year"){const t={};f.forEach(o=>{const c=new Date(o.scheduled_date).getFullYear().toString();t[c]||(t[c]={faceToFace:0,online:0}),(o.defense_mode||"Face-to-face")==="Online"?t[c].online++:t[c].faceToFace++}),s=Object.entries(t).sort(([o],[a])=>o.localeCompare(a)).slice(-5).map(([o,a])=>({label:o,faceToFace:a.faceToFace,online:a.online}))}if(j(s),s.length>1){const t=s[s.length-1].faceToFace+s[s.length-1].online,o=s[s.length-2].faceToFace+s[s.length-2].online,a=o>0?(t-o)/o*100:0;S(Number(a.toFixed(1)))}}).catch(r=>{console.error("Error fetching defense requests:",r),j([])}).finally(()=>{w(!1)})},[d]),b?e.jsxs(h,{className:"rounded-xl shadow-none border",children:[e.jsxs(T,{children:[e.jsx(C,{children:"Defense Mode Trends"}),e.jsx(y,{children:"Loading..."})]}),e.jsx(x,{className:"h-[250px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading chart data..."})})]}):p.length===0?e.jsxs(h,{className:"rounded-xl shadow-none border",children:[e.jsxs(T,{children:[e.jsx(C,{children:"Defense Mode Trends"}),e.jsx(y,{children:"No data available"})]}),e.jsx(x,{className:"h-[250px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"No scheduled defenses found"})})]}):e.jsxs(h,{className:"rounded-xl shadow-none border flex flex-col justify-between p-0 min-h-[220px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 pt-5",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Defense Mode Trends"}),e.jsxs(E,{value:d,onValueChange:N,children:[e.jsx(O,{className:"w-[120px] h-8 text-xs",children:e.jsx(W,{})}),e.jsxs(H,{children:[e.jsx(u,{value:"week",children:"Weekly"}),e.jsx(u,{value:"month",children:"Monthly"}),e.jsx(u,{value:"year",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"px-6",children:[e.jsx("div",{className:"text-3xl font-bold leading-tight",children:k}),e.jsxs("div",{className:"text-sm mt-1 mb-2 text-muted-foreground",children:[g>=0?"+":"",g,"% from previous period"]})]}),e.jsx(x,{className:"flex-1 flex items-end w-full p-0 pb-2",children:e.jsx(D,{config:P,className:"w-full h-[140px]",children:e.jsxs(K,{accessibilityLayer:!0,data:p,margin:{left:12,right:12},children:[e.jsx(U,{vertical:!1}),e.jsx(V,{dataKey:"label",tickLine:!1,axisLine:!1,tickMargin:8,tickFormatter:r=>r}),e.jsx(L,{cursor:!1,content:e.jsx(_,{indicator:"line"})}),e.jsx(F,{dataKey:"online",type:"natural",fill:"var(--color-online)",fillOpacity:.4,stroke:"var(--color-online)",strokeWidth:2,stackId:"a"}),e.jsx(F,{dataKey:"faceToFace",type:"natural",fill:"var(--color-faceToFace)",fillOpacity:.4,stroke:"var(--color-faceToFace)",strokeWidth:2,stackId:"a"}),e.jsx(M,{content:e.jsx(A,{})})]})})})]})}export{je as DefenseModeBreakdown};
