import{j as e,L as ie,S as le,r as j}from"./app-DdPj2m7B.js";import{A as oe,C as Te}from"./app-layout-CZ3kZ0t2.js";import{d as Ee}from"./dayjs.min-D6wfwQTr.js";import{T as Fe,t as A}from"./index-B2MlTwnV.js";import{B as w}from"./button-C4XkiM_B.js";import{I as D}from"./input-DCrn1t-u.js";import{B as de}from"./badge-ofr1GoIX.js";import{S as R}from"./separator-DAbYQnLI.js";import{C as De,a as Re,c as $e,d as Le,e as Me}from"./command-D56cLWk0.js";import{C as ze}from"./calendar-DKOUdBib.js";import{S as Be,a as Oe,b as Ue,c as Ie,e as ce}from"./select-BHDrHMEc.js";import{P as _e,a as ve,b as be}from"./popover-tBQRRq13.js";import{D as Ve,a as He,b as We,c as Ke}from"./dialog-BeApitpu.js";import{c as Ye}from"./utils-jAU0Cazi.js";import{A as Xe,a as Je}from"./avatar-Cz3zvE7t.js";import{T as me,a as Ge,b as ue,c as fe}from"./tabs-BvzTftzm.js";import{T as Qe,a as Ze,b as pe,c as T,d as es,e as E}from"./table-C8ztdzxp.js";import{A as ss}from"./arrow-left-C9WAaS2h.js";import{F as $}from"./file-text-Dl_aF8u0.js";import{C as I}from"./calendar-BkrqGKNC.js";import{C as ts}from"./circle-check-big-CKCqbWb4.js";import{C as xe}from"./circle-x-BzZWIzCj.js";import{C as he}from"./circle-arrow-left-Bx1mKyRQ.js";import{U as ge}from"./users-Bi2Lh05r.js";import{C as V}from"./clock-WdEz_qo4.js";import{S as je}from"./signature-HJa2c2uW.js";import{S as as}from"./send-ChQ392yu.js";import{U as ns}from"./user-check-jTMUIr-7.js";import{U as rs}from"./user-Dpzu1VZB.js";import{C as is}from"./check-BgnkF1LW.js";import{f as L}from"./format-HX8DKPSU.js";import"./index-DYEC1Owk.js";import"./index-DZZQifJx.js";import"./index-DDxX9UbU.js";import"./index-C0AcbnKJ.js";import"./index-DRr-UIpQ.js";import"./x-gfWO9KfB.js";import"./createLucideIcon-B8qZ3ylK.js";import"./tooltip-YyHP33lU.js";import"./floating-ui.react-dom-qFQCHW7g.js";import"./chevron-right-BZod6iQK.js";import"./dropdown-menu-sYZpN2tC.js";import"./index-DGKk-Zer.js";import"./index-ATT6OHxL.js";import"./index-DxK34XW3.js";import"./index-MX9TSR8D.js";import"./index-BdQOngYf.js";import"./settings-CYIvZ_Tn.js";import"./graduation-cap-BxuxjmnL.js";import"./dollar-sign-DEGfV_co.js";import"./credit-card-BvkjxVWT.js";import"./info-BWBV8Gn3.js";import"./sun-CPhm4DAg.js";import"./search-gvHM0uxt.js";import"./en-US-BA9orzCf.js";import"./endOfWeek-QFyZPl43.js";import"./differenceInCalendarMonths-HUNRrXGm.js";import"./normalizeInterval-CdMCNNY-.js";import"./endOfMonth-CK_ShA5m.js";import"./isSameDay-DUlCFK42.js";import"./isSameMonth-CQd3m9St.js";import"./chevron-left-IcMAr9yn.js";import"./chevron-down-DEJUajdp.js";import"./index-DFD1OPps.js";const M=m=>String(m??"").trim().toLowerCase();function z(m){const l=String(m??"").trim().toLowerCase().replace(/[\s\-_]+/g,"");return l?l.includes("proposal")?"proposal":l.includes("prefinal")||l.includes("pre")&&l.includes("final")?"prefinal":l.includes("final")?"final":"":""}function H(m){const l=M(m);return l==="masteral"?"masteral":l==="doctorate"?"doctorate":""}function B(m){const l=M(m);return l?/(^|\s)(ms|msc|ma|mba|m\s*\.?\s*s|m\s*\.?\s*a|master)/.test(l)?"masteral":/(^|\s)(phd|ph\.?\s*d|dr|doctor|doctoral|doctorate)/.test(l)?"doctorate":l.includes("master")?"masteral":l.includes("doctor")?"doctorate":"":""}function Ne(m,l){const d=M(m),x=M(l),_=c=>c.includes("chair"),t=c=>c.includes("panel")&&!_(c),v=c=>c.includes("advis");return _(x)?_(d):t(x)?t(d):v(x)?v(d):d.includes(x)||x.includes(d)}function ls(m,l,d,x){if(!Array.isArray(m)||!l||!d||!x)return null;const _=H(l)||B(l),t=z(d);if(!_||!t)return null;const v=m.find(u=>{const b=H(u.program_level)||B(u.program_level),C=z(u.defense_type);return b===_&&C===t&&Ne(u.type||"",x)});if(!v)return null;const c=Number(v.amount);return Number.isFinite(c)?c:null}function os(m,l,d,x){if(!Array.isArray(m)||!l||!d||!x)return null;const _=B(l),t=z(d);if(!_||!t)return null;const v=m.find(u=>{const b=H(u.program_level)||B(u.program_level),C=z(u.defense_type);return b===_&&C===t&&Ne(u.type||"",x)});if(!v)return null;const c=Number(v.amount);return Number.isFinite(c)?c:null}function ds(m,l){if(!l||!Array.isArray(m))return null;const d=String(l).trim();if(!d)return null;const x=m.find(t=>String(t.id)===d);if(x)return x;if(/^\d+$/.test(d)){const t=m.find(v=>String(v.id)===d||String(v.id).endsWith(`-${d}`));if(t)return t}const _=d.toLowerCase();return m.find(t=>String(t.name||"").trim().toLowerCase()===_)||null}function cs({label:m,value:l,onChange:d,options:x,disabled:_,taken:t}){const[v,c]=j.useState(!1),[u,b]=j.useState(""),C=j.useMemo(()=>{if(!u)return x;const h=u.toLowerCase();return x.filter(y=>y.name.toLowerCase().includes(h)||y.email&&y.email.toLowerCase().includes(h))},[u,x]);return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:m}),e.jsxs(_e,{open:v,onOpenChange:h=>{c(h),h||b("")},children:[e.jsx(ve,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full h-9 px-3 flex items-center justify-between rounded-md border bg-background text-sm text-left focus:outline-none focus:ring-2 focus:ring-primary/40 hover:bg-accent disabled:opacity-50",disabled:_,children:[e.jsx("span",{className:`truncate ${l?"":"text-muted-foreground"}`,children:l||`Select ${m}`}),e.jsx(Te,{size:14,className:"opacity-50"})]})}),e.jsx(be,{className:"w-[320px] p-0",align:"start",sideOffset:4,onOpenAutoFocus:h=>h.preventDefault(),children:e.jsxs(De,{shouldFilter:!1,children:[e.jsx(Re,{value:u,onValueChange:b,placeholder:"Search...",className:"h-9",autoFocus:!0}),e.jsx($e,{className:"py-8 text-sm text-muted-foreground text-center",children:"No matches."}),e.jsx(Le,{className:"max-h-72 overflow-auto",children:C.map(h=>{const y=h.name===l,q=t.has(h.name)&&!y;return e.jsxs(Me,{value:h.name,disabled:q,onSelect:()=>{q||(d(h.name),c(!1),b(""))},className:`flex flex-col items-start gap-0.5 px-3 py-2
                      ${y?"bg-muted":""}
                      ${q?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center w-full gap-2",children:[e.jsx(is,{size:14,className:y?"opacity-100 text-muted-foreground":"opacity-0"}),e.jsx("span",{className:"text-sm truncate",children:h.name})]}),h.email&&e.jsx("span",{className:"pl-5 text-[11px] text-muted-foreground truncate max-w-[250px]",children:h.email}),q&&!y&&e.jsx("span",{className:"pl-5 text-[10px] text-muted-foreground",children:"Already chosen"})]},h.id)})})]})})]})]})}function Ct(m){var re;const l=m||{},d=l.defenseRequest||null,x=l.userRole||"",_=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/defense-request"}];if(d!=null&&d.id){const s=(((re=d.thesis_title)==null?void 0:re.length)||0)>60?d.thesis_title.slice(0,57)+"...":d.thesis_title||`Request #${d.id}`;_.push({title:s,href:`/coordinator/defense-requests/${d.id}/details`})}if(!d)return e.jsxs(oe,{breadcrumbs:_,children:[e.jsx(ie,{title:"Defense Request - Not Found"}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-red-500",children:"No defense request loaded. Use the list page and click Details again."}),e.jsx(w,{variant:"outline",onClick:()=>le.visit("/defense-request"),children:"Back to list"})]})]});const[t,v]=j.useState(d),[c,u]=j.useState({open:!1,action:null,sendEmail:!1}),[b,C]=j.useState(!1),[h,y]=j.useState([]),[q,W]=j.useState(!1),[K,Y]=j.useState(null),[X,J]=j.useState([]);j.useEffect(()=>{let s=!0;async function r(){W(!0),Y(null);const i=["/coordinator/defense/panel-members-all","/api/panel-members"];let a=!1;for(const o of i)try{const n=await fetch(o,{headers:{Accept:"application/json"}});if(!n.ok){console.warn("Panel member fetch failed",o,n.status);continue}const p=await n.json();s&&(y(Array.isArray(p)?p:[]),a=!0);break}catch(n){console.warn("Fetch error",o,n)}!a&&s&&(y([]),Y("Could not load panel members.")),s&&W(!1)}return r(),()=>{s=!1}},[]),j.useEffect(()=>{let s=!0;return(async()=>{try{const i=await(await fetch("/dean/payment-rates/data",{headers:{Accept:"application/json"}})).json(),a=Array.isArray(i==null?void 0:i.rates)?i.rates:Array.isArray(i)?i:[];s&&J(a)}catch{s&&J([])}})(),()=>{s=!1}},[]);const[g,G]=j.useState({defense_chairperson:t.defense_chairperson??"",defense_panelist1:t.defense_panelist1??"",defense_panelist2:t.defense_panelist2??"",defense_panelist3:t.defense_panelist3??"",defense_panelist4:t.defense_panelist4??""}),[f,P]=j.useState({scheduled_date:t.scheduled_date??"",scheduled_time:t.scheduled_time??"",scheduled_end_time:t.scheduled_end_time??"",defense_mode:t.defense_mode??"",defense_venue:t.defense_venue??"",scheduling_notes:t.scheduling_notes??""}),[ms,us]=j.useState(!1),[fs,ps]=j.useState(!1),ye=j.useMemo(()=>new Set(Object.values(g).filter(Boolean)),[g]),k=["Coordinator","Administrative Assistant","Dean"].includes(x);async function Q(){var s;try{return await fetch("/sanctum/csrf-cookie",{credentials:"same-origin"}),((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""}catch{return""}}async function Z(s,r,i=!0){r.headers||(r.headers={}),r.headers["X-CSRF-TOKEN"]=await Q();let a;try{a=await fetch(s,r)}catch{throw new Error("network")}if(a.status===419&&i){r.headers["X-CSRF-TOKEN"]=await Q();try{a=await fetch(s,r)}catch{throw new Error("network")}}return a}async function O(s,r=!1){if(!t.id)return;C(!0);let i="Pending";s==="approve"?i="Approved":s==="reject"?i="Rejected":s==="retrieve"&&(i="Pending");try{const a={status:i,send_email:r};if(console.log("handleStatusChange payload:",a),s==="approve"){a.panels={defense_chairperson:g.defense_chairperson,defense_panelist1:g.defense_panelist1,defense_panelist2:g.defense_panelist2,defense_panelist3:g.defense_panelist3,defense_panelist4:g.defense_panelist4};const p=N=>{if(!N)return"";const F=N.split(":");return F.length>=2?`${F[0]}:${F[1]}`:N};a.schedule={scheduled_date:f.scheduled_date,scheduled_time:p(f.scheduled_time),scheduled_end_time:p(f.scheduled_end_time),defense_mode:f.defense_mode,defense_venue:f.defense_venue,scheduling_notes:f.scheduling_notes},console.log("Approval payload with panels and schedule:",a)}const o=await Z(`/defense-requests/${t.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)});let n={};try{n=await o.json()}catch{n={error:"Invalid response from server."}}if(console.log("updateStatus response:",{ok:o.ok,status:o.status,data:n}),o.ok)n.request?(v(n.request),G({defense_chairperson:n.request.defense_chairperson||"",defense_panelist1:n.request.defense_panelist1||"",defense_panelist2:n.request.defense_panelist2||"",defense_panelist3:n.request.defense_panelist3||"",defense_panelist4:n.request.defense_panelist4||""}),P({scheduled_date:n.request.scheduled_date||"",scheduled_time:n.request.scheduled_time||"",scheduled_end_time:n.request.scheduled_end_time||"",defense_mode:n.request.defense_mode||"",defense_venue:n.request.defense_venue||"",scheduling_notes:n.request.scheduling_notes||""})):v(p=>({...p,coordinator_status:i,workflow_state:n.workflow_state||p.workflow_state,workflow_history:n.workflow_history||p.workflow_history,status:n.status||p.status})),A.success(`Coordinator status set to ${i}`);else if(o.status===422&&(n!=null&&n.conflicts)){const p=(n.conflicts||[]).map(N=>`${N.person} has a conflict (${N.time_range}) with ${N.student_name}`).join(`
`);s==="approve"&&window.confirm(`Scheduling conflicts detected:
`+p+`

Click OK to force approve and override, Cancel to abort.`)&&await we(),A.error((n==null?void 0:n.error)||`Failed to update status (${o.status})`)}else A.error((n==null?void 0:n.error)||`Failed to update status (${o.status})`)}catch(a){a instanceof Error&&a.message==="network"?A.error("Network error updating status. Please check your connection and try again."):A.error("Unknown error updating status.")}finally{C(!1),u({open:!1,action:null,sendEmail:!1})}}async function we(){if(t.id){C(!0);try{const s=o=>{if(!o)return"";const n=o.split(":");return n.length>=2?`${n[0]}:${n[1]}`:o},r={status:"Approved",send_email:c.sendEmail,force:!0,panels:{defense_chairperson:g.defense_chairperson,defense_panelist1:g.defense_panelist1,defense_panelist2:g.defense_panelist2,defense_panelist3:g.defense_panelist3,defense_panelist4:g.defense_panelist4},schedule:{scheduled_date:f.scheduled_date,scheduled_time:s(f.scheduled_time),scheduled_end_time:s(f.scheduled_end_time),defense_mode:f.defense_mode,defense_venue:f.defense_venue,scheduling_notes:f.scheduling_notes}},i=await Z(`/defense-requests/${t.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)}),a=await i.json().catch(()=>({}));i.ok?(a.request&&v(a.request),A.success("Coordinator status set to Approved (forced)")):A.error((a==null?void 0:a.error)||`Failed to force approve (${i.status})`)}catch{A.error("Network error while forcing approval")}finally{C(!1),u({open:!1,action:null,sendEmail:!1})}}}function ee(s){if(!s)return"—";try{return L(new Date(s),"PPP")}catch{return s}}function S(s){return s?/^https?:\/\//i.test(s)||s.startsWith("/storage/")?s:`/storage/${s.replace(/^\/?storage\//,"")}`:null}const se=[{label:"Adviser’s Endorsement",url:S(t.advisers_endorsement)},{label:"REC Endorsement",url:S(t.rec_endorsement)},{label:"Proof of Payment",url:S(t.proof_of_payment)},{label:"Manuscript",url:S(t.manuscript_proposal)},{label:"Similarity Index",url:S(t.similarity_index)},{label:"Avisee-Adviser File",url:S(t.avisee_adviser_attachment)},{label:"AI Detection Certificate",url:S(t.ai_detection_certificate)},{label:"Endorsement Form",url:S(t.endorsement_form)}];function Ce(s){var N;const r=s.event_type||s.action||s.status_change||s.status||s.type||"Event",i=s.description||s.details||s.note||s.notes||s.remarks||"",a=s.from_state||s.from||s.previous_state,o=s.to_state||s.to||s.new_state,n=s.created_at||s.timestamp||s.performed_at||s.date||"",p=s.user_name||((N=s.user)==null?void 0:N.name)||s.actor_name||s.actor||s.performed_by_name||s.performed_by||"";return{event:r,desc:i,from:a,to:o,created:n,userName:p}}const U="rounded-lg border p-5 space-y-3";function ke(s){var a,o,n,p;const r=((o=(a=s.first_name)==null?void 0:a.trim())==null?void 0:o[0])??"",i=((p=(n=s.last_name)==null?void 0:n.trim())==null?void 0:p[0])??"";return(r+i).toUpperCase()||"U"}function Se(s){if(!s)return"";try{return L(new Date(s),"PPpp")}catch{return s}}const Ae=[{key:"submitted",label:"Submitted",icon:e.jsx(as,{className:"h-5 w-5"})},{key:"adviser-approved",label:"Endorsed by Adviser",icon:e.jsx(ns,{className:"h-5 w-5"})},{key:"coordinator-approved",label:"Approved by Coordinator",icon:e.jsx(je,{className:"h-5 w-5"})},{key:"rejected",label:"Rejected by Coordinator",icon:e.jsx(xe,{className:"h-5 w-5"})},{key:"retrieved",label:"Retrieved (Set to Pending)",icon:e.jsx(he,{className:"h-5 w-5"})},{key:"panels-assigned",label:"Panels Assigned",icon:e.jsx(rs,{className:"h-5 w-5"})},{key:"scheduled",label:"Scheduled",icon:e.jsx(V,{className:"h-5 w-5"})}];function Pe(s){return s=(s||"").toLowerCase(),s.includes("submit")?"submitted":s.includes("adviser")?"adviser-approved":s.includes("rejected")?"rejected":s.includes("retrieved")?"retrieved":s.includes("coordinator")?"coordinator-approved":s.includes("panel")?"panels-assigned":s.includes("schedule")?"scheduled":""}function te(s){if(!s)return"";const[r,i]=s.split(":"),a=new Date;return a.setHours(Number(r),Number(i)),L(a,"hh:mm a")}const[ae,ne]=j.useState("details");return e.jsxs(oe,{breadcrumbs:_,children:[e.jsx(Fe,{position:"bottom-right",richColors:!0,closeButton:!0}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsx(ie,{title:t.thesis_title||`Defense Request #${t.id}`}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>le.visit("/defense-request"),className:"h-8 px-2",children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(me,{value:ae,onValueChange:s=>ne(s),children:e.jsxs(Ge,{className:"h-8",children:[e.jsxs(ue,{value:"details",className:"flex items-center gap-1 text-sm px-3",children:[e.jsx($,{className:"h-4 w-4"})," Details"]}),e.jsxs(ue,{value:"assign-schedule",className:"flex items-center gap-1 text-sm font-medium px-3",children:[e.jsx(I,{className:"h-4 w-4"}),"Assign & Schedule"]})]})})]}),k&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"approve",sendEmail:!1}),disabled:b||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(ts,{className:"h-4 w-4 mr-1 text-green-600"}),"Approve"]}),e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"reject",sendEmail:!1}),disabled:b||t.coordinator_status==="Rejected"||t.coordinator_status==="Approved"||t.workflow_state==="completed",children:[e.jsx(xe,{className:"h-4 w-4 mr-1 text-red-600"}),"Reject"]}),e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>u({open:!0,action:"retrieve",sendEmail:!1}),disabled:b||!["Rejected","Approved"].includes(t.coordinator_status||"")||t.workflow_state==="completed",children:[e.jsx(he,{className:"h-4 w-4 mr-1 text-blue-600"}),"Retrieve"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-5 mb-2",children:[e.jsx("div",{className:"w-full md:max-w-3xl mx-auto flex flex-col gap-5",children:e.jsxs(me,{value:ae,onValueChange:s=>ne(s),className:"w-full",children:[e.jsxs(fe,{value:"details",className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-1 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold",children:t.thesis_title}),e.jsx("div",{className:"text-xs text-muted-foreground font-medium mt-0.5",children:"Thesis Title"})]}),e.jsx("div",{className:"flex flex-col md:items-end gap-1",children:t.coordinator_status&&e.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${t.coordinator_status==="Approved"?"bg-green-100 text-green-600":t.coordinator_status==="Rejected"?"bg-red-100 text-red-600":t.coordinator_status==="Needs Signature"?"bg-blue-100 text-blue-600":t.coordinator_status==="Not Scheduled"?"bg-yellow-100 text-yellow-700":t.coordinator_status==="No Assigned Panelists"?"bg-orange-100 text-orange-600":"bg-gray-100 text-gray-600"}`,children:["Coordinator Status: ",t.coordinator_status]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Presenter"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Xe,{className:"h-8 w-8",children:e.jsx(Je,{className:"text-base font-bold bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-200",children:ke(t)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm leading-tight",children:[t.first_name," ",t.middle_name?`${t.middle_name} `:"",t.last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:t.school_id})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Program"}),e.jsx("div",{className:"font-medium text-sm",children:t.program})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Defense Type"}),e.jsx(de,{variant:"secondary",className:"text-xs font-medium",children:t.defense_type??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Scheduled Date"}),e.jsx("div",{className:"font-medium text-sm",children:ee(t.scheduled_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Time"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduled_time?`${te(t.scheduled_time)}${t.scheduled_end_time?" - "+te(t.scheduled_end_time):""}`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx("div",{className:"font-medium text-sm",children:t.defense_venue||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsx("div",{className:"font-medium text-sm",children:t.defense_mode?t.defense_mode==="face-to-face"?"Face-to-Face":"Online":"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx("div",{className:"font-medium text-sm",children:t.scheduling_notes||"—"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-5 space-y-3",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"})," Committee"]}),e.jsx(R,{}),(()=>{const s=(a,o)=>{const n=ds(h,a);return{displayName:(n==null?void 0:n.name)||a||"—",email:(n==null?void 0:n.email)||"",rawValue:a||"",role:o}},r=[{key:"adviser",info:s(t.defense_adviser,"Adviser")},{key:"defense_chairperson",info:s(g.defense_chairperson||t.defense_chairperson,"Panel Chair")},{key:"defense_panelist1",info:s(g.defense_panelist1||t.defense_panelist1,"Panel Member")},{key:"defense_panelist2",info:s(g.defense_panelist2||t.defense_panelist2,"Panel Member")},{key:"defense_panelist3",info:s(g.defense_panelist3||t.defense_panelist3,"Panel Member")},{key:"defense_panelist4",info:s(g.defense_panelist4||t.defense_panelist4,"Panel Member")}].map(a=>{const o=!!(a.info.rawValue||a.info.displayName&&a.info.displayName!=="—"),n=!!a.info.email,p=o?n?"Assigned":"Pending confirmation":"—",N=o?t.program_level?ls(X,t.program_level,t.defense_type,a.info.role):os(X,t.program,t.defense_type,a.info.role):null;return{name:a.info.displayName,email:a.info.email||"—",role:a.info.role,status:p,receivable:N}}),i=a=>typeof a=="number"?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(a):a??"—";return e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Qe,{children:[e.jsx(Ze,{children:e.jsxs(pe,{children:[e.jsx(T,{className:"min-w-[180px]",children:"Name"}),e.jsx(T,{className:"min-w-[220px]",children:"Email"}),e.jsx(T,{className:"min-w-[120px]",children:"Role"}),e.jsx(T,{className:"min-w-[120px]",children:"Status"}),e.jsx(T,{className:"min-w-[160px] text-right",children:"Receivable"})]})}),e.jsx(es,{children:r.map((a,o)=>e.jsxs(pe,{children:[e.jsx(E,{className:"font-medium",children:a.name}),e.jsx(E,{className:"text-xs text-muted-foreground",children:a.email||"—"}),e.jsx(E,{children:a.role}),e.jsx(E,{children:e.jsx(de,{variant:"secondary",className:a.status==="Assigned"?"bg-green-100 text-green-700":a.status==="Pending confirmation"?"bg-yellow-100 text-amber-700":"bg-amber-100 text-amber-700",children:a.status})}),e.jsx(E,{className:"text-right",children:i(a.receivable)})]},o))})]})})})()]}),e.jsxs("div",{className:U,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"})," Attachments"]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[se.filter(s=>!!s.url).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments."}),se.filter(s=>!!s.url).map(s=>{var r;return e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900 hover:bg-muted transition",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto truncate max-w-[180px]",children:(r=s.url)==null?void 0:r.split("/").pop()})]},s.label)}),t.reference_no&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-white dark:bg-zinc-900",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Reference No."}),e.jsx("span",{className:"ml-auto text-xs",children:t.reference_no})]})]})]})]}),e.jsxs(fe,{value:"assign-schedule",className:"space-y-5",children:[e.jsxs("div",{className:U,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"})," Panel Assignment"]}),e.jsx(R,{}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:[{label:"Chairperson",key:"defense_chairperson"},{label:"Panelist 1",key:"defense_panelist1"},{label:"Panelist 2",key:"defense_panelist2"},{label:"Panelist 3",key:"defense_panelist3"},{label:"Panelist 4",key:"defense_panelist4"}].map(({label:s,key:r})=>e.jsx(cs,{label:s,value:g[r],onChange:i=>G(a=>({...a,[r]:i})),options:h,disabled:!k||q,taken:ye},r))}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Changes to panel assignments are saved when you Approve the request."})}),K&&e.jsx("div",{className:"text-xs text-red-500 mt-2",children:K})]}),e.jsxs("div",{className:U,children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"})," Scheduling"]}),e.jsx(R,{}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Date"}),e.jsxs(_e,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:Ye("w-full justify-start text-left font-normal",!f.scheduled_date&&"text-muted-foreground"),disabled:!k,children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),f.scheduled_date?ee(f.scheduled_date):"Pick a date"]})}),e.jsx(be,{className:"w-auto p-0",align:"start",children:e.jsx(ze,{mode:"single",selected:f.scheduled_date?new Date(f.scheduled_date):void 0,onSelect:s=>{P(r=>({...r,scheduled_date:s?L(s,"yyyy-MM-dd"):""}))},initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Start Time"}),e.jsx(D,{type:"time",value:f.scheduled_time,onChange:s=>P(r=>({...r,scheduled_time:s.target.value})),disabled:!k})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"End Time"}),e.jsx(D,{type:"time",value:f.scheduled_end_time,onChange:s=>P(r=>({...r,scheduled_end_time:s.target.value})),disabled:!k})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Mode"}),e.jsxs(Be,{value:f.defense_mode,onValueChange:s=>P(r=>({...r,defense_mode:s})),disabled:!k,children:[e.jsx(Oe,{children:e.jsx(Ue,{placeholder:"Select mode"})}),e.jsxs(Ie,{children:[e.jsx(ce,{value:"face-to-face",children:"Face-to-Face"}),e.jsx(ce,{value:"online",children:"Online"})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Venue"}),e.jsx(D,{value:f.defense_venue,onChange:s=>P(r=>({...r,defense_venue:s.target.value})),disabled:!k})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Notes"}),e.jsx(D,{value:f.scheduling_notes,onChange:s=>P(r=>({...r,scheduling_notes:s.target.value})),disabled:!k})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Scheduling changes will be persisted when you Approve the request."})})]})]})]})}),e.jsx("div",{className:"w-full md:w-[340px] flex-shrink-0",children:e.jsxs("div",{className:"rounded-xl border p-5 bg-white dark:bg-zinc-900 sticky top-24 h-fit",children:[e.jsxs("h2",{className:"text-xs font-semibold mb-8 flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"})," Workflow Progress"]}),e.jsx("div",{className:"flex flex-col gap-0 relative",children:Array.isArray(t.workflow_history)&&t.workflow_history.length>0?t.workflow_history.map((s,r)=>{const{event:i,created:a,userName:o}=Ce(s),n=Pe(i),p=Ae.find(qe=>qe.key===n)||{label:i.charAt(0).toUpperCase()+i.slice(1),icon:e.jsx(V,{className:"h-5 w-5 text-gray-500"})},N=Array.isArray(t.workflow_history)&&r===t.workflow_history.length-1;return e.jsxs("div",{className:"flex items-start gap-3 relative",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-9 h-9 rounded-md flex items-center justify-center bg-gray-100 text-gray-500",children:p.icon}),!N&&e.jsx("div",{className:"h-8 border-l-2 border-dotted border-gray-300 dark:border-zinc-700 mx-auto"})]}),e.jsxs("div",{className:"pb-4",children:[e.jsx("div",{className:"font-semibold text-xs",children:p.label}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[o&&e.jsx("span",{children:o}),a&&e.jsxs("span",{children:[" ","· ",Se(a)]})]})]})]},r)}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No workflow history yet."})})]})})]}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["Last updated by:"," ",t.last_status_updated_by_name||t.last_status_updated_by||"—"," ",t.last_status_updated_at?`(${Ee(t.last_status_updated_at).format("YYYY-MM-DD [at] h:mm A")})`:""]})]}),e.jsx(Ve,{open:c.open,onOpenChange:s=>{s||u({open:!1,action:null,sendEmail:!1})},children:e.jsxs(He,{children:[e.jsx(We,{children:"Confirm Action"}),e.jsx(Ke,{children:c.action==="approve"?"Please review before approving.":c.action==="reject"?"Are you sure you want to reject this defense request?":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[e.jsxs("p",{children:["Set request to"," ",e.jsx("span",{className:"font-semibold",children:c.action==="approve"?"Approved":c.action==="reject"?"Rejected":"Pending"}),"?"]}),c.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(je,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving this defense request authorizes the use of your signature on the official defense documents."})]})]}),c.action==="approve"||c.action==="reject"?e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Would you like to send email notifications to all parties?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"ghost",className:"flex-1",onClick:()=>u({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(w,{variant:"outline",className:"flex-1",onClick:()=>{c.action&&O(c.action,!1)},disabled:b,children:"Skip Email"}),e.jsx(w,{className:"flex-1",onClick:()=>{c.action&&O(c.action,!0)},disabled:b,children:"Send Emails"})]})]}):e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(w,{variant:"ghost",onClick:()=>u({open:!1,action:null,sendEmail:!1}),children:"Cancel"}),e.jsx(w,{onClick:()=>c.action&&O(c.action,!1),disabled:b,children:"Confirm"})]})]})})]})}export{Ct as default};
