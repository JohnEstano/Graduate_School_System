import{r as a,j as t}from"./app-BDkuJsct.js";import{C as d,a as c,b as l,d as u,c as x,e as b}from"./card-BJFJPDio.js";import{C as A,a as S,b as R,c as D,d as _}from"./chart-7aubccfQ.js";import{R as E,a as j}from"./RadarChart-DvW10P3K.js";import{P as L,a as w}from"./PolarAngleAxis--DfQntO3.js";import"./utils-jAU0Cazi.js";import"./generateCategoricalChart-BOHwT1p9.js";import"./index-CoS1vLG5.js";import"./index-Chjiymov.js";const F={students:{label:"Students",color:"#e11d48"},capacity:{label:"Capacity",color:"hsl(var(--muted))"}};function B(){const[h,m]=a.useState([]),[v,g]=a.useState(!0),[p,C]=a.useState({totalAdvisers:0,totalStudents:0,avgRatio:0});return a.useEffect(()=>{fetch("/api/coordinator/advisers",{headers:{Accept:"application/json"}}).then(e=>{if(!e.ok)throw new Error("Failed to fetch");return e.json()}).then(e=>{const r=Array.isArray(e)?e:e.advisers??[],y=r.filter(s=>s.status==="active").map(s=>{const n=s.assigned_students_count||0,o=`${s.first_name} ${s.last_name}`.trim();return{adviser:o.length>15?o.substring(0,15)+"...":o,students:n,capacity:10}}).slice(0,6);m(y);const f=r.reduce((s,n)=>s+(n.assigned_students_count||0),0),i=r.filter(s=>s.status==="active").length,N=i>0?(f/i).toFixed(1):0;C({totalAdvisers:i,totalStudents:f,avgRatio:Number(N)})}).catch(e=>{console.error("Error fetching advisers:",e),m([])}).finally(()=>{g(!1)})},[]),v?t.jsxs(d,{children:[t.jsxs(c,{children:[t.jsx(l,{children:"Adviser-Student Distribution"}),t.jsx(u,{children:"Loading..."})]}),t.jsx(x,{className:"h-[300px] flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"Loading chart data..."})})]}):h.length===0?t.jsxs(d,{children:[t.jsxs(c,{children:[t.jsx(l,{children:"Adviser-Student Distribution"}),t.jsx(u,{children:"No data available"})]}),t.jsx(x,{className:"h-[300px] flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"No active advisers found"})})]}):t.jsxs(d,{className:"rounded-xl shadow-none border",children:[t.jsxs(c,{className:"items-center pb-4",children:[t.jsx(l,{children:"Adviser-Student Distribution"}),t.jsx(u,{children:"Student load per adviser vs ideal capacity"})]}),t.jsx(x,{className:"pb-0",children:t.jsx(A,{config:F,className:"mx-auto aspect-square max-h-[250px]",children:t.jsxs(E,{data:h,margin:{top:-40,bottom:-10},children:[t.jsx(S,{cursor:!1,content:t.jsx(R,{indicator:"line"})}),t.jsx(L,{dataKey:"adviser"}),t.jsx(w,{}),t.jsx(j,{dataKey:"students",fill:"var(--color-students)",fillOpacity:.6}),t.jsx(j,{dataKey:"capacity",fill:"var(--color-capacity)",fillOpacity:.3}),t.jsx(D,{className:"mt-8",content:t.jsx(_,{})})]})})}),t.jsx(b,{className:"flex-col gap-2 pt-4 text-sm",children:t.jsxs("div",{className:"flex items-center gap-2 font-medium leading-none",children:[p.totalStudents," students across ",p.totalAdvisers," advisers"]})})]})}export{B as CoordinatorAdviserStudentRatio};
