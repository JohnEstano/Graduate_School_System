import{r as o,j as e}from"./app-BDkuJsct.js";import{C as l,a as n,b as c,d,c as f,e as g}from"./card-BJFJPDio.js";import{C as k,a as w,b as A}from"./chart-7aubccfQ.js";import{B as S}from"./BarChart-AW9tJqMJ.js";import{Y as q,X as L}from"./YAxis-B7UrdJFR.js";import{B as E,C as N}from"./generateCategoricalChart-BOHwT1p9.js";import"./utils-jAU0Cazi.js";import"./index-CoS1vLG5.js";import"./index-Chjiymov.js";const R={count:{label:"Requests",color:"#e11d48"}},m=[{key:"submitted",label:"Submitted",color:"#94a3b8"},{key:"adviser-review",label:"Adviser Review",color:"#64748b"},{key:"adviser-approved",label:"Adviser Approved",color:"#3b82f6"},{key:"coordinator-review",label:"Coordinator Review",color:"#f59e0b"},{key:"coordinator-approved",label:"Coordinator Approved",color:"#10b981"},{key:"panels-assigned",label:"Panels Assigned",color:"#8b5cf6"},{key:"scheduled",label:"Scheduled",color:"#ec4899"},{key:"completed",label:"Completed",color:"#059669"}];function X(){const[i,u]=o.useState([]),[j,b]=o.useState(!0),[y,C]=o.useState(0);return o.useEffect(()=>{fetch("/defense-requests",{headers:{Accept:"application/json"}}).then(t=>{if(!t.ok)throw new Error("Failed to fetch");return t.json()}).then(t=>{const x=(Array.isArray(t)?t:t.defenseRequests??[]).filter(r=>{var s;return!["adviser-rejected","coordinator-rejected","cancelled"].includes((s=r.workflow_state)==null?void 0:s.toLowerCase())});C(x.length);const a={};m.forEach(r=>{a[r.key]=0}),x.forEach(r=>{var p;const s=((p=r.workflow_state)==null?void 0:p.toLowerCase())||"submitted";a[s]!==void 0&&a[s]++});const v=m.map(r=>({stage:r.label,count:a[r.key],fill:r.color})).filter(r=>r.count>0);u(v)}).catch(t=>{console.error("Error fetching defense requests:",t),u([])}).finally(()=>{b(!1)})},[]),j?e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(c,{children:"Workflow Status Pipeline"}),e.jsx(d,{children:"Loading..."})]}),e.jsx(f,{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading chart data..."})})]}):i.length===0?e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(c,{children:"Workflow Status Pipeline"}),e.jsx(d,{children:"No data available"})]}),e.jsx(f,{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"No active defense requests found"})})]}):e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(c,{children:"Workflow Status Pipeline"}),e.jsx(d,{children:"Defense requests by workflow stage"})]}),e.jsx(f,{children:e.jsx(k,{config:R,children:e.jsxs(S,{accessibilityLayer:!0,data:i,layout:"vertical",margin:{left:20},children:[e.jsx(q,{dataKey:"stage",type:"category",tickLine:!1,tickMargin:10,axisLine:!1,tickFormatter:t=>t}),e.jsx(L,{dataKey:"count",type:"number",hide:!0}),e.jsx(w,{cursor:!1,content:e.jsx(A,{hideLabel:!0})}),e.jsx(E,{dataKey:"count",radius:5,children:i.map((t,h)=>e.jsx(N,{fill:t.fill},`cell-${h}`))})]})})}),e.jsx(g,{className:"flex-col items-start gap-2 text-sm",children:e.jsxs("div",{className:"flex gap-2 font-medium leading-none",children:[y," active requests in the pipeline"]})})]})}export{X as WorkflowStatusFunnel};
