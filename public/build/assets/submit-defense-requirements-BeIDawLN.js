import{K as se,r as n,m as ae,j as e}from"./app-DW0Mt5c9.js";import{L as l}from"./label-Dk8neUpq.js";import{I as i}from"./input-Ch6RmxP_.js";import{B as o}from"./button-BZf0VdIO.js";import{S as m}from"./separator-4d5ucxHB.js";import{S as le}from"./Stepper-CkkTexZW.js";import{D as O,a as M,e as $,b as E,c as I}from"./dialog-D7L72BhV.js";import{A as ie,b as te,c as ne,d as re,e as de,f as ce,h as oe}from"./alert-dialog-CRrgAssw.js";import{P as p}from"./paperclip-Cbu-YW77.js";import{C as me}from"./check-C1Ca0PY3.js";import{C as xe}from"./circle-alert-CV2dla6l.js";import"./index-DHu7YzAG.js";import"./index-RzYQM1sh.js";import"./utils-jAU0Cazi.js";import"./index-DZZQifJx.js";import"./index-xrb8sl6P.js";import"./proxy-CMvBkXOB.js";import"./index-BMNAwHVU.js";import"./index-Bh88FqJG.js";import"./x-CW6T59GI.js";import"./createLucideIcon-S0dKkUVo.js";function Ee({onFinish:he,open:_,onOpenChange:j,acceptDefense:q=!0}){var C,w,A,F,R,T;const{props:g}=se(),r=((C=g==null?void 0:g.auth)==null?void 0:C.user)||{},t=Array.isArray(r.advisers)&&r.advisers.length>0?r.advisers[0]:null,y=n.useRef(null),b=n.useRef(null),P=n.useRef(null),D=n.useRef(null),S=n.useRef(null),{data:s,setData:u,post:z,processing:L,reset:B}=ae({first_name:r.first_name||"",middle_name:r.middle_name||"",last_name:r.last_name||"",school_id:r.school_id||"",program:r.program||"",thesis_title:"",adviser:t?`${t.first_name} ${t.middle_name?t.middle_name+" ":""}${t.last_name}`:"",adviser_id:t?t.id:null,status:"pending",defense_type:"",rec_endorsement:null,proof_of_payment:null,reference_no:"",manuscript_proposal:null,similarity_index:null,avisee_adviser_attachment:null,amount:""}),[ue,fe]=n.useState(!1),[d,v]=n.useState(0),[U,V]=n.useState(!1),[G,c]=n.useState(!1),[H,x]=n.useState("");function f(a){return h=>{var k;if((k=h.target.files)!=null&&k[0]){const N=h.target.files[0],Z=200*1024*1024,ee=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg","image/gif","image/webp"];if(N.size>Z){x(`File size too large. Maximum allowed size is 200MB. Your file is ${(N.size/(1024*1024)).toFixed(2)}MB.`),c(!0),h.target.value="";return}if(!ee.includes(N.type)){x("File type not allowed. Please upload PDF, Word documents, or images (JPEG, PNG)."),c(!0),h.target.value="";return}u(a,N)}}}function K(){z(route("defense-requirements.store"),{forceFormData:!0,onSuccess:()=>{window.location.reload()},onError:a=>{if(console.error("Submission failed:",a),a.message&&a.message.includes("POST Content-Length"))x("File upload failed: Files are too large. Please ensure each file is under 200MB and try again."),c(!0);else if(a.message&&a.message.includes("PostTooLargeException"))x("Upload size limit exceeded. Please reduce file sizes and try again."),c(!0);else{const h=Object.values(a).flat().join(`
`);x(`Submission failed:
${h}`),c(!0)}},onProgress:a=>{console.log("Upload progress:",a)}})}function Y(){return!(!s.defense_type||!s.thesis_title.trim()||!s.manuscript_proposal||!s.similarity_index||!s.proof_of_payment||!s.reference_no.trim()||!s.amount.trim()||s.defense_type==="Proposal"&&!s.avisee_adviser_attachment||(s.defense_type==="Prefinal"||s.defense_type==="Final")&&!s.rec_endorsement)}function J(){if(d===0){v(d+1);return}if(d===1){if(!Y()){x("Please fill in all required fields and upload all required documents before proceeding."),c(!0);return}v(d+1);return}d===2&&K()}function W(){d>0&&v(d-1)}function Q(a){j(a),a||(v(0),B(),V(!1))}const X=[{title:"Personal Information",content:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Student Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"First Name"}),e.jsx(i,{value:s.first_name,readOnly:!0,disabled:!0,placeholder:"First Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Middle Name"}),e.jsx(i,{value:s.middle_name,readOnly:!0,disabled:!0,placeholder:"Middle Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Last Name"}),e.jsx(i,{value:s.last_name,readOnly:!0,disabled:!0,placeholder:"Last Name",className:"h-8 text-sm"})]})]})]}),e.jsx(m,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"School ID"}),e.jsx(i,{value:s.school_id,readOnly:!0,disabled:!0,placeholder:"School ID",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Program"}),e.jsx(i,{value:s.program,readOnly:!0,disabled:!0,placeholder:"Program",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Adviser"}),e.jsx(i,{value:t?`${t.first_name} ${t.middle_name?t.middle_name+" ":""}${t.last_name}`:"No adviser registered",readOnly:!0,disabled:!0,placeholder:"Adviser",className:"h-8 text-sm"})]})]})]})},{title:"Defense Type & Thesis Information",content:e.jsxs("div",{className:"space-y-6 pb-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Defense Details"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[{value:"Proposal",label:"Proposal"},{value:"Prefinal",label:"Prefinal"},{value:"Final",label:"Final"}].map(a=>e.jsx("button",{type:"button",onClick:()=>u("defense_type",a.value),className:`rounded-md px-4 py-2 text-xs font-medium cursor-pointer border
                                        ${s.defense_type===a.value?"bg-rose-500 text-white border-rose-500":"bg-white text-zinc-700 border-zinc-200"}`,"aria-pressed":s.defense_type===a.value,children:a.label},a.value))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select the type of defense you are applying for."})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Thesis Information"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Thesis Title ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx(i,{value:s.thesis_title,onChange:a=>u("thesis_title",a.target.value),placeholder:"Thesis Title",className:"h-8 text-sm"})]})})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Document Uploads"}),e.jsxs("div",{className:"space-y-4",children:[(s.defense_type==="Prefinal"||s.defense_type==="Final")&&e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["REC Endorsement ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:s.rec_endorsement?s.rec_endorsement.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(o,{variant:"outline",type:"button",onClick:()=>{var a;return(a=P.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(p,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:P,className:"hidden",onChange:f("rec_endorsement")})]})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Manuscript ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:s.manuscript_proposal?s.manuscript_proposal.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(o,{variant:"outline",type:"button",onClick:()=>{var a;return(a=y.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(p,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:y,className:"hidden",onChange:f("manuscript_proposal")})]})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Similarity Index ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:s.similarity_index?s.similarity_index.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(o,{variant:"outline",type:"button",onClick:()=>{var a;return(a=b.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(p,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:b,className:"hidden",onChange:f("similarity_index")})]})]}),s.defense_type==="Proposal"&&e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs",children:["Avisee-Adviser Attachment ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:s.avisee_adviser_attachment?s.avisee_adviser_attachment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(o,{variant:"outline",type:"button",onClick:()=>{var a;return(a=S.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(p,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:S,className:"hidden",onChange:f("avisee_adviser_attachment")})]})]})]})]}),e.jsx(m,{className:"my-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Payment"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs mb-1",children:["Proof of Payment ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:s.proof_of_payment?s.proof_of_payment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(o,{variant:"outline",type:"button",onClick:()=>{var a;return(a=D.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(p,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:D,className:"hidden",onChange:f("proof_of_payment")})]})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs mb-1 flex items-center gap-1",children:["Amount ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-700",children:"₱"}),e.jsx(i,{type:"number",min:"0",step:"0.01",value:s.amount,onChange:a=>u("amount",a.target.value),placeholder:"Enter paid amount",className:"h-8 text-sm w-40"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please enter the accurate paid amount reflected on the uploaded receipt."})]}),e.jsxs("div",{children:[e.jsxs(l,{className:"text-xs mb-1",children:["Reference No. ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx(i,{value:s.reference_no,onChange:a=>u("reference_no",a.target.value),placeholder:"Reference No.",className:"h-8 text-sm"})]})]})]})]})},{title:"Review Submission",content:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"rounded-lg border border-rose-200 bg-rose-50 p-4 text-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",`${s.first_name} ${s.middle_name} ${s.last_name}`]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"School ID:"})," ",s.school_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Program:"})," ",s.program]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Adviser:"})," ",s.adviser]})]})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Defense Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Type of Defense:"})," ",s.defense_type]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Thesis Title:"})," ",s.thesis_title]})]})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Document Uploads"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[(s.defense_type==="Prefinal"||s.defense_type==="Final")&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"REC Endorsement:"})," ",((w=s.rec_endorsement)==null?void 0:w.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Manuscript:"})," ",((A=s.manuscript_proposal)==null?void 0:A.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Similarity Index:"})," ",((F=s.similarity_index)==null?void 0:F.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),s.defense_type==="Proposal"&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Avisee-Adviser Attachment:"})," ",((R=s.avisee_adviser_attachment)==null?void 0:R.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]})]})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Payment"}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Proof of Payment:"})," ",((T=s.proof_of_payment)==null?void 0:T.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reference No.:"})," ",s.reference_no]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"}),s.amount?e.jsxs("span",{children:["₱ ",parseFloat(s.amount).toLocaleString(void 0,{minimumFractionDigits:2})]}):e.jsx("span",{className:"text-muted-foreground",children:"—"})]})]})]})]})})}];return q?e.jsxs(O,{open:_,onOpenChange:Q,children:[e.jsxs(M,{className:"flex h-[95vh] w-full max-w-3xl flex-col",children:[e.jsxs($,{children:[e.jsx(E,{children:"Submit Defense Requirements"}),e.jsx(I,{children:"Fill up all necessary information"})]}),U?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center space-y-6 px-4",children:[e.jsx(me,{size:48,className:"text-rose-500"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Requirements Submitted!"}),e.jsx("p",{className:"text-center text-gray-600",children:"Your defense requirements have been saved successfully."}),e.jsx(o,{onClick:()=>j(!1),children:"Done"})]}):e.jsx("div",{className:"flex-1 overflow-auto px-2",children:e.jsx(le,{steps:X,currentStep:d,onNext:J,onPrev:W,loading:L,className:"h-full"})})]}),e.jsx(ie,{open:G,onOpenChange:c,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-amber-100",children:e.jsx(xe,{className:"h-5 w-5 text-amber-600"})}),e.jsx(re,{className:"text-lg",children:"Required Fields Missing"})]}),e.jsx(de,{className:"pt-3 text-base whitespace-pre-line",children:H})]}),e.jsx(ce,{children:e.jsx(oe,{className:"bg-rose-600 hover:bg-rose-700",children:"OK"})})]})})]}):e.jsx(O,{open:_,onOpenChange:j,children:e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(E,{children:"Defense Requirement Submission Closed"}),e.jsx(I,{children:"The coordinator has disabled defense requirement submissions. Please try again later or contact your coordinator."})]}),e.jsx(o,{onClick:()=>j(!1),children:"Close"})]})})}export{Ee as default};
