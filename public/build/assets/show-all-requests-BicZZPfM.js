import{j as e,r as a,L as be,S as ve}from"./app-DdPj2m7B.js";import{t as d,T as ye}from"./index-B2MlTwnV.js";import{B as i}from"./button-C4XkiM_B.js";import{C as W}from"./checkbox-DDzRYWAy.js";import{I as Ce}from"./input-DCrn1t-u.js";import Ne from"./table-defense-requests-BDr91uvO.js";import{D as B,a as E,b as F,c as L}from"./dialog-BeApitpu.js";import{C as we}from"./calendar-DKOUdBib.js";import{P as M,a as I,b as U}from"./popover-tBQRRq13.js";import{A as ke}from"./app-layout-CZ3kZ0t2.js";import{G as Se}from"./graduation-cap-BxuxjmnL.js";import{S as De}from"./search-gvHM0uxt.js";import{C as Q}from"./circle-plus-DNS-2CjW.js";import{C as qe}from"./calendar-BkrqGKNC.js";import{X as Y}from"./x-gfWO9KfB.js";import{C as ze}from"./circle-check-big-CKCqbWb4.js";import{C as Re}from"./circle-x-BzZWIzCj.js";import{C as Te}from"./circle-arrow-left-Bx1mKyRQ.js";import{i as _e,S as Ae}from"./isWithinInterval-BGjcImah.js";import{P as Pe}from"./printer-8ps6np5W.js";import{S as Z}from"./signature-HJa2c2uW.js";import{C as $e,a as Oe}from"./chevrons-right-BiGuqRdN.js";import{C as Be}from"./chevron-left-IcMAr9yn.js";import{C as Ee}from"./chevron-right-BZod6iQK.js";import{s as ee,f as se}from"./format-HX8DKPSU.js";import{e as Fe}from"./endOfDay-UBg8OSOW.js";import"./index-C0AcbnKJ.js";import"./index-DYEC1Owk.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-DxK34XW3.js";import"./index-ATT6OHxL.js";import"./index-DGKk-Zer.js";import"./index-DFD1OPps.js";import"./index-BdQOngYf.js";import"./check-BgnkF1LW.js";import"./createLucideIcon-B8qZ3ylK.js";import"./table-C8ztdzxp.js";import"./badge-ofr1GoIX.js";import"./clock-WdEz_qo4.js";import"./index-DDxX9UbU.js";import"./index-DRr-UIpQ.js";import"./en-US-BA9orzCf.js";import"./endOfWeek-QFyZPl43.js";import"./differenceInCalendarMonths-HUNRrXGm.js";import"./normalizeInterval-CdMCNNY-.js";import"./endOfMonth-CK_ShA5m.js";import"./isSameDay-DUlCFK42.js";import"./isSameMonth-CQd3m9St.js";import"./chevron-down-DEJUajdp.js";import"./floating-ui.react-dom-qFQCHW7g.js";import"./tooltip-YyHP33lU.js";import"./separator-DAbYQnLI.js";import"./dropdown-menu-sYZpN2tC.js";import"./index-MX9TSR8D.js";import"./avatar-Cz3zvE7t.js";import"./settings-CYIvZ_Tn.js";import"./users-Bi2Lh05r.js";import"./file-text-Dl_aF8u0.js";import"./dollar-sign-DEGfV_co.js";import"./send-ChQ392yu.js";import"./credit-card-BvkjxVWT.js";import"./tabs-BvzTftzm.js";import"./info-BWBV8Gn3.js";import"./sun-CPhm4DAg.js";function Le({page:l,totalPages:h,onPageChange:o}){return e.jsxs("div",{className:"flex justify-between items-center gap-2 px-4 py-4 bg-background sticky bottom-0 z-10",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Page ",l," of ",h]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{size:"lg",variant:"outline",disabled:l===1,onClick:()=>o(1),children:e.jsx($e,{className:"w-5 h-5"})}),e.jsx(i,{size:"lg",variant:"outline",disabled:l===1,onClick:()=>o(l-1),children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsx(i,{size:"lg",variant:"outline",disabled:l===h,onClick:()=>o(l+1),children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsx(i,{size:"lg",variant:"outline",disabled:l===h,onClick:()=>o(h),children:e.jsx(Oe,{className:"w-5 h-5"})})]})]})}function te({defenseRequests:l,onStatusChange:h}){const[o,b]=a.useState({open:!1,id:null,action:null});function N(){const s=document.querySelector('meta[name="csrf-token"]');return(s==null?void 0:s.content)||""}const D=s=>s.map(t=>({...t,date_of_defense:t.date_of_defense||t.scheduled_date||void 0,mode_defense:t.mode_defense||t.defense_mode||void 0})),[q,g]=a.useState(()=>l?D(l):[]);a.useEffect(()=>{l&&g(D(l))},[l]);const[v,X]=a.useState(""),[u,z]=a.useState([]),[f,R]=a.useState([]),[n,T]=a.useState(),[w,re]=a.useState(null),[_,J]=a.useState(1),[ie,ne]=a.useState({pending:[],rejected:[],approved:[]}),[Me,Ie]=a.useState({title:!0,presenter:!0,adviser:!0,submitted_at:!0,program:!0,date:!0,mode:!0,type:!0,priority:!0}),[ae,y]=a.useState(!1),[j,k]=a.useState(null),[le,A]=a.useState(!1),[x,K]=a.useState(!1),H=a.useCallback(async()=>{const s=d.loading("Fetching table data...");K(!0);try{const t=await fetch("/coordinator/defense-requests/all-defense-requests");if(t.ok){const r=await t.json();g(D(r)),d.success("Table data loaded!",{id:s})}else d.error("Failed to fetch defense requests",{id:s})}catch{d.error("Error fetching defense requests",{id:s})}finally{K(!1),setTimeout(()=>d.dismiss(s),1e3)}},[]);a.useEffect(()=>{H()},[H]);const P=a.useMemo(()=>{let s=q;if(v){const t=v.toLowerCase();s=s.filter(r=>`${r.first_name} ${r.last_name} ${r.thesis_title}`.toLowerCase().includes(t))}if(u.length&&(s=s.filter(t=>u.includes(t.status))),f.length&&(s=s.filter(t=>f.includes(t.defense_type))),n!=null&&n.from&&(n!=null&&n.to)){const t=ee(n.from),r=Fe(n.to);s=s.filter(m=>{if(!m.date_of_defense)return!0;const p=ee(new Date(m.date_of_defense));return _e(p,{start:t,end:r})})}return s},[v,u,f,q,n]),G=a.useMemo(()=>w?[...P].sort((s,t)=>{const r=s.date_of_defense?new Date(s.date_of_defense).getTime():0,m=t.date_of_defense?new Date(t.date_of_defense).getTime():0;return w==="asc"?r-m:m-r}):P,[P,w]),oe=Math.max(1,Math.ceil(G.length/10)),S=G.slice((_-1)*10,_*10),c=ie.all||[],C=s=>ne(t=>({...t,all:s})),V=c.length===S.length&&S.length>0,de=()=>C(V?[]:S.map(s=>s.id)),ce=s=>C(c.includes(s)?c.filter(t=>t!==s):[...c,s]),me=()=>re(s=>s==="asc"?"desc":s==="desc"?null:"asc"),pe=async s=>{try{const t=await fetch("/defense-requests/bulk-status",{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":N(),Accept:"application/json"},body:JSON.stringify({ids:c,status:s})}),r=await t.json();t.ok&&r.updated_ids?(g(m=>m.map(p=>r.updated_ids.includes(p.id)?{...p,status:r.status}:p)),C([]),d.success("Bulk updated")):d.error((r==null?void 0:r.error)||"Bulk update failed")}catch{d.error("Bulk update error")}},he=async()=>{try{const s=await fetch("/defense-requests/bulk-remove",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":N(),Accept:"application/json"},body:JSON.stringify({ids:c})}),t=await s.json();s.ok?(g(r=>r.filter(m=>!c.includes(m.id))),C([]),d.success("Deleted")):d.error((t==null?void 0:t.error)||"Delete failed")}catch{d.error("Delete error")}};function $(s){k(s),y(!0)}const ue=async()=>{if(!j||c.length===0){y(!1);return}let s="Pending";j==="approve"?s="Approved":j==="reject"?s="Rejected":j==="retrieve"&&(s="Pending"),await pe(s),y(!1),k(null),d.success(`Updated to ${s}`)},fe=async(s,t)=>{try{(await fetch(`/defense-requests/${s}/priority`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":N(),Accept:"application/json"},body:JSON.stringify({priority:t})})).ok?(g(m=>m.map(p=>p.id===s?{...p,priority:t}:p)),d.success("Priority updated")):d.error("Failed to update priority")}catch{d.error("Error updating priority")}};function xe(){const s=q.filter(r=>c.includes(r.id)),t=window.open("","","height=900,width=1200");t&&(t.document.write(`
      <html>
        <head>
          <title>Print Selected</title>
          <style>
            body{font-family:Arial;padding:32px}
            h1{font-size:18px;margin:0 0 16px}
            table{border-collapse:collapse;width:100%}
            th,td{border:1px solid #ccc;padding:6px 8px;font-size:12px;text-align:left}
          </style>
        </head>
        <body>
          <h1>Defense Requests</h1>
          <table>
            <thead><tr><th>ID</th><th>Title</th><th>Presenter</th><th>Type</th><th>Priority</th><th>Status</th></tr></thead>
            <tbody>
              ${s.map(r=>`<tr>
                <td>${r.id}</td>
                <td>${r.thesis_title}</td>
                <td>${r.first_name} ${r.last_name}</td>
                <td>${r.defense_type}</td>
                <td>${r.priority}</td>
                <td>${r.status}</td>
              </tr>`).join("")}
            </tbody>
          </table>
          <script>window.print()<\/script>
        </body>
      </html>
    `),t.document.close())}const je=a.useCallback(async(s,t)=>{try{(await fetch(`/defense-requests/${s}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":N(),Accept:"application/json"},body:JSON.stringify({status:t})})).ok?(g(m=>m.map(p=>p.id===s?{...p,status:t}:p)),h==null||h(s,t),d.success(`Request #${s} set to ${t}`)):d.error("Failed to update status")}catch{d.error("Error updating status")}},[h]);function O(s,t){b({open:!0,id:s,action:t})}async function ge(){if(!o.id||!o.action){b({open:!1,id:null,action:null});return}let s="Pending";o.action==="approve"?s="Approved":o.action==="reject"?s="Rejected":o.action==="retrieve"&&(s="Pending"),await je(o.id,s),b({open:!1,id:null,action:null})}return console.log("Initial defenseRequests prop:",l),e.jsxs(e.Fragment,{children:[e.jsx(be,{title:"Defense Requests"}),e.jsx(ye,{richColors:!0,position:"bottom-right"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-2 overflow-auto rounded-xl pt-5 pr-3 pl-3 relative",children:[e.jsxs("div",{className:"w-full bg-white dark:bg-zinc-900 border border-border rounded-lg overflow-hidden mb-2",children:[e.jsx("div",{className:"flex flex-row dark:bg-zinc-900 items-center justify-between w-full p-3 border-b bg-white",children:e.jsxs("div",{className:"flex dark:bg-zinc-900 items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-rose-100 dark:bg-rose-900 border border-rose-500",children:e.jsx(Se,{className:"h-5 w-5 text-rose-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"Defense Requests"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"This section shows all defense requests. Search, filter, and manage requests."})]})]})}),e.jsx("div",{className:"flex dark:bg-zinc-900 items-center justify-between gap-2 px-4 py-3 border-b bg-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{type:"text",startIcon:De,placeholder:"Search...",value:v,onChange:s=>{X(s.target.value),J(1)},className:"max-w-xs text-sm h-8",disabled:x}),e.jsxs(M,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Status",u.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:u.length>1?`${u.length} selected`:u[0]})]})}),e.jsxs(U,{className:"w-44 p-1",side:"bottom",align:"start",children:[["Pending","Approved","Rejected"].map(s=>e.jsxs("div",{onClick:()=>z(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s]),className:"flex items-center gap-2 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(W,{checked:u.includes(s)}),e.jsx("span",{className:"text-sm",children:s})]},s)),e.jsx(i,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>z([]),children:"Clear"})]})]}),e.jsxs(M,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Type",f.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:f.length>1?`${f.length} selected`:f[0]})]})}),e.jsxs(U,{className:"w-44 p-1",side:"bottom",align:"start",children:[["Proposal","Prefinal","Final"].map(s=>e.jsxs("div",{onClick:()=>R(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s]),className:"flex items-center gap-2 p-2 rounded hover:bg-muted cursor-pointer",children:[e.jsx(W,{checked:f.includes(s)}),e.jsx("span",{className:"text-sm",children:s})]},s)),e.jsx(i,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>R([]),children:"Clear"})]})]}),e.jsxs(M,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"h-8 px-3 rounded-md border-dashed text-xs flex items-center gap-1",children:[e.jsx(qe,{size:14}),"Date",(n==null?void 0:n.from)&&(n==null?void 0:n.to)&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs bg-muted",children:`${se(n.from,"MMM dd")} - ${se(n.to,"MMM dd")}`})]})}),e.jsxs(U,{className:"w-auto p-2",side:"bottom",align:"start",children:[e.jsx(we,{mode:"range",selected:n,onSelect:T}),e.jsx(i,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>T(void 0),children:"Clear Dates"})]})]}),(u.length>0||f.length>0||(n==null?void 0:n.from)||v.trim())&&e.jsxs(i,{variant:"ghost",size:"sm",className:"h-8 px-3 flex items-center gap-1",onClick:()=>{z([]),R([]),T(void 0),X("")},children:[e.jsx(Y,{size:14})," Reset"]})]})})]}),c.length>0&&e.jsxs("div",{className:"fixed left-1/2 z-30 -translate-x-1/2 bottom-4 md:bottom-6 flex items-center gap-1 bg-white border border-border shadow-lg rounded-lg px-4 py-1 text-xs animate-in fade-in slide-in-from-bottom-2 dark:bg-muted dark:text-muted-foreground dark:border-border",children:[e.jsxs("span",{className:"font-semibold min-w-[70px] text-center",children:[c.length," selected"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(i,{variant:"ghost",size:"icon",className:"px-2 py-1 h-7 w-auto text-xs flex items-center gap-1",onClick:()=>$("approve"),"aria-label":"Approve",disabled:x,children:[e.jsx(ze,{size:13,className:"text-green-500"}),e.jsx("span",{className:"hidden sm:inline",children:x?"Updating...":"Approve"})]}),e.jsxs(i,{variant:"ghost",size:"icon",className:"px-2 py-1 h-7 w-auto text-xs flex items-center gap-1",onClick:()=>$("reject"),"aria-label":"Reject",disabled:x,children:[e.jsx(Re,{size:13,className:"text-red-500"}),e.jsx("span",{className:"hidden sm:inline",children:x?"Updating...":"Reject"})]}),e.jsxs(i,{variant:"ghost",size:"icon",className:"px-2 py-1 h-7 w-auto text-xs flex items-center gap-1",onClick:()=>$("retrieve"),"aria-label":"Retrieve",disabled:x,children:[e.jsx(Te,{size:13,className:"text-blue-500"}),e.jsx("span",{className:"hidden sm:inline",children:x?"Updating...":"Retrieve"})]}),e.jsxs(i,{variant:"ghost",size:"icon",className:"px-2 py-1 h-7 w-auto text-xs flex items-center gap-1",onClick:()=>{},"aria-label":"Link",disabled:x,children:[e.jsx(Ae,{size:13,className:"text-blue-500"}),e.jsx("span",{className:"hidden sm:inline",children:"Link"})]}),e.jsxs(i,{variant:"ghost",size:"icon",className:"px-2 py-1 h-7 w-auto text-xs flex items-center gap-1",onClick:xe,"aria-label":"Print",disabled:x,children:[e.jsx(Pe,{size:13}),e.jsx("span",{className:"hidden sm:inline",children:"Print"})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"px-1 py-1 h-7 w-auto text-xs flex items-center",onClick:()=>C([]),"aria-label":"Clear selection",children:e.jsx(Y,{size:14})})]})]}),e.jsx("div",{className:"w-full flex-1 flex flex-col min-h-0 overflow-hidden",children:e.jsx(Ne,{paged:S,columns:{title:!0,presenter:!0,adviser:!0,program:!0,panelists:!0,scheduled:!0,status:!0},selected:c,toggleSelectOne:ce,headerChecked:V,toggleSelectAll:de,toggleSort:me,sortDir:w,onPriorityChange:fe,tabType:void 0,onViewDetails:s=>ve.visit(`/coordinator/defense-requests/${s}/details`),onRowApprove:s=>O(s,"approve"),onRowReject:s=>O(s,"reject"),onRowRetrieve:s=>O(s,"retrieve"),highlightMissingDateMode:!1,hideActions:!1,hideSelect:!1})}),e.jsx(Le,{page:_,totalPages:oe,onPageChange:J})]}),e.jsx(B,{open:o.open,onOpenChange:s=>{s||b({open:!1,id:null,action:null})},children:e.jsxs(E,{children:[e.jsx(F,{children:"Confirm Action"}),e.jsx(L,{children:o.action==="approve"?"Please review before approving.":"Apply this status change?"}),e.jsxs("div",{className:"mt-3 text-sm space-y-3",children:[o.id&&e.jsxs("p",{children:["Request #",o.id,": Set to"," ",e.jsx("span",{className:"font-semibold",children:o.action==="approve"?"Approved":o.action==="reject"?"Rejected":"Pending"}),"?"]}),o.action==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(Z,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving this defense request authorizes the use of your signature on the official defense documents."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(i,{variant:"ghost",onClick:()=>b({open:!1,id:null,action:null}),children:"Cancel"}),e.jsx(i,{onClick:ge,children:"Confirm"})]})]})}),e.jsx(B,{open:ae,onOpenChange:s=>{s||(y(!1),k(null))},children:e.jsxs(E,{children:[e.jsx(F,{children:"Status Update"}),e.jsx(L,{children:j==="approve"?"Review before bulk approval.":"Confirm the status change."}),e.jsxs("div",{className:"space-y-3 mt-2 text-sm",children:[e.jsxs("p",{children:["Update ",c.length," request",c.length!==1&&"s"," to"," ",e.jsx("span",{className:"font-semibold",children:j==="approve"?"Approved":j==="reject"?"Rejected":"Pending"}),"?"]}),j==="approve"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-md border bg-muted/40 p-5",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-4",children:e.jsx(Z,{className:"h-14 w-14 text-primary"})}),e.jsx("p",{className:"text-center text-sm leading-relaxed",children:"Approving these defense requests authorizes the use of your signature on their official defense documents."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"ghost",onClick:()=>{y(!1),k(null)},children:"Cancel"}),e.jsx(i,{onClick:ue,children:"Confirm"})]})]})]})}),e.jsx(B,{open:le,onOpenChange:A,children:e.jsxs(E,{children:[e.jsx(F,{children:"Delete Requests"}),e.jsx(L,{children:"This action cannot be undone."}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("p",{className:"text-sm",children:["Delete ",c.length," selected request(s)?"]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"ghost",onClick:()=>A(!1),children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:async()=>{await he(),A(!1)},children:"Delete"})]})]})]})})]})}function et(l){if(l.withLayout){const h=[{title:"Dashboard",href:"/dashboard"},{title:"Defense Requests",href:"/defense-request"}];return e.jsx(ke,{breadcrumbs:h,children:e.jsx(te,{...l})})}return e.jsx(te,{...l})}export{et as default};
