import{K as U,r,m as G,j as e,R as z}from"./app-c5ij2Uy8.js";import{L as t}from"./label-BNkzA3Iq.js";import{I as i}from"./input-CzpjdScL.js";import{B as v}from"./button-Bw6OnloJ.js";import{S as H}from"./Stepper-CGGLkoax.js";import{D as J,a as K,b as Q,c as W,d as V}from"./dialog-BwPQxLPS.js";import{P as b}from"./paperclip-BdB9cqmg.js";import{C as X}from"./check--NhZ1PHA.js";import"./index-DQWsGEEw.js";import"./index-C6aQ0K-7.js";import"./utils-jAU0Cazi.js";import"./index-DZZQifJx.js";import"./index-DMzRbVW9.js";import"./index-CQBUWWAm.js";import"./x-b-iKzdpp.js";import"./createLucideIcon-QXbACLHs.js";function Z({value:x,onChange:g}){const[N,o]=r.useState(!1),[n,u]=r.useState(x),[p,f]=r.useState([]),[j,a]=r.useState(!1),d=r.useRef(null);z.useEffect(()=>{u(x)},[x]),z.useEffect(()=>{if(n.length<4){f([]),o(!1);return}a(!0),fetch(`/api/faculty-search?q=${encodeURIComponent(n)}`).then(l=>l.json()).then(l=>{f(l),o(!0)}).catch(()=>f([])).finally(()=>a(!1))},[n]);function S(l){const c=l.target.value;u(c),g(c),c.length>=4?o(!0):o(!1)}function P(l){var m;const c=`${l.first_name} ${l.middle_name?l.middle_name+" ":""}${l.last_name}`;g(c),u(c),o(!1),(m=d.current)==null||m.blur()}function C(){setTimeout(()=>o(!1),100)}return e.jsxs("div",{style:{position:"relative"},children:[e.jsx(i,{ref:d,value:n,onChange:S,placeholder:"Your adviser's name",className:"h-8 text-sm",autoComplete:"off",onFocus:()=>{n.length>=4&&o(!0)},onBlur:C}),N&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-200 rounded shadow",style:{maxHeight:200,overflowY:"auto"},children:[j&&e.jsx("div",{className:"px-2 py-1 text-xs text-muted-foreground",children:"Searching..."}),!j&&p.length===0&&n.length>=4&&e.jsx("div",{className:"px-2 py-1 text-xs text-muted-foreground",children:"No faculty found."}),e.jsx("ul",{children:p.map(l=>{const c=`${l.first_name} ${l.middle_name?l.middle_name+" ":""}${l.last_name}`;return e.jsx("li",{className:"px-2 py-2 cursor-pointer hover:bg-rose-100 text-sm",onMouseDown:()=>P(l),children:c},l.id)})})]})]})}function pe({onFinish:x,open:g,onOpenChange:N}){var F,T,I,O,$;const{props:o}=U(),n=((F=o==null?void 0:o.auth)==null?void 0:F.user)||{},u=r.useRef(null),p=r.useRef(null),f=r.useRef(null),j=r.useRef(null),{data:a,setData:d,post:S,processing:P,reset:C}=G({first_name:n.first_name||"",middle_name:n.middle_name||"",last_name:n.last_name||"",school_id:n.school_id||"",program:n.program||"",thesis_title:"",adviser:"",status:"pending",defense_type:"",rec_endorsement:null,proof_of_payment:null,reference_no:"",manuscript_proposal:null,similarity_index:null}),[l,c]=r.useState(!1),[m,R]=r.useState(0),[E,D]=r.useState(!1);function y(s){return h=>{var k;if((k=h.target.files)!=null&&k[0]){const _=h.target.files[0],A=200*1024*1024,Y=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg"];if(_.size>A){alert(`File size too large. Maximum allowed size is 200MB. Your file is ${(_.size/(1024*1024)).toFixed(2)}MB.`),h.target.value="";return}if(!Y.includes(_.type)){alert("File type not allowed. Please upload PDF, Word documents, or images (JPEG, PNG)."),h.target.value="";return}d(s,_)}}}function M(){S(route("defense-requirements.store"),{forceFormData:!0,onSuccess:()=>{D(!0),x&&x()},onError:s=>{if(console.error("Submission failed:",s),s.message&&s.message.includes("POST Content-Length"))alert("File upload failed: Files are too large. Please ensure each file is under 200MB and try again.");else if(s.message&&s.message.includes("PostTooLargeException"))alert("Upload size limit exceeded. Please reduce file sizes and try again.");else{const h=Object.values(s).flat().join(`
`);alert(`Submission failed:
${h}`)}},onProgress:s=>{console.log("Upload progress:",s)}})}function q(){m<w.length-1?R(m+1):M()}function B(){m>0&&R(m-1)}function L(s){N(s),s||(R(0),C(),D(!1))}const w=[{title:"Personal Information",content:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"First Name"}),e.jsx(i,{value:a.first_name,readOnly:!0,disabled:!0,placeholder:"First Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Middle Name"}),e.jsx(i,{value:a.middle_name,readOnly:!0,disabled:!0,placeholder:"Middle Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Last Name"}),e.jsx(i,{value:a.last_name,readOnly:!0,disabled:!0,placeholder:"Last Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"School ID"}),e.jsx(i,{value:a.school_id,readOnly:!0,disabled:!0,placeholder:"School ID",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Program"}),e.jsx(i,{value:a.program,readOnly:!0,disabled:!0,placeholder:"Program",className:"h-8 text-sm"})]})]})},{title:"Defense Type & Thesis Information",content:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-xs mb-2 block",children:"Type of Defense"}),e.jsx("div",{className:"flex gap-2 mb-4",children:[{value:"Proposal",label:"Proposal"},{value:"Prefinal",label:"Prefinal"},{value:"Final",label:"Final"}].map(s=>e.jsx("button",{type:"button",onClick:()=>d("defense_type",s.value),className:`rounded-md px-4 py-2 text-xs font-medium cursor-pointer border
                                        ${a.defense_type===s.value?"bg-rose-500 text-white border-rose-500":"bg-white text-zinc-700 border-zinc-200"}`,"aria-pressed":a.defense_type===s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Thesis Title"}),e.jsx(i,{value:a.thesis_title,onChange:s=>d("thesis_title",s.target.value),placeholder:"Thesis Title",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Adviser"}),e.jsx(Z,{value:a.adviser,onChange:s=>d("adviser",s)})]})]})},{title:"Attachments",content:e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx(t,{className:"text-xs",children:"Reference No."}),e.jsx(i,{value:a.reference_no,onChange:s=>d("reference_no",s.target.value),placeholder:"Reference No.",className:"h-8 text-sm"}),e.jsx(t,{className:"text-xs",children:"REC Endorsement"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.rec_endorsement?a.rec_endorsement.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(v,{variant:"outline",type:"button",onClick:()=>{var s;return(s=f.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(b,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:f,className:"hidden",onChange:y("rec_endorsement")})]}),e.jsx(t,{className:"text-xs",children:"Proof of Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.proof_of_payment?a.proof_of_payment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(v,{variant:"outline",type:"button",onClick:()=>{var s;return(s=j.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(b,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:j,className:"hidden",onChange:y("proof_of_payment")})]}),e.jsx(t,{className:"text-xs",children:"Manuscript for Proposal"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.manuscript_proposal?a.manuscript_proposal.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(v,{variant:"outline",type:"button",onClick:()=>{var s;return(s=u.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(b,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:u,className:"hidden",onChange:y("manuscript_proposal")})]}),e.jsx(t,{className:"text-xs",children:"Similarity Index"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{readOnly:!0,value:a.similarity_index?a.similarity_index.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(v,{variant:"outline",type:"button",onClick:()=>{var s;return(s=p.current)==null?void 0:s.click()},className:"h-8 px-2 text-xs",children:[e.jsx(b,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:p,className:"hidden",onChange:y("similarity_index")})]})]})},{title:"Review Submission",content:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-lg border border-rose-200 bg-rose-50 p-4 text-sm",children:[e.jsx("div",{className:"mb-2 font-semibold",children:"Personal Info"}),e.jsxs("div",{children:["Name: ",`${a.first_name} ${a.middle_name} ${a.last_name}`]}),e.jsxs("div",{children:["School ID: ",a.school_id]}),e.jsxs("div",{children:["Program: ",a.program]}),e.jsxs("div",{children:["Type of Defense: ",a.defense_type]}),e.jsxs("div",{children:["Thesis Title: ",a.thesis_title]}),e.jsxs("div",{children:["Adviser: ",a.adviser]}),e.jsxs("div",{children:["Reference No.: ",a.reference_no]}),e.jsxs("div",{children:["Recommendation Endorsement: ",((T=a.rec_endorsement)==null?void 0:T.name)||"—"]}),e.jsxs("div",{children:["Proof of Payment: ",((I=a.proof_of_payment)==null?void 0:I.name)||"—"]}),e.jsxs("div",{children:["Manuscript Proposal: ",((O=a.manuscript_proposal)==null?void 0:O.name)||"—"]}),e.jsxs("div",{children:["Similarity Index: ",(($=a.similarity_index)==null?void 0:$.name)||"—"]})]})})}];return e.jsx(J,{open:g,onOpenChange:L,children:e.jsxs(K,{className:"flex h-[95vh] w-full max-w-3xl flex-col",children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Submit Defense Requirements"}),e.jsx(V,{children:"Fill up all necessary information"})]}),E?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center space-y-6 px-4",children:[e.jsx(X,{size:48,className:"text-rose-500"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Requirements Submitted!"}),e.jsx("p",{className:"text-center text-gray-600",children:"Your defense requirements have been saved successfully."}),e.jsx(v,{onClick:()=>N(!1),children:"Done"})]}):e.jsx("div",{className:"flex-1 overflow-auto px-2",children:e.jsx(H,{steps:w,currentStep:m,onNext:q,onPrev:B,loading:P,className:"h-full"})})]})})}export{pe as default};
