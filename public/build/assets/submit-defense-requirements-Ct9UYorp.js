import{K as ne,r as i,m as oe,j as e}from"./app-CQngmq00.js";import{L as t}from"./label-CbqPBzn6.js";import{I as l}from"./input-izsDzGd9.js";import{B as m}from"./button-Cw9tQIeO.js";import{S as x}from"./separator-CMC4qrzs.js";import{S as de}from"./Stepper-DLUcjs0b.js";import{D as z,a as I,e as B,b as K,c as U}from"./dialog-D-tH9FDm.js";import{A as ce,b as me,c as xe,d as he,e as ue,f as fe,h as pe}from"./alert-dialog-Bv4FR8BT.js";import{P as g}from"./paperclip-DYnyPUSo.js";import{C as je}from"./check-BEGkAg7k.js";import{C as ge}from"./circle-alert-qBFnhNFa.js";import"./index-DRp-GX9j.js";import"./index-CDDLQrUy.js";import"./utils-jAU0Cazi.js";import"./index-DZZQifJx.js";import"./index-ahz1tZ6M.js";import"./proxy-DVhXeFh8.js";import"./index-BSk2xfhC.js";import"./index-BZgaE142.js";import"./x-B3RMhnUQ.js";import"./createLucideIcon-pjYyoixj.js";function Ke({onFinish:ve,open:w,onOpenChange:v,acceptDefense:V=!0}){var O,k,L,E,$,q;const{props:P}=ne(),n=((O=P==null?void 0:P.auth)==null?void 0:O.user)||{},r=Array.isArray(n.advisers)&&n.advisers.length>0?n.advisers[0]:null,F=i.useRef(null),A=i.useRef(null),R=i.useRef(null),T=i.useRef(null),M=i.useRef(null),[N,G]=i.useState([]),{data:s,setData:h,post:H,processing:Y,reset:J}=oe({first_name:n.first_name||"",middle_name:n.middle_name||"",last_name:n.last_name||"",school_id:n.school_id||"",program:n.program||"",thesis_title:"",adviser:r?`${r.first_name} ${r.middle_name?r.middle_name+" ":""}${r.last_name}`:"",adviser_id:r?r.id:null,status:"pending",defense_type:"",rec_endorsement:null,proof_of_payment:null,reference_no:"",manuscript_proposal:null,similarity_index:null,avisee_adviser_attachment:null,amount:""}),[Ne,ye]=i.useState(!1),[o,y]=i.useState(0),[W,Q]=i.useState(!1),[X,c]=i.useState(!1),[Z,u]=i.useState("");i.useEffect(()=>{fetch("/dean/payment-rates/data").then(a=>a.json()).then(a=>{a.rates&&G(a.rates)}).catch(a=>console.error("Failed to fetch payment rates:",a))},[]),i.useEffect(()=>{if(!s.defense_type||!s.program||N.length===0){h("amount","");return}let a="Masteral";const d=s.program.toLowerCase().trim();["doctor","doctorate","doctoral","phd","ph.d","ph. d","dba","edd","ed.d","dsc","dpm","dpa"].some(f=>d.includes(f))?a="Doctorate":a="Masteral";const _=s.defense_type;console.log("Payment calculation:",{program:s.program,mappedLevel:a,defenseType:_,availableRates:N});const b=N.filter(f=>{const C=f.program_level===a,re=f.defense_type.toLowerCase()===_.toLowerCase();return C&&re});console.log("Matching rates:",b);const S=b.reduce((f,C)=>f+Number(C.amount),0);console.log("Total calculated amount:",S),h("amount",S>0?S.toFixed(2):"0.00")},[s.defense_type,s.program,N]);function p(a){return d=>{var D;if((D=d.target.files)!=null&&D[0]){const j=d.target.files[0],_=200*1024*1024,b=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg","image/gif","image/webp"];if(j.size>_){u(`File size too large. Maximum allowed size is 200MB. Your file is ${(j.size/(1024*1024)).toFixed(2)}MB.`),c(!0),d.target.value="";return}if(!b.includes(j.type)){u("File type not allowed. Please upload PDF, Word documents, or images (JPEG, PNG)."),c(!0),d.target.value="";return}h(a,j)}}}function ee(){H(route("defense-requirements.store"),{forceFormData:!0,onSuccess:()=>{window.location.reload()},onError:a=>{if(console.error("Submission failed:",a),a.message&&a.message.includes("POST Content-Length"))u("File upload failed: Files are too large. Please ensure each file is under 200MB and try again."),c(!0);else if(a.message&&a.message.includes("PostTooLargeException"))u("Upload size limit exceeded. Please reduce file sizes and try again."),c(!0);else{const d=Object.values(a).flat().join(`
`);u(`Submission failed:
${d}`),c(!0)}},onProgress:a=>{console.log("Upload progress:",a)}})}function se(){return!(!s.defense_type||!s.thesis_title.trim()||!s.manuscript_proposal||!s.similarity_index||!s.proof_of_payment||!s.reference_no.trim()||s.amount===""||s.amount===null||s.amount===void 0||s.defense_type==="Proposal"&&!s.avisee_adviser_attachment||(s.defense_type==="Prefinal"||s.defense_type==="Final")&&!s.rec_endorsement)}function ae(){if(o===0){y(o+1);return}if(o===1){if(!se()){u("Please fill in all required fields and upload all required documents before proceeding."),c(!0);return}y(o+1);return}o===2&&ee()}function te(){o>0&&y(o-1)}function le(a){v(a),a||(y(0),J(),Q(!1))}const ie=[{title:"Personal Information",content:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Student Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"First Name"}),e.jsx(l,{value:s.first_name,readOnly:!0,disabled:!0,placeholder:"First Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Middle Name"}),e.jsx(l,{value:s.middle_name,readOnly:!0,disabled:!0,placeholder:"Middle Name",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Last Name"}),e.jsx(l,{value:s.last_name,readOnly:!0,disabled:!0,placeholder:"Last Name",className:"h-8 text-sm"})]})]})]}),e.jsx(x,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"School ID"}),e.jsx(l,{value:s.school_id,readOnly:!0,disabled:!0,placeholder:"School ID",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Program"}),e.jsx(l,{value:s.program,readOnly:!0,disabled:!0,placeholder:"Program",className:"h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-xs",children:"Adviser"}),e.jsx(l,{value:r?`${r.first_name} ${r.middle_name?r.middle_name+" ":""}${r.last_name}`:"No adviser registered",readOnly:!0,disabled:!0,placeholder:"Adviser",className:"h-8 text-sm"})]})]})]})},{title:"Defense Type & Thesis Information",content:e.jsxs("div",{className:"space-y-6 pb-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Defense Details"}),e.jsx("div",{className:"flex gap-2 mb-2",children:[{value:"Proposal",label:"Proposal"},{value:"Prefinal",label:"Prefinal"},{value:"Final",label:"Final"}].map(a=>e.jsx("button",{type:"button",onClick:()=>h("defense_type",a.value),className:`rounded-md px-4 py-2 text-xs font-medium cursor-pointer border
                                        ${s.defense_type===a.value?"bg-rose-500 text-white border-rose-500":"bg-white text-zinc-700 border-zinc-200"}`,"aria-pressed":s.defense_type===a.value,children:a.label},a.value))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select the type of defense you are applying for."})]}),e.jsx(x,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Thesis Information"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs",children:["Thesis Title ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx(l,{value:s.thesis_title,onChange:a=>h("thesis_title",a.target.value),placeholder:"Thesis Title",className:"h-8 text-sm"})]})})]}),e.jsx(x,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Document Uploads"}),e.jsxs("p",{className:"text-xs text-gray-600 mb-3",children:["Please upload the required documents below. ",e.jsx("strong",{children:"PDF files only"})," are accepted. ",e.jsx("br",{})]}),e.jsxs("div",{className:"space-y-4",children:[(s.defense_type==="Prefinal"||s.defense_type==="Final")&&e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs",children:["REC Endorsement ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{readOnly:!0,value:s.rec_endorsement?s.rec_endorsement.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(m,{variant:"outline",type:"button",onClick:()=>{var a;return(a=R.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(g,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:R,className:"hidden",onChange:p("rec_endorsement")})]})]}),e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs",children:["Manuscript ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{readOnly:!0,value:s.manuscript_proposal?s.manuscript_proposal.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(m,{variant:"outline",type:"button",onClick:()=>{var a;return(a=F.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(g,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:F,className:"hidden",onChange:p("manuscript_proposal")})]})]}),e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs",children:["Similarity Form ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{readOnly:!0,value:s.similarity_index?s.similarity_index.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(m,{variant:"outline",type:"button",onClick:()=>{var a;return(a=A.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(g,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:A,className:"hidden",onChange:p("similarity_index")})]})]}),s.defense_type==="Proposal"&&e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs",children:["Avisee-Adviser Attachment ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{readOnly:!0,value:s.avisee_adviser_attachment?s.avisee_adviser_attachment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(m,{variant:"outline",type:"button",onClick:()=>{var a;return(a=M.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(g,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:M,className:"hidden",onChange:p("avisee_adviser_attachment")})]})]})]})]}),e.jsx(x,{className:"my-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Payment"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs mb-1",children:["Proof of Payment ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{readOnly:!0,value:s.proof_of_payment?s.proof_of_payment.name:"",placeholder:"No file chosen",className:"flex-1 h-8 text-sm"}),e.jsxs(m,{variant:"outline",type:"button",onClick:()=>{var a;return(a=T.current)==null?void 0:a.click()},className:"h-8 px-2 text-xs",children:[e.jsx(g,{className:"mr-1 h-4 w-4"}),"Choose File"]}),e.jsx("input",{type:"file",ref:T,className:"hidden",onChange:p("proof_of_payment")})]})]}),e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs mb-1 flex items-center gap-1",children:["Amount ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-700",children:"₱"}),e.jsx(l,{type:"text",value:s.amount?parseFloat(s.amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):s.defense_type?"0.00":"",readOnly:!0,disabled:!0,placeholder:s.defense_type?"Calculating...":"Select defense type first",className:"h-8 text-sm w-48 bg-gray-50"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please ensure that the submitted proof of payment matches the amount reflected above."})]}),e.jsxs("div",{children:[e.jsxs(t,{className:"text-xs mb-1",children:["Reference No. ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx(l,{value:s.reference_no,onChange:a=>h("reference_no",a.target.value),placeholder:"Reference No.",className:"h-8 text-sm"})]})]})]})]})},{title:"Review Submission",content:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"rounded-lg border border-rose-200 bg-rose-50 p-4 text-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",`${s.first_name} ${s.middle_name} ${s.last_name}`]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"School ID:"})," ",s.school_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Program:"})," ",s.program]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Adviser:"})," ",s.adviser]})]})]}),e.jsx(x,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Defense Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Type of Defense:"})," ",s.defense_type]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Thesis Title:"})," ",s.thesis_title]})]})]}),e.jsx(x,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Document Uploads"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1",children:[(s.defense_type==="Prefinal"||s.defense_type==="Final")&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"REC Endorsement:"})," ",((k=s.rec_endorsement)==null?void 0:k.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Manuscript:"})," ",((L=s.manuscript_proposal)==null?void 0:L.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Similarity Form:"})," ",((E=s.similarity_index)==null?void 0:E.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),s.defense_type==="Proposal"&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Avisee-Adviser Attachment:"})," ",(($=s.avisee_adviser_attachment)==null?void 0:$.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]})]})]}),e.jsx(x,{}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold text-rose-700",children:"Payment"}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Proof of Payment:"})," ",((q=s.proof_of_payment)==null?void 0:q.name)||e.jsx("span",{className:"text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reference No.:"})," ",s.reference_no]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"}),s.amount?e.jsxs("span",{children:["₱ ",parseFloat(s.amount).toLocaleString(void 0,{minimumFractionDigits:2})]}):e.jsx("span",{className:"text-muted-foreground",children:"—"})]})]})]})]})})}];return V?e.jsxs(z,{open:w,onOpenChange:le,children:[e.jsxs(I,{className:"flex h-[95vh] w-full max-w-3xl flex-col",children:[e.jsxs(B,{children:[e.jsx(K,{children:"Submit Defense Requirements"}),e.jsx(U,{children:"Fill up all necessary information"})]}),W?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center space-y-6 px-4",children:[e.jsx(je,{size:48,className:"text-rose-500"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Requirements Submitted!"}),e.jsx("p",{className:"text-center text-gray-600",children:"Your defense requirements have been saved successfully."}),e.jsx(m,{onClick:()=>v(!1),children:"Done"})]}):e.jsx("div",{className:"flex-1 overflow-auto px-2",children:e.jsx(de,{steps:ie,currentStep:o,onNext:ae,onPrev:te,loading:Y,className:"h-full"})})]}),e.jsx(ce,{open:X,onOpenChange:c,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-amber-100",children:e.jsx(ge,{className:"h-5 w-5 text-amber-600"})}),e.jsx(he,{className:"text-lg",children:"Required Fields Missing"})]}),e.jsx(ue,{className:"pt-3 text-base whitespace-pre-line",children:Z})]}),e.jsx(fe,{children:e.jsx(pe,{className:"bg-rose-600 hover:bg-rose-700",children:"OK"})})]})})]}):e.jsx(z,{open:w,onOpenChange:v,children:e.jsxs(I,{children:[e.jsxs(B,{children:[e.jsx(K,{children:"Defense Requirement Submission Closed"}),e.jsx(U,{children:"The coordinator has disabled defense requirement submissions. Please try again later or contact your coordinator."})]}),e.jsx(m,{onClick:()=>v(!1),children:"Close"})]})})}export{Ke as default};
