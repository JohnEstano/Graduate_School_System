import{r as x,j as s}from"./app-c5ij2Uy8.js";import{S as R}from"./skeleton-CGx7kAgr.js";import{c as f}from"./utils-jAU0Cazi.js";import{G as A}from"./graduation-cap-tQeZTHqc.js";import{C as I}from"./calendar-2wm08bbg.js";import{s as N,f as W}from"./format-C3S3_MiX.js";import{i as j}from"./isSameDay-BpBRZswP.js";import{p as v}from"./parseISO-Dx9MyA3S.js";import"./createLucideIcon-QXbACLHs.js";const L=["Coordinator","Administrative Assistant","Dean"];function $(l,d){const n=N(d,{weekStartsOn:0});return new Date(n.getFullYear(),n.getMonth(),n.getDate()+l)}function D(l){if(!l)return"";const[d,n]=l.split(":").map(c=>parseInt(c,10)),m=new Date(2020,0,1,d,n,0);return W(m,"h:mm a")}function K(l){const{weekDays:d,selectedDay:n,setSelectedDay:m,approvedDefenses:c,loading:S=!1,referenceDate:p,studentId:u,userRole:_,canManage:E}=l,[b,z]=x.useState([]),[C,w]=x.useState(!1);x.useEffect(()=>{const t=N(p,{weekStartsOn:0}),r=new Date(t);r.setDate(r.getDate()+6);const o=`?from=${encodeURIComponent(t.toISOString())}&to=${encodeURIComponent(r.toISOString())}`;w(!0),fetch("/api/calendar/events"+o).then(e=>e.json()).then(e=>{z(e.filter(a=>a.origin==="event"))}).catch(()=>{}).finally(()=>w(!1))},[p]);const g=$(n,p),y=x.useMemo(()=>{const t=c.filter(e=>e.status==="Approved"&&e.date_of_defense).filter(e=>j(v(e.date_of_defense),g)).map(e=>({id:"def-"+e.id,kind:"defense",title:e.thesis_title||"Defense",start:e.start_time||null,end:e.end_time||null,color:"#059669",raw:e,owner:u&&e.submitted_by===u})),r=b.filter(e=>{const a=v(e.start);return j(a,g)}).map(e=>{const[a,i]=e.start.split(" "),h=e.end?e.end.split(" ")[1]:void 0;return{id:e.id,kind:"event",title:e.title||"Event",start:e.allDay?null:(i==null?void 0:i.slice(0,5))||null,end:e.allDay?null:(h==null?void 0:h.slice(0,5))||null,color:e.color||"#2563eb",raw:e,owner:!1}});return[...t,...r].sort((e,a)=>e.start===a.start?e.title.localeCompare(a.title):e.start===null?-1:a.start===null?1:e.start.localeCompare(a.start))},[c,b,g,u]),k=S||C,O=E||L.includes(_||"");return s.jsxs("div",{className:"w-full md:w-[380px] border rounded-xl p-5 bg-white dark:bg-zinc-900 flex flex-col min-h-[260px]",children:[s.jsx("div",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"This Week's Schedules"}),s.jsx("div",{className:"flex flex-nowrap gap-2 mb-3",children:d.map(t=>s.jsx("button",{className:f("px-2.5 py-1 rounded-full text-xs font-semibold transition cursor-pointer whitespace-nowrap",n===t.value?"bg-rose-500 text-white":"bg-gray-100 dark:bg-zinc-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-zinc-700"),onClick:()=>m(t.value),disabled:k,children:t.label},t.value))}),s.jsx("div",{className:"flex flex-col gap-2",children:k?s.jsx("div",{children:[...Array(4)].map((t,r)=>s.jsx(R,{className:"h-7 w-full mb-2 bg-gray-100 dark:bg-zinc-800"},r))}):y.length===0?s.jsx("div",{className:"flex items-center justify-center h-24",children:s.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"No schedules."})}):y.map(t=>{const r=t.kind==="defense",o=t.start?D(t.start):t.start===null?"All Day":"",e=t.end?D(t.end):"",a=o&&e?`${o} – ${e}`:o,i=r?"Defense":"Event";return s.jsxs("div",{className:f("group flex items-center gap-2 px-2 py-2 rounded border max-w-full text-xs",r?"border-emerald-500/60 bg-emerald-50 dark:bg-emerald-900/20":"border-gray-300 bg-gray-50 dark:border-zinc-700 dark:bg-zinc-800/60"),style:{minWidth:0},title:t.title,children:[r?s.jsx(A,{className:f("flex-shrink-0",t.owner?"text-emerald-600":"text-emerald-500"),size:18}):s.jsx(I,{className:"text-gray-500 dark:text-gray-400 flex-shrink-0",size:18}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-semibold truncate max-w-[200px] text-gray-800 dark:text-gray-200",children:t.title}),s.jsx("span",{className:f("px-1.5 py-[1px] rounded-full text-[9px] font-bold tracking-wide shrink-0",r?"bg-emerald-500 text-white":"bg-gray-400 text-white dark:bg-zinc-600"),children:i}),t.owner&&s.jsx("span",{className:"px-1 py-[1px] rounded-full text-[9px] font-semibold bg-rose-500 text-white shrink-0",children:"You"})]}),a&&s.jsx("div",{className:"text-[10px] text-gray-600 dark:text-gray-400 truncate",children:a}),r&&O&&t.raw.defense_type&&s.jsxs("div",{className:"text-[10px] text-gray-500 dark:text-gray-500 truncate italic",children:[t.raw.defense_type,t.raw.defense_mode?` • ${t.raw.defense_mode}`:""]})]})]},t.id)})})]})}export{K as default};
