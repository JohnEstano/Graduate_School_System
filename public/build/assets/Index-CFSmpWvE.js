import{K as S,r as n,j as e,L as A}from"./app-BDkuJsct.js";import{A as M}from"./app-layout-Cr_DtTkJ.js";import{B as l}from"./button-DggClj9M.js";import B from"./display-applications-B6YtH8Ks.js";import z from"./compre-exam-form-C8KVcR3I.js";import{D as R,a as I,d as L,b as P,c as X,e as $}from"./dialog-DeUj0iLU.js";import{B as w}from"./badge-BJdX7_A9.js";import{G as T}from"./graduation-cap-Cszrlop1.js";import{c as y}from"./createLucideIcon-CEmaZ7tj.js";import{R as q}from"./refresh-ccw-CK5sEEwl.js";import{I as F}from"./info-DwFda8kE.js";import"./index-B_a1aFVM.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./input-BmPXXlp0.js";import"./index-CWqpdCTP.js";import"./index-BhbofC_p.js";import"./index-D-bfryUZ.js";import"./x-CtfT_1vN.js";import"./tooltip-CWM4FSMS.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./separator-DaKqQg6m.js";import"./index-LRezjsDo.js";import"./chevron-right-BpKiIXqV.js";import"./dropdown-menu-B7sOazTG.js";import"./index-DMsjTEK4.js";import"./index-BdhkuEJx.js";import"./index-BKBXBDOv.js";import"./index-QFmRa-KD.js";import"./check-BUlQxyEc.js";import"./avatar-DpsgA3Kf.js";import"./settings-BITCJcnj.js";import"./users-BTr8E8QO.js";import"./file-text-rxgzo2tt.js";import"./dollar-sign-CSALIIUa.js";import"./send-9CEFXyiZ.js";import"./credit-card-CM3Zlvhr.js";import"./tabs-BOuSS6lC.js";import"./circle-check-big-CKfkcUFR.js";import"./sun-B3PIUh1_.js";import"./chevron-down-DMxaecxw.js";import"./book-open-D0xLe0hN.js";import"./hourglass-BE6hGw0v.js";import"./circle-x-DUEw59KP.js";import"./badge-check-CeCr6JRP.js";import"./formatDistanceToNow-nFmhZNS9.js";import"./constructNow-DDgVKswu.js";import"./format-Cze4Gw5q.js";import"./differenceInCalendarMonths-BlVIDW-K.js";import"./endOfDay-Ci94Ylrd.js";import"./endOfMonth-DvPI_8Ds.js";import"./heading-small-DO1H52cq.js";import"./label-MiJboLk1.js";import"./Stepper-CN-_nE1p.js";import"./popover-CxnVWzfd.js";import"./calendar-BhsmegxW.js";import"./endOfWeek-BqBOMalL.js";import"./normalizeInterval-6lUcOLZ2.js";import"./isSameDay-DsAL-Hdb.js";import"./isSameMonth-C-hFGgGu.js";import"./calendar-CI-DWPmu.js";import"./plus-kO5msmqZ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]],G=y("CalendarX",K);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],V=y("ShieldAlert",H);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],U=y("ShieldCheck",Y),W=[{title:"Dashboard",href:"/dashboard"},{title:"Comprehensive Exam",href:"/comprehensive-exam"}];function rt(){var v;const{props:_}=S(),{application:t}=_,[E,d]=n.useState(!1),[s,u]=n.useState({examOpen:null,gradesComplete:null,documentsComplete:null,noOutstandingBalance:null,loading:!0,error:null}),[O,m]=n.useState(!1),[N,k]=n.useState(0);async function x(){var o;u(a=>({...a,loading:!0,error:null}));try{const a=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),g=await fetch("/api/comprehensive-exam/eligibility",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":a||""}});if(!g.ok)throw new Error(`API error: ${g.status}`);const f=(await g.json()).requirements||[],b=f.find(r=>r.name==="Complete documents submitted"),j=f.find(r=>r.name==="Complete grades (registrar verified)"),C=f.find(r=>r.name==="No outstanding tuition balance"),p={examOpen:!0,gradesComplete:(j==null?void 0:j.completed)??null,documentsComplete:(b==null?void 0:b.completed)??null,noOutstandingBalance:(C==null?void 0:C.completed)??null,loading:!1,error:null};u(p),p.gradesComplete===null&&p.documentsComplete===null&&p.noOutstandingBalance===null?N<5&&(console.log(`Data still loading, will retry in 3 seconds (attempt ${N+1}/5)`),setTimeout(()=>{k(r=>r+1),x()},3e3)):k(0)}catch(a){console.error("=== API ERROR ===",a),u({examOpen:null,gradesComplete:null,documentsComplete:null,noOutstandingBalance:null,loading:!1,error:a instanceof Error?a.message:"API call failed"})}}n.useEffect(()=>{x()},[]);const i=n.useMemo(()=>!!(s.examOpen&&s.gradesComplete&&s.documentsComplete&&s.noOutstandingBalance),[s]),h=s.examOpen===!1,c=t?((v=t.final_approval_status)==null?void 0:v.toLowerCase())==="pending":!1,D=n.useMemo(()=>[{label:"Exam window is open",ok:s.examOpen},{label:"Complete grades (registrar verified)",ok:s.gradesComplete},{label:"Complete documents submitted",ok:s.documentsComplete},{label:"No outstanding tuition balance",ok:s.noOutstandingBalance}],[s]);return e.jsxs(M,{breadcrumbs:W,children:[e.jsx(A,{title:"Comprehensive Exam"}),e.jsx("div",{className:"flex flex-col px-7 pt-5 pb-5 w-full",children:e.jsxs("div",{className:"w-full bg-white border border-zinc-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"flex flex-row items-center justify-between w-full p-3 border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-full bg-rose-500/10 border border-rose-500",children:e.jsx(T,{className:"h-5 w-5 text-rose-400"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-base font-semibold",children:"Comprehensive Exam"}),e.jsx("p",{className:"block text-xs text-muted-foreground",children:"Submit and track your comprehensive exam application."}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx(w,{variant:i?"secondary":"outline",className:h?"border-rose-300 text-rose-700 bg-rose-50":i?"border-green-300 text-green-700 bg-green-50":"",children:h?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),"Closed"]}):i?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),"Eligible"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3.5 w-3.5"}),"Not eligible"]})}),e.jsxs(l,{size:"sm",variant:"outline",className:"h-7 px-2 text-xs",onClick:x,disabled:s.loading,children:[e.jsx(q,{className:`h-3.5 w-3.5 mr-1 ${s.loading?"animate-spin":""}`}),"Refresh"]}),e.jsxs(l,{size:"sm",variant:"ghost",className:"h-7 px-2 text-xs",onClick:()=>m(!0),children:[e.jsx(F,{className:"h-3.5 w-3.5 mr-1"}),"Details"]})]})]})]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(l,{className:"bg-rose-500 text-sm px-5 rounded-md",onClick:()=>d(!0),disabled:!i||!!t&&c,title:h?"Exam is closed":i?c?"Application pending":"Submit application":"You are not eligible yet",children:"Submit application"}),e.jsx(z,{open:E,onOpenChange:d}),e.jsx("div",{children:t?e.jsx(B,{application:{id:t.application_id,first_name:t.first_name,middle_initial:t.middle_name?t.middle_name[0]:null,last_name:t.last_name,program:t.program,school_year:t.school_year,office_address:t.office_address??null,mobile_no:t.contact_number??null,telephone_no:t.telephone_number??null,email:t.email,status:t.final_approval_status||"Pending",subjects:t.subjects,created_at:t.created_at??null}}):e.jsx("div",{className:"p-6 text-center text-sm text-muted-foreground",children:"No application submitted yet."})})]}),e.jsx(R,{open:O,onOpenChange:m,children:e.jsxs(I,{className:"sm:max-w-md",children:[e.jsxs(L,{children:[e.jsx(P,{children:"Comprehensive Exam Eligibility"}),e.jsx(X,{children:"You must meet all the requirements below before you can submit an application."})]}),e.jsx("div",{className:"space-y-2",children:D.map((o,a)=>e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsx("span",{className:"text-sm",children:o.label}),e.jsx(w,{variant:"outline",className:o.ok===!0?"border-green-300 text-green-700 bg-green-50":o.ok===!1?"border-rose-300 text-rose-700 bg-rose-50":"text-zinc-600",children:o.ok===!0?"OK":o.ok===!1?"Missing":"Unknown"})]},a))}),e.jsxs($,{className:"mt-2",children:[e.jsx(l,{variant:"outline",onClick:()=>m(!1),children:"Close"}),e.jsx(l,{onClick:()=>{m(!1),i&&!c&&d(!0)},disabled:!i||c,children:"Apply Now"})]})]})})]})})]})}export{rt as default};
