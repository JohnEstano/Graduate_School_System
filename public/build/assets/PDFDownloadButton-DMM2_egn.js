const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-SrjXImBB.js","assets/app-BDkuJsct.js","assets/app-NLFSu90G.css","assets/typeof-QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{r as R,j as P,_}from"./app-BDkuJsct.js";import{B as L}from"./button-DggClj9M.js";import{D as S}from"./download-DGArilmi.js";import"./index-B_a1aFVM.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-CEmaZ7tj.js";function O({record:t,onClick:h,useServerSide:y=!0}){const[f,s]=R.useState(!1),v=y?async()=>{try{s(!0);const a=await fetch(`/payments/${t.id}/download-pdf`,{method:"GET",headers:{Accept:"application/pdf"}});if(!a.ok)throw new Error("Download failed");const d=await a.blob(),o=window.URL.createObjectURL(d),n=document.createElement("a");n.href=o,n.download=`${(t==null?void 0:t.name)||(t==null?void 0:t.id)||"honorarium"}_honorarium.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)}catch(a){console.error("PDF download failed:",a),alert("Failed to download PDF. Please try again.")}finally{s(!1)}}:async()=>{try{s(!0);const a=(await _(async()=>{const{default:e}=await import("./html2canvas.esm-CBrSDip1.js");return{default:e}},[])).default,{jsPDF:d}=await _(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-SrjXImBB.js");return{jsPDF:e}},__vite__mapDeps([0,1,2,3])),o=document.getElementById("honorarium-details");if(!o){alert("Honorarium container not found!");return}const n=o.querySelectorAll("img"),x=Array.from(n).map(async e=>{try{const l=document.createElement("canvas"),D=l.getContext("2d");if(l.width=e.naturalWidth||e.width,l.height=e.naturalHeight||e.height,D){D.drawImage(e,0,0);const E=l.toDataURL("image/png");e.setAttribute("src",E)}}catch(l){console.warn("Failed to convert image:",l)}});await Promise.all(x),await new Promise(e=>setTimeout(e,100));const m=await a(o,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,imageTimeout:0}),g=m.toDataURL("image/png",1),i=new d("p","mm","a4"),b=i.internal.pageSize.getWidth(),p=i.internal.pageSize.getHeight(),c=b,r=m.height*c/m.width;i.addImage(g,"PNG",0,0,c,r,"","FAST");let u=r-p,w=0;for(;u>0;)w=u-r,i.addPage(),i.addImage(g,"PNG",0,w,c,r,"","FAST"),u-=p;i.save(`${(t==null?void 0:t.name)||(t==null?void 0:t.id)||"honorarium"}_honorarium.pdf`)}catch(a){console.error("PDF generation failed:",a),alert("Failed to generate PDF. Please try again.")}finally{s(!1)}},F=a=>{a.stopPropagation(),h&&h(a),a.defaultPrevented||v()};return P.jsxs(L,{variant:"outline",className:"rounded-md px-3 py-2 h-auto text-xs flex items-center gap-1",disabled:f,onClick:F,children:[P.jsx(S,{size:16}),f?"Generating PDF...":"Download PDF"]})}export{O as default};
