import{r as i,j as e,L as yt}from"./app-c5ij2Uy8.js";import{A as wt}from"./app-layout-CoKXZjt7.js";import{B as k}from"./button-Bw6OnloJ.js";import{B as jt}from"./badge-B7RMVcXi.js";import{c as b}from"./utils-jAU0Cazi.js";import{S as ze,a as Fe,b as Ue,c as Ye,d as Be}from"./select-CdAxdG97.js";import{D as Nt,f as vt,a as Mt,b as St,c as Et,e as Ct}from"./dialog-BwPQxLPS.js";import{L as F}from"./label-BNkzA3Iq.js";import{T as We}from"./textarea-BcT2cLoB.js";import{C as Dt}from"./checkbox-CWSffrSs.js";import{r as _t}from"./index-DQWsGEEw.js";import{G as oe}from"./graduation-cap-tQeZTHqc.js";import{C as kt}from"./calendar-2wm08bbg.js";import{X as Tt}from"./x-b-iKzdpp.js";import{C as At}from"./chevron-left-bO_x8oOH.js";import{C as Ot}from"./chevron-right-Ck80R1L5.js";import{P as It}from"./printer-D3edrfgz.js";import{T as Lt}from"./trash-2-rjtEU3ND.js";import{f as h,s as Ve}from"./format-C3S3_MiX.js";import{s as Ce,i as Ge}from"./isSameMonth-cQo4_rH8.js";import{e as De}from"./endOfMonth-CYiy1H1z.js";import{e as Rt,a as R}from"./endOfWeek-KFoFvLmK.js";import{p as U}from"./parseISO-Dx9MyA3S.js";import{i as _e}from"./isToday-Dy9Okhcb.js";import{i as qe}from"./isSameDay-BpBRZswP.js";import"./index-C6aQ0K-7.js";import"./index-DZZQifJx.js";import"./input-CzpjdScL.js";import"./index-DMzRbVW9.js";import"./index-CQBUWWAm.js";import"./tooltip-83sBEdgp.js";import"./floating-ui.react-dom-Dei2gU0X.js";import"./createLucideIcon-QXbACLHs.js";import"./separator-D3p5J1Rh.js";import"./index-B09PGLNS.js";import"./dropdown-menu-BwXzysW_.js";import"./index-CV-6as2J.js";import"./index-bpbdPemA.js";import"./index-k7YYal9B.js";import"./settings-DxBpoil_.js";import"./chevrons-up-down-D9rV0uwe.js";import"./file-text-DKQ02F9u.js";import"./users-pq8v5pDb.js";import"./credit-card-Dc2ElWmq.js";import"./circle-check-big-REqj7tp6.js";import"./info-DAOKqyYD.js";import"./index-Dy381sfG.js";import"./chevron-down-DGQt6VpT.js";import"./check--NhZ1PHA.js";import"./constructNow-bMnG1Fhl.js";const Je=d=>d.toString().padStart(2,"0"),Pt=[{title:"Dashboard",href:"/dashboard"},{title:"Schedules",href:"/schedule"}],Ke=["January","February","March","April","May","June","July","August","September","October","November","December"],$t=new Date().getFullYear(),Ht=Array.from({length:9},(d,u)=>$t-4+u),P=0,ie=24,zt=30,C=(ie-P)*60,D=44,Ft="bg-emerald-300/90 hover:bg-emerald-300 text-emerald-900 ring-1 ring-emerald-500/40 shadow-sm transition-colors",Xe="bg-emerald-400/90 hover:bg-emerald-400 text-emerald-950 ring-1 ring-emerald-600/40 shadow-sm transition-colors";function Ut(){const d=[];for(let u=P;u<ie;u++)for(let m=0;m<60;m+=zt){const w=(u-P)*60+m,S=h(new Date(2020,1,1,u,m,0),"h:mm a");d.push({label:S,minutes:w,isHour:m===0})}return d}const V=Ut();function G(d){if(!d)return 0;const[u,m]=d.split(":").map(w=>parseInt(w,10));return(u-P)*60+m}function le(d){if(!d)return"";const[u,m]=d.split(":"),w=new Date(2020,0,1,Number(u||0),Number(m||0),0);return h(w,"h:mm a")}function Qe(d){if(!d.length)return d;const u=[...d].sort((v,N)=>(v.start||"").localeCompare(N.start||"")||(v.end||"").localeCompare(N.end||""));let m=[],w=0;const S=()=>{if(!m.length)return;const v=w+1;m.forEach(N=>{const E=100/v;N.ev.__layout={leftPct:N.col*E,widthPct:E-1.5,top:0,height:0}}),m=[],w=0};for(const v of u){const N=G(v.start),E=v.end?G(v.end):N+30,x=Math.max(N+5,E);m=m.filter(j=>j.end>N);const _=new Set(m.map(j=>j.col));let g=0;for(;_.has(g);)g++;m.push({ev:v,start:N,end:x,col:g}),w=Math.max(w,g)}return S(),u}function ke(d){if(!d)return"#064e3b";const u=d.replace("#","");if(u.length!==6)return"#064e3b";const m=parseInt(u.slice(0,2),16)/255,w=parseInt(u.slice(2,4),16)/255,S=parseInt(u.slice(4,6),16)/255;return .2126*Math.pow(m,2.2)+.7152*Math.pow(w,2.2)+.0722*Math.pow(S,2.2)>.55?"#1f2937":"#ffffff"}function Yt(d){const u=d.replace("#","").match(/^([0-9a-fA-F]{6})$/);if(!u)return{r:37,g:99,b:235};const m=u[1];return{r:parseInt(m.slice(0,2),16),g:parseInt(m.slice(2,4),16),b:parseInt(m.slice(4,6),16)}}function Bt(d){const u=(d.defense?"#059669":d.color||"#2563eb").toLowerCase();function m(g,j){const M=g.replace("#",""),$=parseInt(M,16);let Z=($>>16)+j,Y=($>>8&255)+j,T=($&255)+j;return Z=Math.max(0,Math.min(255,Z)),Y=Math.max(0,Math.min(255,Y)),T=Math.max(0,Math.min(255,T)),"#"+((1<<24)+(Z<<16)+(Y<<8)+T).toString(16).slice(1)}const w=m(u,-30),{r:S,g:v,b:N}=Yt(u),E=(.299*S+.587*v+.114*N)/255,x=E>.55?"#1f2937":"#ffffff",_=E>.55?"#111827":"rgba(255,255,255,0.85)";return{base:u,border:w,text:x,subText:_}}const Oe=0,et=52,Te=Oe+et,Ae="backdrop-blur supports-[backdrop-filter]:bg-white/85 bg-white/70 dark:bg-neutral-900/75 shadow-sm";function Ze(){const d=document.querySelector('meta[name="csrf-token"]');return(d==null?void 0:d.content)||""}function Us({canManage:d,userRole:u}){const[m,w]=i.useState([]),[S,v]=i.useState([]),[N,E]=i.useState([]),[x,_]=i.useState(new Date),[g,j]=i.useState(new Date),[M,$]=i.useState("week"),[Z,Y]=i.useState(!1),[T,q]=i.useState(!1),[de,ee]=i.useState(!1),[J,ce]=i.useState(""),[A,Ie]=i.useState(h(new Date,"yyyy-MM-dd")),[te,me]=i.useState("08:00"),[se,ue]=i.useState("09:00"),[O,he]=i.useState(!1),[pe,fe]=i.useState(""),[Le,H]=i.useState(null),[xe,ge]=i.useState("#10b981"),tt=["#10b981","#0ea5e9","#6366f1","#f59e0b","#ef4444","#d946ef","#14b8a6","#6d28d9"],[be]=i.useState(""),[Wt,st]=i.useState(new Date);i.useEffect(()=>{const t=setInterval(()=>st(new Date),6e4);return()=>clearInterval(t)},[]);const ye=i.useRef(null),we=i.useRef(null),[K,Re]=i.useState({v:!1,y:0}),[X,Pe]=i.useState({v:!1,y:0}),nt=t=>{if(!ye.current)return;const s=ye.current.getBoundingClientRect(),l=Math.min(Math.max(0,t.clientY-s.top),s.height);Re({v:!0,y:l})},rt=()=>Re({v:!1,y:0}),at=t=>{if(!we.current)return;const s=we.current.getBoundingClientRect(),l=Math.min(Math.max(0,t.clientY-s.top),s.height);Pe({v:!0,y:l})},ot=()=>Pe({v:!1,y:0});i.useEffect(()=>{Y(!0),fetch("/defense-requests/calendar").then(t=>t.json()).then(t=>w(t||[])).finally(()=>Y(!1))},[]),i.useEffect(()=>{const t=Ce(x),s=De(x),l=`?from=${encodeURIComponent(t.toISOString())}&to=${encodeURIComponent(s.toISOString())}`;fetch("/api/calendar/events"+l).then(a=>a.json()).then(a=>{const c=r=>new Date(r.replace(" ","T")),n=a.filter(r=>r.origin==="event").map(r=>{const o=c(r.start),f=r.end?c(r.end):null;return{id:r.id,title:r.title||"Event",date:h(o,"yyyy-MM-dd"),start:h(o,"HH:mm"),end:f?h(f,"HH:mm"):void 0,raw:{id:Number((r.id||"").replace("ev-",""))||0,thesis_title:r.title,date_of_defense:h(o,"yyyy-MM-dd"),start_time:h(o,"HH:mm"),end_time:f?h(f,"HH:mm"):void 0,defense_type:void 0,defense_mode:void 0,defense_venue:void 0,program:void 0,student_name:void 0},color:r.color||"#2563eb",defense:!1,description:r.description??r.desc??r.details??r.detail??r.note??r.notes??""}});E(n)}).catch(()=>{})},[x]),i.useEffect(()=>{const t=m.map(s=>({id:"def-"+s.id,title:s.thesis_title||"Thesis Defense",date:s.date_of_defense,start:s.start_time?s.start_time.slice(0,5):void 0,end:s.end_time?s.end_time.slice(0,5):void 0,raw:s,defense:!0}));v([...t,...N])},[m,N]);const je=i.useMemo(()=>{if(!be.trim())return S;const t=be.toLowerCase();return S.filter(s=>s.title.toLowerCase().includes(t)||(s.raw.student_name||"").toLowerCase().includes(t)||(s.raw.program||"").toLowerCase().includes(t)||(s.raw.defense_type||"").toLowerCase().includes(t))},[S,be]),lt=i.useMemo(()=>{const t=Ve(Ce(x),{weekStartsOn:0}),s=Rt(De(x),{weekStartsOn:0}),l=[];let a=t;for(;a<=s;){const c=[];for(let n=0;n<7;n++)c.push(a),a=R(a,1);l.push(c)}return l},[x]),B=i.useMemo(()=>{const t={};return je.forEach(s=>{var l;(t[l=s.date]||(t[l]=[])).push(s)}),Object.values(t).forEach(s=>s.sort((l,a)=>(l.start||"23:59:59").localeCompare(a.start||"23:59:59"))),t},[je]),Ne=g?h(g,"yyyy-MM-dd"):"";i.useMemo(()=>Ne?B[Ne]||[]:[],[B,Ne]);const ne=i.useMemo(()=>{const s=Ve(g||new Date,{weekStartsOn:0});return Array.from({length:7},(l,a)=>R(s,a))},[g]),it=i.useMemo(()=>{const t={};return ne.forEach(s=>{const l=h(s,"yyyy-MM-dd");t[l]=(B[l]||[]).map(a=>({...a})),Qe(t[l])}),t},[ne,B]),dt=()=>{M==="month"?_(R(Ce(x),-1)):j(M==="week"?t=>R(t||new Date,-7):t=>R(t||new Date,-1))},ct=()=>{M==="month"?_(R(De(x),1)):j(M==="week"?t=>R(t||new Date,7):t=>R(t||new Date,1))},mt=()=>{const t=new Date;_(t),j(t)};i.useEffect(()=>{M==="month"&&g&&!Ge(g,x)&&j(x)},[M,x,g]);function re(t,s=28){return t.length>s?t.slice(0,s)+"…":t}const ut=()=>{const t=lt,s=120;return e.jsxs("div",{className:"w-full border border-t-0 bg-white flex flex-col rounded-b-md rounded-t-none",children:[e.jsx("div",{className:b("grid border-b sticky z-40",Ae),style:{gridTemplateColumns:"repeat(7, 1fr)",top:Te},children:["SUN","MON","TUE","WED","THU","FRI","SAT"].map(l=>e.jsx("div",{className:"h-12 border-r last:border-r-0 flex items-center justify-center text-[10px] font-semibold uppercase tracking-wide",children:l},l))}),e.jsx("div",{className:"grid grid-cols-7",children:t.map(l=>l.map(a=>{const c=h(a,"yyyy-MM-dd"),n=B[c]||[],r=!Ge(a,x),o=_e(a),f=g&&qe(a,g);return e.jsxs("div",{onClick:()=>{j(a),$("day")},className:b("relative p-1 border-r border-b last:[&:nth-last-child(-n+7)]:border-b-0 cursor-pointer overflow-hidden transition-colors focus:outline-none focus-visible:outline-none",r?"bg-muted/20 text-muted-foreground":"bg-white","hover:bg-accent/40"),style:{minHeight:s},children:[e.jsxs("div",{className:"flex items-start justify-between mb-0.5",children:[e.jsx("span",{className:b("w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-semibold select-none",o&&"bg-primary text-white shadow",!o&&f&&"bg-primary/80 text-white",!o&&!f&&"text-muted-foreground"),children:h(a,"d")}),n.length>3&&e.jsxs("span",{className:"text-[10px] text-muted-foreground mt-0.5",children:["+",n.length-3]})]}),e.jsx("div",{className:"space-y-0.5",children:n.slice(0,3).map(y=>e.jsxs("div",{className:b("px-1 py-0.5 rounded text-[10px] font-medium truncate flex items-center gap-1",y.defense?Xe:"ring-1 ring-emerald-500/30"),style:y.defense?void 0:{backgroundColor:y.color||"#6ee7b7",color:ke(y.color)},title:y.title,children:[y.defense&&e.jsx(oe,{className:"h-3 w-3"}),re(y.title,26)]},y.id))})]},c)}))})]})},ht=()=>{const s=V.length*D;let l=null;if(K.v){const a=Math.min(C,Math.max(0,K.y/s*C)),c=Math.round(a),n=P+Math.floor(c/60),r=c%60,o=(n+11)%12+1,f=n>=12?"PM":"AM";l=`${o}:${Je(r)} ${f}`}return e.jsxs("div",{className:"w-full border border-t-0 bg-white flex flex-col overflow-visible rounded-b-md rounded-t-none",children:[e.jsxs("div",{className:b("grid border-b sticky z-40",Ae),style:{gridTemplateColumns:"90px repeat(7, 1fr)",top:Te},children:[e.jsx("div",{className:"h-12 border-r flex items-center justify-center text-[10px] font-semibold uppercase tracking-wide text-muted-foreground",children:"TIME"}),ne.map(a=>{const c=g&&qe(a,g),n=_e(a);return e.jsxs("div",{className:b("h-12 border-r flex flex-col items-center justify-center gap-0.5 text-xs font-medium",c&&!n&&"bg-primary/5",n&&"text-primary font-semibold"),children:[e.jsx("span",{className:"uppercase tracking-wide text-[10px]",children:h(a,"EEE")}),e.jsx("span",{className:b("w-7 h-7 rounded-full flex items-center justify-center text-[12px] font-semibold",n&&"bg-primary text-white shadow",!n&&c&&"bg-primary/80 text-white"),children:h(a,"d")})]},a.toISOString())})]}),e.jsxs("div",{ref:ye,className:"relative",style:{minHeight:s},onMouseMove:nt,onMouseLeave:rt,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 border-r bg-white z-20",style:{width:90},children:V.map(a=>e.jsx("div",{className:"relative flex items-center justify-end pr-3",style:{height:D},children:e.jsx("span",{className:b("select-none text-[10px]",a.isHour?"font-semibold text-muted-foreground":"text-muted-foreground/50"),children:a.label.replace(":00","")})},a.minutes))}),e.jsxs("div",{className:"absolute top-0 bottom-0 right-0 grid",style:{left:90,gridTemplateColumns:"repeat(7, 1fr)"},children:[ne.map(a=>{const c=h(a,"yyyy-MM-dd"),n=it[c]||[];return e.jsxs("div",{className:b("relative border-r",_e(a)&&"bg-primary/5"),children:[Array.from({length:ie-P},(r,o)=>o%2===1?e.jsx("div",{className:"absolute inset-x-0 bg-muted/15",style:{top:o*2*D,height:D*2}},"stripe-"+o):null),V.map((r,o)=>e.jsx("div",{className:b("absolute left-0 right-0 border-b",r.isHour?"border-muted-foreground/40":"border-muted/40"),style:{top:o*D}},r.minutes)),n.map(r=>{const o=Math.max(0,G(r.start)),f=Math.min(C,r.end?G(r.end):o+60),y=o/C*100,I=Math.max(5,f-o)/C*100,L=r.__layout;return e.jsxs("div",{className:b("absolute rounded-md text-[11px] flex flex-col overflow-hidden cursor-pointer",r.defense?Ft:"ring-1 ring-emerald-500/40 shadow-sm","hover:ring-2"),style:{top:`calc(${y}% )`,height:`calc(${I}% )`,left:`calc(${(L==null?void 0:L.leftPct)??0}% + 4px)`,width:`calc(${(L==null?void 0:L.widthPct)??100}% - 8px)`,backgroundColor:r.defense?void 0:r.color||"#34d399",color:r.defense?void 0:ke(r.color)},title:r.title,onClick:bt=>{bt.stopPropagation(),d&&!r.defense?Q(r):(j(U(r.date)),Me(r),$("day"))},children:[e.jsxs("div",{className:"px-1 pt-1 flex items-start gap-1",children:[r.defense&&e.jsx(oe,{className:"h-3.5 w-3.5 shrink-0 text-emerald-900/80"}),e.jsx("span",{className:"font-semibold leading-tight truncate",children:re(r.title,56)})]}),e.jsxs("div",{className:"px-1 pb-1 font-medium",children:[r.start&&le(r.start),r.end&&" – "+le(r.end)]}),r.raw.student_name&&r.defense&&e.jsx("div",{className:"px-1 pb-1 truncate text-emerald-950/90 text-[10px]",children:re(r.raw.student_name,40)})]},r.id)})]},"week-col-"+c)}),K.v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pointer-events-none absolute left-0 right-0 h-px bg-black/60 z-40",style:{top:K.y}}),l&&e.jsx("div",{className:"pointer-events-none absolute z-50 -translate-y-1/2 px-1.5 py-0.5 bg-black text-white rounded text-[10px] font-medium shadow",style:{top:K.y,left:4},children:l})]})]})]})]})},pt=()=>{const t=g||new Date,s=h(t,"yyyy-MM-dd"),l=Qe((B[s]||[]).map(n=>({...n}))),a=V.length*D;let c=null;if(X.v){const n=Math.min(C,Math.max(0,X.y/a*C)),r=Math.round(n),o=P+Math.floor(r/60),f=r%60,y=(o+11)%12+1,W=o>=12?"PM":"AM";c=`${y}:${Je(f)} ${W}`}return e.jsxs("div",{className:"w-full border border-t-0 bg-white flex flex-col rounded-b-md rounded-t-none",children:[e.jsxs("div",{className:b("sticky flex items-center justify-between px-6 py-4 border-b z-40",Ae),style:{top:Te},children:[e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsx("div",{className:"flex flex-col leading-none",children:e.jsx("span",{className:"text-4xl font-bold tracking-tight",children:h(t,"d")})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-lg font-semibold",children:h(t,"MMMM")}),e.jsx("span",{className:"text-sm text-muted-foreground",children:h(t,"EEEE, yyyy")})]})]}),e.jsx(jt,{variant:"secondary",className:"text-[11px] px-3 py-1",children:"Approved Defenses"})]}),e.jsx("div",{ref:we,className:"relative",onMouseMove:at,onMouseLeave:ot,children:e.jsxs("div",{className:"relative",style:{minHeight:a},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[90px] border-r bg-white z-20",children:V.map(n=>e.jsx("div",{className:"relative flex items-center justify-end pr-3",style:{height:D},children:e.jsx("span",{className:b("text-[11px] select-none",n.isHour?"font-semibold text-muted-foreground":"text-muted-foreground/50"),children:n.label.replace(":00","")})},n.minutes))}),e.jsxs("div",{className:"absolute left-[90px] right-0 top-0 bottom-0",children:[Array.from({length:ie-P},(n,r)=>r%2===1?e.jsx("div",{className:"absolute inset-x-0 bg-muted/15",style:{top:r*2*D,height:D*2}},"stripe-"+r):null),V.map((n,r)=>e.jsx("div",{className:b("absolute left-0 right-0 border-b",n.isHour?"border-muted-foreground/40":"border-muted/40"),style:{top:r*D}},n.minutes)),l.map(n=>{const r=Math.max(0,G(n.start)),o=Math.min(C,n.end?G(n.end):r+60),f=r/C*100,W=Math.max(5,o-r)/C*100,I=n.__layout;return e.jsxs("div",{className:b("absolute rounded-md p-2 text-[11px] flex flex-col overflow-hidden cursor-pointer",n.defense?Xe:"ring-1 ring-emerald-500/40 hover:ring-2"),style:{top:`calc(${f}% )`,height:`calc(${W}% )`,left:`calc(${(I==null?void 0:I.leftPct)??0}% )`,width:`calc(${(I==null?void 0:I.widthPct)??100}% )`,backgroundColor:n.defense?void 0:n.color||"#34d399",color:n.defense?void 0:ke(n.color)},title:n.title,onClick:L=>{L.stopPropagation(),d&&!n.defense?Q(n):Me(n)},children:[e.jsxs("div",{className:"flex items-start gap-1",children:[n.defense&&e.jsx(oe,{className:"h-4 w-4 shrink-0"}),e.jsx("div",{className:"font-semibold leading-tight truncate text-[12px]",children:re(n.title,80)})]}),e.jsxs("div",{className:"text-[11px] font-medium mt-0.5",children:[n.start&&le(n.start),n.end&&" – "+le(n.end),n.raw.defense_venue&&n.defense&&" • "+n.raw.defense_venue]}),n.defense&&n.raw.student_name&&e.jsxs("div",{className:"text-[10px] truncate",children:[n.raw.student_name," ",n.raw.program&&e.jsxs("span",{className:"opacity-70",children:["(",n.raw.program,")"]})]}),n.defense&&n.raw.defense_type&&e.jsx("div",{className:"text-[10px] mt-0.5 uppercase tracking-wide",children:n.raw.defense_type})]},n.id)}),X.v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pointer-events-none absolute left-0 right-0 h-px bg-black/60 z-40",style:{top:X.y}}),c&&e.jsx("div",{className:"pointer-events-none absolute z-50 -translate-y-1/2 px-1.5 py-0.5 bg-black text-white rounded text-[10px] font-medium shadow",style:{top:X.y,left:4},children:c})]})]})]})})]})},ve=i.useRef(null),[p,Q]=i.useState(null),[z,Me]=i.useState(null),[$e,Se]=i.useState(!1),[ft,He]=i.useState(!1),ae=!!p,Ee=()=>{!z||$e||(Se(!0),setTimeout(()=>{Me(null),Se(!1)},180))};i.useEffect(()=>{if(z){Se(!1),He(!0);const t=requestAnimationFrame(()=>He(!1));return()=>cancelAnimationFrame(t)}},[z]),i.useEffect(()=>{if(!z)return;const t=l=>{ve.current&&!ve.current.contains(l.target)&&Ee()},s=l=>{l.key==="Escape"&&Ee()};return document.addEventListener("mousedown",t),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",s)}},[z]);const xt=z&&M==="day"?_t.createPortal(e.jsx("div",{ref:ve,className:b("fixed right-4 w-[400px] max-h-[82vh] flex flex-col rounded-lg overflow-hidden shadow-lg border z-[2500]","transition-all duration-200 ease-out will-change-transform will-change-opacity origin-top",ft||$e?"opacity-0 translate-y-2 scale-[0.97]":"opacity-100 translate-y-0 scale-100"),style:{top:Oe+et+14},children:(()=>{const t=z,s=Bt(t),l=h(U(t.date),"PPP"),a=(t.start?h(U("2020-01-01T"+t.start),"h:mm a"):"")+(t.end?" – "+h(U("2020-01-01T"+t.end),"h:mm a"):(t.start,"")),c=t.description&&t.description.trim()||"—";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 flex items-start gap-3",style:{background:s.base,borderBottom:`1px solid ${s.border}`,color:s.text},children:[e.jsx("div",{className:"mt-0.5 shrink-0",children:t.defense?e.jsx(oe,{className:"h-5 w-5",style:{color:s.text}}):e.jsx(kt,{className:"h-5 w-5",style:{color:s.text}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"font-semibold text-sm leading-snug pr-6",style:{color:s.text},title:t.title,children:t.title}),e.jsxs("div",{className:"text-[11px] font-medium mt-0.5",style:{color:s.subText},children:[l,a&&" • "+a]})]}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7 -m-1",onClick:Ee,children:e.jsx(Tt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-white",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:t.defense?"Defense Details":"Event Details"}),e.jsxs("dl",{className:"grid grid-cols-3 gap-x-2 gap-y-1 text-[11px]",children:[e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Date"}),e.jsx("dd",{className:"col-span-2",children:l}),e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Time"}),e.jsx("dd",{className:"col-span-2",children:a||"—"}),t.defense&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Student"}),e.jsx("dd",{className:"col-span-2",children:t.raw.student_name||"—"}),e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Program"}),e.jsx("dd",{className:"col-span-2",children:t.raw.program||"—"}),e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Type"}),e.jsx("dd",{className:"col-span-2 uppercase",children:t.raw.defense_type||"—"}),e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Mode"}),e.jsx("dd",{className:"col-span-2",children:t.raw.defense_mode||"—"}),e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Venue"}),e.jsx("dd",{className:"col-span-2",children:t.raw.defense_venue||"—"})]}),e.jsx("dt",{className:"font-medium text-muted-foreground",children:"Description"}),e.jsx("dd",{className:"col-span-2 whitespace-pre-wrap",children:c})]})]})})})]})})()}),document.body):null;i.useEffect(()=>{p&&(q(!0),ce(p.title),Ie(p.date),he(!1),me(p.start?p.start.slice(0,5):"08:00"),ue(p.end?p.end.slice(0,5):p.start?p.start.slice(0,5):"09:00"),fe(p.description||""),ge(p.color||"#10b981"))},[p]),i.useEffect(()=>{!T&&!p&&(ce(""),fe(""),he(!1),me("08:00"),ue("09:00"),ge("#10b981")),!T&&p&&Q(null)},[T,p]);const gt=()=>{try{const t=[...je].slice().sort((o,f)=>o.date===f.date?(o.start||"23:59").localeCompare(f.start||"23:59"):o.date.localeCompare(f.date)),s=o=>(o||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l=t.map(o=>{const f=h(U(o.date),"MMM d, yyyy"),y=(o.start?h(U("2020-01-01T"+o.start),"h:mm a"):"")+(o.end?" – "+h(U("2020-01-01T"+o.end),"h:mm a"):"");return`<tr>
          <td>${s(f)}</td>
          <td>${s(y)}</td>
          <td>${s(o.title)}</td>
          <td>${s(o.raw.student_name||"—")}</td>
          <td>${s(o.raw.program||"—")}</td>
          <td>${s(o.raw.defense_type||"—")}</td>
          <td>${s(o.raw.defense_venue||o.raw.defense_mode||"—")}</td>
        </tr>`}).join("")||'<tr><td colspan="7" style="text-align:center;padding:16px;color:#666;">No scheduled defenses.</td></tr>',a=`<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Schedules Print</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  * { box-sizing:border-box; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; }
  body { margin:24px; color:#111; }
  h1 { margin:0 0 16px; font-size:20px; }
  table { border-collapse:collapse; width:100%; font-size:12px; }
  thead th { background:#f1f5f9; text-align:left; padding:6px 8px; font-weight:600; border:1px solid #dbe1e6; }
  td { padding:6px 8px; border:1px solid #e2e8f0; vertical-align:top; }
  tbody tr:nth-child(even) { background:#fafafa; }
  @media print { body { margin:8px 16px; } }
</style>
</head>
<body>
<h1>Schedules (${t.length})</h1>
<table>
  <thead>
    <tr>
      <th>Date</th><th>Time</th><th>Title</th><th>Student</th><th>Program</th><th>Type</th><th>Venue / Mode</th>
    </tr>
  </thead>
  <tbody>${l}</tbody>
</table>
<script>window.addEventListener('load',()=>{setTimeout(()=>window.print(),120);});<\/script>
</body>
</html>`,c=new Blob([a],{type:"text/html"}),n=URL.createObjectURL(c);if(!window.open(n,"_blank")){alert("Pop-up blocked. Allow pop-ups to print."),URL.revokeObjectURL(n);return}setTimeout(()=>URL.revokeObjectURL(n),5e3)}catch(t){console.error("Print failed",t),alert("Print failed.")}};return e.jsxs(wt,{breadcrumbs:Pt,children:[e.jsx(yt,{title:"Schedules"}),e.jsxs("div",{className:"flex flex-col gap-0",children:[e.jsxs("div",{className:b("flex flex-wrap items-center gap-2 w-full bg-white border rounded-md rounded-b-none px-3 py-2 sticky z-50","shadow-sm"),style:{top:Oe},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{size:"icon",variant:"outline",onClick:dt,children:e.jsx(At,{className:"h-4 w-4"})}),e.jsx(k,{size:"icon",variant:"outline",onClick:ct,children:e.jsx(Ot,{className:"h-4 w-4"})}),e.jsx(k,{variant:"outline",onClick:mt,children:"Today"})]}),e.jsx("div",{className:"inline-flex rounded-md border overflow-hidden h-8",children:["day","week","month"].map(t=>e.jsx("button",{type:"button",onClick:()=>$(t),className:b("px-3 text-xs font-medium uppercase tracking-wide transition-colors focus:outline-none",M===t?"bg-primary text-white":"bg-white hover:bg-muted/60 text-muted-foreground"),children:t},t))}),M==="month"&&e.jsxs(e.Fragment,{children:[e.jsxs(ze,{value:String(x.getMonth()),onValueChange:t=>{const s=new Date(x);s.setMonth(Number(t)),_(s)},children:[e.jsx(Fe,{className:"w-[130px] h-8",children:e.jsx(Ue,{children:Ke[x.getMonth()]})}),e.jsx(Ye,{children:Ke.map((t,s)=>e.jsx(Be,{value:String(s),children:t},t))})]}),e.jsxs(ze,{value:String(x.getFullYear()),onValueChange:t=>{const s=new Date(x);s.setFullYear(Number(t)),_(s)},children:[e.jsx(Fe,{className:"w-[100px] h-8",children:e.jsx(Ue,{children:x.getFullYear()})}),e.jsx(Ye,{children:Ht.map(t=>e.jsx(Be,{value:String(t),children:t},t))})]})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx(k,{type:"button",size:"icon",variant:"outline",onClick:gt,title:"Print schedules",children:e.jsx(It,{className:"h-4 w-4"})}),e.jsxs(Nt,{open:T,onOpenChange:t=>{q(t),t||H(null)},children:[e.jsx(vt,{asChild:!0,children:e.jsx(k,{size:"sm",children:ae?"Edit Event":"Add Event"})}),e.jsxs(Mt,{className:"sm:max-w-md",children:[e.jsx(St,{children:e.jsx(Et,{className:"text-sm font-semibold",children:ae?"Edit Event":"Create Event"})}),e.jsxs("div",{className:"space-y-3 py-1",children:[Le&&e.jsx("div",{className:"text-[11px] text-red-600 bg-red-50 border border-red-200 px-2 py-1 rounded",children:Le}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(F,{className:"text-xs",children:"Title"}),e.jsx(We,{rows:2,value:J,onChange:t=>ce(t.target.value),placeholder:"Event title",className:"text-xs resize-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 grid gap-1",children:[e.jsx(F,{className:"text-xs",children:"Date"}),e.jsx("input",{type:"date",value:A,onChange:t=>Ie(t.target.value),className:"h-8 text-xs border rounded-md px-2"})]}),e.jsxs("div",{className:"grid gap-1 w-28",children:[e.jsx(F,{className:"text-xs",children:"All Day"}),e.jsxs("div",{className:"h-8 px-2 flex items-center gap-2 border rounded-md",children:[e.jsx(Dt,{checked:O,onCheckedChange:t=>he(!!t)}),e.jsx("span",{className:"text-[11px]",children:"Yes"})]})]})]}),!O&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"grid gap-1 flex-1",children:[e.jsx(F,{className:"text-xs",children:"Start"}),e.jsx("input",{type:"time",step:300,value:te,onChange:t=>me(t.target.value),className:"h-8 text-xs border rounded-md px-2"})]}),e.jsxs("div",{className:"grid gap-1 flex-1",children:[e.jsx(F,{className:"text-xs",children:"End"}),e.jsx("input",{type:"time",step:300,value:se,onChange:t=>ue(t.target.value),className:"h-8 text-xs border rounded-md px-2"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(F,{className:"text-xs",children:"Description (optional)"}),e.jsx(We,{value:pe,onChange:t=>fe(t.target.value),rows:3,className:"text-xs resize-none",placeholder:"Short description..."})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(F,{className:"text-xs",children:"Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:tt.map(t=>e.jsx("button",{type:"button",onClick:()=>ge(t),className:b("w-6 h-6 rounded-full ring-2 transition",xe===t?"ring-black scale-110":"ring-transparent hover:ring-gray-400"),style:{backgroundColor:t},"aria-label":`Choose ${t}`},t))})]})]}),e.jsxs(Ct,{className:"gap-2",children:[ae&&e.jsxs(k,{type:"button",variant:"destructive",size:"sm",onClick:async()=>{if(p&&confirm("Delete this event?")){ee(!0);try{const t=Ze();if(!(await fetch(`/api/calendar/events/${p.raw.id}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":t}})).ok)throw new Error("Delete failed");E(l=>l.filter(a=>a.raw.id!==p.raw.id)),q(!1),Q(null)}catch(t){H(t.message||"Delete failed")}finally{ee(!1)}}},children:[e.jsx(Lt,{className:"h-4 w-4 mr-1"})," Delete"]}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>q(!1),disabled:de,children:"Cancel"}),e.jsx(k,{size:"sm",onClick:async()=>{if(!J.trim()){H("Title required.");return}if(!A){H("Date required.");return}if(!O&&se<=te){H("End must be after start.");return}H(null),ee(!0);try{const t=Ze(),s={title:J.trim(),description:pe.trim()||null,start:O?`${A} 00:00:00`:`${A} ${te}:00`,end:O?`${A} 23:59:59`:`${A} ${se}:00`,allDay:O,color:xe};let l;if(ae&&p?l=await fetch(`/api/calendar/events/${p.raw.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t},body:JSON.stringify(s)}):l=await fetch("/api/calendar/events",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t},body:JSON.stringify(s)}),!l.ok){const o=await l.json().catch(()=>({}));throw new Error(o.message||o.error||"Save failed")}const c=(await l.json().catch(()=>({}))).event_id||p&&p.raw.id,n=O?"00:00":te,r=O?"23:59":se;E(o=>{const f=o.filter(W=>W.raw.id!==c),y={id:"ev-"+c,title:J.trim(),date:A,start:n,end:r,raw:{id:c,thesis_title:J.trim(),date_of_defense:A,start_time:n,end_time:r,defense_type:void 0,defense_mode:void 0,defense_venue:void 0,program:void 0,student_name:void 0},color:xe,defense:!1,description:pe.trim()};return[...f,y]}),q(!1),Q(null)}catch(t){H(t.message||"Error")}finally{ee(!1)}},disabled:de,children:de?"Saving...":"Save Event"})]})]})]})]})]}),M==="month"&&ut(),M==="week"&&ht(),M==="day"&&pt(),xt,!1]})]})}export{Us as default};
