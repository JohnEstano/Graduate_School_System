import{r as n,j as e}from"./app-OOvd0qGy.js";import{C as h,c as u,a as N,b as w}from"./card-CMDgN0i6.js";import{S as k,a as z,b as _,c as E,e as R}from"./select-Bb-LA2Y0.js";import{T as P,a as I,b as y,c as r,d as H,e as a}from"./table-CmM6ti-o.js";import{S as o}from"./skeleton-bTWQssEl.js";import{c as M}from"./createLucideIcon-Cvkj7Hkp.js";import{P as W}from"./printer-wZNaoGBe.js";import"./utils-jAU0Cazi.js";import"./index-DQ9rqnvl.js";import"./index-DcZRhvrv.js";import"./index-kQq3evoo.js";import"./index-C9drr0Qb.js";import"./index-B9sjBiRz.js";import"./floating-ui.react-dom-BrG2AUyT.js";import"./index-C7ezi2Q7.js";import"./index-DnomuSoJ.js";import"./index-4w5oLsoB.js";import"./chevron-down-CgfVHQYn.js";import"./check-CihXD7iu.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],L=M("RefreshCw",A),re=()=>{const[d,j]=n.useState(!0),[m,p]=n.useState(null),[l,v]=n.useState(null),[i,S]=n.useState(void 0),f=n.useRef(null),[b,C]=n.useState(180),x=()=>{j(!0),p(null);const t="/legacy/academic-records"+(i?`?semester_id=${i}`:"");fetch(t,{headers:{Accept:"application/json"}}).then(async s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);const c=await s.json();v(c.data)}).catch(s=>p(s.message)).finally(()=>j(!1))};n.useEffect(()=>{x()},[]),n.useEffect(()=>{i!==void 0&&x()},[i]);const T=()=>{const t=document.getElementById("academic-records-table");if(!t)return;const s=window.open("","","width=900,height=600");s&&(s.document.write("<html><head><title>Print Academic Records</title>"),s.document.write("<style>table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ccc;padding:6px;text-align:center;}th{text-align:center;}body{font-family:sans-serif;}</style>"),s.document.write("</head><body>"),s.document.write(t.outerHTML),s.document.write("</body></html>"),s.document.close(),s.focus(),s.print())};return n.useEffect(()=>{if(f.current&&(l!=null&&l.semesters)){const t=l.semesters.reduce((c,g)=>c.label.length>g.label.length?c:g,{label:""}),s=document.createElement("span");s.style.visibility="hidden",s.style.position="absolute",s.style.fontSize="16px",s.style.fontWeight="400",s.style.padding="8px",s.innerText=t.label||"Select semester",document.body.appendChild(s),C(s.offsetWidth+40),document.body.removeChild(s)}},[l==null?void 0:l.semesters]),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-auto bg-white dark:bg-background",children:d?e.jsxs("div",{className:"w-full min-h-[70vh] bg-zinc-100 dark:bg-zinc-900 flex flex-col gap-4 p-0 m-0",children:[e.jsx(o,{className:"h-6 w-1/6 rounded bg-zinc-300 dark:bg-zinc-800 mt-8 mx-8"}),e.jsx(o,{className:"h-12 w-3/4 rounded bg-zinc-300 dark:bg-zinc-800 mx-8"}),e.jsx(o,{className:"h-12 w-2/3 rounded bg-zinc-300 dark:bg-zinc-800 mx-8"}),e.jsx(o,{className:"h-[500px] w-full rounded bg-zinc-300 dark:bg-zinc-800 mt-4"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"px-3 py-2 rounded border flex items-center gap-2 disabled:opacity-50",disabled:d,title:"Reload",children:e.jsx(L,{size:18,className:d?"animate-spin":""})}),e.jsx("button",{onClick:T,className:"px-3 py-2 rounded border flex items-center gap-2",title:"Print Table",disabled:d,children:e.jsx(W,{size:18})})]})}),m&&e.jsx(h,{className:"rounded-xl border mb-4 shadow-none",children:e.jsxs(u,{className:"bg-red-50 text-red-700",children:["Failed to load: ",m," — try logging out/in if session expired."]})}),!d&&!m&&l&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{className:"rounded-xl border mb-4 shadow-none w-full",children:[e.jsx(N,{children:e.jsx(w,{children:"Student Information & Semester"})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium text-gray-500 mb-2",children:"Student"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"School ID:"})," ",l.student.student_number||"—"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",l.student.name||"—"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Program:"})," ",l.student.program||"—"]}),l.gwa&&e.jsxs("p",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"GWA:"})," ",l.gwa]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-500 mb-2",children:"Semester"}),e.jsx("div",{ref:f,style:{width:b},children:e.jsxs(k,{value:i??l.current_semester_id??"",onValueChange:t=>S(t),children:[e.jsx(z,{className:"w-full bg-gray-100 border rounded",style:{width:b},children:e.jsx(_,{placeholder:"Select semester"})}),e.jsx(E,{children:l.semesters.map(t=>e.jsx(R,{value:t.id,children:t.label},t.id))})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Select a semester to reload real grades."})]})]})]}),e.jsxs(h,{className:"rounded-xl border shadow-none w-full",children:[e.jsx(N,{children:e.jsx(w,{children:"Courses"})}),e.jsxs(u,{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 w-full",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Courses"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[l.records.length," rows"]})]}),l.records.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No records returned for this semester."}):e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs(P,{id:"academic-records-table",children:[e.jsx(I,{children:e.jsxs(y,{children:[e.jsx(r,{children:"Code"}),e.jsx(r,{children:"Title"}),e.jsx(r,{children:"Units"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Prelim"}),e.jsx(r,{children:"Midterm"}),e.jsx(r,{children:"Finals"}),e.jsx(r,{children:"Average"}),e.jsx(r,{children:"Units Earned"}),e.jsx(r,{children:"Section"})]})}),e.jsx(H,{children:l.records.map((t,s)=>{const c=t.average||t.average_var||"";return e.jsxs(y,{className:"hover:bg-gray-50",children:[e.jsx(a,{children:t.code}),e.jsx(a,{children:t.title}),e.jsx(a,{className:"text-center",children:t.units}),e.jsx(a,{className:"text-center",children:t.course_type}),e.jsx(a,{className:"text-center",children:t.prelim}),e.jsx(a,{className:"text-center",children:t.midterm}),e.jsx(a,{className:"text-center",children:t.finals}),e.jsxs(a,{className:"text-center",children:[c,c&&t.units_earned!==null?` / ${t.units_earned}`:""]}),e.jsx(a,{className:"text-center",children:t.units_earned}),e.jsx(a,{className:"text-center",children:t.section})]},s)})})]})})]})]})]})]})})};export{re as default};
