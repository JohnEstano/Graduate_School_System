import{r as i,j as e}from"./app-BDkuJsct.js";import{C,c as k}from"./card-BJFJPDio.js";import{S,a as b,b as v,c as D,e as m}from"./select-D1tIJaem.js";import{R as A}from"./generateCategoricalChart-BOHwT1p9.js";import{A as N,a as E}from"./AreaChart-D-ENoPw9.js";import"./utils-jAU0Cazi.js";import"./index-BhbofC_p.js";import"./index-DMsjTEK4.js";import"./index-BdhkuEJx.js";import"./index-BKBXBDOv.js";import"./index-LRezjsDo.js";import"./floating-ui.react-dom-w0Q93DA2.js";import"./index-Dia2ik6c.js";import"./index-D-bfryUZ.js";import"./chevron-down-DMxaecxw.js";import"./createLucideIcon-CEmaZ7tj.js";import"./check-BUlQxyEc.js";import"./index-CoS1vLG5.js";import"./index-Chjiymov.js";import"./YAxis-B7UrdJFR.js";function Z(){const[c,u]=i.useState("month"),[x,h]=i.useState([]),[T,g]=i.useState(!0),[j,w]=i.useState(0),[f,y]=i.useState(0);return i.useEffect(()=>{fetch("/defense-requests",{headers:{Accept:"application/json"}}).then(n=>{if(!n.ok)throw new Error("Failed to fetch");return n.json()}).then(n=>{const d=(Array.isArray(n)?n:n.defenseRequests??[]).filter(t=>t.scheduled_date!==null);w(d.length);let r=[];if(c==="week"){const t={},s=new Date,o=new Date(s.getTime()-28*24*60*60*1e3);d.forEach(l=>{const a=new Date(l.scheduled_date);if(a>=o){const p=`Week ${4-Math.floor((s.getTime()-a.getTime())/6048e5)}`;t[p]=(t[p]||0)+1}}),r=Array.from({length:4},(l,a)=>({label:`Week ${a+1}`,defenses:t[`Week ${a+1}`]||0}))}else if(c==="month"){const t={};d.forEach(o=>{const a=new Date(o.scheduled_date).toLocaleDateString("en-US",{month:"short"});t[a]=(t[a]||0)+1}),r=Object.keys(t).slice(-6).map(o=>({label:o,defenses:t[o]}))}else if(c==="year"){const t={};d.forEach(s=>{const l=new Date(s.scheduled_date).getFullYear().toString();t[l]=(t[l]||0)+1}),r=Object.entries(t).sort(([s],[o])=>s.localeCompare(o)).slice(-5).map(([s,o])=>({label:s,defenses:o}))}if(h(r),r.length>1){const t=r[r.length-1].defenses,s=r[r.length-2].defenses,o=s>0?(t-s)/s*100:0;y(Number(o.toFixed(1)))}}).catch(n=>{console.error("Error fetching defense requests:",n),h([])}).finally(()=>{g(!1)})},[c]),e.jsxs(C,{className:"col-span-1 rounded-xl shadow-none border flex flex-col justify-between p-0 min-h-[220px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 pt-5",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total Defenses Scheduled"}),e.jsxs(S,{value:c,onValueChange:u,children:[e.jsx(b,{className:"w-[120px] h-8 text-xs",children:e.jsx(v,{})}),e.jsxs(D,{children:[e.jsx(m,{value:"week",children:"Weekly"}),e.jsx(m,{value:"month",children:"Monthly"}),e.jsx(m,{value:"year",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"px-6",children:[e.jsx("div",{className:"text-3xl font-bold leading-tight",children:j}),e.jsxs("div",{className:"text-sm mt-1 mb-2 text-muted-foreground",children:[f>=0?"+":"",f,"% from previous period"]})]}),e.jsx(k,{className:"flex-1 flex items-end w-full p-0",children:e.jsx("div",{className:"w-full h-[90px]",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(N,{data:x,margin:{left:0,right:0,top:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"roseArea",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#e11d48",stopOpacity:.16}),e.jsx("stop",{offset:"100%",stopColor:"#e11d48",stopOpacity:.06})]})}),e.jsx(E,{type:"monotone",dataKey:"defenses",stroke:"#e11d48",fill:"url(#roseArea)",strokeWidth:2,dot:{fill:"#e11d48",r:3},isAnimationActive:!0,animationDuration:900})]})})})})]})}export{Z as default};
